
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://bayareametro.github.io/tm2py/add-force-of-mock/api/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.6">
    
    
      
        <title>API Documentation - Travel Model Two Python Package: tm2py</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Travel Model Two Python Package: tm2py" class="md-header__button md-logo" aria-label="Travel Model Two Python Package: tm2py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Travel Model Two Python Package: tm2py
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Documentation
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bayareametro/tm2py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      API Documentation
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../architecture/" class="md-tabs__link">
      Architecture
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/development/" class="md-tabs__link">
        Contributing
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../examples/" class="md-tabs__link">
        Examples
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Travel Model Two Python Package: tm2py" class="md-nav__button md-logo" aria-label="Travel Model Two Python Package: tm2py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Travel Model Two Python Package: tm2py
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bayareametro/tm2py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API Documentation
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
    <nav class="md-nav" aria-label="Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller" class="md-nav__link">
    controller
  </a>
  
    <nav class="md-nav" aria-label="controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController" class="md-nav__link">
    RunController
  </a>
  
    <nav class="md-nav" aria-label="RunController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__repr__" class="md-nav__link">
    __repr__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component" class="md-nav__link">
    component()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component_name" class="md-nav__link">
    component_name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.emme_manager" class="md-nav__link">
    emme_manager()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.get_abs_path" class="md-nav__link">
    get_abs_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iter_component" class="md-nav__link">
    iter_component()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iteration" class="md-nav__link">
    iteration()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.num_processors" class="md-nav__link">
    num_processors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_dir" class="md-nav__link">
    run_dir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_iterations" class="md-nav__link">
    run_iterations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_next" class="md-nav__link">
    run_next()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.time_period_names" class="md-nav__link">
    time_period_names()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config" class="md-nav__link">
    config
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="md-nav__link">
    ActiveModeShortestPathSkimConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModesConfig" class="md-nav__link">
    ActiveModesConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig" class="md-nav__link">
    AirPassengerConfig
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig.valid_input_demand_filename_tmpl" class="md-nav__link">
    valid_input_demand_filename_tmpl()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    AirPassengerDemandAggregationConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ChoiceClassConfig" class="md-nav__link">
    ChoiceClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.CoefficientConfig" class="md-nav__link">
    CoefficientConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem" class="md-nav__link">
    ConfigItem
  </a>
  
    <nav class="md-nav" aria-label="ConfigItem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.__getitem__" class="md-nav__link">
    __getitem__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.items" class="md-nav__link">
    items()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.load_toml" class="md-nav__link">
    load_toml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.maz_skim_period_exists" class="md-nav__link">
    maz_skim_period_exists()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    DemandCountyGroupConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    EmmeConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayCapClassConfig" class="md-nav__link">
    HighwayCapClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    HighwayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassDemandConfig" class="md-nav__link">
    HighwayClassDemandConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    HighwayConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="md-nav__link">
    valid_skim_matrix_name_template()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_template" class="md-nav__link">
    valid_skim_template()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    HighwayMazToMazConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    HighwayTollsConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    HouseholdConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ImpedanceConfig" class="md-nav__link">
    ImpedanceConfig
  </a>
  
    <nav class="md-nav" aria-label="ImpedanceConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ImpedanceConfig.sums_to_one" class="md-nav__link">
    sums_to_one()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    InternalExternalConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.LoggingConfig" class="md-nav__link">
    LoggingConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.MatrixFactorConfig" class="md-nav__link">
    MatrixFactorConfig
  </a>
  
    <nav class="md-nav" aria-label="MatrixFactorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.MatrixFactorConfig.valid_zone_index" class="md-nav__link">
    valid_zone_index()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig" class="md-nav__link">
    RunConfig
  </a>
  
    <nav class="md-nav" aria-label="RunConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="md-nav__link">
    end_iteration_gt_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.start_component_used" class="md-nav__link">
    start_component_used()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ScenarioConfig" class="md-nav__link">
    ScenarioConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDayClassConfig" class="md-nav__link">
    TimeOfDayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDayConfig" class="md-nav__link">
    TimeOfDayConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimePeriodConfig" class="md-nav__link">
    TimePeriodConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimeSplitConfig" class="md-nav__link">
    TimeSplitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TollChoiceConfig" class="md-nav__link">
    TollChoiceConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    TransitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    TransitModeConfig
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitVehicleConfig" class="md-nav__link">
    TransitVehicleConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripDistributionClassConfig" class="md-nav__link">
    TripDistributionClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripDistributionConfig" class="md-nav__link">
    TripDistributionConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationClassConfig" class="md-nav__link">
    TripGenerationClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationConfig" class="md-nav__link">
    TripGenerationConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationFormulaConfig" class="md-nav__link">
    TripGenerationFormulaConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckClassConfig" class="md-nav__link">
    TruckClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    TruckConfig
  </a>
  
    <nav class="md-nav" aria-label="TruckConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig.outfile_trip_table_tmp" class="md-nav__link">
    outfile_trip_table_tmp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-component" class="md-nav__link">
    Base Component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component" class="md-nav__link">
    component
  </a>
  
    <nav class="md-nav" aria-label="component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component" class="md-nav__link">
    Component
  </a>
  
    <nav class="md-nav" aria-label="Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.controller" class="md-nav__link">
    controller()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_abs_path" class="md-nav__link">
    get_abs_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_emme_scenario" class="md-nav__link">
    get_emme_scenario()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.logger" class="md-nav__link">
    logger()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.report_progress" class="md-nav__link">
    report_progress()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.time_period_names" class="md-nav__link">
    time_period_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.top_sheet" class="md-nav__link">
    top_sheet()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.trace" class="md-nav__link">
    trace()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.verify" class="md-nav__link">
    verify()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.write_top_sheet" class="md-nav__link">
    write_top_sheet()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError" class="md-nav__link">
    FileFormatError
  </a>
  
    <nav class="md-nav" aria-label="FileFormatError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent" class="md-nav__link">
    Subcomponent
  </a>
  
    <nav class="md-nav" aria-label="Subcomponent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demand-components" class="md-nav__link">
    Demand Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand" class="md-nav__link">
    prepare_demand
  </a>
  
    <nav class="md-nav" aria-label="prepare_demand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareDemand" class="md-nav__link">
    PrepareDemand
  </a>
  
    <nav class="md-nav" aria-label="PrepareDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand" class="md-nav__link">
    PrepareHighwayDemand
  </a>
  
    <nav class="md-nav" aria-label="PrepareHighwayDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#household-demand" class="md-nav__link">
    Household Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household" class="md-nav__link">
    household
  </a>
  
    <nav class="md-nav" aria-label="household">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel" class="md-nav__link">
    HouseholdModel
  </a>
  
    <nav class="md-nav" aria-label="HouseholdModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    HouseholdConfig
  </a>
  
    <nav class="md-nav" aria-label="HouseholdConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#air-passenger-demand" class="md-nav__link">
    Air Passenger Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger" class="md-nav__link">
    air_passenger
  </a>
  
    <nav class="md-nav" aria-label="air_passenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger" class="md-nav__link">
    AirPassenger
  </a>
  
    <nav class="md-nav" aria-label="AirPassenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    AirPassengerDemandAggregationConfig
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerDemandAggregationConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commercial-demand" class="md-nav__link">
    Commercial Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial" class="md-nav__link">
    commercial
  </a>
  
    <nav class="md-nav" aria-label="commercial">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="md-nav__link">
    CommercialVehicleModel
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emme_scenario" class="md-nav__link">
    emme_scenario()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emmebank" class="md-nav__link">
    emmebank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.matrix_cache" class="md-nav__link">
    matrix_cache()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay" class="md-nav__link">
    CommercialVehicleTimeOfDay
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTimeOfDay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.class_period_splits" class="md-nav__link">
    class_period_splits()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run" class="md-nav__link">
    run()
  </a>
  
    <nav class="md-nav" aria-label="run()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run--todo-use-timeperiodsplit" class="md-nav__link">
    TODO use TimePeriodSplit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice" class="md-nav__link">
    CommercialVehicleTollChoice
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTollChoice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution" class="md-nav__link">
    CommercialVehicleTripDistribution
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTripDistribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.blended_skims" class="md-nav__link">
    blended_skims()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factor_matrices" class="md-nav__link">
    friction_factor_matrices()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factors" class="md-nav__link">
    friction_factors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.k_factors" class="md-nav__link">
    k_factors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration" class="md-nav__link">
    CommercialVehicleTripGeneration
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTripGeneration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration--trip-generation" class="md-nav__link">
    Trip generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    TruckConfig
  </a>
  
    <nav class="md-nav" aria-label="TruckConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig.outfile_trip_table_tmp" class="md-nav__link">
    outfile_trip_table_tmp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inter-regional-demand" class="md-nav__link">
    Inter-regional Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external" class="md-nav__link">
    internal_external
  </a>
  
    <nav class="md-nav" aria-label="internal_external">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalDemand" class="md-nav__link">
    ExternalDemand
  </a>
  
    <nav class="md-nav" aria-label="ExternalDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice" class="md-nav__link">
    ExternalTollChoice
  </a>
  
    <nav class="md-nav" aria-label="ExternalTollChoice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice--toll-choice" class="md-nav__link">
    Toll choice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal" class="md-nav__link">
    InternalExternal
  </a>
  
    <nav class="md-nav" aria-label="InternalExternal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    InternalExternalConfig
  </a>
  
    <nav class="md-nav" aria-label="InternalExternalConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visitor-demand" class="md-nav__link">
    Visitor Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.visitor" class="md-nav__link">
    visitor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#highway-network-components" class="md-nav__link">
    Highway Network Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network" class="md-nav__link">
    highway_network
  </a>
  
    <nav class="md-nav" aria-label="highway_network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="md-nav__link">
    PrepareNetwork
  </a>
  
    <nav class="md-nav" aria-label="PrepareNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign" class="md-nav__link">
    highway_assign
  </a>
  
    <nav class="md-nav" aria-label="highway_assign">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass" class="md-nav__link">
    AssignmentClass
  </a>
  
    <nav class="md-nav" aria-label="AssignmentClass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_analysis_spec" class="md-nav__link">
    emme_analysis_spec()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_class_analysis" class="md-nav__link">
    emme_class_analysis()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_highway_class_spec" class="md-nav__link">
    emme_highway_class_spec()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_analysis_link_attribute" class="md-nav__link">
    skim_analysis_link_attribute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_matrices" class="md-nav__link">
    skim_matrices()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="md-nav__link">
    HighwayAssignment
  </a>
  
    <nav class="md-nav" aria-label="HighwayAssignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    HighwayConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="md-nav__link">
    valid_skim_matrix_name_template()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_template" class="md-nav__link">
    valid_skim_template()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    HighwayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    HighwayTollsConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    DemandCountyGroupConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz" class="md-nav__link">
    highway_maz
  </a>
  
    <nav class="md-nav" aria-label="highway_maz">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="md-nav__link">
    AssignMAZSPDemand
  </a>
  
    <nav class="md-nav" aria-label="AssignMAZSPDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="md-nav__link">
    SkimMAZCosts
  </a>
  
    <nav class="md-nav" aria-label="SkimMAZCosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    HighwayMazToMazConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transit-network-components" class="md-nav__link">
    Transit Network Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign" class="md-nav__link">
    transit_assign
  </a>
  
    <nav class="md-nav" aria-label="transit_assign">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="md-nav__link">
    TransitAssignment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim" class="md-nav__link">
    transit_skim
  </a>
  
    <nav class="md-nav" aria-label="transit_skim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="md-nav__link">
    TransitSkim
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    TransitModeConfig
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    TransitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-network-components" class="md-nav__link">
    Active Network Components
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emme-wrappers" class="md-nav__link">
    Emme Wrappers
  </a>
  
    <nav class="md-nav" aria-label="Emme Wrappers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme" class="md-nav__link">
    emme
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    EmmeConfig
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errata" class="md-nav__link">
    Errata
  </a>
  
    <nav class="md-nav" aria-label="Errata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache" class="md-nav__link">
    LogCache
  </a>
  
    <nav class="md-nav" aria-label="LogCache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.clear" class="md-nav__link">
    clear()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.write_cache" class="md-nav__link">
    write_cache()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay" class="md-nav__link">
    LogDisplay
  </a>
  
    <nav class="md-nav" aria-label="LogDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile" class="md-nav__link">
    LogFile
  </a>
  
    <nav class="md-nav" aria-label="LogFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride" class="md-nav__link">
    LogFileLevelOverride
  </a>
  
    <nav class="md-nav" aria-label="LogFileLevelOverride">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.level" class="md-nav__link">
    level()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter" class="md-nav__link">
    LogFormatter
  </a>
  
    <nav class="md-nav" aria-label="LogFormatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.decrease_indent" class="md-nav__link">
    decrease_indent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.increase_indent" class="md-nav__link">
    increase_indent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.level" class="md-nav__link">
    level()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd" class="md-nav__link">
    LogStartEnd
  </a>
  
    <nav class="md-nav" aria-label="LogStartEnd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger" class="md-nav__link">
    Logger
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__del__" class="md-nav__link">
    __del__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.clear_msg_cache" class="md-nav__link">
    clear_msg_cache()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.debug" class="md-nav__link">
    debug()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.debug_enabled" class="md-nav__link">
    debug_enabled()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.detail" class="md-nav__link">
    detail()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.error" class="md-nav__link">
    error()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.fatal" class="md-nav__link">
    fatal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.get_logger" class="md-nav__link">
    get_logger()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.info" class="md-nav__link">
    info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_dict" class="md-nav__link">
    log_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_start_end" class="md-nav__link">
    log_start_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.notify_slack" class="md-nav__link">
    notify_slack()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.status" class="md-nav__link">
    status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.trace" class="md-nav__link">
    trace()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.trace_enabled" class="md-nav__link">
    trace_enabled()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.warn" class="md-nav__link">
    warn()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier" class="md-nav__link">
    SlackNotifier
  </a>
  
    <nav class="md-nav" aria-label="SlackNotifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.post_message" class="md-nav__link">
    post_message()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools" class="md-nav__link">
    tools
  </a>
  
    <nav class="md-nav" aria-label="tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.download_unzip" class="md-nav__link">
    download_unzip()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.emme_context" class="md-nav__link">
    emme_context()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.interpolate_dfs" class="md-nav__link">
    interpolate_dfs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.mocked_inro_context" class="md-nav__link">
    mocked_inro_context()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.run_process" class="md-nav__link">
    run_process()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.temp_file" class="md-nav__link">
    temp_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.zonal_csv_to_matrices" class="md-nav__link">
    zonal_csv_to_matrices()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.examples" class="md-nav__link">
    examples
  </a>
  
    <nav class="md-nav" aria-label="examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.examples.get_example" class="md-nav__link">
    get_example()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contributing" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/development/" class="md-nav__link">
        Development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/documentation/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../examples/">Examples</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/restart_model/" class="md-nav__link">
        Restart Model Run
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/run_model/" class="md-nav__link">
        Run model
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
    <nav class="md-nav" aria-label="Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller" class="md-nav__link">
    controller
  </a>
  
    <nav class="md-nav" aria-label="controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController" class="md-nav__link">
    RunController
  </a>
  
    <nav class="md-nav" aria-label="RunController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__repr__" class="md-nav__link">
    __repr__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component" class="md-nav__link">
    component()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component_name" class="md-nav__link">
    component_name()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.emme_manager" class="md-nav__link">
    emme_manager()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.get_abs_path" class="md-nav__link">
    get_abs_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iter_component" class="md-nav__link">
    iter_component()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iteration" class="md-nav__link">
    iteration()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.num_processors" class="md-nav__link">
    num_processors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_dir" class="md-nav__link">
    run_dir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_iterations" class="md-nav__link">
    run_iterations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_next" class="md-nav__link">
    run_next()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.time_period_names" class="md-nav__link">
    time_period_names()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config" class="md-nav__link">
    config
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="md-nav__link">
    ActiveModeShortestPathSkimConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModesConfig" class="md-nav__link">
    ActiveModesConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig" class="md-nav__link">
    AirPassengerConfig
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig.valid_input_demand_filename_tmpl" class="md-nav__link">
    valid_input_demand_filename_tmpl()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    AirPassengerDemandAggregationConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ChoiceClassConfig" class="md-nav__link">
    ChoiceClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.CoefficientConfig" class="md-nav__link">
    CoefficientConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem" class="md-nav__link">
    ConfigItem
  </a>
  
    <nav class="md-nav" aria-label="ConfigItem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.__getitem__" class="md-nav__link">
    __getitem__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.items" class="md-nav__link">
    items()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.load_toml" class="md-nav__link">
    load_toml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.maz_skim_period_exists" class="md-nav__link">
    maz_skim_period_exists()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    DemandCountyGroupConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    EmmeConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayCapClassConfig" class="md-nav__link">
    HighwayCapClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    HighwayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassDemandConfig" class="md-nav__link">
    HighwayClassDemandConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    HighwayConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="md-nav__link">
    valid_skim_matrix_name_template()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_template" class="md-nav__link">
    valid_skim_template()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    HighwayMazToMazConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    HighwayTollsConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    HouseholdConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ImpedanceConfig" class="md-nav__link">
    ImpedanceConfig
  </a>
  
    <nav class="md-nav" aria-label="ImpedanceConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ImpedanceConfig.sums_to_one" class="md-nav__link">
    sums_to_one()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    InternalExternalConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.LoggingConfig" class="md-nav__link">
    LoggingConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.MatrixFactorConfig" class="md-nav__link">
    MatrixFactorConfig
  </a>
  
    <nav class="md-nav" aria-label="MatrixFactorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.MatrixFactorConfig.valid_zone_index" class="md-nav__link">
    valid_zone_index()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig" class="md-nav__link">
    RunConfig
  </a>
  
    <nav class="md-nav" aria-label="RunConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="md-nav__link">
    end_iteration_gt_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.start_component_used" class="md-nav__link">
    start_component_used()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ScenarioConfig" class="md-nav__link">
    ScenarioConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDayClassConfig" class="md-nav__link">
    TimeOfDayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDayConfig" class="md-nav__link">
    TimeOfDayConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimePeriodConfig" class="md-nav__link">
    TimePeriodConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimeSplitConfig" class="md-nav__link">
    TimeSplitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TollChoiceConfig" class="md-nav__link">
    TollChoiceConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    TransitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    TransitModeConfig
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitVehicleConfig" class="md-nav__link">
    TransitVehicleConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripDistributionClassConfig" class="md-nav__link">
    TripDistributionClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripDistributionConfig" class="md-nav__link">
    TripDistributionConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationClassConfig" class="md-nav__link">
    TripGenerationClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationConfig" class="md-nav__link">
    TripGenerationConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TripGenerationFormulaConfig" class="md-nav__link">
    TripGenerationFormulaConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckClassConfig" class="md-nav__link">
    TruckClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    TruckConfig
  </a>
  
    <nav class="md-nav" aria-label="TruckConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig.outfile_trip_table_tmp" class="md-nav__link">
    outfile_trip_table_tmp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-component" class="md-nav__link">
    Base Component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component" class="md-nav__link">
    component
  </a>
  
    <nav class="md-nav" aria-label="component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component" class="md-nav__link">
    Component
  </a>
  
    <nav class="md-nav" aria-label="Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.controller" class="md-nav__link">
    controller()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_abs_path" class="md-nav__link">
    get_abs_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_emme_scenario" class="md-nav__link">
    get_emme_scenario()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.logger" class="md-nav__link">
    logger()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.report_progress" class="md-nav__link">
    report_progress()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.time_period_names" class="md-nav__link">
    time_period_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.top_sheet" class="md-nav__link">
    top_sheet()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.trace" class="md-nav__link">
    trace()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.verify" class="md-nav__link">
    verify()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.write_top_sheet" class="md-nav__link">
    write_top_sheet()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError" class="md-nav__link">
    FileFormatError
  </a>
  
    <nav class="md-nav" aria-label="FileFormatError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent" class="md-nav__link">
    Subcomponent
  </a>
  
    <nav class="md-nav" aria-label="Subcomponent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Subcomponent.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demand-components" class="md-nav__link">
    Demand Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand" class="md-nav__link">
    prepare_demand
  </a>
  
    <nav class="md-nav" aria-label="prepare_demand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareDemand" class="md-nav__link">
    PrepareDemand
  </a>
  
    <nav class="md-nav" aria-label="PrepareDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand" class="md-nav__link">
    PrepareHighwayDemand
  </a>
  
    <nav class="md-nav" aria-label="PrepareHighwayDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#household-demand" class="md-nav__link">
    Household Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household" class="md-nav__link">
    household
  </a>
  
    <nav class="md-nav" aria-label="household">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel" class="md-nav__link">
    HouseholdModel
  </a>
  
    <nav class="md-nav" aria-label="HouseholdModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    HouseholdConfig
  </a>
  
    <nav class="md-nav" aria-label="HouseholdConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#air-passenger-demand" class="md-nav__link">
    Air Passenger Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger" class="md-nav__link">
    air_passenger
  </a>
  
    <nav class="md-nav" aria-label="air_passenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger" class="md-nav__link">
    AirPassenger
  </a>
  
    <nav class="md-nav" aria-label="AirPassenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    AirPassengerDemandAggregationConfig
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerDemandAggregationConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commercial-demand" class="md-nav__link">
    Commercial Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial" class="md-nav__link">
    commercial
  </a>
  
    <nav class="md-nav" aria-label="commercial">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="md-nav__link">
    CommercialVehicleModel
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emme_scenario" class="md-nav__link">
    emme_scenario()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emmebank" class="md-nav__link">
    emmebank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.matrix_cache" class="md-nav__link">
    matrix_cache()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay" class="md-nav__link">
    CommercialVehicleTimeOfDay
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTimeOfDay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.class_period_splits" class="md-nav__link">
    class_period_splits()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run" class="md-nav__link">
    run()
  </a>
  
    <nav class="md-nav" aria-label="run()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run--todo-use-timeperiodsplit" class="md-nav__link">
    TODO use TimePeriodSplit
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice" class="md-nav__link">
    CommercialVehicleTollChoice
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTollChoice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution" class="md-nav__link">
    CommercialVehicleTripDistribution
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTripDistribution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.blended_skims" class="md-nav__link">
    blended_skims()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factor_matrices" class="md-nav__link">
    friction_factor_matrices()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factors" class="md-nav__link">
    friction_factors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.k_factors" class="md-nav__link">
    k_factors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration" class="md-nav__link">
    CommercialVehicleTripGeneration
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleTripGeneration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration--trip-generation" class="md-nav__link">
    Trip generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    TruckConfig
  </a>
  
    <nav class="md-nav" aria-label="TruckConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig.outfile_trip_table_tmp" class="md-nav__link">
    outfile_trip_table_tmp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inter-regional-demand" class="md-nav__link">
    Inter-regional Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external" class="md-nav__link">
    internal_external
  </a>
  
    <nav class="md-nav" aria-label="internal_external">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalDemand" class="md-nav__link">
    ExternalDemand
  </a>
  
    <nav class="md-nav" aria-label="ExternalDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice" class="md-nav__link">
    ExternalTollChoice
  </a>
  
    <nav class="md-nav" aria-label="ExternalTollChoice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice--toll-choice" class="md-nav__link">
    Toll choice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.ExternalTollChoice.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal" class="md-nav__link">
    InternalExternal
  </a>
  
    <nav class="md-nav" aria-label="InternalExternal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    InternalExternalConfig
  </a>
  
    <nav class="md-nav" aria-label="InternalExternalConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visitor-demand" class="md-nav__link">
    Visitor Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.visitor" class="md-nav__link">
    visitor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#highway-network-components" class="md-nav__link">
    Highway Network Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network" class="md-nav__link">
    highway_network
  </a>
  
    <nav class="md-nav" aria-label="highway_network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="md-nav__link">
    PrepareNetwork
  </a>
  
    <nav class="md-nav" aria-label="PrepareNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign" class="md-nav__link">
    highway_assign
  </a>
  
    <nav class="md-nav" aria-label="highway_assign">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass" class="md-nav__link">
    AssignmentClass
  </a>
  
    <nav class="md-nav" aria-label="AssignmentClass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_analysis_spec" class="md-nav__link">
    emme_analysis_spec()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_class_analysis" class="md-nav__link">
    emme_class_analysis()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_highway_class_spec" class="md-nav__link">
    emme_highway_class_spec()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_analysis_link_attribute" class="md-nav__link">
    skim_analysis_link_attribute()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_matrices" class="md-nav__link">
    skim_matrices()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="md-nav__link">
    HighwayAssignment
  </a>
  
    <nav class="md-nav" aria-label="HighwayAssignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    HighwayConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="md-nav__link">
    valid_skim_matrix_name_template()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.valid_skim_template" class="md-nav__link">
    valid_skim_template()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    HighwayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    HighwayTollsConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    DemandCountyGroupConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz" class="md-nav__link">
    highway_maz
  </a>
  
    <nav class="md-nav" aria-label="highway_maz">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="md-nav__link">
    AssignMAZSPDemand
  </a>
  
    <nav class="md-nav" aria-label="AssignMAZSPDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="md-nav__link">
    SkimMAZCosts
  </a>
  
    <nav class="md-nav" aria-label="SkimMAZCosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    HighwayMazToMazConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transit-network-components" class="md-nav__link">
    Transit Network Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign" class="md-nav__link">
    transit_assign
  </a>
  
    <nav class="md-nav" aria-label="transit_assign">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="md-nav__link">
    TransitAssignment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim" class="md-nav__link">
    transit_skim
  </a>
  
    <nav class="md-nav" aria-label="transit_skim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="md-nav__link">
    TransitSkim
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    TransitModeConfig
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    TransitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-network-components" class="md-nav__link">
    Active Network Components
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emme-wrappers" class="md-nav__link">
    Emme Wrappers
  </a>
  
    <nav class="md-nav" aria-label="Emme Wrappers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme" class="md-nav__link">
    emme
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    EmmeConfig
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errata" class="md-nav__link">
    Errata
  </a>
  
    <nav class="md-nav" aria-label="Errata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache" class="md-nav__link">
    LogCache
  </a>
  
    <nav class="md-nav" aria-label="LogCache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.clear" class="md-nav__link">
    clear()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.write_cache" class="md-nav__link">
    write_cache()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay" class="md-nav__link">
    LogDisplay
  </a>
  
    <nav class="md-nav" aria-label="LogDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile" class="md-nav__link">
    LogFile
  </a>
  
    <nav class="md-nav" aria-label="LogFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride" class="md-nav__link">
    LogFileLevelOverride
  </a>
  
    <nav class="md-nav" aria-label="LogFileLevelOverride">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.level" class="md-nav__link">
    level()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter" class="md-nav__link">
    LogFormatter
  </a>
  
    <nav class="md-nav" aria-label="LogFormatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.decrease_indent" class="md-nav__link">
    decrease_indent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.increase_indent" class="md-nav__link">
    increase_indent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.level" class="md-nav__link">
    level()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd" class="md-nav__link">
    LogStartEnd
  </a>
  
    <nav class="md-nav" aria-label="LogStartEnd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger" class="md-nav__link">
    Logger
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__del__" class="md-nav__link">
    __del__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.clear_msg_cache" class="md-nav__link">
    clear_msg_cache()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.debug" class="md-nav__link">
    debug()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.debug_enabled" class="md-nav__link">
    debug_enabled()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.detail" class="md-nav__link">
    detail()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.error" class="md-nav__link">
    error()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.fatal" class="md-nav__link">
    fatal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.get_logger" class="md-nav__link">
    get_logger()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.info" class="md-nav__link">
    info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_dict" class="md-nav__link">
    log_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_start_end" class="md-nav__link">
    log_start_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.notify_slack" class="md-nav__link">
    notify_slack()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.status" class="md-nav__link">
    status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.trace" class="md-nav__link">
    trace()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.trace_enabled" class="md-nav__link">
    trace_enabled()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.warn" class="md-nav__link">
    warn()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier" class="md-nav__link">
    SlackNotifier
  </a>
  
    <nav class="md-nav" aria-label="SlackNotifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.post_message" class="md-nav__link">
    post_message()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools" class="md-nav__link">
    tools
  </a>
  
    <nav class="md-nav" aria-label="tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.download_unzip" class="md-nav__link">
    download_unzip()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.emme_context" class="md-nav__link">
    emme_context()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.interpolate_dfs" class="md-nav__link">
    interpolate_dfs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.mocked_inro_context" class="md-nav__link">
    mocked_inro_context()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.run_process" class="md-nav__link">
    run_process()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.temp_file" class="md-nav__link">
    temp_file()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.zonal_csv_to_matrices" class="md-nav__link">
    zonal_csv_to_matrices()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.examples" class="md-nav__link">
    examples
  </a>
  
    <nav class="md-nav" aria-label="examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.examples.get_example" class="md-nav__link">
    get_example()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/bayareametro/tm2py/edit/master/docs/api.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="api-documentation">API Documentation<a class="headerlink" href="#api-documentation" title="Permanent link"> ¶</a></h1>
<h2 id="controller">Controller<a class="headerlink" href="#controller" title="Permanent link"> ¶</a></h2>


<div class="doc doc-object doc-module">



<h3 id="tm2py.controller" class="doc doc-heading">
          <code>tm2py.controller</code>


<a href="#tm2py.controller" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>RunController - model operation controller.</p>
<p>Main interface to start a TM2PY model run. Provide one or more configuration
files in .toml format (by convention a scenario.toml and a model.toml)</p>
<p>Typical usage example:
  from tm2py.controller import RunController
  controller = RunController(
    [&ldquo;scenario.toml&rdquo;, &ldquo;model.toml&rdquo;])
  controller.run()</p>
<p>Or from the command-line:
  <code>python &lt;path&gt;/tm2py/tm2py/controller.py –s scenario.toml –m model.toml</code></p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.controller.RunController" class="doc doc-heading">
        <code>RunController</code>


<a href="#tm2py.controller.RunController" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">

  
      <p>Main operational interface for model runs.</p>
<p>Provide one or more config files in TOML (*.toml) format, and a run directory.
If the run directory is not provided the root directory of the first config_file is used.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>
<details class="internal-properties">
  <summary>Internal properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/controller.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RunController</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Main operational interface for model runs.</span>

<span class="sd">    Provide one or more config files in TOML (*.toml) format, and a run directory.</span>
<span class="sd">    If the run directory is not provided the root directory of the first config_file is used.</span>

<span class="sd">    Properties:</span>
<span class="sd">        config: root Configuration object</span>
<span class="sd">        logger: logger object</span>
<span class="sd">        top_sheet: placeholder for top sheet functionality (not implemented yet)</span>
<span class="sd">        trace: placeholder for trace functionality (not implemented yet)</span>
<span class="sd">        run_dir: root run directory for the model run</span>
<span class="sd">        iteration: current running (or last started) iteration</span>
<span class="sd">        component: current running (or last started) Component object</span>
<span class="sd">        emme_manager: EmmeManager object for centralized Emme-related (highway and</span>
<span class="sd">            transit assignments and skims) utilities.</span>
<span class="sd">        complete_components: list of components which have completed, tuple of</span>
<span class="sd">            (iteration, name, Component object)</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _emme_manager: EmmeManager object, cached on first access</span>
<span class="sd">        _iteration: current iteration</span>
<span class="sd">        _component: current running / last run Component</span>
<span class="sd">        _component_name: name of the current / last run component</span>
<span class="sd">        _queued_components: list of iteration, name, Component</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">config_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">run_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">run_components</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for RunController class.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_file: Single or list of config file locations as strings or Path objects.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            run_dir: Model run directory as a Path object or string. If not provided, defaults</span>
<span class="sd">                to the directory of the first config_file.</span>
<span class="sd">            run_components: List of component names to run. Defaults to all components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">run_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">run_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">run_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load_toml</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">emme_context</span><span class="p">()</span>
        <span class="c1"># NOTE: Logger opens log file on __enter__ (in run), not ready for logging yet</span>
        <span class="c1"># Logger uses self.config.logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_sheet</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># mapping from defined names referenced in config to Component objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">run_components</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_queue_components</span><span class="p">(</span><span class="n">run_components</span><span class="o">=</span><span class="n">run_components</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Legible representation.&quot;&quot;&quot;</span>
        <span class="n">_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;RunController</span>
<span class="s2">            Run Directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="s2"></span>
<span class="s2">            Iteration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_iterations</span><span class="si">}</span><span class="s2"></span>
<span class="s2">            Component: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">component_name</span><span class="si">}</span><span class="s2"></span>
<span class="s2">            Completed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="si">}</span><span class="s2"></span>
<span class="s2">            Queued: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_str</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">run_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The root run directory of the model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">run_iterations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;List of iterations for this model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_iteration</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return input time_period name or names and return list of time_period names.</span>

<span class="sd">        Implemented here for easy access for all components.</span>

<span class="sd">        Returns: list of uppercased string names of time periods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Number of processors available for parallel processing.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_num_processors</span><span class="p">(</span>
                <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Current iteration of model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">component_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Name of current component of model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iter_component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Tuple of the current iteration and component name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span>

    <span class="k">def</span> <span class="nf">component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Current component of model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeManager</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Cached Emme Manager object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init_emme_manager</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Emme not found, skipping Emme-related components&quot;</span><span class="p">)</span>
                <span class="c1"># TODO: All of the Emme-related components need to be handled &quot;in place&quot; rather</span>
                <span class="c1"># than skippping using a Mock</span>
                <span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">MagicMock</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span>

    <span class="k">def</span> <span class="nf">_init_emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize Emme manager, start Emme desktop App, and initialize Modeller.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="n">EmmeManager</span><span class="p">()</span>
        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span><span class="o">.</span><span class="n">project</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Initialize Modeller to use Emme assignment tools and other APIs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span><span class="o">.</span><span class="n">modeller</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the absolute path from the root run directory given a relative path.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Main interface to run model.</span>

<span class="sd">        Iterates through the self._queued_components and runs them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_next</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run next component in the queue.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No components in queue&quot;</span><span class="p">)</span>
        <span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">!=</span> <span class="n">iteration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">component</span>
        <span class="n">component</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_queue_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_components</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add components per iteration to queue according to input Config.</span>

<span class="sd">        Args:</span>
<span class="sd">            run_components: if provided, only run these components</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="s2">&quot;Components already queued, returning without re-queuing.&quot;</span>
            <span class="k">return</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RUN COMPOMENTS&quot;</span><span class="p">,</span> <span class="n">run_components</span><span class="p">)</span>
        <span class="n">_initial_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">initial_components</span>
        <span class="n">_global_iter_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">global_iteration_components</span>
        <span class="n">_final_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">final_components</span>

        <span class="k">if</span> <span class="n">run_components</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_initial_components</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_initial_components</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">run_components</span>
            <span class="p">]</span>
            <span class="n">_global_iter_components</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_global_iter_components</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">run_components</span>
            <span class="p">]</span>
            <span class="n">_final_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">_final_components</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">run_components</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_c_name</span> <span class="ow">in</span> <span class="n">_initial_components</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># Queue components which are run for each iteration</span>

        <span class="n">_iteration_x_components</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_iterations</span><span class="p">,</span> <span class="n">_global_iter_components</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_iteration</span><span class="p">,</span> <span class="n">_c_name</span> <span class="ow">in</span> <span class="n">_iteration_x_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="n">_iteration</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># Queue components which are run after final iteration</span>
        <span class="n">_finalizer_iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">c_name</span> <span class="ow">in</span> <span class="n">_final_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="n">_finalizer_iteration</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># If start_component specified, remove things before its first occurance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span><span class="p">:</span>

            <span class="n">_queued_c_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_queued_c_names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Start component </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span><span class="si">}</span><span class="s2"> not found in queued </span><span class="se">\</span>
<span class="s2">                    components </span><span class="si">{</span><span class="n">_queued_c_names</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">_start_c_index</span> <span class="o">=</span> <span class="n">_queued_c_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">[</span><span class="n">_start_c_index</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_add_component_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add component to queue (self._queued_components), first validating its inputs.</span>

<span class="sd">        Args:</span>
<span class="sd">            iteration (int): iteration to add component to.</span>
<span class="sd">            component_name (Component): Component to add to queue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">component_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span><span class="p">:</span>
            <span class="n">_component</span><span class="o">.</span><span class="n">validate_inputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">component_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iteration</span><span class="p">,</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">_component</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_calculate_num_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpu_processors</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert input value (parse if string) to number of processors.</span>

<span class="sd">        nt or string as &#39;MAX-X&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            cpu_processors (int): number of processors on current CPU</span>
<span class="sd">        Returns:</span>
<span class="sd">            An int of the number of processors to use</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: Input value exceeds number of available processors</span>
<span class="sd">            Exception: Input value less than 1 processors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_config_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">num_processors</span>
        <span class="n">num_processors</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_config_value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_config_value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
                <span class="n">num_processors</span> <span class="o">=</span> <span class="n">cpu_processors</span>
            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[0-9]+$&quot;</span><span class="p">,</span> <span class="n">_config_value</span><span class="p">):</span>
                <span class="n">num_processors</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_config_value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_processor_range</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^MAX[/s]*-[/s]*&quot;</span><span class="p">,</span> <span class="n">_config_value</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="n">num_processors</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cpu_processors</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">_processor_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_processors</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_config_value</span><span class="p">)</span>

        <span class="n">num_processors</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cpu_processors</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span>
        <span class="n">num_processors</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_processors</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">num_processors</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_components</span><span class="o">=</span><span class="n">component_cls_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></code>

<a href="#tm2py.controller.RunController.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for RunController class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>config_file</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.Collection">Collection</span>[<span title="typing.Union">Union</span>[str, <span title="pathlib.Path">Path</span>]], str, <span title="pathlib.Path">Path</span>]</code>
          </td>
          <td><p>Single or list of config file locations as strings or Path objects.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>run_dir</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, str]</code>
          </td>
          <td><p>Model run directory as a Path object or string. If not provided, defaults
to the directory of the first config_file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>run_components</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>List of component names to run. Defaults to all components.</p></td>
          <td>
                <code>component_cls_map.keys()</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">config_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">run_dir</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">run_components</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for RunController class.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file: Single or list of config file locations as strings or Path objects.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        run_dir: Model run directory as a Path object or string. If not provided, defaults</span>
<span class="sd">            to the directory of the first config_file.</span>
<span class="sd">        run_components: List of component names to run. Defaults to all components.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">run_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">run_dir</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load_toml</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">emme_context</span><span class="p">()</span>
    <span class="c1"># NOTE: Logger opens log file on __enter__ (in run), not ready for logging yet</span>
    <span class="c1"># Logger uses self.config.logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">top_sheet</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># mapping from defined names referenced in config to Component objects</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">run_components</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_queue_components</span><span class="p">(</span><span class="n">run_components</span><span class="o">=</span><span class="n">run_components</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.__repr__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

<a href="#tm2py.controller.RunController.__repr__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Legible representation.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Legible representation.&quot;&quot;&quot;</span>
    <span class="n">_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;RunController</span>
<span class="s2">        Run Directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        Iteration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">run_iterations</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        Component: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">component_name</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        Completed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="si">}</span><span class="s2"></span>
<span class="s2">        Queued: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_str</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.component" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">component</span><span class="p">()</span></code>

<a href="#tm2py.controller.RunController.component" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Current component of model.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Current component of model.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.component_name" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">component_name</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.component_name" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Name of current component of model run.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">component_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Name of current component of model run.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.emme_manager" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_manager</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.emme_manager" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Cached Emme Manager object.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Cached Emme Manager object.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_emme_manager</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Emme not found, skipping Emme-related components&quot;</span><span class="p">)</span>
            <span class="c1"># TODO: All of the Emme-related components need to be handled &quot;in place&quot; rather</span>
            <span class="c1"># than skippping using a Mock</span>
            <span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">MagicMock</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.get_abs_path" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_abs_path</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span></code>

<a href="#tm2py.controller.RunController.get_abs_path" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Get the absolute path from the root run directory given a relative path.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the absolute path from the root run directory given a relative path.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rel_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">rel_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rel_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.iter_component" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">iter_component</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.iter_component" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Tuple of the current iteration and component name.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">iter_component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Tuple of the current iteration and component name.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.iteration" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">iteration</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.iteration" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Current iteration of model run.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Current iteration of model run.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.num_processors" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">num_processors</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.num_processors" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Number of processors available for parallel processing.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">num_processors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Number of processors available for parallel processing.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_num_processors</span><span class="p">(</span>
            <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.controller.RunController.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Main interface to run model.</p>
<p>Iterates through the self._queued_components and runs them.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main interface to run model.</span>

<span class="sd">    Iterates through the self._queued_components and runs them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_next</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.run_dir" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run_dir</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.run_dir" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>The root run directory of the model run.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">run_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;The root run directory of the model run.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.run_iterations" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run_iterations</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.run_iterations" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>List of iterations for this model run.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">run_iterations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;List of iterations for this model run.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">range</span><span class="p">(</span>
        <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_iteration</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.run_next" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run_next</span><span class="p">()</span></code>

<a href="#tm2py.controller.RunController.run_next" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run next component in the queue.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run next component in the queue.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No components in queue&quot;</span><span class="p">)</span>
    <span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">!=</span> <span class="n">iteration</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">iteration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">component</span>
    <span class="n">component</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.controller.RunController.time_period_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">time_period_names</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.controller.RunController.time_period_names" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Return input time_period name or names and return list of time_period names.</p>
<p>Implemented here for easy access for all components.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/controller.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return input time_period name or names and return list of time_period names.</span>

<span class="sd">    Implemented here for easy access for all components.</span>

<span class="sd">    Returns: list of uppercased string names of time periods</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link"> ¶</a></h2>


<div class="doc doc-object doc-module">



<h3 id="tm2py.config" class="doc doc-heading">
          <code>tm2py.config</code>


<a href="#tm2py.config" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Config implementation and schema.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.config.ActiveModeShortestPathSkimConfig" class="doc doc-heading">
        <code>ActiveModeShortestPathSkimConfig</code>


<a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Active mode skim entry.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ActiveModeShortestPathSkimConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Active mode skim entry.&quot;&quot;&quot;</span>

    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">roots</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">output</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">max_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.ActiveModesConfig" class="doc doc-heading">
        <code>ActiveModesConfig</code>


<a href="#tm2py.config.ActiveModesConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Active Mode skim parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ActiveModesConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Active Mode skim parameters.&quot;&quot;&quot;</span>

    <span class="n">emme_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">shortest_path_skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ActiveModeShortestPathSkimConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.AirPassengerConfig" class="doc doc-heading">
        <code>AirPassengerConfig</code>


<a href="#tm2py.config.AirPassengerConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Air passenger model parameters.</p>
<p>Properties</p>
<p>highway_demand_file: output OMX file
input_demand_folder: location to find the input demand csvs</p>

<details class="input_demand_filename_tmpl">
  <summary>filename template for input demand. Should have</summary>
  <p>{year}, {direction} and {airport} variables and end in &lsquo;.csv&rsquo;</p>
</details>
<details class="reference_start_year">
  <summary>base start year for input demand tables</summary>
  <p>used to calculate the linear interpolation, as well as
in the file name template {year}_{direction}{airport}.csv</p>
</details>
<details class="reference_end_year">
  <summary>end year for input demand tables</summary>
  <p>used to calculate the linear interpolation, as well as
in the file name template {year}_{direction}{airport}.csv</p>
</details>
<details class="airport_names">
  <summary>list of one or more airport names / codes as used in</summary>
  <p>the input file names</p>
</details>
<details class="demand_aggregation">
  <summary>specification of aggregation of by-access mode</summary>
  <p>demand to highway class demand</p>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AirPassengerConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Air passenger model parameters.</span>

<span class="sd">    Properties</span>

<span class="sd">    highway_demand_file: output OMX file</span>
<span class="sd">    input_demand_folder: location to find the input demand csvs</span>
<span class="sd">    input_demand_filename_tmpl: filename template for input demand. Should have</span>
<span class="sd">        {year}, {direction} and {airport} variables and end in &#39;.csv&#39;</span>
<span class="sd">    reference_start_year: base start year for input demand tables</span>
<span class="sd">        used to calculate the linear interpolation, as well as</span>
<span class="sd">        in the file name template {year}_{direction}{airport}.csv</span>
<span class="sd">    reference_end_year: end year for input demand tables</span>
<span class="sd">        used to calculate the linear interpolation, as well as</span>
<span class="sd">        in the file name template {year}_{direction}{airport}.csv</span>
<span class="sd">    airport_names: list of one or more airport names / codes as used in</span>
<span class="sd">        the input file names</span>
<span class="sd">    demand_aggregation: specification of aggregation of by-access mode</span>
<span class="sd">        demand to highway class demand</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">input_demand_folder</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">input_demand_filename_tmpl</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reference_start_year</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reference_end_year</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">airport_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">demand_aggregation</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AirPassengerDemandAggregationConfig</span><span class="p">]</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;input_demand_filename_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_input_demand_filename_tmpl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{year}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{year}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{direction}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{direction}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{airport}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{airport}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.AirPassengerConfig.valid_input_demand_filename_tmpl" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">valid_input_demand_filename_tmpl</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.AirPassengerConfig.valid_input_demand_filename_tmpl" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate skim matrix template has correct {}.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;input_demand_filename_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_input_demand_filename_tmpl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>

    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{year}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{year}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{direction}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{direction}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{airport}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{airport}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.AirPassengerDemandAggregationConfig" class="doc doc-heading">
        <code>AirPassengerDemandAggregationConfig</code>


<a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Air passenger demand aggregation input parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AirPassengerDemandAggregationConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Air passenger demand aggregation input parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: (src_group_name) name used for the class group in the input columns</span>
<span class="sd">            for the trip tables,</span>
<span class="sd">        mode: (result_class_name) name used in the output OMX matrix names, note</span>
<span class="sd">            that this should match the expected naming convention in the</span>
<span class="sd">            HighwayClassDemandConfig name(s)</span>
<span class="sd">        access_modes: list of names used for the access modes in the input</span>
<span class="sd">            columns for the trip tables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.ChoiceClassConfig" class="doc doc-heading">
        <code>ChoiceClassConfig</code>


<a href="#tm2py.config.ChoiceClassConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Choice class parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>
<details class="the-end-value-in-the-utility-equation-for-class-c-and-property-p-is">
  <summary>The end value in the utility equation for class c and property p is</summary>
  <p>utility[p].coeff *
classes[c].property_factor[p] *
sum(skim(classes[c].skim_mode,skim_p) for skim_p in property_to_skim[p])</p>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ChoiceClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Choice class parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        property_to_skim_toll: Maps a property in the utility equation with a list of skim</span>
<span class="sd">            properties. If more than one skim property is listed, they will be summed together</span>
<span class="sd">            (e.g. cost if the sum of bridge toll and value toll). This defaults to a value in the</span>
<span class="sd">            code.</span>
<span class="sd">        property_to_skim_notoll: Maps a property in the utility equation with a list of skim</span>
<span class="sd">            properties for no toll choice.If more than one skim property is listed, they will</span>
<span class="sd">            be summed together  (e.g. cost if the sum of bridge toll and value toll). This</span>
<span class="sd">            defaults to a value in the code.</span>
<span class="sd">        property_factors: This will scale the property for this class. e.g. a shared ride cost</span>
<span class="sd">            could be applied a factor assuming that the cost is shared among individuals.</span>

<span class="sd">    The end value in the utility equation for class c and property p is:</span>

<span class="sd">       utility[p].coeff *</span>
<span class="sd">       classes[c].property_factor[p] *</span>
<span class="sd">       sum(skim(classes[c].skim_mode,skim_p) for skim_p in property_to_skim[p])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">skim_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;da&quot;</span><span class="p">)</span>
    <span class="n">veh_group_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">property_factors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CoefficientConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.CoefficientConfig" class="doc doc-heading">
        <code>CoefficientConfig</code>


<a href="#tm2py.config.CoefficientConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Coefficient and properties to be used in utility or regression.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CoefficientConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Coefficient and properties to be used in utility or regression.&quot;&quot;&quot;</span>

    <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">coeff</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.ConfigItem" class="doc doc-heading">
        <code>ConfigItem</code>


<a href="#tm2py.config.ConfigItem" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Base class to add partial dict-like interface to tm2py model configuration.</p>
<p>Allow use of .items() [&ldquo;X&rdquo;] and .get(&ldquo;X&rdquo;) .to_dict() from configuration.</p>
<p>Not to be constructed directly. To be used a mixin for dataclasses
representing config schema.
Do not use &ldquo;get&rdquo; &ldquo;to_dict&rdquo;, or &ldquo;items&rdquo; for key names.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ConfigItem</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class to add partial dict-like interface to tm2py model configuration.</span>

<span class="sd">    Allow use of .items() [&quot;X&quot;] and .get(&quot;X&quot;) .to_dict() from configuration.</span>

<span class="sd">    Not to be constructed directly. To be used a mixin for dataclasses</span>
<span class="sd">    representing config schema.</span>
<span class="sd">    Do not use &quot;get&quot; &quot;to_dict&quot;, or &quot;items&quot; for key names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The sub-config objects in config.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value for key if key is in the dictionary, else default.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.ConfigItem.__getitem__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

<a href="#tm2py.config.ConfigItem.__getitem__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.ConfigItem.get" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.config.ConfigItem.get" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Return the value for key if key is in the dictionary, else default.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the value for key if key is in the dictionary, else default.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.ConfigItem.items" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">items</span><span class="p">()</span></code>

<a href="#tm2py.config.ConfigItem.items" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>The sub-config objects in config.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The sub-config objects in config.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.Configuration" class="doc doc-heading">
        <code>Configuration</code>


<a href="#tm2py.config.Configuration" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Configuration: root of the model configuration.&quot;&quot;&quot;</span>

    <span class="n">scenario</span><span class="p">:</span> <span class="n">ScenarioConfig</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">RunConfig</span>
    <span class="n">time_periods</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TimePeriodConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">household</span><span class="p">:</span> <span class="n">HouseholdConfig</span>
    <span class="n">air_passenger</span><span class="p">:</span> <span class="n">AirPassengerConfig</span>
    <span class="n">internal_external</span><span class="p">:</span> <span class="n">InternalExternalConfig</span>
    <span class="n">truck</span><span class="p">:</span> <span class="n">TruckConfig</span>
    <span class="n">active_modes</span><span class="p">:</span> <span class="n">ActiveModesConfig</span>
    <span class="n">highway</span><span class="p">:</span> <span class="n">HighwayConfig</span>
    <span class="n">transit</span><span class="p">:</span> <span class="n">TransitConfig</span>
    <span class="n">emme</span><span class="p">:</span> <span class="n">EmmeConfig</span>
    <span class="n">logging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoggingConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">LoggingConfig</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_toml</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">toml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Configuration&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load configuration from .toml files(s).</span>

<span class="sd">        Normally the config is split into a scenario_config.toml file and a</span>
<span class="sd">        model_config.toml file.</span>

<span class="sd">        Args:</span>
<span class="sd">            toml_path: a valid system path string or Path object to a TOML format config file or</span>
<span class="sd">                list of paths of path objects to a set of TOML files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Configuration object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toml_path</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
            <span class="n">toml_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">toml_path</span><span class="p">]</span>
        <span class="n">toml_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">toml_path</span><span class="p">))</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">toml_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">path_item</span> <span class="ow">in</span> <span class="n">toml_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path_item</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">maz_skim_period_exists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;time_periods&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">time_period_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">])</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span> <span class="ow">in</span> <span class="n">time_period_names</span>
            <span class="p">),</span> <span class="s2">&quot;maz_to_maz -&gt; skim_period -&gt; name not found in time_periods list&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.Configuration.load_toml" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">load_toml</span><span class="p">(</span><span class="n">toml_path</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.Configuration.load_toml" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Load configuration from .toml files(s).</p>
<p>Normally the config is split into a scenario_config.toml file and a
model_config.toml file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>toml_path</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="typing.Union">Union</span>[str, pathlib.<span title="pathlib.Path">Path</span>]], str, pathlib.<span title="pathlib.Path">Path</span>]</code>
          </td>
          <td><p>a valid system path string or Path object to a TOML format config file or
list of paths of path objects to a set of TOML files.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.config.Configuration" href="#tm2py.config.Configuration">Configuration</a></code>
          </td>
          <td><p>A Configuration object</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load_toml</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">toml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Configuration&quot;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Load configuration from .toml files(s).</span>

<span class="sd">    Normally the config is split into a scenario_config.toml file and a</span>
<span class="sd">    model_config.toml file.</span>

<span class="sd">    Args:</span>
<span class="sd">        toml_path: a valid system path string or Path object to a TOML format config file or</span>
<span class="sd">            list of paths of path objects to a set of TOML files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Configuration object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">toml_path</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
        <span class="n">toml_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">toml_path</span><span class="p">]</span>
    <span class="n">toml_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">toml_path</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">toml_path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">path_item</span> <span class="ow">in</span> <span class="n">toml_path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path_item</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.Configuration.maz_skim_period_exists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">maz_skim_period_exists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.Configuration.maz_skim_period_exists" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate highway.maz_to_maz.skim_period refers to a valid period.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">maz_skim_period_exists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;time_periods&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">time_period_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span> <span class="ow">in</span> <span class="n">time_period_names</span>
        <span class="p">),</span> <span class="s2">&quot;maz_to_maz -&gt; skim_period -&gt; name not found in time_periods list&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.DemandCountyGroupConfig" class="doc doc-heading">
        <code>DemandCountyGroupConfig</code>


<a href="#tm2py.config.DemandCountyGroupConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Grouping of counties for assignment and demand files.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DemandCountyGroupConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grouping of counties for assignment and demand files.</span>

<span class="sd">    Properties:</span>
<span class="sd">        number: id number for this group, must be unique</span>
<span class="sd">        counties: list of one or more county names</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">counties</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">COUNTY_NAMES</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.EmmeConfig" class="doc doc-heading">
        <code>EmmeConfig</code>


<a href="#tm2py.config.EmmeConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Emme-specific parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EmmeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Emme-specific parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        all_day_scenario_id: scenario ID to use for all day</span>
<span class="sd">            (initial imported) scenario with all time period data</span>
<span class="sd">        project_path: relative path from run_dir to Emme desktop project (.emp)</span>
<span class="sd">        highway_database_path: relative path to highway Emmebank</span>
<span class="sd">        active_database_paths: list of relative paths to active mode Emmebanks</span>
<span class="sd">        transit_database_path: relative path to transit Emmebank</span>
<span class="sd">        num_processors: the number of processors to use in Emme procedures,</span>
<span class="sd">            either as an integer, or value MAX, MAX-N. Typically recommend</span>
<span class="sd">            using MAX-1 (on desktop systems) or MAX-2 (on servers with many</span>
<span class="sd">            logical processors) to leave capacity for background / other tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_day_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">project_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">highway_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">active_database_paths</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">transit_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">num_processors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^MAX$|^MAX-\d+$|^\d+$&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayCapClassConfig" class="doc doc-heading">
        <code>HighwayCapClassConfig</code>


<a href="#tm2py.config.HighwayCapClassConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway link capacity and speed (&lsquo;capclass&rsquo;) index entry.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayCapClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway link capacity and speed (&#39;capclass&#39;) index entry.</span>

<span class="sd">    Properties:</span>
<span class="sd">        capclass: cross index for link @capclass lookup</span>
<span class="sd">        capacity: value for link capacity, PCE / hour</span>
<span class="sd">        free_flow_speed: value for link free flow speed, miles / hour</span>
<span class="sd">        critical_speed: value for critical speed (Ja) used in Akcelik</span>
<span class="sd">            type functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">capclass</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">capacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">free_flow_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">critical_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayClassConfig" class="doc doc-heading">
        <code>HighwayClassConfig</code>


<a href="#tm2py.config.HighwayClassConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway assignment class definition.</p>
<p>Note that excluded_links, skims and toll attribute names include
vehicle groups (&ldquo;{vehicle}&rdquo;) which reference the list of
highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).
The default example model config uses:
&ldquo;da&rdquo;, &ldquo;sr2&rdquo;, &ldquo;sr3&rdquo;, &ldquo;vsm&rdquo;, sml&rdquo;, &ldquo;med&rdquo;, &ldquo;lrg&rdquo;</p>

<details class="example-single-class-config">
  <summary>Example single class config</summary>
  <p>name = &ldquo;da&rdquo;
description= &ldquo;drive alone&rdquo;
mode_code= &ldquo;d&rdquo;
[[highway.classes.demand]]
    source = &ldquo;household&rdquo;
    name = &ldquo;SOV_GP_{period}&rdquo;
[[highway.classes.demand]]
    source = &ldquo;air_passenger&rdquo;
    name = &ldquo;da&rdquo;
[[highway.classes.demand]]
    source = &ldquo;internal_external&rdquo;
    name = &ldquo;da&rdquo;
excluded_links = [&ldquo;is_toll_da&rdquo;, &ldquo;is_sr2&rdquo;],
value_of_time = 18.93,  # $ / hr
operating_cost_per_mile = 17.23,  # cents / mile
toll = [&ldquo;@bridgetoll_da&rdquo;]
skims = [&ldquo;time&rdquo;, &ldquo;dist&rdquo;, &ldquo;freeflowtime&rdquo;, &ldquo;bridgetoll_da&rdquo;],</p>
</details>
<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment class definition.</span>

<span class="sd">    Note that excluded_links, skims and toll attribute names include</span>
<span class="sd">    vehicle groups (&quot;{vehicle}&quot;) which reference the list of</span>
<span class="sd">    highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).</span>
<span class="sd">    The default example model config uses:</span>
<span class="sd">    &quot;da&quot;, &quot;sr2&quot;, &quot;sr3&quot;, &quot;vsm&quot;, sml&quot;, &quot;med&quot;, &quot;lrg&quot;</span>

<span class="sd">    Example single class config:</span>
<span class="sd">        name = &quot;da&quot;</span>
<span class="sd">        description= &quot;drive alone&quot;</span>
<span class="sd">        mode_code= &quot;d&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;household&quot;</span>
<span class="sd">            name = &quot;SOV_GP_{period}&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;air_passenger&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;internal_external&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        excluded_links = [&quot;is_toll_da&quot;, &quot;is_sr2&quot;],</span>
<span class="sd">        value_of_time = 18.93,  # $ / hr</span>
<span class="sd">        operating_cost_per_mile = 17.23,  # cents / mile</span>
<span class="sd">        toll = [&quot;@bridgetoll_da&quot;]</span>
<span class="sd">        skims = [&quot;time&quot;, &quot;dist&quot;, &quot;freeflowtime&quot;, &quot;bridgetoll_da&quot;],</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: short (up to 10 character) unique reference name for the class.</span>
<span class="sd">            used in attribute and matrix names</span>
<span class="sd">        description: longer text used in attribute and matrix descriptions</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords.</span>
<span class="sd">            Should be unique in list of :es, unless multiple classes</span>
<span class="sd">            have identical excluded_links specification. Cannot be the</span>
<span class="sd">            same as used for highway.maz_to_maz.mode_code.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        demand: list of OMX file and matrix keyname references,</span>
<span class="sd">            see HighwayClassDemandConfig</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            this class&#39; available subnetwork (generate link.modes)</span>
<span class="sd">            Options are:</span>
<span class="sd">                - &quot;is_sr&quot;: is reserved for shared ride (@useclass in 2,3)</span>
<span class="sd">                - &quot;is_sr2&quot;: is reserved for shared ride 2+ (@useclass == 2)</span>
<span class="sd">                - &quot;is_sr3&quot;: is reserved for shared ride 3+ (@useclass == 3)</span>
<span class="sd">                - &quot;is_auto_only&quot;: is reserved for autos (non-truck) (@useclass != 1)</span>
<span class="sd">                - &quot;is_toll_{vehicle}&quot;: has a value (non-bridge) toll for the {vehicle} toll group</span>
<span class="sd">        toll: list of additional toll cost link attribute (values stored in cents),</span>
<span class="sd">            summed, one of &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">        toll_factor: optional, factor to apply to toll values in cost calculation</span>
<span class="sd">        pce: optional, passenger car equivalent to convert assigned demand in</span>
<span class="sd">            PCE units to vehicles for total assigned vehicle calculations</span>
<span class="sd">        skims: list of skim matrices to generate</span>
<span class="sd">            Options are:</span>
<span class="sd">                &quot;time&quot;: pure travel time in minutes</span>
<span class="sd">                &quot;dist&quot;: distance in miles</span>
<span class="sd">                &quot;hovdist&quot;: distance on HOV facilities (is_sr2 or is_sr3)</span>
<span class="sd">                &quot;tolldist&quot;: distance on toll facilities</span>
<span class="sd">                    (@tollbooth &gt; highway.tolls.tollbooth_start_index)</span>
<span class="sd">                &quot;freeflowtime&quot;: free flow travel time in minutes</span>
<span class="sd">                &quot;bridgetoll_{vehicle}&quot;: bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">                &quot;valuetoll_{vehicle}&quot;: other, non-bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">veh_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pce</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Note that excluded_links, skims, and tolls validated under HighwayConfig to include</span>
    <span class="c1"># highway.toll.dst_vehicle_group_names names</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassDemandConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayClassDemandConfig" class="doc doc-heading">
        <code>HighwayClassDemandConfig</code>


<a href="#tm2py.config.HighwayClassDemandConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway class input source for demand.</p>
<p>Used to specify where to find related demand file for this
highway class. Multiple</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayClassDemandConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway class input source for demand.</span>

<span class="sd">    Used to specify where to find related demand file for this</span>
<span class="sd">    highway class. Multiple</span>

<span class="sd">    Properties:</span>
<span class="sd">        source: reference name of the component section for the</span>
<span class="sd">                source &quot;highway_demand_file&quot; location, one of:</span>
<span class="sd">                &quot;household&quot;, &quot;air_passenger&quot;, &quot;internal_external&quot;, &quot;truck&quot;</span>
<span class="sd">        name: name of matrix in the OMX file, can include &quot;{period}&quot;</span>
<span class="sd">                placeholder</span>
<span class="sd">        factor: optional, multiplicative factor to generate PCEs from</span>
<span class="sd">                trucks or convert person-trips to vehicle-trips for HOVs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;household&quot;</span><span class="p">,</span> <span class="s2">&quot;air_passenger&quot;</span><span class="p">,</span> <span class="s2">&quot;internal_external&quot;</span><span class="p">,</span> <span class="s2">&quot;truck&quot;</span><span class="p">]</span>
    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayConfig" class="doc doc-heading">
        <code>HighwayConfig</code>


<a href="#tm2py.config.HighwayConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway assignment and skims parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skims parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        generic_highway_mode_code: single character unique mode ID for entire</span>
<span class="sd">            highway network (no excluded_links)</span>
<span class="sd">        relative_gap: target relative gap stopping criteria</span>
<span class="sd">        max_iterations: maximum iterations stopping criteria</span>
<span class="sd">        area_type_buffer_dist_miles: used to in calculation to categorize link @areatype</span>
<span class="sd">            The area type is determined based on the average density of nearby</span>
<span class="sd">            (within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</span>
<span class="sd">        output_skim_path: relative path template from run dir for OMX output skims</span>
<span class="sd">        output_skim_filename_tmpl: template for OMX filename for a time period. Must include</span>
<span class="sd">            {time_period} in the string and end in &#39;.omx&#39;.</span>
<span class="sd">        output_skim_matrixname_tmpl: template for matrix names within OMX output skims.</span>
<span class="sd">            Should include {time_period}, {mode}, and {property}</span>
<span class="sd">        tolls: input toll specification, see HighwayTollsConfig</span>
<span class="sd">        maz_to_maz: maz-to-maz shortest path assignment and skim specification,</span>
<span class="sd">            see HighwayMazToMazConfig</span>
<span class="sd">        classes: highway assignment multi-class setup and skim specification,</span>
<span class="sd">            see HighwayClassConfig</span>
<span class="sd">        capclass_lookup: index cross-reference table from the link @capclass value</span>
<span class="sd">            to the free-flow speed, capacity, and critical speed values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generic_highway_mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">relative_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">area_type_buffer_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_filename_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_matrixname_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls</span><span class="p">:</span> <span class="n">HighwayTollsConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">maz_to_maz</span><span class="p">:</span> <span class="n">HighwayMazToMazConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">capclass_lookup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayCapClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_filename_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate skim template has correct {} and extension.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; output_skim_filename_tmpl must have </span><span class="se">{{</span><span class="s2">time_period</span><span class="se">}}</span><span class="s2">&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.omx&quot;</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; &#39;output_skim_filename_tmpl must end in &#39;.omx&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_matrixname_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{time_period}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{property&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{property}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{mode&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{mode}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
        <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
        <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># maz_to_maz.mode_code must be unique</span>
            <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
            <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
            <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
                <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
        <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
        <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
            <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
            <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
            <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
        <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
            <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
                <span class="n">available_link_sets</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.HighwayConfig.unique_capclass_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate list of capclass_lookup has unique .capclass values.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
    <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.HighwayConfig.unique_class_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.unique_class_names" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate list of classes has unique .name values.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate skim matrix template has correct {}.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_matrixname_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{time_period}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{property&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{property}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{mode&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{mode}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.HighwayConfig.valid_skim_template" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.valid_skim_template" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate skim template has correct {} and extension.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_filename_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate skim template has correct {} and extension.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; output_skim_filename_tmpl must have </span><span class="se">{{</span><span class="s2">time_period</span><span class="se">}}</span><span class="s2">&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.omx&quot;</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; &#39;output_skim_filename_tmpl must end in &#39;.omx&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.HighwayConfig.validate_class_keyword_lists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate classes .skims, .toll, and .excluded_links values.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
    <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
    <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
        <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
        <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
        <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
    <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
        <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
            <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
            <span class="n">available_link_sets</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate list of classes has unique .mode_code or .excluded_links match.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
    <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
    <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># maz_to_maz.mode_code must be unique</span>
        <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
        <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
        <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
            <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
            <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
        <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayMazToMazConfig" class="doc doc-heading">
        <code>HighwayMazToMazConfig</code>


<a href="#tm2py.config.HighwayMazToMazConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway MAZ to MAZ shortest path assignment and skim parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayMazToMazConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway MAZ to MAZ shortest path assignment and skim parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords,</span>
<span class="sd">            plus including MAZ connectors.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        max_skim_cost: max shortest path distance to search for MAZ-to-MAZ</span>
<span class="sd">            skims, in generized costs units (includes operating cost</span>
<span class="sd">            converted to minutes)</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</span>
<span class="sd">        demand_file: relative path to find the input demand files</span>
<span class="sd">            can have use a placeholder for {period} and {number}, where the</span>
<span class="sd">            {period} is the time_period.name (see TimePeriodConfig)</span>
<span class="sd">            and {number} is the demand_count_groups[].number</span>
<span class="sd">            (see DemandCountyGroupConfig)</span>
<span class="sd">            e.g.: auto_{period}_MAZ_AUTO_{number}_{period}.omx</span>
<span class="sd">        demand_county_groups: List of demand county names and</span>
<span class="sd">        skim_period: period name to use for the shotest path skims, must</span>
<span class="sd">            match one of the names listed in the time_periods</span>
<span class="sd">        output_skim_file: relative path to resulting MAZ-to-MAZ skims</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_skim_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_county_groups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DemandCountyGroupConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skim_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate list of demand_county_groups has unique .number values.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayTollsConfig" class="doc doc-heading">
        <code>HighwayTollsConfig</code>


<a href="#tm2py.config.HighwayTollsConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway assignment and skim input tolls and related parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayTollsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skim input tolls and related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        file_path: source relative file path for the highway tolls index CSV</span>
<span class="sd">        tollbooth_start_index: tollbooth separates links with &quot;bridge&quot; tolls</span>
<span class="sd">            (index &lt; this value) vs. &quot;value&quot; tolls. These toll attributes</span>
<span class="sd">            can then be referenced separately in the highway.classes[].tolls</span>
<span class="sd">            list</span>
<span class="sd">        src_vehicle_group_names: name used for the vehicle toll CSV column IDs,</span>
<span class="sd">            of the form &quot;toll{period}_{vehicle}&quot;</span>
<span class="sd">        dst_vehicle_group_names: list of names used in destination network</span>
<span class="sd">            for the corresponding vehicle group. Length of list must be the same</span>
<span class="sd">            as src_vehicle_group_names. Used for toll related attributes and</span>
<span class="sd">            resulting skim matrices. Cross-referenced in list of highway.classes[],</span>
<span class="sd">            valid keywords for:</span>
<span class="sd">                excluded_links: &quot;is_toll_{vehicle}&quot;</span>
<span class="sd">                tolls: &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">                skims: &quot;bridgetoll_{vehicle}&quot;, &quot;valuetoll_{vehicle}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tollbooth_start_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">dst_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate dst_vehicle_group_names has same length as src_vehicle_group_names.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.HouseholdConfig" class="doc doc-heading">
        <code>HouseholdConfig</code>


<a href="#tm2py.config.HouseholdConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Household (residents) model parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HouseholdConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Household (residents) model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">transit_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.ImpedanceConfig" class="doc doc-heading">
        <code>ImpedanceConfig</code>


<a href="#tm2py.config.ImpedanceConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Blended skims used for accessibility/friction calculations.</p>
<p>Properties:I
    name: name to store it as, referred to in TripDistribution config
    skim_mode: name of the mode to use for the blended skim
    time_blend: blend of time periods to use; mapped to the factors (which should sum to 1)</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ImpedanceConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Blended skims used for accessibility/friction calculations.</span>

<span class="sd">    Properties:I</span>
<span class="sd">        name: name to store it as, referred to in TripDistribution config</span>
<span class="sd">        skim_mode: name of the mode to use for the blended skim</span>
<span class="sd">        time_blend: blend of time periods to use; mapped to the factors (which should sum to 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">skim_mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">time_blend</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;time_blend&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sums_to_one</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="s2">&quot;blend factors must sum to 1&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.ImpedanceConfig.sums_to_one" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">sums_to_one</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.ImpedanceConfig.sums_to_one" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate highway.maz_to_maz.skim_period refers to a valid period.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;time_blend&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sums_to_one</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="s2">&quot;blend factors must sum to 1&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.InternalExternalConfig" class="doc doc-heading">
        <code>InternalExternalConfig</code>


<a href="#tm2py.config.InternalExternalConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Internal &lt;-&gt; External model parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">InternalExternalConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Internal &lt;-&gt; External model parameters.&quot;&quot;&quot;</span>

    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">DemandGrowth</span>
    <span class="n">time_of_day</span><span class="p">:</span> <span class="n">TimeOfDayConfig</span>
    <span class="n">toll_choice</span><span class="p">:</span> <span class="n">TollChoiceConfig</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.LoggingConfig" class="doc doc-heading">
        <code>LoggingConfig</code>


<a href="#tm2py.config.LoggingConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Logging parameters. TODO.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LoggingConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Logging parameters. TODO.</span>

<span class="sd">    Properties:</span>
<span class="sd">        display_level: filter level for messages to show in console, default</span>
<span class="sd">            is STATUS</span>
<span class="sd">        run_file_path: relative path to high-level log file for the model run,</span>
<span class="sd">            default is tm2py_run_[%Y%m%d_%H%M].log</span>
<span class="sd">        run_file_level: filter level for messages recorded in the run log,</span>
<span class="sd">            default is INFO</span>
<span class="sd">        log_file_path: relative path to general log file with more detail</span>
<span class="sd">            than the run_file, default is tm2py_detail_[%Y%m%d_%H%M].log</span>
<span class="sd">        log_file_level: optional, filter level for messages recorded in the</span>
<span class="sd">            standard log, default is DETAIL</span>
<span class="sd">        log_on_error_file_path: relative path to use for fallback log message cache</span>
<span class="sd">            on error, default is tm2py_error_[%Y%m%d_%H%M].log</span>
<span class="sd">        notify_slack: if true notify_slack messages will be sent, default is False</span>
<span class="sd">        use_emme_logbook: if True log messages recorded in the standard log file will</span>
<span class="sd">            also be recorded in the Emme logbook, default is True</span>
<span class="sd">        iter_component_level: tuple of tuples of iteration, component name, log level.</span>
<span class="sd">            Used to override log levels (log_file_level) for debugging and recording</span>
<span class="sd">            more detail in the log_file_path.</span>
<span class="sd">            Example: [ [2, &quot;highway&quot;, &quot;TRACE&quot;] ] to record all messages</span>
<span class="sd">            during the highway component run at iteration 2.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">display_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
    <span class="n">run_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;tm2py_run_</span><span class="si">{}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">run_file_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
    <span class="n">log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;tm2py_debug_</span><span class="si">{}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">log_file_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="n">log_on_error_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;tm2py_error_</span><span class="si">{}</span><span class="s2">.log&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">notify_slack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">use_emme_logbook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">iter_component_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ComponentNames</span><span class="p">,</span> <span class="n">LogLevel</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.MatrixFactorConfig" class="doc doc-heading">
        <code>MatrixFactorConfig</code>


<a href="#tm2py.config.MatrixFactorConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Mapping of zone or list of zones to factor value.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MatrixFactorConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapping of zone or list of zones to factor value.&quot;&quot;&quot;</span>

    <span class="n">zone_index</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span>
    <span class="n">factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">i_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">j_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">as_growth_rate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;zone_index&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_zone_index</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate zone index and turn to list if isn&#39;t one.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]),</span> <span class="s2">&quot;Zone_index must be greater or equal to 0&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;factor&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_factor</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;i_factor&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">),</span> <span class="s2">&quot;Found both `factor` and</span><span class="se">\</span>
<span class="s2">            `i_factor` in MatrixFactorConfig. Should be one or the other.&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;j_factor&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">),</span> <span class="s2">&quot;Found both `factor` and</span><span class="se">\</span>
<span class="s2">            `j_factor` in MatrixFactorConfig. Should be one or the other.&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.MatrixFactorConfig.valid_zone_index" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">valid_zone_index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.MatrixFactorConfig.valid_zone_index" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate zone index and turn to list if isn&rsquo;t one.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;zone_index&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_zone_index</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate zone index and turn to list if isn&#39;t one.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]),</span> <span class="s2">&quot;Zone_index must be greater or equal to 0&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.RunConfig" class="doc doc-heading">
        <code>RunConfig</code>


<a href="#tm2py.config.RunConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Model run parameters.</p>
<p>Note that the components will be executed in the order listed.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">RunConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Model run parameters.</span>

<span class="sd">    Note that the components will be executed in the order listed.</span>

<span class="sd">    Properties:</span>
<span class="sd">        start_iteration: start iteration number, 0 to include initial_components</span>
<span class="sd">        end_iteration: final iteration number</span>
<span class="sd">        start_component: name of component to start with, will skip components</span>
<span class="sd">            list prior to this component</span>
<span class="sd">        initial_components: list of components to run as initial (0) iteration, in order</span>
<span class="sd">        global_iteration_components: list of component to run at every subsequent</span>
<span class="sd">            iteration (max(1, start_iteration) to end_iteration), in order.</span>
<span class="sd">        final_components: list of components to run after final iteration, in order</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">initial_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">global_iteration_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">final_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">start_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">end_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">start_component</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="n">EmptyString</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">end_iteration_gt_start</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate end_iteration greater than start_iteration.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;end_iteration&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be greater than &#39;start_iteration&#39;</span><span class="se">\</span>
<span class="s2">                (</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;start_iteration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">start_component_used</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate start_component is listed in *_components.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;initial_components&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;start_component&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be one of the components listed in</span><span class="se">\</span>
<span class="s2">                    initial_components if &#39;start_iteration = 0&#39;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;global_iteration_components&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;start_component&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be one of the components listed in</span><span class="se">\</span>
<span class="s2">                    global_iteration_components if &#39;start_iteration &gt; 0&#39;&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.RunConfig.end_iteration_gt_start" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">end_iteration_gt_start</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate end_iteration greater than start_iteration.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">end_iteration_gt_start</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate end_iteration greater than start_iteration.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;end_iteration&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be greater than &#39;start_iteration&#39;</span><span class="se">\</span>
<span class="s2">            (</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;start_iteration&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.RunConfig.start_component_used" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">start_component_used</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.RunConfig.start_component_used" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate start_component is listed in *_components.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">start_component_used</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate start_component is listed in *_components.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;initial_components&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;start_component&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be one of the components listed in</span><span class="se">\</span>
<span class="s2">                initial_components if &#39;start_iteration = 0&#39;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;global_iteration_components&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;start_component&#39; (</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">) must be one of the components listed in</span><span class="se">\</span>
<span class="s2">                global_iteration_components if &#39;start_iteration &gt; 0&#39;&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.ScenarioConfig" class="doc doc-heading">
        <code>ScenarioConfig</code>


<a href="#tm2py.config.ScenarioConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Scenario related parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ScenarioConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scenario related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        verify: optional, default False if specified as True components will run</span>
<span class="sd">            additional post-process verify step to validate results / outputs</span>
<span class="sd">            (not implemented yet)</span>
<span class="sd">        maz_landuse_file: relative path to maz_landuse_file used by multiple</span>
<span class="sd">            components</span>
<span class="sd">        name: scenario name string</span>
<span class="sd">        year: model year, must be at least 2005</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maz_landuse_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span>
    <span class="n">verify</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TimeOfDayClassConfig" class="doc doc-heading">
        <code>TimeOfDayClassConfig</code>


<a href="#tm2py.config.TimeOfDayClassConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Configuraiton for a class of time of day model.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TimeOfDayClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Configuraiton for a class of time of day model.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">time_period_split</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeSplitConfig</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TimeOfDayConfig" class="doc doc-heading">
        <code>TimeOfDayConfig</code>


<a href="#tm2py.config.TimeOfDayConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Configuration for time of day model.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TimeOfDayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Configuration for time of day model.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeOfDayClassConfig</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TimePeriodConfig" class="doc doc-heading">
        <code>TimePeriodConfig</code>


<a href="#tm2py.config.TimePeriodConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Time time period entry.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TimePeriodConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Time time period entry.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: name of the time period, up to four characters</span>
<span class="sd">        length_hours: length of the time period in hours</span>
<span class="sd">        highway_capacity_factor: factor to use to multiple the per-hour</span>
<span class="sd">            capacites in the highway network</span>
<span class="sd">        emme_scenario_id: scenario ID to use for Emme per-period</span>
<span class="sd">            assignment (highway and transit) scenarios</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">length_hours</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">highway_capacity_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">emme_scenario_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TimeSplitConfig" class="doc doc-heading">
        <code>TimeSplitConfig</code>


<a href="#tm2py.config.TimeSplitConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Split matrix i and j.</p>
<p>i.e. for time of day splits.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TimeSplitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split matrix i and j.</span>

<span class="sd">    i.e. for time of day splits.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">production</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NonNegativeFloat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">attraction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NonNegativeFloat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">od</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NonNegativeFloat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;production&quot;</span><span class="p">,</span> <span class="s2">&quot;attraction&quot;</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">less_than_equal_one</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;Value should be less than or equal to 1&quot;</span>
            <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">od</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attraction</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;TimeSplitConfig: Must either specifify an od or any of</span><span class="se">\</span>
<span class="s2">            production/attraction - not both.</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attraction</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attraction</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;TimeSplitConfig: Must have both production AND attraction</span><span class="se">\</span>
<span class="s2">            if one of them is specified.&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TollChoiceConfig" class="doc doc-heading">
        <code>TollChoiceConfig</code>


<a href="#tm2py.config.TollChoiceConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Toll choice parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TollChoiceConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Toll choice parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        property_to_skim_toll: Maps a property in the utility equation with a list of skim</span>
<span class="sd">            properties. If more than one skim property is listed, they will be summed together</span>
<span class="sd">            (e.g. cost if the sum of bridge toll and value toll). This defaults to a value in the</span>
<span class="sd">            code.</span>
<span class="sd">        property_to_skim_notoll: Maps a property in the utility equation with a list of skim</span>
<span class="sd">            properties for no toll choice.If more than one skim property is listed, they will</span>
<span class="sd">            be summed together  (e.g. cost if the sum of bridge toll and value toll). This</span>
<span class="sd">            defaults to a value in the code.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ChoiceClassConfig</span><span class="p">]</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">property_to_skim_toll</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">property_to_skim_notoll</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span>
    <span class="p">)</span>
    <span class="n">utility</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CoefficientConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TransitConfig" class="doc doc-heading">
        <code>TransitConfig</code>


<a href="#tm2py.config.TransitConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Transit assignment parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit assignment parameters.&quot;&quot;&quot;</span>

    <span class="n">modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitModeConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">vehicles</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitVehicleConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

    <span class="n">apply_msa_demand</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">effective_headway_source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">initial_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">initial_boarding_penalty</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_boarding_penalty</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_transfers</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fares_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fare_matrix_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fare_max_transfer_distance_miles</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">use_fares</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">override_connector_times</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">input_connector_access_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">input_connector_egress_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_stop_usage_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TransitModeConfig" class="doc doc-heading">
        <code>TransitModeConfig</code>


<a href="#tm2py.config.TransitModeConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Transit mode definition (see also mode in the Emme API).</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitModeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit mode definition (see also mode in the Emme API).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;WALK&quot;</span><span class="p">,</span> <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;EGRESS&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCAL&quot;</span><span class="p">,</span> <span class="s2">&quot;PREMIUM&quot;</span><span class="p">]</span>
    <span class="n">assign_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="n">mode_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">in_vehicle_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">speed_miles_per_hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TransitVehicleConfig" class="doc doc-heading">
        <code>TransitVehicleConfig</code>


<a href="#tm2py.config.TransitVehicleConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Transit vehicle definition (see also transit vehicle in the Emme API).</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitVehicleConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit vehicle definition (see also transit vehicle in the Emme API).&quot;&quot;&quot;</span>

    <span class="n">vehicle_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">auto_equivalent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">seated_capacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">total_capacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TripDistributionClassConfig" class="doc doc-heading">
        <code>TripDistributionClassConfig</code>


<a href="#tm2py.config.TripDistributionClassConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Trip Distribution parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripDistributionClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Trip Distribution parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: name of class to apply to</span>
<span class="sd">        impedance_name: refers to an impedance (skim) matrix to use - often a blended skim.</span>
<span class="sd">        use_k_factors: boolean on if to use k-factors</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">impedance</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">use_k_factors</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TripDistributionConfig" class="doc doc-heading">
        <code>TripDistributionConfig</code>


<a href="#tm2py.config.TripDistributionConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Trip Distribution parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripDistributionConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Trip Distribution parameters.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TripDistributionClassConfig</span><span class="p">]</span>
    <span class="n">max_balance_iterations</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">max_balance_relative_error</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">friction_factors_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">k_factors_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TripGenerationClassConfig" class="doc doc-heading">
        <code>TripGenerationClassConfig</code>


<a href="#tm2py.config.TripGenerationClassConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Trip Generation parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripGenerationClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Trip Generation parameters.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">purpose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">production_formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TripGenerationFormulaConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">attraction_formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TripGenerationFormulaConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">balance_to</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;production&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TripGenerationConfig" class="doc doc-heading">
        <code>TripGenerationConfig</code>


<a href="#tm2py.config.TripGenerationConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Trip Generation parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripGenerationConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Trip Generation parameters.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TripGenerationClassConfig</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TripGenerationFormulaConfig" class="doc doc-heading">
        <code>TripGenerationFormulaConfig</code>


<a href="#tm2py.config.TripGenerationFormulaConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>TripProductionConfig.</p>
<p>Trip productions or attractions for a zone are the constant plus the sum of the rates * values
in land use file for that zone.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TripGenerationFormulaConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TripProductionConfig.</span>

<span class="sd">    Trip productions or attractions for a zone are the constant plus the sum of the rates * values</span>
<span class="sd">    in land use file for that zone.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">land_use_rates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CoefficientConfig</span><span class="p">]</span>
    <span class="n">constant</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">multiplier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TruckClassConfig" class="doc doc-heading">
        <code>TruckClassConfig</code>


<a href="#tm2py.config.TruckClassConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Truck class parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TruckClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Truck class parameters.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.config.TruckConfig" class="doc doc-heading">
        <code>TruckConfig</code>


<a href="#tm2py.config.TruckConfig" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Truck model parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TruckConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Truck model parameters.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TruckClassConfig</span><span class="p">]</span>
    <span class="n">impedances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImpedanceConfig</span><span class="p">]</span>
    <span class="n">trip_gen</span><span class="p">:</span> <span class="n">TripGenerationConfig</span>
    <span class="n">trip_dist</span><span class="p">:</span> <span class="n">TripDistributionConfig</span>
    <span class="n">time_of_day</span><span class="p">:</span> <span class="n">TimeOfDayConfig</span>
    <span class="n">toll_choice</span><span class="p">:</span> <span class="n">TollChoiceConfig</span>
    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @validator(&quot;classes&quot;)</span>
<span class="sd">    def class_consistency(cls, v, values):</span>
<span class="sd">        # TODO Can&#39;t get to work righ tnow</span>
<span class="sd">        _class_names = [c.name for c in v]</span>
<span class="sd">        _gen_classes = [c.name for c in values[&quot;trip_gen&quot;]]</span>
<span class="sd">        _dist_classes = [c.name for c in values[&quot;trip_dist&quot;]]</span>
<span class="sd">        _time_classes = [c.name for c in values[&quot;time_split&quot;]]</span>
<span class="sd">        _toll_classes = [c.name for c in values[&quot;toll_choice&quot;]]</span>

<span class="sd">        assert (</span>
<span class="sd">            _class_names == _gen_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t equal\</span>
<span class="sd">            class names in truck.trip_gen ({_gen_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _dist_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t  equal\</span>
<span class="sd">            class names in truck.trip_dist ({_dist_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _time_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t  equal\</span>
<span class="sd">            class names in truck.time_split ({_time_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _toll_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t equal\</span>
<span class="sd">            class names in truck.toll_choice ({_toll_classes}).&quot;</span>

<span class="sd">        return v</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="tm2py.config.TruckConfig.outfile_trip_table_tmp" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

<a href="#tm2py.config.TruckConfig.outfile_trip_table_tmp" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>@validator(&ldquo;classes&rdquo;)
def class_consistency(cls, v, values):
    # TODO Can&rsquo;t get to work righ tnow
    _class_names = [c.name for c in v]
    _gen_classes = [c.name for c in values[&ldquo;trip_gen&rdquo;]]
    _dist_classes = [c.name for c in values[&ldquo;trip_dist&rdquo;]]
    _time_classes = [c.name for c in values[&ldquo;time_split&rdquo;]]
    _toll_classes = [c.name for c in values[&ldquo;toll_choice&rdquo;]]</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">assert</span><span class="w"> </span><span class="ss">(</span><span class="w"></span>
<span class="w">    </span><span class="nv">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">_gen_classes</span><span class="w"></span>
<span class="ss">)</span>,<span class="w"> </span><span class="s2">&quot;truck.classes ({_class_names}) doesn&#39;t equal            class names in truck.trip_gen ({_gen_classes}).&quot;</span><span class="w"></span>
<span class="nv">assert</span><span class="w"> </span><span class="ss">(</span><span class="w"></span>
<span class="w">    </span><span class="nv">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">_dist_classes</span><span class="w"></span>
<span class="ss">)</span>,<span class="w"> </span><span class="s2">&quot;truck.classes ({_class_names}) doesn&#39;t  equal            class names in truck.trip_dist ({_dist_classes}).&quot;</span><span class="w"></span>
<span class="nv">assert</span><span class="w"> </span><span class="ss">(</span><span class="w"></span>
<span class="w">    </span><span class="nv">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">_time_classes</span><span class="w"></span>
<span class="ss">)</span>,<span class="w"> </span><span class="s2">&quot;truck.classes ({_class_names}) doesn&#39;t  equal            class names in truck.time_split ({_time_classes}).&quot;</span><span class="w"></span>
<span class="nv">assert</span><span class="w"> </span><span class="ss">(</span><span class="w"></span>
<span class="w">    </span><span class="nv">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">_toll_classes</span><span class="w"></span>
<span class="ss">)</span>,<span class="w"> </span><span class="s2">&quot;truck.classes ({_class_names}) doesn&#39;t equal            class names in truck.toll_choice ({_toll_classes}).&quot;</span><span class="w"></span>

<span class="k">return</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
  </div>

</div>





  </div>

  </div>

</div>




  </div>

  </div>

</div><p><strong>Configurations for each component are listed with those components</strong></p>
<h2 id="components">Components<a class="headerlink" href="#components" title="Permanent link"> ¶</a></h2>
<h3 id="base-component">Base Component<a class="headerlink" href="#base-component" title="Permanent link"> ¶</a></h3>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.component" class="doc doc-heading">
          <code>tm2py.components.component</code>


<a href="#tm2py.components.component" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Root component ABC.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.component.Component" class="doc doc-heading">
        <code>Component</code>


<a href="#tm2py.components.component.Component" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Template for Component class with several built-in methods.</p>
<p>A component is a piece of the model that can be run independently (of other components) given
the required input data and configuration.  It communicates information to other components via
disk I/O (including the emmebank).</p>
<p>Note: if the component needs data that is not written to disk, it would be considered a
subcomponent.</p>
<p>Abstract Methods – Each component class must have the following methods:
    __init___: constructor, which associates the RunController with the instantiated object
    run: run the component without any arguments
    validate_inputs: validate the inputs to the component
    report_progress: report progress to the user
    verify: verify the component&rsquo;s output
    write_top_sheet: write outputs to topsheet
    test_component: test the component</p>

<details class="template-class-methods---component-classes-inherit">
  <summary>Template Class methods - component classes inherit</summary>
  
</details>
<details class="template-class-properties---component-classes-inherit">
  <summary>Template Class Properties - component classes inherit</summary>
  
</details>      <p>::
    class MyComponent(Component):</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code>def __init__(self, controller):
    super().__init__(controller)
    self._parameter = None

def run(self):
    self._step1()
    self._step2()

def _step1(self):
    pass

def _step2(self):
    pass
</code></pre></div></td></tr></table></div>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Component</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Template for Component class with several built-in methods.</span>

<span class="sd">    A component is a piece of the model that can be run independently (of other components) given</span>
<span class="sd">    the required input data and configuration.  It communicates information to other components via</span>
<span class="sd">    disk I/O (including the emmebank).</span>

<span class="sd">    Note: if the component needs data that is not written to disk, it would be considered a</span>
<span class="sd">    subcomponent.</span>

<span class="sd">    Abstract Methods – Each component class must have the following methods:</span>
<span class="sd">        __init___: constructor, which associates the RunController with the instantiated object</span>
<span class="sd">        run: run the component without any arguments</span>
<span class="sd">        validate_inputs: validate the inputs to the component</span>
<span class="sd">        report_progress: report progress to the user</span>
<span class="sd">        verify: verify the component&#39;s output</span>
<span class="sd">        write_top_sheet: write outputs to topsheet</span>
<span class="sd">        test_component: test the component</span>

<span class="sd">    Template Class methods - component classes inherit:</span>
<span class="sd">        get_abs_path: convenience method to get absolute path of the run directory</span>
<span class="sd">        get_emme_scenario: ....</span>

<span class="sd">    Template Class Properties - component classes inherit:</span>
<span class="sd">        controller: RunController object</span>
<span class="sd">        config: Config object</span>
<span class="sd">        time_period_names: convenience property</span>
<span class="sd">        top_sheet: topsheet object</span>
<span class="sd">        logger: logger object</span>
<span class="sd">        trace: trace object</span>

<span class="sd">    Example:</span>
<span class="sd">    ::</span>
<span class="sd">        class MyComponent(Component):</span>

<span class="sd">        def __init__(self, controller):</span>
<span class="sd">            super().__init__(controller)</span>
<span class="sd">            self._parameter = None</span>

<span class="sd">        def run(self):</span>
<span class="sd">            self._step1()</span>
<span class="sd">            self._step2()</span>

<span class="sd">        def _step1(self):</span>
<span class="sd">            pass</span>

<span class="sd">        def _step2(self):</span>
<span class="sd">            pass</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model component template/abstract base class.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to the run controller object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parent controller.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span>

    <span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Convenince method to get absolute path from run directory.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emmebank_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeScenario</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the Emme scenario object from the Emmebank at emmebank_path for the time_period ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            emmebank_path: valid Emmebank path, absolute or relative to root run directory</span>
<span class="sd">            time_period: valid time_period ID</span>

<span class="sd">        Returns</span>
<span class="sd">            Emme Scenario object (see Emme API Reference)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">):</span>
            <span class="n">emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
        <span class="n">emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
        <span class="n">scenario_id</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">tp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">emme_scenario_id</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span>
        <span class="p">}[</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">scenario_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return input time_period name or names and return list of time_period names.</span>

<span class="sd">        Implemented here for easy access for all components.</span>

<span class="sd">        Returns: list of uppercased string names of time periods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">time_period_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to top sheet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">top_sheet</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to logger.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">logger</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to trace.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate inputs are correct at model initiation, raise on error.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run model component.&quot;&quot;&quot;</span>

    <span class="c1"># @abstractmethod</span>
    <span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write progress to log file.&quot;&quot;&quot;</span>

    <span class="c1"># @abstractmethod</span>
    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify component outputs / results.&quot;&quot;&quot;</span>

    <span class="c1"># @abstractmethod</span>
    <span class="k">def</span> <span class="nf">write_top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write key outputs to the model top sheet.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.component.Component.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Model component template/abstract base class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Reference to the run controller object.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Model component template/abstract base class.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to the run controller object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">controller</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.controller" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">controller</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.controller" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Parent controller.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parent controller.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.get_abs_path" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_abs_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

<a href="#tm2py.components.component.Component.get_abs_path" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Convenince method to get absolute path from run directory.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Convenince method to get absolute path from run directory.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.get_emme_scenario" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_emme_scenario</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span></code>

<a href="#tm2py.components.component.Component.get_emme_scenario" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Get the Emme scenario object from the Emmebank at emmebank_path for the time_period ID.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>emmebank_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>valid Emmebank path, absolute or relative to root run directory</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>time_period</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>valid time_period ID</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns
    Emme Scenario object (see Emme API Reference)</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emmebank_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeScenario</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the Emme scenario object from the Emmebank at emmebank_path for the time_period ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        emmebank_path: valid Emmebank path, absolute or relative to root run directory</span>
<span class="sd">        time_period: valid time_period ID</span>

<span class="sd">    Returns</span>
<span class="sd">        Emme Scenario object (see Emme API Reference)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">):</span>
        <span class="n">emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
    <span class="n">emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
    <span class="n">scenario_id</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">tp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">emme_scenario_id</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span>
    <span class="p">}[</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">scenario_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.logger" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">logger</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.logger" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Reference to logger.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reference to logger.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">logger</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.report_progress" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">report_progress</span><span class="p">()</span></code>

<a href="#tm2py.components.component.Component.report_progress" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Write progress to log file.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write progress to log file.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#tm2py.components.component.Component.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run model component.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run model component.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.time_period_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">time_period_names</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.time_period_names" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Return input time_period name or names and return list of time_period names.</p>
<p>Implemented here for easy access for all components.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return input time_period name or names and return list of time_period names.</span>

<span class="sd">    Implemented here for easy access for all components.</span>

<span class="sd">    Returns: list of uppercased string names of time periods</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">time_period_names</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.top_sheet" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">top_sheet</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.top_sheet" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Reference to top sheet.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reference to top sheet.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">top_sheet</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.trace" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">trace</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.component.Component.trace" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Reference to trace.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reference to trace.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#tm2py.components.component.Component.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate inputs are correct at model initiation, raise on error.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate inputs are correct at model initiation, raise on error.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.verify" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">verify</span><span class="p">()</span></code>

<a href="#tm2py.components.component.Component.verify" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Verify component outputs / results.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify component outputs / results.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Component.write_top_sheet" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">write_top_sheet</span><span class="p">()</span></code>

<a href="#tm2py.components.component.Component.write_top_sheet" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Write key outputs to the model top sheet.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write key outputs to the model top sheet.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.component.FileFormatError" class="doc doc-heading">
        <code>FileFormatError</code>


<a href="#tm2py.components.component.FileFormatError" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>Exception</code></p>

  
      <p>Exception raised when a file is not in the expected format.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FileFormatError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised when a file is not in the expected format.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exception for invalid file formats.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String representation for FileFormatError.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s2"> is not a valid format.&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.FileFormatError.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

<a href="#tm2py.components.component.FileFormatError.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Exception for invalid file formats.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception for invalid file formats.&quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.FileFormatError.__str__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__str__</span><span class="p">()</span></code>

<a href="#tm2py.components.component.FileFormatError.__str__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>String representation for FileFormatError.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;String representation for FileFormatError.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s2"> is not a valid format.&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.component.Subcomponent" class="doc doc-heading">
        <code>Subcomponent</code>


<a href="#tm2py.components.component.Subcomponent" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Template for sub-component class.</p>
<p>A sub-component is a more loosly defined component that allows for input into the run()
method.  It is used to break-up larger processes into smaller chunks which can be:
(1) re-used across components (i.e toll choice)
(2) updated/subbed in to a parent component(s) run method based on the expected API
(3) easier to test, understand and debug.
(4) more consistent with the algorithms we understand from transportation planning 101</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Subcomponent</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Template for sub-component class.</span>

<span class="sd">    A sub-component is a more loosly defined component that allows for input into the run()</span>
<span class="sd">    method.  It is used to break-up larger processes into smaller chunks which can be:</span>
<span class="sd">    (1) re-used across components (i.e toll choice)</span>
<span class="sd">    (2) updated/subbed in to a parent component(s) run method based on the expected API</span>
<span class="sd">    (3) easier to test, understand and debug.</span>
<span class="sd">    (4) more consistent with the algorithms we understand from transportation planning 101</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for model sub-component abstract base class.</span>

<span class="sd">        Only calls the super class constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to the run controller object.</span>
<span class="sd">            component (Component): Reference to the parent component object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">component</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run sub-component, allowing for multiple inputs.</span>

<span class="sd">        Allowing for inputs to the run() method is what differentiates a sub-component from</span>
<span class="sd">        a component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Subcomponent.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.component.Subcomponent.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for model sub-component abstract base class.</p>
<p>Only calls the super class constructor.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Reference to the run controller object.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>component</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code>
          </td>
          <td><p>Reference to the parent component object.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for model sub-component abstract base class.</span>

<span class="sd">    Only calls the super class constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to the run controller object.</span>
<span class="sd">        component (Component): Reference to the parent component object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">component</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.component.Subcomponent.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#tm2py.components.component.Subcomponent.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run sub-component, allowing for multiple inputs.</p>
<p>Allowing for inputs to the run() method is what differentiates a sub-component from
a component.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/component.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run sub-component, allowing for multiple inputs.</span>

<span class="sd">    Allowing for inputs to the run() method is what differentiates a sub-component from</span>
<span class="sd">    a component.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h3 id="demand-components">Demand Components<a class="headerlink" href="#demand-components" title="Permanent link"> ¶</a></h3>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.prepare_demand" class="doc doc-heading">
          <code>tm2py.components.demand.prepare_demand</code>


<a href="#tm2py.components.demand.prepare_demand" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Demand loading from OMX to Emme database.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.prepare_demand.PrepareDemand" class="doc doc-heading">
        <code>PrepareDemand</code>


<a href="#tm2py.components.demand.prepare_demand.PrepareDemand" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code>, <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Abstract base class to import and average demand.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareDemand</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract base class to import and average demand.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for PrepareDemand class.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for the current run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">omx_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">demand</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redim_demand</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">demand</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_redim_demand</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
        <span class="n">_shape</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">_shape</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">num_zones</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">demand</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">_shape</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">num_zones</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
            <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided demand matrix is larger (</span><span class="si">{</span><span class="n">_shape</span><span class="si">}</span><span class="s2">) than the </span><span class="se">\</span>
<span class="s2">                specified number of zones: </span><span class="si">{</span><span class="n">num_zones</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">demand</span>

    <span class="c1"># Disable too many arguments recommendation</span>
    <span class="c1"># pylint: disable=R0913</span>
    <span class="k">def</span> <span class="nf">_save_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">demand</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">apply_msa</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">msa_iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">apply_msa</span> <span class="ow">or</span> <span class="n">msa_iteration</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">available_matrix_identifier</span><span class="p">(</span><span class="s2">&quot;FULL&quot;</span><span class="p">)</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
                <span class="n">matrix</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">matrix</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;error averaging demand: matrix </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
            <span class="n">prev_demand</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get_numpy_data</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">prev_demand</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">msa_iteration</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">demand</span> <span class="o">-</span> <span class="n">prev_demand</span><span class="p">)</span>

        <span class="n">matrix</span><span class="o">.</span><span class="n">set_numpy_data</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_zero_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zero_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="s1">&#39;ms&quot;zero&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zero_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">available_matrix_identifier</span><span class="p">(</span><span class="s2">&quot;SCALAR&quot;</span><span class="p">)</span>
            <span class="n">zero_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
            <span class="n">zero_matrix</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;zero&quot;</span>
            <span class="n">zero_matrix</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;zero demand matrix&quot;</span>
        <span class="n">zero_matrix</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.prepare_demand.PrepareDemand.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareDemand.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for PrepareDemand class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Run controller for the current run.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for PrepareDemand class.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for the current run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.prepare_demand.PrepareHighwayDemand" class="doc doc-heading">
        <code>PrepareHighwayDemand</code>


<a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.demand.prepare_demand.PrepareDemand" href="#tm2py.components.demand.prepare_demand.PrepareDemand">PrepareDemand</a></code></p>

  
      <p>Import and average highway demand.</p>
<p>Demand is imported from OMX files based on reference file paths and OMX
matrix names in highway assignment config (highway.classes).
The demand is average using MSA with the current demand matrices
(in the Emmebank) if the controller.iteration &gt; 1.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>parent RunController object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareHighwayDemand</span><span class="p">(</span><span class="n">PrepareDemand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import and average highway demand.</span>

<span class="sd">    Demand is imported from OMX files based on reference file paths and OMX</span>
<span class="sd">    matrix names in highway assignment config (highway.classes).</span>
<span class="sd">    The demand is average using MSA with the current demand matrices</span>
<span class="sd">    (in the Emmebank) if the controller.iteration &gt; 1.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for PrepareHighwayDemand.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to run controller object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="c1"># @LogStartEnd(&quot;prepare highway demand&quot;)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open combined demand OMX files from demand models and prepare for assignment.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_zero_matrix</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_demand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">demand_config</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load demand from OMX files and save to Emme matrix for highway assignment.</span>

<span class="sd">        Average with previous demand (MSA) if the current iteration &gt; 1</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of the highway assignment class</span>
<span class="sd">            description (str): the description for the highway assignment class</span>
<span class="sd">            demand_config (dict): the list of file cross-reference(s) for the demand to be loaded</span>
<span class="sd">                {&quot;source&quot;: &lt;name of demand model component&gt;,</span>
<span class="sd">                 &quot;name&quot;: &lt;OMX key name&gt;,</span>
<span class="sd">                 &quot;factor&quot;: &lt;factor to apply to demand in this file&gt;}</span>
<span class="sd">            time_period (str): the time time_period ID (name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand</span><span class="p">(</span><span class="n">demand_config</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_config</span> <span class="ow">in</span> <span class="n">demand_config</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand</span><span class="p">(</span><span class="n">file_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="n">demand_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2"> demand&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_demand</span><span class="p">(</span><span class="n">demand_name</span><span class="p">,</span> <span class="n">demand</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">apply_msa</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
        <span class="c1"># Load demand from cross-referenced source file,</span>
        <span class="c1"># the named demand model component under the key highway_demand_file</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">file_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;factor&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">highway_demand_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.prepare_demand.PrepareHighwayDemand.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for PrepareHighwayDemand.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Reference to run controller object.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for PrepareHighwayDemand.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to run controller object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.prepare_demand.PrepareHighwayDemand.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.prepare_demand.PrepareHighwayDemand.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Open combined demand OMX files from demand models and prepare for assignment.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/prepare_demand.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open combined demand OMX files from demand models and prepare for assignment.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_zero_matrix</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h4 id="household-demand">Household Demand<a class="headerlink" href="#household-demand" title="Permanent link"> ¶</a></h4>
<p>Personal travel demand generated by household members.</p>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.household" class="doc doc-heading">
          <code>tm2py.components.demand.household</code>


<a href="#tm2py.components.demand.household" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Placeholder docstring for CT-RAMP related components for household residents&rsquo; model.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.household.HouseholdModel" class="doc doc-heading">
        <code>HouseholdModel</code>


<a href="#tm2py.components.demand.household.HouseholdModel" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Run household resident model.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/household.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HouseholdModel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run household resident model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates inputs for component.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the the household resident travel demand model.</span>

<span class="sd">        Steps:</span>
<span class="sd">            1. Starts household manager.</span>
<span class="sd">            2. Starts matrix manager.</span>
<span class="sd">            3. Starts resident travel model (CTRAMP).</span>
<span class="sd">            4. Cleans up CTRAMP java.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_household_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_matrix_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_resident_model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_java</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_start_household_manager</span><span class="p">():</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CALL CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\r</span><span class="s2">untime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\b</span><span class="s2">in;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="s1">&#39;CALL CTRAMP</span><span class="se">\\</span><span class="s1">runtime</span><span class="se">\\</span><span class="s1">runHhMgr.cmd &quot;%JAVA_PATH%&quot; &quot;%HOST_IP_ADDRESS%&quot;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_household_manager&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_start_matrix_manager</span><span class="p">():</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CALL CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\r</span><span class="s2">untime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\b</span><span class="s2">in;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="s1">&#39;CALL CTRAMP</span><span class="se">\r</span><span class="s1">untime</span><span class="se">\r</span><span class="s1">unMtxMgr.cmd %HOST_IP_ADDRESS% &quot;%JAVA_PATH%&quot;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_matrix_manager&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_resident_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sample_rate_iteration</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">}</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">sample_rate_iteration</span><span class="p">[</span><span class="n">iteration</span><span class="p">]</span>
        <span class="n">_shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s2">&quot;CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">mtctm2.properties&quot;</span><span class="p">,</span> <span class="s2">&quot;mtctm2.properties&quot;</span><span class="p">)</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CALL CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\r</span><span class="s2">untime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\b</span><span class="s2">in;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;CALL CTRAMP</span><span class="se">\r</span><span class="s1">untime</span><span class="se">\r</span><span class="s1">unMTCTM2ABM.cmd </span><span class="si">{</span><span class="n">sample_rate</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s1"> &quot;%JAVA_PATH%&quot;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;run_resident_model&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_stop_java</span><span class="p">():</span>
        <span class="n">run_process</span><span class="p">([</span><span class="s1">&#39;taskkill /im &quot;java.exe&quot; /F&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.household.HouseholdModel.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.household.HouseholdModel.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run the the household resident travel demand model.</p>

<details class="steps">
  <summary>Steps</summary>
  <ol>
<li>Starts household manager.</li>
<li>Starts matrix manager.</li>
<li>Starts resident travel model (CTRAMP).</li>
<li>Cleans up CTRAMP java.</li>
</ol>
</details>
      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/household.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the the household resident travel demand model.</span>

<span class="sd">    Steps:</span>
<span class="sd">        1. Starts household manager.</span>
<span class="sd">        2. Starts matrix manager.</span>
<span class="sd">        3. Starts resident travel model (CTRAMP).</span>
<span class="sd">        4. Cleans up CTRAMP java.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_household_manager</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_matrix_manager</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_resident_model</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_java</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.household.HouseholdModel.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.household.HouseholdModel.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validates inputs for component.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/household.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validates inputs for component.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.HouseholdConfig" class="doc doc-heading">
        <code>tm2py.config.HouseholdConfig</code>


<a href="#tm2py.config.HouseholdConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Household (residents) model parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HouseholdConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Household (residents) model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">transit_demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h4 id="air-passenger-demand">Air Passenger Demand<a class="headerlink" href="#air-passenger-demand" title="Permanent link"> ¶</a></h4>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.air_passenger" class="doc doc-heading">
          <code>tm2py.components.demand.air_passenger</code>


<a href="#tm2py.components.demand.air_passenger" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Module containing the AirPassenger class which builds the airport trip matrices.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.air_passenger.AirPassenger" class="doc doc-heading">
        <code>AirPassenger</code>


<a href="#tm2py.components.demand.air_passenger.AirPassenger" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Builds the airport trip matrices.</p>
<p>input: nonres/{year}_{tofrom}{airport}.csv
output: five time-of-day-specific OMX files with matrices DA, SR2, SR3</p>
<p>Notes:
These are independent of level-of-service.</p>
<p>Note that the reference names, years, file paths and other key details
are controlled via the config, air_passenger section. See the
AirPassengerConfig doc for details on specifying these inputs.</p>
<p>The following details are based on the default config values.</p>
<p>Creates air passenger vehicle trip tables for the Bay Area&rsquo;s three major
airports, namely SFO, OAK, and SJC.  Geoff Gosling, a consultant, created
vehicle trip tables segmented by time of day, travel mode, and access/egress
direction (i.e. to the airport or from the airport) for years 2007 and 2035.
The tables are based on a 2006 Air Passenger survey, which was conducted
at SFO and OAK (but not SJC).</p>

<details class="the-travel-modes-are-as-follows">
  <summary>The travel modes are as follows</summary>
  <p>(a) escort (drive alone, shared ride 2, and shared ride 3+)
(b) park (da, sr2, &amp; sr3+)
&copy; rental car (da, sr2, &amp; sr3+)
(d) taxi ((da, sr2, &amp; sr3+)
(e) limo (da, sr2, &amp; sr3+)
(f) shared ride van (all assumed to be sr3);
(g) hotel shuttle (all assumed to be sr3); and,
(h) charter bus (all assumed to be sr3).</p>
</details>      <p>The shared ride van, hotel shuttle, and charter bus modes are assumed to
have no deadhead travel. The return escort trip is included, as are the
deadhead limo and taxi trips.</p>
<p>The scripts reads in csv files adapted from Mr. Gosling&rsquo;s Excel files,
and creates a highway-assignment ready OMX matrix file for each time-of-day
interval.</p>
<p>Assumes that no air passengers use HOT lanes (probably not exactly true
in certain future year scenarios, but the assumption is made here as a
simplification).  Simple linear interpolations are used to estimate vehicle
demand in years other than 2007 and 2035, including 2015, 2020, 2025, 2030,
and 2040.</p>
<p>Transit travel to the airports is not included in these vehicle trip tables.</p>

<details class="input">
  <summary>Input</summary>
  <p>Year-, access/egress-, and airport-specific database file with 90 columns
of data for each TAZ.  There are 18 columns for each time-of-day interval
as follows:
        (1)   Escort, drive alone
        (2)   Escort, shared ride 2
        (3)   Escort, shared ride 3+
        (4)   Park, drive alone
        (5)   Park, shared ride 2
        (6)   Park, shared ride 3+
        (7)   Rental car, drive alone
        (8)   Rental car, shared ride 2
        (9)   Rental car, shared ride 3+
        (10)  Taxi, drive alone
        (11)  Taxi, shared ride 2
        (12)  Taxi, shared ride 3+
        (13)  Limo, drive alone
        (14)  Limo, shared ride 2
        (15)  Limo, shared ride 3+
        (16)  Shared ride van, shared ride 3+
        (17)  Hotel shuttle, shared ride 3+
        (18)  Charter bus, shared ride 3+</p>
</details>      <p>Five time-of-day-specific tables, each containing origin/destination vehicle
 matrices for the following modes:
           (1) drive alone (DA)
           (2) shared ride 2 (SR2)
           (3) shared ride 3+ (SR3)</p>

<details class="internal-properties">
  <summary>Internal properties</summary>
  <p>_start_year
_end_year
_mode_groups:
_out_names:</p>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AirPassenger</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Builds the airport trip matrices.</span>

<span class="sd">    input: nonres/{year}_{tofrom}{airport}.csv</span>
<span class="sd">    output: five time-of-day-specific OMX files with matrices DA, SR2, SR3</span>

<span class="sd">    Notes:</span>
<span class="sd">    These are independent of level-of-service.</span>

<span class="sd">    Note that the reference names, years, file paths and other key details</span>
<span class="sd">    are controlled via the config, air_passenger section. See the</span>
<span class="sd">    AirPassengerConfig doc for details on specifying these inputs.</span>

<span class="sd">    The following details are based on the default config values.</span>

<span class="sd">    Creates air passenger vehicle trip tables for the Bay Area&#39;s three major</span>
<span class="sd">    airports, namely SFO, OAK, and SJC.  Geoff Gosling, a consultant, created</span>
<span class="sd">    vehicle trip tables segmented by time of day, travel mode, and access/egress</span>
<span class="sd">    direction (i.e. to the airport or from the airport) for years 2007 and 2035.</span>
<span class="sd">    The tables are based on a 2006 Air Passenger survey, which was conducted</span>
<span class="sd">    at SFO and OAK (but not SJC).</span>

<span class="sd">    The travel modes are as follows:</span>
<span class="sd">        (a) escort (drive alone, shared ride 2, and shared ride 3+)</span>
<span class="sd">        (b) park (da, sr2, &amp; sr3+)</span>
<span class="sd">        (c) rental car (da, sr2, &amp; sr3+)</span>
<span class="sd">        (d) taxi ((da, sr2, &amp; sr3+)</span>
<span class="sd">        (e) limo (da, sr2, &amp; sr3+)</span>
<span class="sd">        (f) shared ride van (all assumed to be sr3);</span>
<span class="sd">        (g) hotel shuttle (all assumed to be sr3); and,</span>
<span class="sd">        (h) charter bus (all assumed to be sr3).</span>

<span class="sd">    The shared ride van, hotel shuttle, and charter bus modes are assumed to</span>
<span class="sd">    have no deadhead travel. The return escort trip is included, as are the</span>
<span class="sd">    deadhead limo and taxi trips.</span>

<span class="sd">    The scripts reads in csv files adapted from Mr. Gosling&#39;s Excel files,</span>
<span class="sd">    and creates a highway-assignment ready OMX matrix file for each time-of-day</span>
<span class="sd">    interval.</span>

<span class="sd">    Assumes that no air passengers use HOT lanes (probably not exactly true</span>
<span class="sd">    in certain future year scenarios, but the assumption is made here as a</span>
<span class="sd">    simplification).  Simple linear interpolations are used to estimate vehicle</span>
<span class="sd">    demand in years other than 2007 and 2035, including 2015, 2020, 2025, 2030,</span>
<span class="sd">    and 2040.</span>

<span class="sd">    Transit travel to the airports is not included in these vehicle trip tables.</span>

<span class="sd">    Input:</span>
<span class="sd">        Year-, access/egress-, and airport-specific database file with 90 columns</span>
<span class="sd">        of data for each TAZ.  There are 18 columns for each time-of-day interval</span>
<span class="sd">        as follows:</span>
<span class="sd">                (1)   Escort, drive alone</span>
<span class="sd">                (2)   Escort, shared ride 2</span>
<span class="sd">                (3)   Escort, shared ride 3+</span>
<span class="sd">                (4)   Park, drive alone</span>
<span class="sd">                (5)   Park, shared ride 2</span>
<span class="sd">                (6)   Park, shared ride 3+</span>
<span class="sd">                (7)   Rental car, drive alone</span>
<span class="sd">                (8)   Rental car, shared ride 2</span>
<span class="sd">                (9)   Rental car, shared ride 3+</span>
<span class="sd">                (10)  Taxi, drive alone</span>
<span class="sd">                (11)  Taxi, shared ride 2</span>
<span class="sd">                (12)  Taxi, shared ride 3+</span>
<span class="sd">                (13)  Limo, drive alone</span>
<span class="sd">                (14)  Limo, shared ride 2</span>
<span class="sd">                (15)  Limo, shared ride 3+</span>
<span class="sd">                (16)  Shared ride van, shared ride 3+</span>
<span class="sd">                (17)  Hotel shuttle, shared ride 3+</span>
<span class="sd">                (18)  Charter bus, shared ride 3+</span>

<span class="sd">     Output:</span>
<span class="sd">     Five time-of-day-specific tables, each containing origin/destination vehicle</span>
<span class="sd">     matrices for the following modes:</span>
<span class="sd">               (1) drive alone (DA)</span>
<span class="sd">               (2) shared ride 2 (SR2)</span>
<span class="sd">               (3) shared ride 3+ (SR3)</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _start_year</span>
<span class="sd">        _end_year</span>
<span class="sd">        _mode_groups:</span>
<span class="sd">        _out_names:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the airport trip matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent Controller object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">year</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">airports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">airport_names</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_aggregation</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">demand_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_aggregation</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">access_mode_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">c_name</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">access_modes</span> <span class="k">for</span> <span class="n">c_name</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_classes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">c_name</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">mode</span> <span class="k">for</span> <span class="n">c_name</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">demand_classes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the Air Passenger Demand model to generate the demand matrices.</span>

<span class="sd">        Steps:</span>
<span class="sd">            1. Load the demand data from the CSV files.</span>
<span class="sd">            2. Aggregate the demand data into the assignable classes.</span>
<span class="sd">            3. Create the demand matrices be interpolating the demand data.</span>
<span class="sd">            4. Write the demand matrices to OMX files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_air_pax_demand</span><span class="p">()</span>
        <span class="n">aggr_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_demand</span><span class="p">(</span><span class="n">input_demand</span><span class="p">)</span>

        <span class="n">demand</span> <span class="o">=</span> <span class="n">interpolate_dfs</span><span class="p">(</span>
            <span class="n">aggr_demand</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario_year</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_result</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_air_pax_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Loads demand from the CSV files into single pandas dataframe.</span>

<span class="sd">        Uses the following configs to determine the input file names and paths:</span>
<span class="sd">        - self.config.air_passenger.input_demand_folder</span>
<span class="sd">        - self.config.air_passenger.airport_names</span>
<span class="sd">        - self.config.air_passenger.reference_start_year</span>
<span class="sd">        - self.config.air_passenger.reference_end_year</span>

<span class="sd">        Using the pattern: f&quot;{year}_{direction}{airport}.csv&quot;</span>

<span class="sd">        Returns: pandas dataframe with the following columns:</span>
<span class="sd">            (1) airport</span>
<span class="sd">            (2) time_of_day</span>
<span class="sd">            (3) access_mode</span>
<span class="sd">            (4) demand</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_start_demand_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_air_demand_for_year</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">)</span>
        <span class="n">_end_demand_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_air_demand_for_year</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">)</span>

        <span class="n">_air_pax_demand_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">_start_demand_df</span><span class="p">,</span>
            <span class="n">_end_demand_df</span><span class="p">,</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
            <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEST&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">_grouped_air_pax_demand_df</span> <span class="o">=</span> <span class="n">_air_pax_demand_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEST&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_grouped_air_pax_demand_df</span>

    <span class="k">def</span> <span class="nf">_input_demand_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">airport</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="n">_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_demand_filename_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">airport</span><span class="o">=</span><span class="n">airport</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_demand_folder</span><span class="p">),</span> <span class="n">_file_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_air_demand_for_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Creates a dataframe of concatenated data from CSVs for all airport x direction combos.</span>

<span class="sd">        Args:</span>
<span class="sd">            year (str): year of demand</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: concatenation of all CSVs that were read in as a dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_airport_direction</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">airports</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">demand_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">airport</span><span class="p">,</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">_airport_direction</span><span class="p">:</span>
            <span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_demand_filename</span><span class="p">(</span><span class="n">airport</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">direction</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">demand_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">demand_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">demand_df</span><span class="p">,</span> <span class="n">_df</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">demand_df</span> <span class="o">=</span> <span class="n">_df</span>

        <span class="k">return</span> <span class="n">demand_df</span>

    <span class="k">def</span> <span class="nf">_aggregate_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_demand</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Aggregate demand accross access modes to assignable classes for each year.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_demand: pandas dataframe with the columns for each combo of:</span>
<span class="sd">                {_period}_{_access}_{_group}_{_year}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aggr_demand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">_year_tp_group_accessmode</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">access_mode_groups</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># TODO This should be done entirely in pandas using group-by</span>
        <span class="k">for</span> <span class="n">_year</span><span class="p">,</span> <span class="n">_period</span><span class="p">,</span> <span class="p">(</span><span class="n">_class</span><span class="p">,</span> <span class="n">_access_modes</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_year_tp_group_accessmode</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">input_demand</span><span class="p">[</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_access</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_year</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">_access</span> <span class="ow">in</span> <span class="n">_access_modes</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="n">aggr_demand</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">aggr_demand</span>

    <span class="k">def</span> <span class="nf">_export_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export resulting model year demand to OMX files by period.&quot;&quot;&quot;</span>
        <span class="n">path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_trip_table_directory</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_tmplt</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="n">_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">path_tmplt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outfile_trip_table_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">_period</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">df_to_omx</span><span class="p">(</span>
                <span class="n">demand_df</span><span class="p">,</span>
                <span class="p">{</span>
                    <span class="n">_mode</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">for</span> <span class="n">_class</span><span class="p">,</span> <span class="n">_mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_modes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">},</span>
                <span class="n">_file_path</span><span class="p">,</span>
                <span class="n">orig_column</span><span class="o">=</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span>
                <span class="n">dest_column</span><span class="o">=</span><span class="s2">&quot;DEST&quot;</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.air_passenger.AirPassenger.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Build the airport trip matrices.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>parent Controller object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build the airport trip matrices.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent Controller object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_start_year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_end_year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scenario_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">year</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">airports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">airport_names</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_demand_classes</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_access_mode_groups</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_modes</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.air_passenger.AirPassenger.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run the Air Passenger Demand model to generate the demand matrices.</p>

<details class="steps">
  <summary>Steps</summary>
  <ol>
<li>Load the demand data from the CSV files.</li>
<li>Aggregate the demand data into the assignable classes.</li>
<li>Create the demand matrices be interpolating the demand data.</li>
<li>Write the demand matrices to OMX files.</li>
</ol>
</details>
      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the Air Passenger Demand model to generate the demand matrices.</span>

<span class="sd">    Steps:</span>
<span class="sd">        1. Load the demand data from the CSV files.</span>
<span class="sd">        2. Aggregate the demand data into the assignable classes.</span>
<span class="sd">        3. Create the demand matrices be interpolating the demand data.</span>
<span class="sd">        4. Write the demand matrices to OMX files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">input_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_air_pax_demand</span><span class="p">()</span>
    <span class="n">aggr_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_demand</span><span class="p">(</span><span class="n">input_demand</span><span class="p">)</span>

    <span class="n">demand</span> <span class="o">=</span> <span class="n">interpolate_dfs</span><span class="p">(</span>
        <span class="n">aggr_demand</span><span class="p">,</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_year</span><span class="p">],</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_year</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_result</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.air_passenger.AirPassenger.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.air_passenger.AirPassenger.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate the inputs.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.AirPassengerDemandAggregationConfig" class="doc doc-heading">
        <code>tm2py.config.AirPassengerDemandAggregationConfig</code>


<a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Air passenger demand aggregation input parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AirPassengerDemandAggregationConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Air passenger demand aggregation input parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: (src_group_name) name used for the class group in the input columns</span>
<span class="sd">            for the trip tables,</span>
<span class="sd">        mode: (result_class_name) name used in the output OMX matrix names, note</span>
<span class="sd">            that this should match the expected naming convention in the</span>
<span class="sd">            HighwayClassDemandConfig name(s)</span>
<span class="sd">        access_modes: list of names used for the access modes in the input</span>
<span class="sd">            columns for the trip tables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h4 id="commercial-demand">Commercial Demand<a class="headerlink" href="#commercial-demand" title="Permanent link"> ¶</a></h4>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.commercial" class="doc doc-heading">
          <code>tm2py.components.demand.commercial</code>


<a href="#tm2py.components.demand.commercial" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Commercial vehicle / truck model module.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.commercial.CommercialVehicleModel" class="doc doc-heading">
        <code>CommercialVehicleModel</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Commercial Vehicle demand model.</p>

<details class="generates-truck-demand-matrices-from">
  <summary>Generates truck demand matrices from</summary>
  <ul>
<li>land use</li>
<li>highway network impedances</li>
<li>parameters</li>
</ul>
</details>
<details class="segmented-into-four-truck-types">
  <summary>Segmented into four truck types</summary>
  <p>(1) very small trucks (two-axle, four-tire),
(2) small trucks (two-axle, six-tire),
(3) medium trucks (three-axle),
(4) large or combination (four or more axle) trucks.</p>
</details>
<details class="input">
  <summary>(1) MAZ csv data file with the employment and household counts.</summary>
  <p>(2) Skims
(3) K-Factors
(4)</p>
</details>      <p>Notes:
(1) Based on the BAYCAST truck model, no significant updates.
(2) Combined Chuck&rsquo;s calibration adjustments into the NAICS-based model coefficients.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleModel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Commercial Vehicle demand model.</span>

<span class="sd">    Generates truck demand matrices from:</span>
<span class="sd">        - land use</span>
<span class="sd">        - highway network impedances</span>
<span class="sd">        - parameters</span>

<span class="sd">    Segmented into four truck types:</span>
<span class="sd">        (1) very small trucks (two-axle, four-tire),</span>
<span class="sd">        (2) small trucks (two-axle, six-tire),</span>
<span class="sd">        (3) medium trucks (three-axle),</span>
<span class="sd">        (4) large or combination (four or more axle) trucks.</span>

<span class="sd">    Input:  (1) MAZ csv data file with the employment and household counts.</span>
<span class="sd">            (2) Skims</span>
<span class="sd">            (3) K-Factors</span>
<span class="sd">            (4)</span>
<span class="sd">    Output:</span>

<span class="sd">    Notes:</span>
<span class="sd">    (1) Based on the BAYCAST truck model, no significant updates.</span>
<span class="sd">    (2) Combined Chuck&#39;s calibration adjustments into the NAICS-based model coefficients.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripGeneration component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;trip generation&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTripGeneration</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="s2">&quot;trip distribution&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTripDistribution</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="s2">&quot;time of day&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTimeOfDay</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="s2">&quot;toll choice&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTollChoice</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trk_impedances</span> <span class="o">=</span> <span class="p">{</span><span class="n">imp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">imp</span> <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">impedances</span><span class="p">}</span>

        <span class="c1"># Emme matrix management (lazily evaluated)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Interim Results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">purposes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span><span class="n">trk_class</span><span class="o">.</span><span class="n">purpose</span> <span class="k">for</span> <span class="n">trk_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_gen</span><span class="o">.</span><span class="n">classes</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">trk_class</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">trk_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run commercial vehicle model.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;trip generation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;trip distribution&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;time of day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_results_as_omx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to highway assignment Emmebank.</span>

<span class="sd">        TODO</span>
<span class="sd">            This should really be in the controller?</span>
<span class="sd">            Or part of network.skims?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return emme scenario from emmebank.</span>

<span class="sd">        Use first valid scenario for reference Zone IDs.</span>

<span class="sd">        TODO</span>
<span class="sd">            This should really be in the controller?</span>
<span class="sd">            Or part of network.skims?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_ref_scenario_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">emme_scenario_id</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">_ref_scenario_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">matrix_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Access to MatrixCache to Emmebank for given emme_scenario.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="n">MatrixCache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emme_scenario</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_export_results_as_omx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_demand</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export assignable class demands to OMX files by time-of-day.&quot;&quot;&quot;</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_trip_table_directory</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">outdir</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">matrices</span> <span class="ow">in</span> <span class="n">class_demand</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outfile_trip_table_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">output_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for the CommercialVehicleTripGeneration component.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Run controller for model run.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripGeneration component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;trip generation&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTripGeneration</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="s2">&quot;trip distribution&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTripDistribution</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="s2">&quot;time of day&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTimeOfDay</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="s2">&quot;toll choice&quot;</span><span class="p">:</span> <span class="n">CommercialVehicleTollChoice</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">trk_impedances</span> <span class="o">=</span> <span class="p">{</span><span class="n">imp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">imp</span> <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">impedances</span><span class="p">}</span>

    <span class="c1"># Emme matrix management (lazily evaluated)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Interim Results</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleModel.emme_scenario" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_scenario</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emme_scenario" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Return emme scenario from emmebank.</p>
<p>Use first valid scenario for reference Zone IDs.</p>
<p>TODO
    This should really be in the controller?
    Or part of network.skims?</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return emme scenario from emmebank.</span>

<span class="sd">    Use first valid scenario for reference Zone IDs.</span>

<span class="sd">    TODO</span>
<span class="sd">        This should really be in the controller?</span>
<span class="sd">        Or part of network.skims?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_ref_scenario_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">emme_scenario_id</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">_ref_scenario_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleModel.emmebank" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emmebank</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.emmebank" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Reference to highway assignment Emmebank.</p>
<p>TODO
    This should really be in the controller?
    Or part of network.skims?</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reference to highway assignment Emmebank.</span>

<span class="sd">    TODO</span>
<span class="sd">        This should really be in the controller?</span>
<span class="sd">        Or part of network.skims?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleModel.matrix_cache" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">matrix_cache</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.matrix_cache" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Access to MatrixCache to Emmebank for given emme_scenario.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">matrix_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Access to MatrixCache to Emmebank for given emme_scenario.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="n">MatrixCache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emme_scenario</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleModel.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run commercial vehicle model.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run commercial vehicle model.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;trip generation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;trip distribution&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tripends_df</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;time of day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daily_demand_dict</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_demand_dict</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_results_as_omx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trkclass_tp_toll_demand_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleModel.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate the inputs.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay" class="doc doc-heading">
        <code>CommercialVehicleTimeOfDay</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Subcomponent" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>

  
      <p>Commercial vehicle (truck) Time of Day Split for 4 sizes of truck.</p>
<p>Input:  Trips origin and destination matrices by 4 truck sizes
Ouput:  20 trips origin and destination matrices by 4 truck sizes by 5 times periods</p>

<details class="note">
  <summary>Note</summary>
  <p>The diurnal factors are taken from the BAYCAST-90 model with adjustments made</p>
</details>      <p>during calibration to the very small truck values to better match counts.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleTimeOfDay</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) Time of Day Split for 4 sizes of truck.</span>

<span class="sd">    Input:  Trips origin and destination matrices by 4 truck sizes</span>
<span class="sd">    Ouput:  20 trips origin and destination matrices by 4 truck sizes by 5 times periods</span>

<span class="sd">    Note:</span>
<span class="sd">        The diurnal factors are taken from the BAYCAST-90 model with adjustments made</span>
<span class="sd">    during calibration to the very small truck values to better match counts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTimeOfDay component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">            component (Component): Parent component of sub-component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_of_day</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">split_factor</span> <span class="o">=</span> <span class="s2">&quot;od&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">trk_class</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">trk_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_period_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns split fraction dictonary mapped to [time period class][time period].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">c_name</span><span class="p">:</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">time_period</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">time_period_split</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">c_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_configs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">daily_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Splits the daily demand by time of day based on factors in the config.</span>

<span class="sd">        Uses self.config.truck.classes.{class_name}.time_of_day_split to split the daily demand.</span>

<span class="sd">        #TODO use TimePeriodSplit</span>
<span class="sd">        Args:</span>
<span class="sd">            daily_demand: dictionary of truck type name to numpy array of</span>
<span class="sd">                truck type daily demand</span>

<span class="sd">        Returns:</span>
<span class="sd">             Nested dictionary of truck class: time period name =&gt; numpy array of demand</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

        <span class="n">_class_timeperiod</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_t_class</span><span class="p">,</span> <span class="n">_tp</span> <span class="ow">in</span> <span class="n">_class_timeperiod</span><span class="p">:</span>
            <span class="n">trkclass_tp_demand_dict</span><span class="p">[</span><span class="n">_t_class</span><span class="p">][</span><span class="n">_tp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">class_period_splits</span><span class="p">[</span><span class="n">_t_class</span><span class="p">][</span><span class="n">_tp</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="bp">self</span><span class="o">.</span><span class="n">split_factor</span><span class="p">]</span>
                <span class="o">*</span> <span class="n">daily_demand</span><span class="p">[</span><span class="n">_t_class</span><span class="p">],</span>
                <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">trkclass_tp_demand_dict</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for the CommercialVehicleTimeOfDay component.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Run controller for model run.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>component</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code>
          </td>
          <td><p>Parent component of sub-component</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTimeOfDay component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">        component (Component): Parent component of sub-component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_of_day</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">split_factor</span> <span class="o">=</span> <span class="s2">&quot;od&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_configs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.class_period_splits" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">class_period_splits</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.class_period_splits" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Returns split fraction dictonary mapped to [time period class][time period].</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">class_period_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns split fraction dictonary mapped to [time period class][time period].&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">c_name</span><span class="p">:</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">time_period</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">time_period_split</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">c_name</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_configs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_period_splits</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Splits the daily demand by time of day based on factors in the config.</p>
<p>Uses self.config.truck.classes.{class_name}.time_of_day_split to split the daily demand.</p>
<h6 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run--todo-use-timeperiodsplit">TODO use TimePeriodSplit<a class="headerlink" href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.run--todo-use-timeperiodsplit" title="Permanent link"> ¶</a></h6>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>daily_demand</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="tm2py.components.demand.commercial.NumpyArray">NumpyArray</span>]</code>
          </td>
          <td><p>dictionary of truck type name to numpy array of
truck type daily demand</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Dict">Dict</span>[str, <span title="tm2py.components.demand.commercial.NumpyArray">NumpyArray</span>]]</code>
          </td>
          <td><p>Nested dictionary of truck class: time period name =&gt; numpy array of demand</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">daily_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;Splits the daily demand by time of day based on factors in the config.</span>

<span class="sd">    Uses self.config.truck.classes.{class_name}.time_of_day_split to split the daily demand.</span>

<span class="sd">    #TODO use TimePeriodSplit</span>
<span class="sd">    Args:</span>
<span class="sd">        daily_demand: dictionary of truck type name to numpy array of</span>
<span class="sd">            truck type daily demand</span>

<span class="sd">    Returns:</span>
<span class="sd">         Nested dictionary of truck class: time period name =&gt; numpy array of demand</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trkclass_tp_demand_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">_class_timeperiod</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">_t_class</span><span class="p">,</span> <span class="n">_tp</span> <span class="ow">in</span> <span class="n">_class_timeperiod</span><span class="p">:</span>
        <span class="n">trkclass_tp_demand_dict</span><span class="p">[</span><span class="n">_t_class</span><span class="p">][</span><span class="n">_tp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_period_splits</span><span class="p">[</span><span class="n">_t_class</span><span class="p">][</span><span class="n">_tp</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="bp">self</span><span class="o">.</span><span class="n">split_factor</span><span class="p">]</span>
            <span class="o">*</span> <span class="n">daily_demand</span><span class="p">[</span><span class="n">_t_class</span><span class="p">],</span>
            <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">trkclass_tp_demand_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTimeOfDay.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate the inputs.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.commercial.CommercialVehicleTollChoice" class="doc doc-heading">
        <code>CommercialVehicleTollChoice</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Subcomponent" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>

  
      <p>Commercial vehicle (truck) toll choice.</p>
<p>A binomial choice model for very small, small, medium, and large trucks.
A separate value toll paying versus no value toll paying path choice
model is applied to each of the twenty time period and vehicle type combinations.</p>

<details class="input">
  <summary>(1) Trip tables by time of day and truck class</summary>
  <p>(2) Skims providing the time and cost for value toll and non-value toll paths
for each; the matrix names in the OMX files are:
    &ldquo;{period}<em>{cls_name}_time&rdquo;
    &ldquo;{period}</em>{cls_name}<em>dist&rdquo;
    &ldquo;{period}</em>{cls_name}<em>bridgetoll{grp_name}&rdquo;
    &ldquo;{period}</em>{cls_name}toll_time&rdquo;
    &ldquo;{period}<em>{cls_name}toll_dist&rdquo;
    &ldquo;{period}</em>{cls_name}toll_bridgetoll{grp_name}&rdquo;
    &ldquo;{period}_{cls_name}toll_valuetoll{grp_name}&rdquo;
Where period is the assignment period, cls_name is the truck assignment
class name (as very small, small and medium truck are assigned as the
same class) and grp_name is the truck type name (as the tolls are
calculated separately for very small, small and medium).</p>
</details>      

<details class="notes">
  <summary>(1)  TOLLCLASS is a code, 1 through 10 are reserved for bridges; 11 and up is</summary>
  <p>reserved for value toll facilities.</p>
</details>      <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span><span class="w">  </span><span class="nv">All</span><span class="w"> </span><span class="nv">costs</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">coded</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">year</span><span class="w"> </span><span class="mi">2000</span><span class="w"> </span><span class="nv">cents</span><span class="w"></span>
<span class="w">    </span><span class="ss">(</span><span class="mi">3</span><span class="ss">)</span><span class="w">  </span><span class="nv">The</span><span class="w"> </span><span class="mi">2</span><span class="o">-</span><span class="nv">axle</span><span class="w"> </span><span class="nv">fee</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">very</span><span class="w"> </span><span class="nv">small</span><span class="w"> </span><span class="nv">trucks</span><span class="w"></span>
<span class="w">    </span><span class="ss">(</span><span class="mi">4</span><span class="ss">)</span><span class="w">  </span><span class="nv">The</span><span class="w"> </span><span class="mi">2</span><span class="o">-</span><span class="nv">axle</span><span class="w"> </span><span class="nv">fee</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">small</span><span class="w"> </span><span class="nv">trucks</span><span class="w"></span>
<span class="w">    </span><span class="ss">(</span><span class="mi">5</span><span class="ss">)</span><span class="w">  </span><span class="nv">The</span><span class="w"> </span><span class="mi">3</span><span class="o">-</span><span class="nv">axle</span><span class="w"> </span><span class="nv">fee</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">medium</span><span class="w"> </span><span class="nv">trucks</span><span class="w"></span>
<span class="w">    </span><span class="ss">(</span><span class="mi">6</span><span class="ss">)</span><span class="w">  </span><span class="nv">The</span><span class="w"> </span><span class="nv">average</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="mi">5</span><span class="o">-</span><span class="nv">axle</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="mi">6</span><span class="o">-</span><span class="nv">axle</span><span class="w"> </span><span class="nv">fee</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">large</span><span class="w"> </span><span class="nv">trucks</span><span class="w"></span>
<span class="w">         </span><span class="ss">(</span><span class="nv">about</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">midpoint</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">fee</span><span class="w"> </span><span class="nv">schedule</span><span class="ss">)</span>.<span class="w"></span>
<span class="w">    </span><span class="ss">(</span><span class="mi">7</span><span class="ss">)</span><span class="w">  </span><span class="nv">The</span><span class="w"> </span><span class="nv">in</span><span class="o">-</span><span class="nv">vehicle</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">coefficient</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">work</span><span class="w"> </span><span class="nv">trip</span><span class="w"> </span><span class="nv">mode</span><span class="w"> </span><span class="nv">choice</span><span class="w"> </span><span class="nv">model</span>.<span class="w"></span>
</code></pre></div></td></tr></table></div>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleTollChoice</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) toll choice.</span>

<span class="sd">    A binomial choice model for very small, small, medium, and large trucks.</span>
<span class="sd">    A separate value toll paying versus no value toll paying path choice</span>
<span class="sd">    model is applied to each of the twenty time period and vehicle type combinations.</span>

<span class="sd">    Input:  (1) Trip tables by time of day and truck class</span>
<span class="sd">            (2) Skims providing the time and cost for value toll and non-value toll paths</span>
<span class="sd">            for each; the matrix names in the OMX files are:</span>
<span class="sd">                &quot;{period}_{cls_name}_time&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}_dist&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}_bridgetoll{grp_name}&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_time&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_dist&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_bridgetoll{grp_name}&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_valuetoll{grp_name}&quot;</span>
<span class="sd">            Where period is the assignment period, cls_name is the truck assignment</span>
<span class="sd">            class name (as very small, small and medium truck are assigned as the</span>
<span class="sd">            same class) and grp_name is the truck type name (as the tolls are</span>
<span class="sd">            calculated separately for very small, small and medium).</span>

<span class="sd">    Results: a total of forty demand matrices, by time of day, truck type and toll/non-toll.</span>

<span class="sd">    Notes:  (1)  TOLLCLASS is a code, 1 through 10 are reserved for bridges; 11 and up is</span>
<span class="sd">                 reserved for value toll facilities.</span>
<span class="sd">            (2)  All costs should be coded in year 2000 cents</span>
<span class="sd">            (3)  The 2-axle fee is used for very small trucks</span>
<span class="sd">            (4)  The 2-axle fee is used for small trucks</span>
<span class="sd">            (5)  The 3-axle fee is used for medium trucks</span>
<span class="sd">            (6)  The average of the 5-axle and 6-axle fee is used for large trucks</span>
<span class="sd">                 (about the midpoint of the fee schedule).</span>
<span class="sd">            (7)  The in-vehicle time coefficient is from the work trip mode choice model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for Commercial Vehicle Toll Choice.</span>

<span class="sd">        Also calls Subclass __init__().</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: model run controller</span>
<span class="sd">            component: parent component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">toll_choice</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;toll choice calculator&quot;</span><span class="p">:</span> <span class="n">TollChoiceCalculator</span><span class="p">(</span>
                <span class="n">controller</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># shortcut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice calculator&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">toll_skim_suffix</span> <span class="o">=</span> <span class="s2">&quot;trk&quot;</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trkclass_tp_demand_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split per-period truck demands into nontoll and toll classes.</span>

<span class="sd">        Uses OMX skims output from highway assignment: traffic_skims_{period}.omx&quot;&quot;&quot;</span>

        <span class="n">_tclass_time_combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">)</span>

        <span class="n">class_demands</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_tclass</span> <span class="ow">in</span> <span class="n">_tclass_time_combos</span><span class="p">:</span>

            <span class="n">_split_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">trkclass_tp_demand_dict</span><span class="p">[</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">_time_period</span><span class="p">],</span>
                <span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">_time_period</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;non toll&quot;</span><span class="p">]</span>
            <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">class_demands</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTollChoice.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for Commercial Vehicle Toll Choice.</p>
<p>Also calls Subclass <strong>init</strong>().</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
          </td>
          <td><p>model run controller</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>component</code></td>
          <td>
          </td>
          <td><p>parent component</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for Commercial Vehicle Toll Choice.</span>

<span class="sd">    Also calls Subclass __init__().</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: model run controller</span>
<span class="sd">        component: parent component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">toll_choice</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;toll choice calculator&quot;</span><span class="p">:</span> <span class="n">TollChoiceCalculator</span><span class="p">(</span>
            <span class="n">controller</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># shortcut</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice calculator&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">toll_skim_suffix</span> <span class="o">=</span> <span class="s2">&quot;trk&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTollChoice.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="n">trkclass_tp_demand_dict</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Split per-period truck demands into nontoll and toll classes.</p>
<p>Uses OMX skims output from highway assignment: traffic_skims_{period}.omx</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trkclass_tp_demand_dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split per-period truck demands into nontoll and toll classes.</span>

<span class="sd">    Uses OMX skims output from highway assignment: traffic_skims_{period}.omx&quot;&quot;&quot;</span>

    <span class="n">_tclass_time_combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
    <span class="p">)</span>

    <span class="n">class_demands</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_tclass</span> <span class="ow">in</span> <span class="n">_tclass_time_combos</span><span class="p">:</span>

        <span class="n">_split_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">trkclass_tp_demand_dict</span><span class="p">[</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">_time_period</span><span class="p">],</span>
            <span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">_time_period</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;non toll&quot;</span><span class="p">]</span>
        <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_tclass</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">class_demands</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTollChoice.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTollChoice.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate the inputs.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution" class="doc doc-heading">
        <code>CommercialVehicleTripDistribution</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Subcomponent" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>

  
      <p>Commercial vehicle (truck) Trip Distribution for 4 sizes of truck.</p>

<details class="the-four-truck-types-are">
  <summary>The four truck types are</summary>
  <p>(1) very small trucks (two-axle, four-tire),
(2) small trucks (two-axle, six-tire),
(3) medium trucks (three-axle),
(4) large or combination (four or more axle) trucks.</p>
</details>
<details class="input">
  <summary>(1) Trips by 4 truck sizes</summary>
  <p>(2) highway skims for truck, time, distance, bridgetoll and value toll
(3) friction factors lookup table
(4) k-factors matrix</p>
</details>      <p>A simple gravity model is used to distribute the truck trips, with
separate friction factors used for each class of truck.</p>
<p>A blended travel time is used as the impedance measure, specifically the weighted average
of the AM travel time (one-third weight) and the midday travel time (two-thirds weight).</p>

<details class="input">
  <summary>Input</summary>
  <p>Level-of-service matrices for the AM peak period (6 am to 10 am) and midday
period (10 am to 3 pm) which contain truck-class specific estimates of
congested travel time (in minutes)</p>
<p>A matrix of k-factors, as calibrated by Chuck Purvis.  Note the very small truck model
does not use k-factors; the small, medium, and large trucks use the same k-factors.</p>
<p>A table of friction factors in text format with the following fields, space separated:
- impedance measure (blended travel time);
- friction factors for very small trucks;
- friction factors for small trucks;
- friction factors for medium trucks; and,
- friction factors for large trucks.</p>
</details>
<details class="notes-on-distribution-steps">
  <summary>Notes on distribution steps</summary>
  <p>load nonres/truck_kfactors_taz.csv
load nonres/truckFF.dat
Apply friction factors and kfactors to produce balancing matrix
apply the gravity models using friction factors from nonres/truckFF.dat
(note the very small trucks do not use the K-factors)
Can use Emme matrix balancing for this - important note: reference
matrices by name and ensure names are unique
Trips rounded to 0.01, causes some instability in results</p>
</details>      <p>Notes:
(1) Based on the BAYCAST truck model, no significant updates.
(2) Combined Chuck&rsquo;s calibration adjustments into the NAICS-based model coefficients.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleTripDistribution</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) Trip Distribution for 4 sizes of truck.</span>

<span class="sd">    The four truck types are:</span>
<span class="sd">        (1) very small trucks (two-axle, four-tire),</span>
<span class="sd">        (2) small trucks (two-axle, six-tire),</span>
<span class="sd">        (3) medium trucks (three-axle),</span>
<span class="sd">        (4) large or combination (four or more axle) trucks.</span>

<span class="sd">    Input:  (1) Trips by 4 truck sizes</span>
<span class="sd">            (2) highway skims for truck, time, distance, bridgetoll and value toll</span>
<span class="sd">            (3) friction factors lookup table</span>
<span class="sd">            (4) k-factors matrix</span>
<span class="sd">    Ouput:  Trips origin and destination matrices by 4 truck sizes</span>

<span class="sd">    A simple gravity model is used to distribute the truck trips, with</span>
<span class="sd">    separate friction factors used for each class of truck.</span>

<span class="sd">    A blended travel time is used as the impedance measure, specifically the weighted average</span>
<span class="sd">    of the AM travel time (one-third weight) and the midday travel time (two-thirds weight).</span>

<span class="sd">    Input:</span>
<span class="sd">        Level-of-service matrices for the AM peak period (6 am to 10 am) and midday</span>
<span class="sd">        period (10 am to 3 pm) which contain truck-class specific estimates of</span>
<span class="sd">        congested travel time (in minutes)</span>

<span class="sd">        A matrix of k-factors, as calibrated by Chuck Purvis.  Note the very small truck model</span>
<span class="sd">        does not use k-factors; the small, medium, and large trucks use the same k-factors.</span>

<span class="sd">        A table of friction factors in text format with the following fields, space separated:</span>
<span class="sd">        - impedance measure (blended travel time);</span>
<span class="sd">        - friction factors for very small trucks;</span>
<span class="sd">        - friction factors for small trucks;</span>
<span class="sd">        - friction factors for medium trucks; and,</span>
<span class="sd">        - friction factors for large trucks.</span>

<span class="sd">    Notes on distribution steps:</span>
<span class="sd">        load nonres/truck_kfactors_taz.csv</span>
<span class="sd">        load nonres/truckFF.dat</span>
<span class="sd">        Apply friction factors and kfactors to produce balancing matrix</span>
<span class="sd">        apply the gravity models using friction factors from nonres/truckFF.dat</span>
<span class="sd">        (note the very small trucks do not use the K-factors)</span>
<span class="sd">        Can use Emme matrix balancing for this - important note: reference</span>
<span class="sd">        matrices by name and ensure names are unique</span>
<span class="sd">        Trips rounded to 0.01, causes some instability in results</span>

<span class="sd">    Results: four total daily trips by truck type</span>

<span class="sd">    Notes:</span>
<span class="sd">    (1) Based on the BAYCAST truck model, no significant updates.</span>
<span class="sd">    (2) Combined Chuck&#39;s calibration adjustments into the NAICS-based model coefficients.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripDistribution component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">            component (Component): Parent component of sub-component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_dist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">k_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Zone-to-zone values of truck K factors.</span>

<span class="sd">        Returns:</span>
<span class="sd">             NumpyArray: Zone-to-zone values of truck K factors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_k_factors</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span>

    <span class="k">def</span> <span class="nf">_load_k_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads k-factors from self.config.truck.k_factors_file csv file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumpyArray: Zone-to-zone values of truck K factors.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;return zonal_csv_to_matrices(</span>
<span class="sd">            self.get_abs_path(self.config.k_factors_file),</span>
<span class="sd">            i_column=&quot;I_taz_tm2_v2_2&quot;,</span>
<span class="sd">            j_column=&quot;J_taz_tm2_v2_2&quot;,</span>
<span class="sd">            value_columns=&quot;truck_k&quot;,</span>
<span class="sd">            fill_zones=True,</span>
<span class="sd">            default_value=0,</span>
<span class="sd">            max_zone=max(self.component.emme_scenario.zone_numbers),</span>
<span class="sd">        )[&quot;truck_k&quot;].values&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k_factors_file</span><span class="p">))</span>
        <span class="n">zones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;I_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">num_data_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zones</span><span class="p">)</span>
        <span class="n">row_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">zones</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;I_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">col_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">zones</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;J_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">k_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_data_zones</span><span class="p">,</span> <span class="n">num_data_zones</span><span class="p">))</span>
        <span class="n">k_factors</span><span class="p">[</span><span class="n">row_index</span><span class="p">,</span> <span class="n">col_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;truck_k&quot;</span><span class="p">]</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">emme_scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">num_data_zones</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">num_data_zones</span><span class="p">))</span>
        <span class="n">k_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">k_factors</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">k_factors</span>

    <span class="k">def</span> <span class="nf">blended_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get blended skim. Creates it if doesn&#39;t already exist.</span>

<span class="sd">        Args:</span>
<span class="sd">            mode (str): Mode for skim</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_blended_skim</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                <span class="n">blend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">trk_impedances</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;time_blend&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">friction_factor_matrices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">trk_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k_factors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Zone to zone NumpyArray of impedances for a given truck class.</span>

<span class="sd">        Args:</span>
<span class="sd">            trk_class (str): Truck class abbreviated name</span>
<span class="sd">            k_factors (Union[None,NumpyArray]): If not None, gives an zone-by-zone array of</span>
<span class="sd">                k-factors--additive impedances to be added on top of friciton factors.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumpyArray: Zone-by-zone matrix of friction factors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trk_class</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="p">[</span>
                <span class="n">trk_class</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_friction_factor_matrix</span><span class="p">(</span>
                <span class="n">trk_class</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span><span class="o">.</span><span class="n">impedance</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">k_factors</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span><span class="o">.</span><span class="n">use_k_factors</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_calculate_friction_factor_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">segment_name</span><span class="p">,</span>
        <span class="n">blended_skim_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">k_factors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_k_factors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates friction matrix by interpolating time; optionally multiplying by k_factors.</span>

<span class="sd">        Args:</span>
<span class="sd">            segment_name: Name of the segment to calculate the friction factors for (i.e. vstruck)</span>
<span class="sd">            blended_skim_name (str): Name of blended skim</span>
<span class="sd">            k_factors (Union[None,NumpyArray): Optional k-factors matrix</span>

<span class="sd">        Returns:</span>
<span class="sd">            friction_matrix NumpyArray: friction matrix for a truck class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_friction_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blended_skims</span><span class="p">(</span><span class="n">blended_skim_name</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">friction_factors</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">friction_factors</span><span class="p">[</span><span class="n">segment_name</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">use_k_factors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k_factors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_friction_matrix</span> <span class="o">=</span> <span class="n">_friction_matrix</span> <span class="o">*</span> <span class="n">k_factors</span>

        <span class="k">return</span> <span class="n">_friction_matrix</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">friction_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Table of friction factors for each time band by truck class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame of friction factors read from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_ffactors</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span>

    <span class="k">def</span> <span class="nf">_read_ffactors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load friction factors lookup tables from csv file to dataframe.</span>

<span class="sd">        Reads from file: config.truck.friction_factors_file with following assumed column order:</span>
<span class="sd">            time: Time</span>
<span class="sd">            vsmtrk: Very Small Truck FF</span>
<span class="sd">            smltrk: Small Truck FF</span>
<span class="sd">            medtrk: Medium Truck FF</span>
<span class="sd">            lrgtrk: Large Truck FF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">friction_factors_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">_file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tripends_df</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Run commercial vehicle trip distribution.&quot;&quot;&quot;</span>
        <span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">tc</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_ods</span><span class="p">(</span><span class="n">tripends_df</span><span class="p">,</span> <span class="n">tc</span><span class="p">)</span> <span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">daily_demand_dict</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_distribute_ods</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tripends_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">trk_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">orig_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">dest_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Distribute a trip ends for a given a truck class.</span>

<span class="sd">        Args:</span>
<span class="sd">            tripends_df: dataframe with trip ends as &quot;{trk_class}_prod&quot; and{trk_class}_attr&quot;.</span>
<span class="sd">            trk_class: name of truck class to distribute.</span>
<span class="sd">            orig_factor (float, optional): Amount to factor towards origins. Defaults to 0.5.</span>
<span class="sd">            dest_factor (float, optional): Amount to factor towards destinations. Defaults to 0.5.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumpyArray: Distributed trip ends for given truck class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">orig_factor</span> <span class="o">+</span> <span class="n">dest_factor</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;orig_factor (</span><span class="si">{orig_factor}</span><span class="s2">) and dest_factor (</span><span class="si">{dest_factor}</span><span class="s2">) must</span><span class="se">\</span>
<span class="s2">                sum to 1.0&quot;</span>
            <span class="p">)</span>

        <span class="n">_prod_attr_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_balancing</span><span class="p">(</span>
            <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
            <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
            <span class="n">trk_class</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">daily_demand</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">orig_factor</span> <span class="o">*</span> <span class="n">_prod_attr_matrix</span>
            <span class="o">+</span> <span class="n">dest_factor</span> <span class="o">*</span> <span class="n">_prod_attr_matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">, prod sum: </span><span class="si">{</span><span class="n">_prod_attr_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;daily sum: </span><span class="si">{</span><span class="n">daily_demand</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">daily_demand</span>

    <span class="k">def</span> <span class="nf">_matrix_balancing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">orig_totals</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">dest_totals</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">trk_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Distribute origins and destinations based on friction factors for a givein truck class.</span>

<span class="sd">        Args:</span>
<span class="sd">            orig_totals: Total demand for origins as a numpy array</span>
<span class="sd">            dest_totals: Total demand for destinations as a numpy array</span>
<span class="sd">            trk_class (str): Truck class name</span>



<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matrix_balancing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.matrix_calculation.matrix_balancing&quot;</span>
        <span class="p">)</span>
        <span class="n">matrix_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.matrix_calculation.matrix_controlled_rounding&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Transfer numpy to emmebank</span>
        <span class="n">_ff_emme_mx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_friction&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">friction_factor_matrices</span><span class="p">(</span><span class="n">trk_class</span><span class="p">),</span>
            <span class="n">matrix_type</span><span class="o">=</span><span class="s2">&quot;FULL&quot;</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="n">_orig_tots_emme_mx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_prod&quot;</span><span class="p">,</span> <span class="n">orig_totals</span><span class="p">,</span> <span class="n">matrix_type</span><span class="o">=</span><span class="s2">&quot;ORIGIN&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="n">_dest_tots_emme_mx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_attr&quot;</span><span class="p">,</span> <span class="n">dest_totals</span><span class="p">,</span> <span class="n">matrix_type</span><span class="o">=</span><span class="s2">&quot;DESTINATION&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Create a destination matrix for output to live in Emmebank</span>
        <span class="n">_result_emme_mx_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">get_or_init_matrix</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trk_class</span><span class="si">}</span><span class="s2">_daily_demand&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;od_values_to_balance&quot;</span><span class="p">:</span> <span class="n">_ff_emme_mx_name</span><span class="p">,</span>
            <span class="s2">&quot;origin_totals&quot;</span><span class="p">:</span> <span class="n">_orig_tots_emme_mx_name</span><span class="p">,</span>
            <span class="s2">&quot;destination_totals&quot;</span><span class="p">:</span> <span class="n">_dest_tots_emme_mx_name</span><span class="p">,</span>
            <span class="s2">&quot;allowable_difference&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
            <span class="s2">&quot;max_relative_error&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_balance_relative_error</span><span class="p">,</span>
            <span class="s2">&quot;max_iterations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_balance_iterations</span><span class="p">,</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;od_balanced_values&quot;</span><span class="p">:</span> <span class="n">_result_emme_mx_name</span><span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;allowed_memory&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">num_processors</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_BALANCING&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">matrix_balancing</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">emme_scenario</span><span class="p">)</span>

        <span class="n">matrix_round</span><span class="p">(</span>
            <span class="n">_result_emme_mx_name</span><span class="p">,</span>
            <span class="n">_result_emme_mx_name</span><span class="p">,</span>
            <span class="n">min_demand</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">values_to_round</span><span class="o">=</span><span class="s2">&quot;ALL_NON_ZERO&quot;</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">emme_scenario</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">_result_emme_mx_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for the CommercialVehicleTripDistribution component.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Run controller for model run.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>component</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code>
          </td>
          <td><p>Parent component of sub-component</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripDistribution component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">        component (Component): Parent component of sub-component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_dist</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.blended_skims" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">blended_skims</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.blended_skims" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Get blended skim. Creates it if doesn&rsquo;t already exist.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Mode for skim</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>_type_</code></td>          <td>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">blended_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get blended skim. Creates it if doesn&#39;t already exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        mode (str): Mode for skim</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_blended_skim</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">blend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">trk_impedances</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;time_blend&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blended_skims</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factor_matrices" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">friction_factor_matrices</span><span class="p">(</span><span class="n">trk_class</span><span class="p">,</span> <span class="n">k_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factor_matrices" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Zone to zone NumpyArray of impedances for a given truck class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>trk_class</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Truck class abbreviated name</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k_factors</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[None, <span title="tm2py.components.demand.commercial.NumpyArray">NumpyArray</span>]</code>
          </td>
          <td><p>If not None, gives an zone-by-zone array of
k-factors&ndash;additive impedances to be added on top of friciton factors.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>NumpyArray</code></td>          <td>
                <code><span title="tm2py.components.demand.commercial.NumpyArray">NumpyArray</span></code>
          </td>
          <td><p>Zone-by-zone matrix of friction factors</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">friction_factor_matrices</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">trk_class</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k_factors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Zone to zone NumpyArray of impedances for a given truck class.</span>

<span class="sd">    Args:</span>
<span class="sd">        trk_class (str): Truck class abbreviated name</span>
<span class="sd">        k_factors (Union[None,NumpyArray]): If not None, gives an zone-by-zone array of</span>
<span class="sd">            k-factors--additive impedances to be added on top of friciton factors.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        NumpyArray: Zone-by-zone matrix of friction factors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">trk_class</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="p">[</span>
            <span class="n">trk_class</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_friction_factor_matrix</span><span class="p">(</span>
            <span class="n">trk_class</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span><span class="o">.</span><span class="n">impedance</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_factors</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span><span class="o">.</span><span class="n">use_k_factors</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factor_matrices</span><span class="p">[</span><span class="n">trk_class</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factors" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">friction_factors</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.friction_factors" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Table of friction factors for each time band by truck class.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td><p>pd.DataFrame: DataFrame of friction factors read from disk.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">friction_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Table of friction factors for each time band by truck class.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame of friction factors read from disk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_ffactors</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_friction_factors</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.k_factors" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">k_factors</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.k_factors" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Zone-to-zone values of truck K factors.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>NumpyArray</code></td>          <td>
          </td>
          <td><p>Zone-to-zone values of truck K factors.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">k_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Zone-to-zone values of truck K factors.</span>

<span class="sd">    Returns:</span>
<span class="sd">         NumpyArray: Zone-to-zone values of truck K factors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_k_factors</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_k_factors</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="n">tripends_df</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run commercial vehicle trip distribution.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tripends_df</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Run commercial vehicle trip distribution.&quot;&quot;&quot;</span>
    <span class="n">daily_demand_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">tc</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribute_ods</span><span class="p">(</span><span class="n">tripends_df</span><span class="p">,</span> <span class="n">tc</span><span class="p">)</span> <span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">daily_demand_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripDistribution.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripDistribution.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate the inputs.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration" class="doc doc-heading">
        <code>CommercialVehicleTripGeneration</code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Subcomponent" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>

  
      <p>Commercial vehicle (truck) Trip Generation for 4 sizes of truck.</p>

<details class="the-four-truck-types-are">
  <summary>The four truck types are</summary>
  <p>(1) very small trucks (two-axle, four-tire),
(2) small trucks (two-axle, six-tire),
(3) medium trucks (three-axle),
(4) large or combination (four or more axle) trucks.</p>
</details>      <h6 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration--trip-generation">Trip generation<a class="headerlink" href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration--trip-generation" title="Permanent link"> ¶</a></h6>
<p>Use linear regression models to generate trip ends,
balancing attractions to productions. Based on BAYCAST truck model.</p>
<p>The truck trip generation models for small trucks (two-axle, six tire),
medium trucks (three-axle), and large or combination (four or more axle)
trucks are taken directly from the study: &ldquo;I-880 Intermodal Corridor Study:
Truck Travel in the San Francisco Bay Area&rdquo;, prepared by Barton Aschman in
December 1992.  The coefficients are on page 223 of this report.</p>
<p>The very small truck generation model is based on the Phoenix four-tire
truck model documented in the TMIP Quick Response Freight Manual.</p>
<p>Note that certain production models previously used SIC-based employment
categories.  To both maintain consistency with the BAYCAST truck model and
update the model to use NAICS-based employment categories, new regression
models were estimated relating the NAICS-based employment data with the
SIC-based-predicted trips.  The goal here is not to create a new truck
model, but to mimic the old model with the available data.  Please see
the excel spreadsheet TruckModel.xlsx for details.  The NAICS-based model
results replicate the SIC-based model results quite well.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleTripGeneration</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) Trip Generation for 4 sizes of truck.</span>

<span class="sd">    The four truck types are:</span>
<span class="sd">        (1) very small trucks (two-axle, four-tire),</span>
<span class="sd">        (2) small trucks (two-axle, six-tire),</span>
<span class="sd">        (3) medium trucks (three-axle),</span>
<span class="sd">        (4) large or combination (four or more axle) trucks.</span>

<span class="sd">    Input:  (1) MAZ csv data file with the employment and household counts.</span>
<span class="sd">    Ouput:  Trips by 4 truck sizes</span>

<span class="sd">    Trip generation</span>
<span class="sd">    ---------------</span>
<span class="sd">    Use linear regression models to generate trip ends,</span>
<span class="sd">    balancing attractions to productions. Based on BAYCAST truck model.</span>

<span class="sd">    The truck trip generation models for small trucks (two-axle, six tire),</span>
<span class="sd">    medium trucks (three-axle), and large or combination (four or more axle)</span>
<span class="sd">    trucks are taken directly from the study: &quot;I-880 Intermodal Corridor Study:</span>
<span class="sd">    Truck Travel in the San Francisco Bay Area&quot;, prepared by Barton Aschman in</span>
<span class="sd">    December 1992.  The coefficients are on page 223 of this report.</span>

<span class="sd">    The very small truck generation model is based on the Phoenix four-tire</span>
<span class="sd">    truck model documented in the TMIP Quick Response Freight Manual.</span>

<span class="sd">    Note that certain production models previously used SIC-based employment</span>
<span class="sd">    categories.  To both maintain consistency with the BAYCAST truck model and</span>
<span class="sd">    update the model to use NAICS-based employment categories, new regression</span>
<span class="sd">    models were estimated relating the NAICS-based employment data with the</span>
<span class="sd">    SIC-based-predicted trips.  The goal here is not to create a new truck</span>
<span class="sd">    model, but to mimic the old model with the available data.  Please see</span>
<span class="sd">    the excel spreadsheet TruckModel.xlsx for details.  The NAICS-based model</span>
<span class="sd">    results replicate the SIC-based model results quite well.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripGeneration component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">            component (Component): Parent component of sub-component</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_gen</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run commercial vehicle trip distribution.&quot;&quot;&quot;</span>
        <span class="n">_landuse_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_landuse</span><span class="p">()</span>
        <span class="n">_unbalanced_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_trip_ends</span><span class="p">(</span><span class="n">_landuse_df</span><span class="p">)</span>
        <span class="n">_balanced_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_balance_pa</span><span class="p">(</span><span class="n">_unbalanced_tripends_df</span><span class="p">)</span>
        <span class="n">total_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_by_class</span><span class="p">(</span><span class="n">_balanced_tripends_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">total_tripends_df</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_aggregate_landuse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Aggregates landuse data from input CSV by MAZ to TAZ and employment groups.</span>

<span class="sd">        TOTEMP, total employment (same regardless of classification system)</span>
<span class="sd">        RETEMPN, retail trade employment per the NAICS classification system</span>
<span class="sd">        FPSEMPN, financial and professional services employment per NAICS</span>
<span class="sd">        HEREMPN, health, educational, and recreational employment per  NAICS</span>
<span class="sd">        OTHEMPN, other employment per the NAICS classification system</span>
<span class="sd">        AGREMPN, agricultural employment per the NAICS classificatin system</span>
<span class="sd">        MWTEMPN, manufacturing, warehousing, and transportation employment per NAICS</span>
<span class="sd">        TOTHH, total households</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">maz_data_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">maz_landuse_file</span>
        <span class="p">)</span>
        <span class="n">maz_input_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">maz_data_file</span><span class="p">)</span>
        <span class="n">zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">emme_scenario</span><span class="o">.</span><span class="n">zone_numbers</span>
        <span class="n">maz_input_data</span> <span class="o">=</span> <span class="n">maz_input_data</span><span class="p">[</span><span class="n">maz_input_data</span><span class="p">[</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">zones</span><span class="p">)]</span>
        <span class="n">taz_input_data</span> <span class="o">=</span> <span class="n">maz_input_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">taz_input_data</span> <span class="o">=</span> <span class="n">taz_input_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">)</span>
        <span class="c1"># combine categories</span>
        <span class="n">taz_landuse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">total_column</span><span class="p">,</span> <span class="n">sub_categories</span> <span class="ow">in</span> <span class="n">_land_use_aggregation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">taz_landuse</span><span class="p">[</span><span class="n">total_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">taz_input_data</span><span class="p">[</span><span class="n">sub_categories</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">taz_landuse</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">taz_landuse</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_generate_trip_ends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">landuse_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate productions and attractions by class based on landuse and truck trip rates.</span>

<span class="sd">        Args:</span>
<span class="sd">            landuse_df (pd.DataFrame): DataFrame with aggregated landuse data.</span>
<span class="sd">                Expected columns for landuse are: AGREMPN, RETEMPN, FPSEMPN, HEREMPN,</span>
<span class="sd">                MWTEMPN, OTHEMPN, TOTEMP, TOTHH</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with unbalanced production and attraction trip ends.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tripends_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">_class_pa</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;production_formula&quot;</span><span class="p">,</span> <span class="s2">&quot;attraction_formula&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># TODO Do this with multi-indexing rather than relying on column naming</span>

        <span class="k">for</span> <span class="n">_c</span><span class="p">,</span> <span class="n">_pa</span> <span class="ow">in</span> <span class="n">_class_pa</span><span class="p">:</span>

            <span class="n">_trip_type</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">purpose</span>
            <span class="n">_trk_class</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">name</span>

            <span class="k">if</span> <span class="n">_pa</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_formula&quot;</span><span class="p">):</span>
                <span class="n">_pa_short</span> <span class="o">=</span> <span class="n">_pa</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># linked trips (non-garage-based) - attractions (equal productions)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">_trip_type</span> <span class="o">==</span> <span class="s2">&quot;linked&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">_pa_short</span> <span class="o">==</span> <span class="s2">&quot;attraction&quot;</span><span class="p">):</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_pa_short</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_constant</span> <span class="o">=</span> <span class="n">_c</span><span class="p">[</span><span class="n">_pa</span><span class="p">]</span><span class="o">.</span><span class="n">constant</span>
                <span class="n">_multiplier</span> <span class="o">=</span> <span class="n">_c</span><span class="p">[</span><span class="n">_pa</span><span class="p">]</span><span class="o">.</span><span class="n">multiplier</span>

                <span class="n">land_use_rates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">_c</span><span class="p">[</span><span class="n">_pa</span><span class="p">]</span><span class="o">.</span><span class="n">land_use_rates</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">land_use_rates</span> <span class="o">=</span> <span class="n">land_use_rates</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">land_use_rates</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;property&quot;</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;property&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">_rate_trips_df</span> <span class="o">=</span> <span class="n">landuse_df</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">land_use_rates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">_trips_df</span> <span class="o">=</span> <span class="n">_rate_trips_df</span> <span class="o">*</span> <span class="n">_multiplier</span> <span class="o">+</span> <span class="n">_constant</span>

                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_pa_short</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_trips_df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
                <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">tripends_df</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_balance_pa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tripends_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Balance production and attractions.</span>

<span class="sd">        Args:</span>
<span class="sd">            tripends_df (pd.DataFrame): DataFrame with unbalanced production and attraction</span>
<span class="sd">                trip ends.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with balanced production and attraction trip ends.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">_trip_type</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">purpose</span>
            <span class="n">_trk_class</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">name</span>
            <span class="n">_balance_to</span> <span class="o">=</span> <span class="n">_c</span><span class="o">.</span><span class="n">balance_to</span>

            <span class="n">_tots</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;attractions&quot;</span><span class="p">:</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
                <span class="s2">&quot;productions&quot;</span><span class="p">:</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
            <span class="p">}</span>

            <span class="c1"># if productions OR attractions are zero, fill one with other</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;attractions&quot;</span><span class="p">]:</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span>
                <span class="p">]</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;productions&quot;</span><span class="p">]:</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span>
                <span class="p">]</span>

            <span class="c1"># otherwise balance based on sums</span>
            <span class="k">elif</span> <span class="n">_balance_to</span> <span class="o">==</span> <span class="s2">&quot;productions&quot;</span><span class="p">:</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_attractions&quot;</span>
                <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;productions&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;attractions&quot;</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">_balance_to</span> <span class="o">==</span> <span class="s2">&quot;attractions&quot;</span><span class="p">:</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tripends_df</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trip_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_productions&quot;</span>
                <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;attractions&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">_tots</span><span class="p">[</span><span class="s2">&quot;productions&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_balance_to</span><span class="si">}</span><span class="s2"> is not a valid balance_to value&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tripends_df</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_aggregate_by_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tripends_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sum tripends by class across trip purpose.</span>

<span class="sd">        Args:</span>
<span class="sd">            tripends_df (pd.DataFrame): DataFrame with balanced production and attraction</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with aggregated tripends by truck class. Returned columns are:</span>
<span class="sd">                vsmtrk_prod, vsmtrk_attr,</span>
<span class="sd">                smltrk_prod, smltrk_attr,</span>
<span class="sd">                medtrk_prod, medtrk_attr,</span>
<span class="sd">                lrgtrk_prod, lrgtrk_attr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">agg_tripends_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="n">_class_pa</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;productions&quot;</span><span class="p">,</span> <span class="s2">&quot;attractions&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_trk_class</span><span class="p">,</span> <span class="n">_pa</span> <span class="ow">in</span> <span class="n">_class_pa</span><span class="p">:</span>
            <span class="n">_sum_cols</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tripends_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_pa</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">agg_tripends_df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_trk_class</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">_pa</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                <span class="n">tripends_df</span><span class="p">[</span><span class="n">_sum_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">agg_tripends_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">agg_tripends_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">to_string</span><span class="p">(),</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">agg_tripends_df</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for the CommercialVehicleTripGeneration component.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Run controller for model run.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>component</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code>
          </td>
          <td><p>Parent component of sub-component</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">,</span> <span class="n">component</span><span class="p">:</span> <span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleTripGeneration component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">        component (Component): Parent component of sub-component</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trip_gen</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run commercial vehicle trip distribution.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run commercial vehicle trip distribution.&quot;&quot;&quot;</span>
    <span class="n">_landuse_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_landuse</span><span class="p">()</span>
    <span class="n">_unbalanced_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_trip_ends</span><span class="p">(</span><span class="n">_landuse_df</span><span class="p">)</span>
    <span class="n">_balanced_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_balance_pa</span><span class="p">(</span><span class="n">_unbalanced_tripends_df</span><span class="p">)</span>
    <span class="n">total_tripends_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_by_class</span><span class="p">(</span><span class="n">_balanced_tripends_df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_tripends_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleTripGeneration.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.commercial.CommercialVehicleTripGeneration.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate the inputs.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate the inputs.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.TruckConfig" class="doc doc-heading">
        <code>tm2py.config.TruckConfig</code>


<a href="#tm2py.config.TruckConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Truck model parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TruckConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Truck model parameters.&quot;&quot;&quot;</span>

    <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TruckClassConfig</span><span class="p">]</span>
    <span class="n">impedances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImpedanceConfig</span><span class="p">]</span>
    <span class="n">trip_gen</span><span class="p">:</span> <span class="n">TripGenerationConfig</span>
    <span class="n">trip_dist</span><span class="p">:</span> <span class="n">TripDistributionConfig</span>
    <span class="n">time_of_day</span><span class="p">:</span> <span class="n">TimeOfDayConfig</span>
    <span class="n">toll_choice</span><span class="p">:</span> <span class="n">TollChoiceConfig</span>
    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @validator(&quot;classes&quot;)</span>
<span class="sd">    def class_consistency(cls, v, values):</span>
<span class="sd">        # TODO Can&#39;t get to work righ tnow</span>
<span class="sd">        _class_names = [c.name for c in v]</span>
<span class="sd">        _gen_classes = [c.name for c in values[&quot;trip_gen&quot;]]</span>
<span class="sd">        _dist_classes = [c.name for c in values[&quot;trip_dist&quot;]]</span>
<span class="sd">        _time_classes = [c.name for c in values[&quot;time_split&quot;]]</span>
<span class="sd">        _toll_classes = [c.name for c in values[&quot;toll_choice&quot;]]</span>

<span class="sd">        assert (</span>
<span class="sd">            _class_names == _gen_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t equal\</span>
<span class="sd">            class names in truck.trip_gen ({_gen_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _dist_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t  equal\</span>
<span class="sd">            class names in truck.trip_dist ({_dist_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _time_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t  equal\</span>
<span class="sd">            class names in truck.time_split ({_time_classes}).&quot;</span>
<span class="sd">        assert (</span>
<span class="sd">            _class_names == _toll_classes</span>
<span class="sd">        ), &quot;truck.classes ({_class_names}) doesn&#39;t equal\</span>
<span class="sd">            class names in truck.toll_choice ({_toll_classes}).&quot;</span>

<span class="sd">        return v</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="tm2py.config.TruckConfig.outfile_trip_table_tmp" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

<a href="#tm2py.config.TruckConfig.outfile_trip_table_tmp" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>@validator(&ldquo;classes&rdquo;)
def class_consistency(cls, v, values):
    # TODO Can&rsquo;t get to work righ tnow
    _class_names = [c.name for c in v]
    _gen_classes = [c.name for c in values[&ldquo;trip_gen&rdquo;]]
    _dist_classes = [c.name for c in values[&ldquo;trip_dist&rdquo;]]
    _time_classes = [c.name for c in values[&ldquo;time_split&rdquo;]]
    _toll_classes = [c.name for c in values[&ldquo;toll_choice&rdquo;]]</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">assert</span><span class="w"> </span><span class="ss">(</span><span class="w"></span>
<span class="w">    </span><span class="nv">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">_gen_classes</span><span class="w"></span>
<span class="ss">)</span>,<span class="w"> </span><span class="s2">&quot;truck.classes ({_class_names}) doesn&#39;t equal            class names in truck.trip_gen ({_gen_classes}).&quot;</span><span class="w"></span>
<span class="nv">assert</span><span class="w"> </span><span class="ss">(</span><span class="w"></span>
<span class="w">    </span><span class="nv">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">_dist_classes</span><span class="w"></span>
<span class="ss">)</span>,<span class="w"> </span><span class="s2">&quot;truck.classes ({_class_names}) doesn&#39;t  equal            class names in truck.trip_dist ({_dist_classes}).&quot;</span><span class="w"></span>
<span class="nv">assert</span><span class="w"> </span><span class="ss">(</span><span class="w"></span>
<span class="w">    </span><span class="nv">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">_time_classes</span><span class="w"></span>
<span class="ss">)</span>,<span class="w"> </span><span class="s2">&quot;truck.classes ({_class_names}) doesn&#39;t  equal            class names in truck.time_split ({_time_classes}).&quot;</span><span class="w"></span>
<span class="nv">assert</span><span class="w"> </span><span class="ss">(</span><span class="w"></span>
<span class="w">    </span><span class="nv">_class_names</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">_toll_classes</span><span class="w"></span>
<span class="ss">)</span>,<span class="w"> </span><span class="s2">&quot;truck.classes ({_class_names}) doesn&#39;t equal            class names in truck.toll_choice ({_toll_classes}).&quot;</span><span class="w"></span>

<span class="k">return</span><span class="w"> </span><span class="nv">v</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
  </div>

</div>





  </div>

  </div>

</div><h4 id="inter-regional-demand">Inter-regional Demand<a class="headerlink" href="#inter-regional-demand" title="Permanent link"> ¶</a></h4>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.internal_external" class="doc doc-heading">
          <code>tm2py.components.demand.internal_external</code>


<a href="#tm2py.components.demand.internal_external" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Module containing Internal &lt;-&gt; External trip model.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.internal_external.ExternalDemand" class="doc doc-heading">
        <code>ExternalDemand</code>


<a href="#tm2py.components.demand.internal_external.ExternalDemand" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Subcomponent" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>

  
      <p>Forecast of daily internal&lt;-&gt;external demand based on growth from a base year.</p>
<p>Create a daily matrix that includes internal/external, external/internal,
and external/external passenger vehicle travel (based on Census 2000 journey-to-work flows).
These trip tables are based on total traffic counts, which include trucks, but trucks are
not explicitly segmented from passenger vehicles.  This short-coming is a hold-over from
BAYCAST and will be addressed in the next model update.</p>
<p>The row and column totals are taken from count station data provided by Caltrans.  The
BAYCAST 2006 IX matrix is used as the base matrix and scaled to match forecast year growth
assumptions. The script generates estimates for the model forecast year; the growth rates
were discussed with neighboring MPOs as part of the SB 375 target setting process.</p>
<p>Input:  (1)  Station-specific assumed growth rates for each forecast year (the lack of
              external/external movements through the region allows simple factoring of
              cells without re-balancing);
         (2)  An input base matrix derived from the Census journey-to-work data.</p>
<p>Output: (1) Four-table, forecast-year specific trip tables containing internal/external,
             external/internal, and external/external vehicle (xxx or person xxx) travel.</p>
<p>Governed by class DemandGrowth Config:
<div class="highlight"><pre><span></span><code>    highway_demand_file:
    input_demand_file:
    input_demand_matrixname_tmpl:
    modes:
    reference_year:
    annual_growth_rate:
    special_gateway_adjust:
</code></pre></div></p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExternalDemand</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Forecast of daily internal&lt;-&gt;external demand based on growth from a base year.</span>

<span class="sd">    Create a daily matrix that includes internal/external, external/internal,</span>
<span class="sd">    and external/external passenger vehicle travel (based on Census 2000 journey-to-work flows).</span>
<span class="sd">    These trip tables are based on total traffic counts, which include trucks, but trucks are</span>
<span class="sd">    not explicitly segmented from passenger vehicles.  This short-coming is a hold-over from</span>
<span class="sd">    BAYCAST and will be addressed in the next model update.</span>

<span class="sd">    The row and column totals are taken from count station data provided by Caltrans.  The</span>
<span class="sd">    BAYCAST 2006 IX matrix is used as the base matrix and scaled to match forecast year growth</span>
<span class="sd">    assumptions. The script generates estimates for the model forecast year; the growth rates</span>
<span class="sd">    were discussed with neighboring MPOs as part of the SB 375 target setting process.</span>

<span class="sd">     Input:  (1)  Station-specific assumed growth rates for each forecast year (the lack of</span>
<span class="sd">                  external/external movements through the region allows simple factoring of</span>
<span class="sd">                  cells without re-balancing);</span>
<span class="sd">             (2)  An input base matrix derived from the Census journey-to-work data.</span>

<span class="sd">     Output: (1) Four-table, forecast-year specific trip tables containing internal/external,</span>
<span class="sd">                 external/internal, and external/external vehicle (xxx or person xxx) travel.</span>


<span class="sd">    Governed by class DemandGrowth Config:</span>
<span class="sd">    ```</span>
<span class="sd">        highway_demand_file:</span>
<span class="sd">        input_demand_file:</span>
<span class="sd">        input_demand_matrixname_tmpl:</span>
<span class="sd">        modes:</span>
<span class="sd">        reference_year:</span>
<span class="sd">        annual_growth_rate:</span>
<span class="sd">        special_gateway_adjust:</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand</span>
        <span class="c1"># Loaded lazily</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_demand</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">year</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">year</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">input_demand_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_demand_file</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_demand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_load_base_demand</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_demand</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_load_base_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load reference matrices from .omx to self._base_demand</span>

<span class="sd">        input file template: self.config.internal_external.input_demand_matrixname_tmpl</span>
<span class="sd">        modes: self.config.internal_external.modes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_mx_name_tmpl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">input_demand_matrixname_tmpl</span>
        <span class="n">_matrices</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="n">_mx_name_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_base_demand</span> <span class="o">=</span> <span class="n">omx_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_demand_file</span><span class="p">,</span> <span class="n">matrices</span><span class="o">=</span><span class="n">_matrices</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Calculate adjusted demand based on scenario year and growth rates.</span>

<span class="sd">        Steps:</span>
<span class="sd">        - 1.1 apply special factors to certain gateways based on ID</span>
<span class="sd">        - 1.2 apply gateway-specific annual growth rates to results of step 1</span>
<span class="sd">           to generate year specific forecast</span>

<span class="sd">        Args:</span>
<span class="sd">            demand: dictionary of input daily demand matrices (numpy arrays)</span>

<span class="sd">        Returns:</span>
<span class="sd">             Dictionary of Numpy matrices of daily PA by class mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Build adjustment matrix to be applied to all input matrices</span>
        <span class="c1"># special gateway adjustments based on zone index</span>
        <span class="k">if</span> <span class="n">base_demand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_demand</span>
        <span class="n">_num_years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_year</span>
        <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">base_demand</span><span class="p">[</span><span class="s2">&quot;da&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">create_matrix_factors</span><span class="p">(</span>
            <span class="n">default_matrix</span><span class="o">=</span><span class="n">_adj_matrix</span><span class="p">,</span>
            <span class="n">matrix_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">special_gateway_adjust</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">create_matrix_factors</span><span class="p">(</span>
            <span class="n">default_matrix</span><span class="o">=</span><span class="n">_adj_matrix</span><span class="p">,</span>
            <span class="n">matrix_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">annual_growth_rate</span><span class="p">,</span>
            <span class="n">periods</span><span class="o">=</span><span class="n">_num_years</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">daily_prod_attract</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">_mode</span><span class="p">,</span> <span class="n">_demand</span> <span class="o">*</span> <span class="n">_adj_matrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">_demand</span> <span class="ow">in</span> <span class="n">base_demand</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">daily_prod_attract</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.internal_external.ExternalDemand.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="n">base_demand</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.internal_external.ExternalDemand.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Calculate adjusted demand based on scenario year and growth rates.</p>
<p>Steps:
- 1.1 apply special factors to certain gateways based on ID
- 1.2 apply gateway-specific annual growth rates to results of step 1
   to generate year specific forecast</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>demand</code></td>
          <td>
          </td>
          <td><p>dictionary of input daily demand matrices (numpy arrays)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="tm2py.components.demand.internal_external.NumpyArray">NumpyArray</span>]</code>
          </td>
          <td><p>Dictionary of Numpy matrices of daily PA by class mode</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Calculate adjusted demand based on scenario year and growth rates.</span>

<span class="sd">    Steps:</span>
<span class="sd">    - 1.1 apply special factors to certain gateways based on ID</span>
<span class="sd">    - 1.2 apply gateway-specific annual growth rates to results of step 1</span>
<span class="sd">       to generate year specific forecast</span>

<span class="sd">    Args:</span>
<span class="sd">        demand: dictionary of input daily demand matrices (numpy arrays)</span>

<span class="sd">    Returns:</span>
<span class="sd">         Dictionary of Numpy matrices of daily PA by class mode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build adjustment matrix to be applied to all input matrices</span>
    <span class="c1"># special gateway adjustments based on zone index</span>
    <span class="k">if</span> <span class="n">base_demand</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">base_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_demand</span>
    <span class="n">_num_years</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reference_year</span>
    <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">base_demand</span><span class="p">[</span><span class="s2">&quot;da&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">create_matrix_factors</span><span class="p">(</span>
        <span class="n">default_matrix</span><span class="o">=</span><span class="n">_adj_matrix</span><span class="p">,</span>
        <span class="n">matrix_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">special_gateway_adjust</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">_adj_matrix</span> <span class="o">=</span> <span class="n">create_matrix_factors</span><span class="p">(</span>
        <span class="n">default_matrix</span><span class="o">=</span><span class="n">_adj_matrix</span><span class="p">,</span>
        <span class="n">matrix_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">annual_growth_rate</span><span class="p">,</span>
        <span class="n">periods</span><span class="o">=</span><span class="n">_num_years</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">daily_prod_attract</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">_mode</span><span class="p">,</span> <span class="n">_demand</span> <span class="o">*</span> <span class="n">_adj_matrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">_mode</span><span class="p">,</span> <span class="n">_demand</span> <span class="ow">in</span> <span class="n">base_demand</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">daily_prod_attract</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.internal_external.ExternalTollChoice" class="doc doc-heading">
        <code>ExternalTollChoice</code>


<a href="#tm2py.components.demand.internal_external.ExternalTollChoice" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Subcomponent" href="#tm2py.components.component.Subcomponent">Subcomponent</a></code></p>

  
      <h6 id="tm2py.components.demand.internal_external.ExternalTollChoice--toll-choice">Toll choice<a class="headerlink" href="#tm2py.components.demand.internal_external.ExternalTollChoice--toll-choice" title="Permanent link"> ¶</a></h6>
<p>Apply a binomial choice model for drive alone, shared ride 2, and shared ride 3
internal/external personal vehicle travel.</p>

<details class="input">
  <summary>(1) Time-period-specific origin/destination matrices of drive alone, shared ride 2,</summary>
  <p>and share ride 3+ internal/external trip tables.</p>
</details>      <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span><span class="w"> </span><span class="nv">Skims</span><span class="w"> </span><span class="nv">providing</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">cost</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">toll</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">non</span><span class="o">-</span><span class="nv">value</span><span class="w"> </span><span class="nv">toll</span><span class="w"> </span><span class="nv">paths</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"></span>

<span class="w">        </span><span class="nv">traffic_skims_</span>{<span class="nv">period</span>}.<span class="nv">omx</span>,<span class="w"> </span><span class="nv">where</span><span class="w"> </span>{<span class="nv">period</span>}<span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">period</span><span class="w"> </span><span class="nv">ID</span>,<span class="w"></span>
<span class="w">        </span>{<span class="nv">class</span>}<span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="nv">da</span>,<span class="w"> </span><span class="nv">sr2</span>,<span class="w"> </span><span class="nv">sr2</span>,<span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">following</span><span class="w"> </span><span class="nv">matrix</span><span class="w"> </span><span class="nv">names</span><span class="w"></span>
<span class="w">          </span><span class="nv">Non</span><span class="o">-</span><span class="nv">value</span><span class="o">-</span><span class="nv">toll</span><span class="w"> </span><span class="nv">paying</span><span class="w"> </span><span class="nv">time</span>:<span class="w"> </span>{<span class="nv">period</span>}<span class="nv">_</span>{<span class="nv">class</span>}<span class="nv">_time</span>,<span class="w"></span>
<span class="w">          </span><span class="nv">Non</span><span class="o">-</span><span class="nv">value</span><span class="o">-</span><span class="nv">toll</span><span class="w"> </span><span class="nv">distance</span>:<span class="w"> </span>{<span class="nv">period</span>}<span class="nv">_</span>{<span class="nv">class</span>}<span class="nv">_dist</span>,<span class="w"></span>
<span class="w">          </span><span class="nv">Non</span><span class="o">-</span><span class="nv">value</span><span class="o">-</span><span class="nv">toll</span><span class="w"> </span><span class="nv">bridge</span><span class="w"> </span><span class="nv">toll</span><span class="w"> </span><span class="nv">is</span>:<span class="w"> </span>{<span class="nv">period</span>}<span class="nv">_</span>{<span class="nv">class</span>}<span class="nv">_bridgetoll_</span>{<span class="nv">class</span>},<span class="w"></span>
<span class="w">          </span><span class="nv">Value</span><span class="o">-</span><span class="nv">toll</span><span class="w"> </span><span class="nv">paying</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="nv">is</span>:<span class="w"> </span>{<span class="nv">period</span>}<span class="nv">_</span>{<span class="nv">class</span>}<span class="nv">toll_time</span>,<span class="w"></span>
<span class="w">          </span><span class="nv">Value</span><span class="o">-</span><span class="nv">toll</span><span class="w"> </span><span class="nv">paying</span><span class="w"> </span><span class="nv">distance</span><span class="w"> </span><span class="nv">is</span>:<span class="w"> </span>{<span class="nv">period</span>}<span class="nv">_</span>{<span class="nv">class</span>}<span class="nv">toll_dist</span>,<span class="w"></span>
<span class="w">          </span><span class="nv">Value</span><span class="o">-</span><span class="nv">toll</span><span class="w"> </span><span class="nv">bridge</span><span class="w"> </span><span class="nv">toll</span><span class="w"> </span><span class="nv">is</span>:<span class="w"> </span>{<span class="nv">period</span>}<span class="nv">_</span>{<span class="nv">class</span>}<span class="nv">toll_bridgetoll_</span>{<span class="nv">class</span>},<span class="w"></span>
<span class="w">          </span><span class="nv">Value</span><span class="o">-</span><span class="nv">toll</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">toll</span><span class="w"> </span><span class="nv">is</span>:<span class="w"> </span>{<span class="nv">period</span>}<span class="nv">_</span>{<span class="nv">class</span>}<span class="nv">toll_valuetoll_</span>{<span class="nv">class</span>},<span class="w"></span>
</code></pre></div></td></tr></table></div>

<p>Output: Five, six-table trip matrices, one for each time period.  Two tables for each vehicle
         class representing value-toll paying path trips and non-value-toll paying path trips</p>

<details class="governed-by-tollclassconfig">
  <summary>Governed by TollClassConfig</summary>
  <div class="highlight"><pre><span></span><code>classes:
value_of_time:
operating_cost_per_mile:
property_to_skim_toll:
property_to_skim_notoll:
utility:
</code></pre></div>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExternalTollChoice</span><span class="p">(</span><span class="n">Subcomponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Toll choice</span>
<span class="sd">    -----------</span>
<span class="sd">    Apply a binomial choice model for drive alone, shared ride 2, and shared ride 3</span>
<span class="sd">    internal/external personal vehicle travel.</span>

<span class="sd">    Input:  (1) Time-period-specific origin/destination matrices of drive alone, shared ride 2,</span>
<span class="sd">                and share ride 3+ internal/external trip tables.</span>
<span class="sd">            (2) Skims providing the time and cost for value toll and non-value toll paths for each</span>

<span class="sd">                traffic_skims_{period}.omx, where {period} is the time period ID,</span>
<span class="sd">                {class} is the class name da, sr2, sr2, with the following matrix names</span>
<span class="sd">                  Non-value-toll paying time: {period}_{class}_time,</span>
<span class="sd">                  Non-value-toll distance: {period}_{class}_dist,</span>
<span class="sd">                  Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},</span>
<span class="sd">                  Value-toll paying time is: {period}_{class}toll_time,</span>
<span class="sd">                  Value-toll paying distance is: {period}_{class}toll_dist,</span>
<span class="sd">                  Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},</span>
<span class="sd">                  Value-toll value toll is: {period}_{class}toll_valuetoll_{class},</span>

<span class="sd">     Output: Five, six-table trip matrices, one for each time period.  Two tables for each vehicle</span>
<span class="sd">             class representing value-toll paying path trips and non-value-toll paying path trips</span>

<span class="sd">    Governed by TollClassConfig:</span>

<span class="sd">        ```</span>
<span class="sd">        classes:</span>
<span class="sd">        value_of_time:</span>
<span class="sd">        operating_cost_per_mile:</span>
<span class="sd">        property_to_skim_toll:</span>
<span class="sd">        property_to_skim_notoll:</span>
<span class="sd">        utility:</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">toll_choice</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;toll choice calculator&quot;</span><span class="p">:</span> <span class="n">TollChoiceCalculator</span><span class="p">(</span>
                <span class="n">controller</span><span class="p">,</span> <span class="n">component</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># shortcut</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice calculator&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">toll_skim_suffix</span> <span class="o">=</span> <span class="s2">&quot;trk&quot;</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">period_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Binary toll / non-toll choice model by class.</span>

<span class="sd">        input: result of _ix_time_of_day</span>
<span class="sd">        skims:</span>
<span class="sd">            traffic_skims_{period}.omx, where {period} is the time period ID,</span>
<span class="sd">            {class} is the class name da, sr2, sr2, with the following matrix names</span>
<span class="sd">              Non-value-toll paying time: {period}_{class}_time,</span>
<span class="sd">              Non-value-toll distance: {period}_{class}_dist,</span>
<span class="sd">              Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},</span>
<span class="sd">              Value-toll paying time is: {period}_{class}toll_time,</span>
<span class="sd">              Value-toll paying distance is: {period}_{class}toll_dist,</span>
<span class="sd">              Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},</span>
<span class="sd">              Value-toll value toll is: {period}_{class}toll_valuetoll_{class},</span>

<span class="sd">        STEPS:</span>
<span class="sd">        3.1: For each time of day, for each da, sr2, sr3, calculate</span>
<span class="sd">             - utility of toll and nontoll</span>
<span class="sd">             - probability of toll / nontoll</span>
<span class="sd">             - split demand into toll and nontoll matrices</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_time_class_combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">)</span>

        <span class="n">class_demands</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">_time_class_combos</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">_time_period</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">_time_period</span> <span class="o">=</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">_time_period</span> <span class="o">=</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Period </span><span class="si">{</span><span class="n">_time_period</span><span class="si">}</span><span class="s2"> not an available time period.</span><span class="se">\</span>
<span class="s2">                    Available periods are:  </span><span class="si">{</span><span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">_split_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">period_demand</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_class</span><span class="p">],</span> <span class="n">_class</span><span class="p">,</span> <span class="n">_time_period</span>
            <span class="p">)</span>

            <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_class</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;non toll&quot;</span><span class="p">]</span>
            <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">class_demands</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.internal_external.ExternalTollChoice.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span></code>

<a href="#tm2py.components.demand.internal_external.ExternalTollChoice.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Binary toll / non-toll choice model by class.</p>
<p>input: result of _ix_time_of_day</p>

<details class="skims">
  <summary>skims</summary>
  <p>traffic_skims_{period}.omx, where {period} is the time period ID,
{class} is the class name da, sr2, sr2, with the following matrix names
  Non-value-toll paying time: {period}<em>{class}_time,
  Non-value-toll distance: {period}</em>{class}<em>dist,
  Non-value-toll bridge toll is: {period}</em>{class}<em>bridgetoll</em>{class},
  Value-toll paying time is: {period}<em>{class}toll_time,
  Value-toll paying distance is: {period}</em>{class}toll_dist,
  Value-toll bridge toll is: {period}<em>{class}toll_bridgetoll</em>{class},
  Value-toll value toll is: {period}<em>{class}toll_valuetoll</em>{class},</p>
</details>      <p>3.1: For each time of day, for each da, sr2, sr3, calculate
     - utility of toll and nontoll
     - probability of toll / nontoll
     - split demand into toll and nontoll matrices</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">period_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;Binary toll / non-toll choice model by class.</span>

<span class="sd">    input: result of _ix_time_of_day</span>
<span class="sd">    skims:</span>
<span class="sd">        traffic_skims_{period}.omx, where {period} is the time period ID,</span>
<span class="sd">        {class} is the class name da, sr2, sr2, with the following matrix names</span>
<span class="sd">          Non-value-toll paying time: {period}_{class}_time,</span>
<span class="sd">          Non-value-toll distance: {period}_{class}_dist,</span>
<span class="sd">          Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},</span>
<span class="sd">          Value-toll paying time is: {period}_{class}toll_time,</span>
<span class="sd">          Value-toll paying distance is: {period}_{class}toll_dist,</span>
<span class="sd">          Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},</span>
<span class="sd">          Value-toll value toll is: {period}_{class}toll_valuetoll_{class},</span>

<span class="sd">    STEPS:</span>
<span class="sd">    3.1: For each time of day, for each da, sr2, sr3, calculate</span>
<span class="sd">         - utility of toll and nontoll</span>
<span class="sd">         - probability of toll / nontoll</span>
<span class="sd">         - split demand into toll and nontoll matrices</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_time_class_combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">component</span><span class="o">.</span><span class="n">classes</span>
    <span class="p">)</span>

    <span class="n">class_demands</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_time_period</span><span class="p">,</span> <span class="n">_class</span> <span class="ow">in</span> <span class="n">_time_class_combos</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">_time_period</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">_time_period</span> <span class="o">=</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">_time_period</span> <span class="o">=</span> <span class="n">_time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Period </span><span class="si">{</span><span class="n">_time_period</span><span class="si">}</span><span class="s2"> not an available time period.</span><span class="se">\</span>
<span class="s2">                Available periods are:  </span><span class="si">{</span><span class="n">period_demand</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">_split_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">period_demand</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_class</span><span class="p">],</span> <span class="n">_class</span><span class="p">,</span> <span class="n">_time_period</span>
        <span class="p">)</span>

        <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="n">_class</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;non toll&quot;</span><span class="p">]</span>
        <span class="n">class_demands</span><span class="p">[</span><span class="n">_time_period</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_class</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_split_demand</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">class_demands</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.internal_external.InternalExternal" class="doc doc-heading">
        <code>InternalExternal</code>


<a href="#tm2py.components.demand.internal_external.InternalExternal" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Develop Internal &lt;-&gt; External trip tables from land use and impedances.</p>
<ol>
<li>Grow demand from base year using static rates ::ExternalDemand</li>
<li>Split by time of day using static factors ::TimePeriodSplit</li>
<li>Apply basic toll binomial choice model: ::ExternalTollChoice</li>
</ol>

<details class="governed-by-internalexternalconfig">
  <summary>Governed by InternalExternalConfig</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InternalExternal</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Develop Internal &lt;-&gt; External trip tables from land use and impedances.</span>

<span class="sd">    1. Grow demand from base year using static rates ::ExternalDemand</span>
<span class="sd">    2. Split by time of day using static factors ::TimePeriodSplit</span>
<span class="sd">    3. Apply basic toll binomial choice model: ::ExternalTollChoice</span>

<span class="sd">    Governed by InternalExternalConfig:</span>
<span class="sd">        highway_demand_file:</span>
<span class="sd">        input_demand_file:</span>
<span class="sd">        input_demand_matrixname_tmpl:</span>
<span class="sd">        modes:</span>
<span class="sd">        reference_year:</span>
<span class="sd">        annual_growth_rate: List[MatrixFactorConfig]</span>
<span class="sd">        time_of_day: TimeOfDayConfig</span>
<span class="sd">        toll_choice: TollChoiceConfig</span>
<span class="sd">        special_gateway_adjust: Optional[List[MatrixFactorConfig]]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;demand forecast&quot;</span><span class="p">:</span> <span class="n">ExternalDemand</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
            <span class="s2">&quot;time of day&quot;</span><span class="p">:</span> <span class="n">TimePeriodSplit</span><span class="p">(</span>
                <span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_of_day</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">time_period_split</span>
            <span class="p">),</span>
            <span class="s2">&quot;toll choice&quot;</span><span class="p">:</span> <span class="n">ExternalTollChoice</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">modes</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate inputs to component.&quot;&quot;&quot;</span>
        <span class="c1">## TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run internal/external travel demand component.&quot;&quot;&quot;</span>

        <span class="n">daily_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;demand forecast&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">period_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;time of day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span>
        <span class="n">class_demands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">class_demands</span><span class="p">)</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_export_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]):</span>
        <span class="sd">&quot;&quot;&quot;Export assignable class demands to OMX files by time-of-day.&quot;&quot;&quot;</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_trip_table_directory</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">matrices</span> <span class="ow">in</span> <span class="n">demand</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">outdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">outfile_trip_table_tmp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">output_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.internal_external.InternalExternal.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run internal/external travel demand component.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run internal/external travel demand component.&quot;&quot;&quot;</span>

    <span class="n">daily_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;demand forecast&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">period_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;time of day&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span>
    <span class="n">class_demands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_components</span><span class="p">[</span><span class="s2">&quot;toll choice&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">class_demands</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.demand.internal_external.InternalExternal.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.demand.internal_external.InternalExternal.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate inputs to component.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate inputs to component.&quot;&quot;&quot;</span>
    <span class="c1">## TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.InternalExternalConfig" class="doc doc-heading">
        <code>tm2py.config.InternalExternalConfig</code>


<a href="#tm2py.config.InternalExternalConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Internal &lt;-&gt; External model parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">InternalExternalConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Internal &lt;-&gt; External model parameters.&quot;&quot;&quot;</span>

    <span class="n">output_trip_table_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">outfile_trip_table_tmp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">modes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">DemandGrowth</span>
    <span class="n">time_of_day</span><span class="p">:</span> <span class="n">TimeOfDayConfig</span>
    <span class="n">toll_choice</span><span class="p">:</span> <span class="n">TollChoiceConfig</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h4 id="visitor-demand">Visitor Demand<a class="headerlink" href="#visitor-demand" title="Permanent link"> ¶</a></h4>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.visitor" class="doc doc-heading">
          <code>tm2py.components.demand.visitor</code>


<a href="#tm2py.components.demand.visitor" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Visitor module.</p>

  </div>

</div><h3 id="highway-network-components">Highway Network Components<a class="headerlink" href="#highway-network-components" title="Permanent link"> ¶</a></h3>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.highway.highway_network" class="doc doc-heading">
          <code>tm2py.components.network.highway.highway_network</code>


<a href="#tm2py.components.network.highway.highway_network" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Module for highway network preparation steps.</p>
<p>Creates required attributes and populates input values needed
for highway assignments. The toll values, VDFs, per-class cost
(tolls+operating costs), modes and skim link attributes are calculated.</p>

<details class="the-following-link-attributes-are-used-as-input">
  <summary>The following link attributes are used as input</summary>
  <ul>
<li>&ldquo;@capclass&rdquo;: link capclass index</li>
<li>&ldquo;length&rdquo;: standard link length, in miles</li>
<li>&ldquo;@tollbooth&rdquo;: label to separate bridgetolls from valuetolls</li>
<li>&ldquo;@tollseg&rdquo;: toll segment, used to index toll value lookups from the toll file
    (under config.highway.tolls.file_path)</li>
<li>&ldquo;@ft&rdquo;: functional class, used to assign VDFs</li>
</ul>
</details>
<details class="the-following-keys-and-tables-are-used-from-the-config">
  <summary>The following keys and tables are used from the config</summary>
  <p>highway.tolls.file_path: relative path to input toll file
highway.tolls.src_vehicle_group_names: names used in tolls file for
    toll class values
highway.tolls.dst_vehicle_group_names: corresponding names used in
    network attributes toll classes
highway.tolls.tollbooth_start_index: index to split point bridge tolls
    (&lt; this value) from distance value tolls (&gt;= this value)
highway.classes: the list of assignment classes, see the notes under
    highway_assign for detailed explanation
highway.capclass_lookup: the lookup table mapping the link @capclass setting
    to capacity (@capacity), free_flow_speed (@free_flow_speec) and
    critical_speed (used to calculate @ja for akcelik type functions)
highway.generic_highway_mode_code: unique (with other mode_codes) single
    character used to label entire auto network in Emme
highway.maz_to_maz.mode_code: unique (with other mode_codes) single
    character used to label MAZ local auto network including connectors</p>
</details>      <p>The following link attributes are created (overwritten) and are subsequently used in
the highway assignments.
    - &ldquo;@flow_XX&rdquo;: link PCE flows per class, where XX is the class name in the config
    - &ldquo;@maz_flow&rdquo;: Assigned MAZ-to-MAZ flow</p>

<details class="the-following-attributes-are-calculated">
  <summary>The following attributes are calculated</summary>
  <ul>
<li>vdf: volume delay function to use</li>
<li>&ldquo;@capacity&rdquo;: total link capacity</li>
<li>&ldquo;@ja&rdquo;: akcelik delay parameter</li>
<li>&ldquo;@hov_length&rdquo;: length with HOV lanes</li>
<li>&ldquo;@toll_length&rdquo;: length with tolls</li>
<li>&ldquo;@bridgetoll_YY&rdquo;: the bridge toll for class subgroup YY</li>
<li>&ldquo;@valuetoll_YY&rdquo;: the &ldquo;value&rdquo;, non-bridge toll for class subgroup YY</li>
<li>&ldquo;@cost_YY&rdquo;: total cost for class YY</li>
</ul>
</details>
  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_network.PrepareNetwork" class="doc doc-heading">
        <code>PrepareNetwork</code>


<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Highway network preparation.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareNetwork</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway network preparation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for PPrepareNetwork.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to run controller object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare network attributes and modes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run network preparation step.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;prepare for highway assignment </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">):</span>
                <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">time</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_class_attributes</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="n">network</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_tolls</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_vdf_attributes</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_modes</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_skim_lengths</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_class_costs</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="n">scenario</span><span class="o">.</span><span class="n">publish_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
        <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Tolls file (config.highway.tolls.file_path) does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tolls file does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">src_veh_groups</span><span class="p">:</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">vehicle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Tolls file missing column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileFormatError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Tolls file missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_class_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create required network attributes including per-class cost and flow attributes.&quot;&quot;&quot;</span>
        <span class="n">create_attribute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.extra_attribute.create_extra_attribute&quot;</span>
        <span class="p">)</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;@capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;total link capacity&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@ja&quot;</span><span class="p">,</span> <span class="s2">&quot;akcelik delay parameter&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@maz_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;Assigned MAZ-to-MAZ flow&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">,</span> <span class="s2">&quot;length with HOV lanes&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">,</span> <span class="s2">&quot;length with tolls&quot;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="c1"># toll field attributes by bridge and value and toll definition</span>
        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="k">for</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="n">dst_veh_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">toll_type</span> <span class="ow">in</span> <span class="s2">&quot;bridge&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;@</span><span class="si">{</span><span class="n">toll_type</span><span class="si">}</span><span class="s2">toll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toll_type</span><span class="si">}</span><span class="s2"> toll value for </span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># results for link cost and assigned flow</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> total costs&#39;</span><span class="p">[:</span><span class="mi">40</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@flow_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> link volume&#39;</span><span class="p">[:</span><span class="mi">40</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">create_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_tolls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the tolls in the network from the toll reference file.&quot;&quot;&quot;</span>
        <span class="n">toll_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_toll_indices</span><span class="p">()</span>
        <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="n">tollbooth_start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">tollbooth_start_index</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
                    <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollseg&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
                    <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">data_row</span> <span class="o">=</span> <span class="n">toll_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;set tolls failed index lookup </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, link </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>  <span class="c1"># tolls will remain at zero</span>
                <span class="c1"># if index is below tollbooth start index then this is a bridge</span>
                <span class="c1"># (point toll), available for all traffic assignment classes</span>
                <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tollbooth_start_index</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">src_veh</span><span class="p">,</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_veh_groups</span><span class="p">,</span> <span class="n">dst_veh_groups</span><span class="p">):</span>
                        <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@bridgetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">data_row</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">src_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># else, this is a tollway with a per-mile charge</span>
                    <span class="k">for</span> <span class="n">src_veh</span><span class="p">,</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_veh_groups</span><span class="p">,</span> <span class="n">dst_veh_groups</span><span class="p">):</span>
                        <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">data_row</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">src_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                            <span class="o">*</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
                            <span class="o">*</span> <span class="mi">100</span>
                        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_toll_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get the mapping of toll lookup table from the toll reference file.&quot;&quot;&quot;</span>
        <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll_file_path </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tolls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">toll_file</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
                <span class="n">tolls</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">tolls</span>

    <span class="k">def</span> <span class="nf">_set_vdf_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set capacity, VDF and critical speed on links.&quot;&quot;&quot;</span>
        <span class="n">capacity_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">critical_speed_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">capclass_lookup</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">capacity_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;capclass&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;critical_speed&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">critical_speed_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;capclass&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;critical_speed&quot;</span><span class="p">)</span>
        <span class="n">tp_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">tp</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">tp</span><span class="o">.</span><span class="n">highway_capacity_factor</span>
            <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span>
        <span class="p">}</span>
        <span class="n">period_capacity_factor</span> <span class="o">=</span> <span class="n">tp_mapping</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span>
        <span class="n">akcelik_vdfs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">cap_lanehour</span> <span class="o">=</span> <span class="n">capacity_map</span><span class="p">[</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capclass&quot;</span><span class="p">]]</span>
            <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_lanehour</span> <span class="o">*</span> <span class="n">period_capacity_factor</span> <span class="o">*</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">]</span>
            <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ft&quot;</span><span class="p">])</span>
            <span class="c1"># re-mapping links with type 99 to type 7 &quot;local road of minor importance&quot;</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>
                <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">=</span> <span class="mi">7</span>
            <span class="c1"># num_lanes not used directly, but set for reference</span>
            <span class="n">link</span><span class="o">.</span><span class="n">num_lanes</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mf">9.9</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="ow">in</span> <span class="n">akcelik_vdfs</span> <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@free_flow_speed&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
                <span class="n">critical_speed</span> <span class="o">=</span> <span class="n">critical_speed_map</span><span class="p">[</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capclass&quot;</span><span class="p">]]</span>
                <span class="n">t_c</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">critical_speed</span>
                <span class="n">t_o</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@free_flow_speed&quot;</span><span class="p">]</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ja&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_c</span> <span class="o">-</span> <span class="n">t_o</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_set_link_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the link modes based on the per-class &#39;excluded_links&#39; set.&quot;&quot;&quot;</span>
        <span class="c1"># first reset link modes (script run more than once)</span>
        <span class="c1"># &quot;generic_highway_mode_code&quot; must already be created (in import to Emme script)</span>
        <span class="n">auto_mode</span> <span class="o">=</span> <span class="p">{</span><span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">generic_highway_mode_code</span><span class="p">)}</span>
        <span class="n">used_modes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">)</span> <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">}</span>
        <span class="n">used_modes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">mode_code</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">-=</span> <span class="n">used_modes</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@drive_link&quot;</span><span class="p">]:</span>
                <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">|=</span> <span class="n">auto_mode</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">used_modes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">network</span><span class="o">.</span><span class="n">delete_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

        <span class="c1"># Create special access/egress mode for MAZ connectors</span>
        <span class="n">maz_access_mode</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">create_mode</span><span class="p">(</span>
            <span class="s2">&quot;AUX_AUTO&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">mode_code</span>
        <span class="p">)</span>
        <span class="n">maz_access_mode</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;MAZ access&quot;</span>
        <span class="c1"># create modes from class spec</span>
        <span class="c1"># (duplicate mode codes allowed provided the excluded_links is the same)</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>
                    <span class="o">!=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span>
                    <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;config error: highway.classes, duplicated mode codes &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(&#39;</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="si">}</span><span class="s2">&#39;) with different excluded &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">create_mode</span><span class="p">(</span><span class="s2">&quot;AUX_AUTO&quot;</span><span class="p">,</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">)</span>
            <span class="n">mode</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">name</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>

        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">modes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">link</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">i_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">link</span><span class="o">.</span><span class="n">j_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">modes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">maz_access_mode</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">modes</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@drive_link&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">exclude_links_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;is_sr&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="s2">&quot;is_sr2&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;is_sr3&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;is_auto_only&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="n">dst_veh_groups</span><span class="p">:</span>
                <span class="n">exclude_links_map</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_exclusions</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">excluded_links</span><span class="p">,</span>
                <span class="n">maz_access_mode</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">modes</span><span class="p">,</span>
                <span class="n">exclude_links_map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_apply_exclusions</span><span class="p">(</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span><span class="p">,</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">,</span>
                    <span class="n">modes</span><span class="p">,</span>
                    <span class="n">exclude_links_map</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">modes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_apply_exclusions</span><span class="p">(</span>
        <span class="n">excluded_links_criteria</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">modes_set</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">link_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply the exclusion criteria to set the link modes.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="n">excluded_links_criteria</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link_values</span><span class="p">[</span><span class="n">criteria</span><span class="p">]:</span>
                <span class="k">return</span>
        <span class="n">modes_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mode_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_link_skim_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the length attributes used in the highway skims.&quot;&quot;&quot;</span>
        <span class="n">tollbooth_start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">tollbooth_start_index</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># distance in hov lanes / facilities</span>
            <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># distance on non-bridge toll facilities</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tollbooth_start_index</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_calc_link_class_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the per-class link cost from the tolls and operating costs.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">cost_attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">op_cost</span> <span class="o">=</span> <span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;operating_cost_per_mile&quot;</span><span class="p">]</span>
            <span class="n">toll_factor</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;toll_factor&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">toll_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">toll_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
                <span class="n">toll_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="n">toll_attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">toll_attr</span> <span class="ow">in</span> <span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">])</span>
                <span class="n">link</span><span class="p">[</span><span class="n">cost_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span> <span class="o">*</span> <span class="n">op_cost</span> <span class="o">+</span> <span class="n">toll_value</span> <span class="o">*</span> <span class="n">toll_factor</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_network.PrepareNetwork.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for PPrepareNetwork.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Reference to run controller object.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="s2">&quot;RunController&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for PPrepareNetwork.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to run controller object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run network preparation step.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare network attributes and modes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run network preparation step.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;prepare for highway assignment </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">):</span>
            <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">time</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_class_attributes</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="n">network</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tolls</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_vdf_attributes</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_modes</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_skim_lengths</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_class_costs</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">publish_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate inputs files are correct, raise if an error is found.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
    <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Tolls file (config.highway.tolls.file_path) does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tolls file does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">src_veh_groups</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">vehicle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Tolls file missing column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span>
                <span class="p">)</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileFormatError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Tolls file missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.highway.highway_assign" class="doc doc-heading">
          <code>tm2py.components.network.highway.highway_assign</code>


<a href="#tm2py.components.network.highway.highway_assign" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Highway assignment and skim component.</p>
<p>Performs equilibrium traffic assignment and generates resulting skims.
The assignmend is configured using the &ldquo;highway&rdquo; table in the source config.
See the config documentation for details. The traffic assignment runs according
to the list of assignment classes under highway.classes.</p>
<p>Other relevant parameters from the config are:
- emme.num_processors: number of processors as integer or &ldquo;MAX&rdquo; or &ldquo;MAX-N&rdquo;
- time_periods[].emme_scenario_id: Emme scenario number to use for each period
- time_periods[].highway_capacity_factor</p>
<p>The Emme network must have the following attributes available:</p>
<p>Link - attributes:
- &ldquo;length&rdquo; in feet
- &ldquo;vdf&rdquo;, volume delay function (volume delay functions must also be setup)
- &ldquo;@useclass&rdquo;, vehicle-class restrictions classification, auto-only, HOV only
- &ldquo;@free_flow_time&rdquo;, the free flow time (in minutes)
- &ldquo;@tollXX_YY&rdquo;, the toll for period XX and class subgroup (see truck
    class) named YY, used together with @tollbooth to generate @bridgetoll_YY
    and @valuetoll_YY
- &ldquo;@maz_flow&rdquo;, the background traffic MAZ-to-MAZ SP assigned flow from highway_maz,
    if controller.iteration &gt; 0
- modes: must be set on links and match the specified mode codes in
    the traffic config</p>
<p>Network results - attributes:
- @flow_XX: link PCE flows per class, where XX is the class name in the config
- timau: auto travel time
- volau: total assigned flow in PCE</p>
<p>Notes:
- Output matrices are in miles, minutes, and cents (2010 dollars) and are stored/
as real values;
- Intrazonal distance/time is one half the distance/time to the nearest neighbor;
- Intrazonal bridge and value tolls are assumed to be zero</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_assign.AssignmentClass" class="doc doc-heading">
        <code>AssignmentClass</code>


<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">

  
      <p>Highway assignment class, represents data from config and conversion to Emme specs.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AssignmentClass</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment class, represents data from config and conversion to Emme specs.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">iteration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor of Highway Assignment class.</span>

<span class="sd">        Args:</span>
<span class="sd">            class_config (_type_): _description_</span>
<span class="sd">            time_period (_type_): _description_</span>
<span class="sd">            iteration (_type_): _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span> <span class="o">=</span> <span class="n">class_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_period</span> <span class="o">=</span> <span class="n">time_period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skims</span> <span class="o">=</span> <span class="n">class_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skims&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_highway_class_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeHighwayClassSpec</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Construct and return Emme traffic assignment class specification.</span>

<span class="sd">        Converted from input config (highway.classes), see Emme Help for</span>
<span class="sd">        SOLA traffic assignment for specification details.</span>
<span class="sd">        Adds time_period as part of demand and skim matrix names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A nested dictionary corresponding to the expected Emme traffic</span>
<span class="sd">            class specification used in the SOLA assignment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">demand_matrix</span> <span class="o">=</span> <span class="s1">&#39;ms&quot;zero&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">demand_matrix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="n">class_spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">mode_code</span><span class="p">,</span>
            <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="n">demand_matrix</span><span class="p">,</span>
            <span class="s2">&quot;generalized_cost&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;link_costs&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># cost in $0.01</span>
                <span class="c1"># $/hr -&gt; min/$0.01</span>
                <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mf">0.6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">value_of_time</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;link_volumes&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@flow_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;od_travel_times&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;shortest_paths&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;path_analyses&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_class_analysis</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">class_spec</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_class_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeHighwayAnalysisSpec</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Construct and return a list of path analyses specs which generate the required skims.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of nested dictionaries corresponding to the Emme path analysis</span>
<span class="sd">            (per-class) specification used in the SOLA assignment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">class_analysis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
            <span class="n">class_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emme_analysis_spec</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                    <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_cost&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">skim_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skim_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">skim_type</span><span class="p">:</span>
                <span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">skim_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">skim_type</span><span class="si">}{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">class_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emme_analysis_spec</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span><span class="p">),</span>
                    <span class="n">matrix_name</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">class_analysis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">skim_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Returns: List of skim matrix names for this class.&quot;&quot;&quot;</span>
        <span class="n">skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
            <span class="n">skim_matrices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_cost&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">skim_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skim_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">skim_type</span><span class="p">:</span>
                <span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">skim_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">skim_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">skim_type</span><span class="si">}{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">skim_matrices</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">emme_analysis_spec</span><span class="p">(</span><span class="n">link_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeHighwayAnalysisSpec</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns Emme highway class path analysis spec.</span>

<span class="sd">        See Emme Help for SOLA assignment for full specification details.</span>
<span class="sd">        Args:</span>
<span class="sd">            link_attr: input link attribute for which to sum values along the paths</span>
<span class="sd">            matrix_name: full matrix name to store the result of the path analysis</span>

<span class="sd">        Returns:</span>
<span class="sd">            The nested dictionary specification which will generate the skim</span>
<span class="sd">            of link attribute values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis_spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;link_component&quot;</span><span class="p">:</span> <span class="n">link_attr</span><span class="p">,</span>
            <span class="s2">&quot;turn_component&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selection_threshold&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
            <span class="s2">&quot;path_to_od_composition&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;considered_paths&quot;</span><span class="p">:</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;multiply_path_proportions_by&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;analyzed_demand&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;path_value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;od_values&quot;</span><span class="p">:</span> <span class="n">matrix_name</span><span class="p">,</span>
                <span class="s2">&quot;selected_link_volumes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;selected_turn_volumes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">analysis_spec</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the link attribute name for the specified skim type and group.</span>

<span class="sd">        Args:</span>
<span class="sd">            skim: name of skim requested, one of dist, hovdist, tolldist, freeflowtime,</span>
<span class="sd">                bridgetoll, or valuetoll</span>
<span class="sd">            group: subgroup name for the bridgetoll or valuetoll, corresponds to one of</span>
<span class="sd">                the names from config.highway.tolls.dst_vehicle_group_names</span>
<span class="sd">        Returns:</span>
<span class="sd">            A string of the link attribute name used in the analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>  <span class="c1"># NOTE: length must be in miles</span>
            <span class="s2">&quot;hovdist&quot;</span><span class="p">:</span> <span class="s2">&quot;@hov_length&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tolldist&quot;</span><span class="p">:</span> <span class="s2">&quot;@toll_length&quot;</span><span class="p">,</span>
            <span class="s2">&quot;freeflowtime&quot;</span><span class="p">:</span> <span class="s2">&quot;@free_flow_time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bridgetoll&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@bridgetoll_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;valuetoll&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">lookup</span><span class="p">[</span><span class="n">skim</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">class_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor of Highway Assignment class.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>class_config</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>time_period</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>iteration</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">iteration</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor of Highway Assignment class.</span>

<span class="sd">    Args:</span>
<span class="sd">        class_config (_type_): _description_</span>
<span class="sd">        time_period (_type_): _description_</span>
<span class="sd">        iteration (_type_): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span> <span class="o">=</span> <span class="n">class_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_period</span> <span class="o">=</span> <span class="n">time_period</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">skims</span> <span class="o">=</span> <span class="n">class_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skims&quot;</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.emme_analysis_spec" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_analysis_spec</span><span class="p">(</span><span class="n">link_attr</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_analysis_spec" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Returns Emme highway class path analysis spec.</p>
<p>See Emme Help for SOLA assignment for full specification details.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>link_attr</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>input link attribute for which to sum values along the paths</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>matrix_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>full matrix name to store the result of the path analysis</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="tm2py.components.network.highway.highway_assign.EmmeHighwayAnalysisSpec">EmmeHighwayAnalysisSpec</span></code>
          </td>
          <td><p>The nested dictionary specification which will generate the skim</p></td>
        </tr>
        <tr>
          <td>
                <code><span title="tm2py.components.network.highway.highway_assign.EmmeHighwayAnalysisSpec">EmmeHighwayAnalysisSpec</span></code>
          </td>
          <td><p>of link attribute values.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">emme_analysis_spec</span><span class="p">(</span><span class="n">link_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeHighwayAnalysisSpec</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns Emme highway class path analysis spec.</span>

<span class="sd">    See Emme Help for SOLA assignment for full specification details.</span>
<span class="sd">    Args:</span>
<span class="sd">        link_attr: input link attribute for which to sum values along the paths</span>
<span class="sd">        matrix_name: full matrix name to store the result of the path analysis</span>

<span class="sd">    Returns:</span>
<span class="sd">        The nested dictionary specification which will generate the skim</span>
<span class="sd">        of link attribute values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analysis_spec</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;link_component&quot;</span><span class="p">:</span> <span class="n">link_attr</span><span class="p">,</span>
        <span class="s2">&quot;turn_component&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="s2">&quot;selection_threshold&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
        <span class="s2">&quot;path_to_od_composition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;considered_paths&quot;</span><span class="p">:</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;multiply_path_proportions_by&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;analyzed_demand&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;path_value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;od_values&quot;</span><span class="p">:</span> <span class="n">matrix_name</span><span class="p">,</span>
            <span class="s2">&quot;selected_link_volumes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;selected_turn_volumes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">analysis_spec</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.emme_class_analysis" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_class_analysis</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_class_analysis" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Construct and return a list of path analyses specs which generate the required skims.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="tm2py.components.network.highway.highway_assign.EmmeHighwayAnalysisSpec">EmmeHighwayAnalysisSpec</span>]</code>
          </td>
          <td><p>A list of nested dictionaries corresponding to the Emme path analysis</p></td>
        </tr>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<span title="tm2py.components.network.highway.highway_assign.EmmeHighwayAnalysisSpec">EmmeHighwayAnalysisSpec</span>]</code>
          </td>
          <td><p>(per-class) specification used in the SOLA assignment.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">emme_class_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeHighwayAnalysisSpec</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Construct and return a list of path analyses specs which generate the required skims.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of nested dictionaries corresponding to the Emme path analysis</span>
<span class="sd">        (per-class) specification used in the SOLA assignment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">class_analysis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
        <span class="n">class_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emme_analysis_spec</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_cost&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">skim_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">skim_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">skim_type</span><span class="p">:</span>
            <span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">skim_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">skim_type</span><span class="si">}{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">class_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emme_analysis_spec</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span><span class="p">),</span>
                <span class="n">matrix_name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">class_analysis</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.emme_highway_class_spec" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_highway_class_spec</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_highway_class_spec" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Construct and return Emme traffic assignment class specification.</p>
<p>Converted from input config (highway.classes), see Emme Help for
SOLA traffic assignment for specification details.
Adds time_period as part of demand and skim matrix names.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="tm2py.components.network.highway.highway_assign.EmmeHighwayClassSpec">EmmeHighwayClassSpec</span></code>
          </td>
          <td><p>A nested dictionary corresponding to the expected Emme traffic</p></td>
        </tr>
        <tr>
          <td>
                <code><span title="tm2py.components.network.highway.highway_assign.EmmeHighwayClassSpec">EmmeHighwayClassSpec</span></code>
          </td>
          <td><p>class specification used in the SOLA assignment.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">emme_highway_class_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeHighwayClassSpec</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Construct and return Emme traffic assignment class specification.</span>

<span class="sd">    Converted from input config (highway.classes), see Emme Help for</span>
<span class="sd">    SOLA traffic assignment for specification details.</span>
<span class="sd">    Adds time_period as part of demand and skim matrix names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A nested dictionary corresponding to the expected Emme traffic</span>
<span class="sd">        class specification used in the SOLA assignment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">demand_matrix</span> <span class="o">=</span> <span class="s1">&#39;ms&quot;zero&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">demand_matrix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
    <span class="n">class_spec</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">mode_code</span><span class="p">,</span>
        <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="n">demand_matrix</span><span class="p">,</span>
        <span class="s2">&quot;generalized_cost&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;link_costs&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># cost in $0.01</span>
            <span class="c1"># $/hr -&gt; min/$0.01</span>
            <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mf">0.6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">value_of_time</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;link_volumes&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@flow_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;od_travel_times&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;shortest_paths&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;path_analyses&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_class_analysis</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">class_spec</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.skim_analysis_link_attribute" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_analysis_link_attribute" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Return the link attribute name for the specified skim type and group.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>skim</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>name of skim requested, one of dist, hovdist, tolldist, freeflowtime,
bridgetoll, or valuetoll</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>group</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>subgroup name for the bridgetoll or valuetoll, corresponds to one of
the names from config.highway.tolls.dst_vehicle_group_names</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>str</code>
          </td>
          <td><p>A string of the link attribute name used in the analysis.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return the link attribute name for the specified skim type and group.</span>

<span class="sd">    Args:</span>
<span class="sd">        skim: name of skim requested, one of dist, hovdist, tolldist, freeflowtime,</span>
<span class="sd">            bridgetoll, or valuetoll</span>
<span class="sd">        group: subgroup name for the bridgetoll or valuetoll, corresponds to one of</span>
<span class="sd">            the names from config.highway.tolls.dst_vehicle_group_names</span>
<span class="sd">    Returns:</span>
<span class="sd">        A string of the link attribute name used in the analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lookup</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>  <span class="c1"># NOTE: length must be in miles</span>
        <span class="s2">&quot;hovdist&quot;</span><span class="p">:</span> <span class="s2">&quot;@hov_length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tolldist&quot;</span><span class="p">:</span> <span class="s2">&quot;@toll_length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;freeflowtime&quot;</span><span class="p">:</span> <span class="s2">&quot;@free_flow_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bridgetoll&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@bridgetoll_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;valuetoll&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">lookup</span><span class="p">[</span><span class="n">skim</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.skim_matrices" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">skim_matrices</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_matrices" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">skim_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Returns: List of skim matrix names for this class.&quot;&quot;&quot;</span>
    <span class="n">skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
        <span class="n">skim_matrices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_cost&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">skim_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">skim_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">skim_type</span><span class="p">:</span>
            <span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">skim_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">skim_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">skim_type</span><span class="si">}{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">skim_matrices</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_assign.HighwayAssignment" class="doc doc-heading">
        <code>HighwayAssignment</code>


<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Highway assignment and skims.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>parent RunController object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayAssignment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skims.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for HighwayAssignment components.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to current run controller.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.hwy_classes</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">class_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.hwy_class_configs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Highway assignment and skims&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run highway assignment.&quot;&quot;&quot;</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="n">PrepareHighwayDemand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">demand</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">time</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
                <span class="n">assign_classes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">AssignmentClass</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_copy_maz_flow</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_background_traffic</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_skim_matrices</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">assign_classes</span><span class="p">)</span>
                <span class="n">assign_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_assignment_spec</span><span class="p">(</span><span class="n">assign_classes</span><span class="p">)</span>
                <span class="c1"># self.logger.log_dict(assign_spec, level=&quot;DEBUG&quot;)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                    <span class="s2">&quot;Run SOLA assignment with path analyses&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
                <span class="p">):</span>
                    <span class="n">assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
                        <span class="s2">&quot;inro.emme.traffic_assignment.sola_traffic_assignment&quot;</span>
                    <span class="p">)</span>
                    <span class="n">assign</span><span class="p">(</span><span class="n">assign_spec</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">chart_log_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Subtract non-time costs from gen cost to get the raw travel time</span>
                <span class="k">for</span> <span class="n">emme_class_spec</span> <span class="ow">in</span> <span class="n">assign_spec</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_calc_time_skim</span><span class="p">(</span><span class="n">emme_class_spec</span><span class="p">)</span>
                <span class="c1"># Set intra-zonal for time and dist to be 1/2 nearest neighbour</span>
                <span class="k">for</span> <span class="n">class_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_intrazonal_values</span><span class="p">(</span>
                        <span class="n">time</span><span class="p">,</span>
                        <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_skims</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_enabled</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug_report</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup and teardown for Emme Matrix cache and list of skim matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">            time_period: time period name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="n">MatrixCache</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Highway assignment for period </span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_copy_maz_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy maz_flow from MAZ demand assignment to ul1 for background traffic.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="s2">&quot;Copy @maz_flow to ul1 for background traffic&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="p">(</span><span class="s2">&quot;ul1&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_flow&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reset_background_traffic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set ul1 for background traffic to 0 (no maz-maz flow).</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="s2">&quot;Set ul1 to 0 for background traffic&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="p">(</span><span class="s2">&quot;ul1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_skim_matrices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">assign_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AssignmentClass</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create matrices to store skim results in Emme database.</span>

<span class="sd">        Also add the matrices to list of self._skim_matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">            assign_classes: list of AssignmentClass objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">create_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.matrix.create_matrix&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="s2">&quot;Creating skim matrices&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">assign_classes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">matrix_name</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="n">skim_matrices</span><span class="p">:</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                        <span class="n">matrix</span> <span class="o">=</span> <span class="n">create_matrix</span><span class="p">(</span>
                            <span class="s2">&quot;mf&quot;</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">scenario</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Create matrix name: </span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s2">, id: </span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_assignment_spec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">assign_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AssignmentClass</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeTrafficAssignmentSpec</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate template Emme SOLA assignment specification.</span>

<span class="sd">        Args:</span>
<span class="sd">            assign_classes: list of AssignmentClass objects</span>

<span class="sd">        Returns</span>
<span class="sd">            Emme specification for SOLA traffic assignment</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relative_gap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">relative_gap</span>
        <span class="n">max_iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_iterations</span>
        <span class="c1"># NOTE: mazmazvol as background traffic in link.data1 (&quot;ul1&quot;)</span>
        <span class="n">base_spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SOLA_TRAFFIC_ASSIGNMENT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;background_traffic&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;link_component&quot;</span><span class="p">:</span> <span class="s2">&quot;ul1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;turn_component&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;add_transit_vehicles&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">klass</span><span class="o">.</span><span class="n">emme_highway_class_spec</span> <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">assign_classes</span><span class="p">],</span>
            <span class="s2">&quot;stopping_criteria&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_iterations&quot;</span><span class="p">:</span> <span class="n">max_iterations</span><span class="p">,</span>
                <span class="s2">&quot;best_relative_gap&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">&quot;relative_gap&quot;</span><span class="p">:</span> <span class="n">relative_gap</span><span class="p">,</span>
                <span class="s2">&quot;normalized_gap&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">num_processors</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">base_spec</span>

    <span class="k">def</span> <span class="nf">_calc_time_skim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emme_class_spec</span><span class="p">:</span> <span class="n">EmmeHighwayClassSpec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the real time skim =gen_cost-per_fac*link_costs.</span>

<span class="sd">        Args:</span>
<span class="sd">            emme_class_spec: dictionary of the per-class spec sub-section from the</span>
<span class="sd">                Emme SOLA assignment spec, classes list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">od_travel_times</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;od_travel_times&quot;</span><span class="p">][</span>
            <span class="s2">&quot;shortest_paths&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">od_travel_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Total link costs is always the first analysis</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;path_analyses&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;od_values&quot;</span><span class="p">]</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;generalized_cost&quot;</span><span class="p">][</span><span class="s2">&quot;perception_factor&quot;</span><span class="p">]</span>
            <span class="n">gencost_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">od_travel_times</span><span class="p">)</span>
            <span class="n">cost_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
            <span class="n">time_data</span> <span class="o">=</span> <span class="n">gencost_data</span> <span class="o">-</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">cost_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">od_travel_times</span><span class="p">,</span> <span class="n">time_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_intrazonal_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">skims</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the intrazonal values to 1/2 nearest neighbour for time and distance skims.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period: time period name (from config)</span>
<span class="sd">            class_name: highway class name (from config)</span>
<span class="sd">            skims: list of requested skims (from config)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">skim_name</span> <span class="ow">in</span> <span class="n">skims</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skim_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">]:</span>
                <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">skim_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting intrazonals to 0.5*min for </span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">)</span>
                <span class="c1"># NOTE: sets values for external zones as well</span>
                <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export skims to OMX files by period.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">            time_period: time period name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: skims in separate file by period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;_export_skims: self.config.output_skim_path:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_path</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">omx_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_path</span>
            <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_filename_tmpl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_period</span><span class="o">=</span><span class="n">time_period</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;export </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">)</span><span class="si">}</span><span class="s2"> skim matrices to </span><span class="si">{</span><span class="n">omx_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">omx_file_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span>
            <span class="n">omx_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">matrix_cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">omx_file</span><span class="o">.</span><span class="n">write_matrices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_debug_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">num_cells</span> <span class="o">=</span> <span class="n">num_zones</span> <span class="o">*</span> <span class="n">num_zones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Highway skim summary for period </span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of zones: </span><span class="si">{</span><span class="n">num_zones</span><span class="si">}</span><span class="s2">. Number of O-D pairs: </span><span class="si">{</span><span class="n">num_cells</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Values outside -9999999, 9999999 are masked in summaries.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;name                            min       max      mean           sum&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999999</span><span class="p">,</span> <span class="mi">9999999</span><span class="p">)</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2"> 13.7g</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for HighwayAssignment components.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Reference to current run controller.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for HighwayAssignment components.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to current run controller.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_config</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run highway assignment.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Highway assignment and skims&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run highway assignment.&quot;&quot;&quot;</span>
    <span class="n">demand</span> <span class="o">=</span> <span class="n">PrepareHighwayDemand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">demand</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">time</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
            <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
            <span class="n">assign_classes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">AssignmentClass</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy_maz_flow</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset_background_traffic</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_skim_matrices</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">assign_classes</span><span class="p">)</span>
            <span class="n">assign_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_assignment_spec</span><span class="p">(</span><span class="n">assign_classes</span><span class="p">)</span>
            <span class="c1"># self.logger.log_dict(assign_spec, level=&quot;DEBUG&quot;)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                <span class="s2">&quot;Run SOLA assignment with path analyses&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
            <span class="p">):</span>
                <span class="n">assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
                    <span class="s2">&quot;inro.emme.traffic_assignment.sola_traffic_assignment&quot;</span>
                <span class="p">)</span>
                <span class="n">assign</span><span class="p">(</span><span class="n">assign_spec</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">chart_log_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Subtract non-time costs from gen cost to get the raw travel time</span>
            <span class="k">for</span> <span class="n">emme_class_spec</span> <span class="ow">in</span> <span class="n">assign_spec</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_time_skim</span><span class="p">(</span><span class="n">emme_class_spec</span><span class="p">)</span>
            <span class="c1"># Set intra-zonal for time and dist to be 1/2 nearest neighbour</span>
            <span class="k">for</span> <span class="n">class_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_intrazonal_values</span><span class="p">(</span>
                    <span class="n">time</span><span class="p">,</span>
                    <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_skims</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_enabled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug_report</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate inputs files are correct, raise if an error is found.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.HighwayConfig" class="doc doc-heading">
        <code>tm2py.config.HighwayConfig</code>


<a href="#tm2py.config.HighwayConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway assignment and skims parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skims parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        generic_highway_mode_code: single character unique mode ID for entire</span>
<span class="sd">            highway network (no excluded_links)</span>
<span class="sd">        relative_gap: target relative gap stopping criteria</span>
<span class="sd">        max_iterations: maximum iterations stopping criteria</span>
<span class="sd">        area_type_buffer_dist_miles: used to in calculation to categorize link @areatype</span>
<span class="sd">            The area type is determined based on the average density of nearby</span>
<span class="sd">            (within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</span>
<span class="sd">        output_skim_path: relative path template from run dir for OMX output skims</span>
<span class="sd">        output_skim_filename_tmpl: template for OMX filename for a time period. Must include</span>
<span class="sd">            {time_period} in the string and end in &#39;.omx&#39;.</span>
<span class="sd">        output_skim_matrixname_tmpl: template for matrix names within OMX output skims.</span>
<span class="sd">            Should include {time_period}, {mode}, and {property}</span>
<span class="sd">        tolls: input toll specification, see HighwayTollsConfig</span>
<span class="sd">        maz_to_maz: maz-to-maz shortest path assignment and skim specification,</span>
<span class="sd">            see HighwayMazToMazConfig</span>
<span class="sd">        classes: highway assignment multi-class setup and skim specification,</span>
<span class="sd">            see HighwayClassConfig</span>
<span class="sd">        capclass_lookup: index cross-reference table from the link @capclass value</span>
<span class="sd">            to the free-flow speed, capacity, and critical speed values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generic_highway_mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">relative_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">area_type_buffer_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_filename_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_matrixname_tmpl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls</span><span class="p">:</span> <span class="n">HighwayTollsConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">maz_to_maz</span><span class="p">:</span> <span class="n">HighwayMazToMazConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">capclass_lookup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayCapClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_filename_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate skim template has correct {} and extension.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; output_skim_filename_tmpl must have </span><span class="se">{{</span><span class="s2">time_period</span><span class="se">}}</span><span class="s2">&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.omx&quot;</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; &#39;output_skim_filename_tmpl must end in &#39;.omx&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_matrixname_tmpl&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{time_period}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{property&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{property}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;{mode&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{mode}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
        <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
        <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># maz_to_maz.mode_code must be unique</span>
            <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
            <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
            <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
                <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
        <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
        <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
            <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
            <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
            <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
        <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
            <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
                <span class="n">available_link_sets</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tm2py.config.HighwayConfig.unique_capclass_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate list of capclass_lookup has unique .capclass values.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
    <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.config.HighwayConfig.unique_class_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.unique_class_names" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate list of classes has unique .name values.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.valid_skim_matrix_name_template" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate skim matrix template has correct {}.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_matrixname_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_skim_matrix_name_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate skim matrix template has correct {}.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{time_period}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{property&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{property}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{mode&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="s2">&quot;-&gt; &#39;output_skim_matrixname_tmpl must have </span><span class="si">{mode}</span><span class="s2">, found </span><span class="si">{value}</span><span class="s2">.&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.config.HighwayConfig.valid_skim_template" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.valid_skim_template" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate skim template has correct {} and extension.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;output_skim_filename_tmpl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">valid_skim_template</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate skim template has correct {} and extension.&quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="s2">&quot;{time_period&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; output_skim_filename_tmpl must have </span><span class="se">{{</span><span class="s2">time_period</span><span class="se">}}</span><span class="s2">&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.omx&quot;</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; &#39;output_skim_filename_tmpl must end in &#39;.omx&#39;, found </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.config.HighwayConfig.validate_class_keyword_lists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate classes .skims, .toll, and .excluded_links values.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
    <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
    <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
        <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
        <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
        <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
    <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
        <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
            <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
            <span class="n">available_link_sets</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate list of classes has unique .mode_code or .excluded_links match.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
    <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
    <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># maz_to_maz.mode_code must be unique</span>
        <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
        <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
        <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
            <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
            <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
        <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.HighwayClassConfig" class="doc doc-heading">
        <code>tm2py.config.HighwayClassConfig</code>


<a href="#tm2py.config.HighwayClassConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway assignment class definition.</p>
<p>Note that excluded_links, skims and toll attribute names include
vehicle groups (&ldquo;{vehicle}&rdquo;) which reference the list of
highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).
The default example model config uses:
&ldquo;da&rdquo;, &ldquo;sr2&rdquo;, &ldquo;sr3&rdquo;, &ldquo;vsm&rdquo;, sml&rdquo;, &ldquo;med&rdquo;, &ldquo;lrg&rdquo;</p>

<details class="example-single-class-config">
  <summary>Example single class config</summary>
  <p>name = &ldquo;da&rdquo;
description= &ldquo;drive alone&rdquo;
mode_code= &ldquo;d&rdquo;
[[highway.classes.demand]]
    source = &ldquo;household&rdquo;
    name = &ldquo;SOV_GP_{period}&rdquo;
[[highway.classes.demand]]
    source = &ldquo;air_passenger&rdquo;
    name = &ldquo;da&rdquo;
[[highway.classes.demand]]
    source = &ldquo;internal_external&rdquo;
    name = &ldquo;da&rdquo;
excluded_links = [&ldquo;is_toll_da&rdquo;, &ldquo;is_sr2&rdquo;],
value_of_time = 18.93,  # $ / hr
operating_cost_per_mile = 17.23,  # cents / mile
toll = [&ldquo;@bridgetoll_da&rdquo;]
skims = [&ldquo;time&rdquo;, &ldquo;dist&rdquo;, &ldquo;freeflowtime&rdquo;, &ldquo;bridgetoll_da&rdquo;],</p>
</details>
<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment class definition.</span>

<span class="sd">    Note that excluded_links, skims and toll attribute names include</span>
<span class="sd">    vehicle groups (&quot;{vehicle}&quot;) which reference the list of</span>
<span class="sd">    highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).</span>
<span class="sd">    The default example model config uses:</span>
<span class="sd">    &quot;da&quot;, &quot;sr2&quot;, &quot;sr3&quot;, &quot;vsm&quot;, sml&quot;, &quot;med&quot;, &quot;lrg&quot;</span>

<span class="sd">    Example single class config:</span>
<span class="sd">        name = &quot;da&quot;</span>
<span class="sd">        description= &quot;drive alone&quot;</span>
<span class="sd">        mode_code= &quot;d&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;household&quot;</span>
<span class="sd">            name = &quot;SOV_GP_{period}&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;air_passenger&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;internal_external&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        excluded_links = [&quot;is_toll_da&quot;, &quot;is_sr2&quot;],</span>
<span class="sd">        value_of_time = 18.93,  # $ / hr</span>
<span class="sd">        operating_cost_per_mile = 17.23,  # cents / mile</span>
<span class="sd">        toll = [&quot;@bridgetoll_da&quot;]</span>
<span class="sd">        skims = [&quot;time&quot;, &quot;dist&quot;, &quot;freeflowtime&quot;, &quot;bridgetoll_da&quot;],</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: short (up to 10 character) unique reference name for the class.</span>
<span class="sd">            used in attribute and matrix names</span>
<span class="sd">        description: longer text used in attribute and matrix descriptions</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords.</span>
<span class="sd">            Should be unique in list of :es, unless multiple classes</span>
<span class="sd">            have identical excluded_links specification. Cannot be the</span>
<span class="sd">            same as used for highway.maz_to_maz.mode_code.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        demand: list of OMX file and matrix keyname references,</span>
<span class="sd">            see HighwayClassDemandConfig</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            this class&#39; available subnetwork (generate link.modes)</span>
<span class="sd">            Options are:</span>
<span class="sd">                - &quot;is_sr&quot;: is reserved for shared ride (@useclass in 2,3)</span>
<span class="sd">                - &quot;is_sr2&quot;: is reserved for shared ride 2+ (@useclass == 2)</span>
<span class="sd">                - &quot;is_sr3&quot;: is reserved for shared ride 3+ (@useclass == 3)</span>
<span class="sd">                - &quot;is_auto_only&quot;: is reserved for autos (non-truck) (@useclass != 1)</span>
<span class="sd">                - &quot;is_toll_{vehicle}&quot;: has a value (non-bridge) toll for the {vehicle} toll group</span>
<span class="sd">        toll: list of additional toll cost link attribute (values stored in cents),</span>
<span class="sd">            summed, one of &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">        toll_factor: optional, factor to apply to toll values in cost calculation</span>
<span class="sd">        pce: optional, passenger car equivalent to convert assigned demand in</span>
<span class="sd">            PCE units to vehicles for total assigned vehicle calculations</span>
<span class="sd">        skims: list of skim matrices to generate</span>
<span class="sd">            Options are:</span>
<span class="sd">                &quot;time&quot;: pure travel time in minutes</span>
<span class="sd">                &quot;dist&quot;: distance in miles</span>
<span class="sd">                &quot;hovdist&quot;: distance on HOV facilities (is_sr2 or is_sr3)</span>
<span class="sd">                &quot;tolldist&quot;: distance on toll facilities</span>
<span class="sd">                    (@tollbooth &gt; highway.tolls.tollbooth_start_index)</span>
<span class="sd">                &quot;freeflowtime&quot;: free flow travel time in minutes</span>
<span class="sd">                &quot;bridgetoll_{vehicle}&quot;: bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">                &quot;valuetoll_{vehicle}&quot;: other, non-bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">veh_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pce</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Note that excluded_links, skims, and tolls validated under HighwayConfig to include</span>
    <span class="c1"># highway.toll.dst_vehicle_group_names names</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassDemandConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.HighwayTollsConfig" class="doc doc-heading">
        <code>tm2py.config.HighwayTollsConfig</code>


<a href="#tm2py.config.HighwayTollsConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway assignment and skim input tolls and related parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayTollsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skim input tolls and related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        file_path: source relative file path for the highway tolls index CSV</span>
<span class="sd">        tollbooth_start_index: tollbooth separates links with &quot;bridge&quot; tolls</span>
<span class="sd">            (index &lt; this value) vs. &quot;value&quot; tolls. These toll attributes</span>
<span class="sd">            can then be referenced separately in the highway.classes[].tolls</span>
<span class="sd">            list</span>
<span class="sd">        src_vehicle_group_names: name used for the vehicle toll CSV column IDs,</span>
<span class="sd">            of the form &quot;toll{period}_{vehicle}&quot;</span>
<span class="sd">        dst_vehicle_group_names: list of names used in destination network</span>
<span class="sd">            for the corresponding vehicle group. Length of list must be the same</span>
<span class="sd">            as src_vehicle_group_names. Used for toll related attributes and</span>
<span class="sd">            resulting skim matrices. Cross-referenced in list of highway.classes[],</span>
<span class="sd">            valid keywords for:</span>
<span class="sd">                excluded_links: &quot;is_toll_{vehicle}&quot;</span>
<span class="sd">                tolls: &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">                skims: &quot;bridgetoll_{vehicle}&quot;, &quot;valuetoll_{vehicle}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tollbooth_start_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">dst_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate dst_vehicle_group_names has same length as src_vehicle_group_names.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.DemandCountyGroupConfig" class="doc doc-heading">
        <code>tm2py.config.DemandCountyGroupConfig</code>


<a href="#tm2py.config.DemandCountyGroupConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Grouping of counties for assignment and demand files.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DemandCountyGroupConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grouping of counties for assignment and demand files.</span>

<span class="sd">    Properties:</span>
<span class="sd">        number: id number for this group, must be unique</span>
<span class="sd">        counties: list of one or more county names</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">counties</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">COUNTY_NAMES</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.highway.highway_maz" class="doc doc-heading">
          <code>tm2py.components.network.highway.highway_maz</code>


<a href="#tm2py.components.network.highway.highway_maz" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Assigns and skims MAZ-to-MAZ demand along shortest generalized cost path.</p>
<p>MAZ to MAZ demand is read in from separate OMX matrices as defined under
the config table highway.maz_to_maz.demand_county_groups,</p>
<p>The demand is expected to be short distance (e.g. &lt;0.5 miles), or within the
same TAZ. The demand is grouped into bins of origin -&gt; all destinations, by
distance (straight-line) to furthest destination. This limits the size of the
shortest path calculated to the minimum required.
The bin edges have been predefined after testing as (in miles):
    [0.0, 0.9, 1.2, 1.8, 2.5, 5.0, 10.0, max_dist]</p>
<p>Input:</p>

<details class="emme-network-with">
  <summary>Emme network with</summary>
  <p>Link attributes:
    - time attribute, either timau (resulting VDF congested time)
      or @free_flow_time
Node attributes: @maz_id, x, y, and #node_county</p>
</details>      <p>Demand matrices under highway.maz_to_maz.demand_file,
and can have a placeholder
    auto_{period}<em>MAZ_AUTO</em>{number}_{period}.omx</p>
<p>Output:
The resulting MAZ-MAZ flows are saved in link @maz_flow which is
used as background traffic in the equilibrium Highway assignment.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="doc doc-heading">
        <code>AssignMAZSPDemand</code>


<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>MAZ-to-MAZ shortest-path highway assignment.</p>
<p>Calculates shortest path between MAZs with demand in the Emme network
and assigns flow.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AssignMAZSPDemand</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">    Calculates shortest path between MAZs with demand in the Emme network</span>
<span class="sd">    and assigns flow.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># skip Too many instance attributes recommendation, it is OK as is</span>
    <span class="c1"># pylint: disable=R0902</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent Controller object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># bins: performance parameter: crow-fly distance bins</span>
        <span class="c1">#       to limit shortest path calculation by origin to furthest destination</span>
        <span class="c1">#       semi-exposed for performance testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span> <span class="o">=</span> <span class="n">_default_bin_edges</span>

        <span class="c1"># Lazily-loaded Emme Properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Internal attributes to track data through the sequence of steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">eb_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run MAZ-to-MAZ shortest path assignment.&quot;&quot;&quot;</span>

        <span class="n">county_groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
            <span class="n">county_groups</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">counties</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">county_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">maz_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_county_mazs</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maz_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;warning: no mazs for counties </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_process_demand</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">)</span>
                <span class="n">demand_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_demand</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">demand_bins</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_find_roots_and_leaves</span><span class="p">(</span><span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_cost_maz</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context setup / teardown, initializes internal attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: name of the time period</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;total cost MAZ-MAZ&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;cost MAZ-MAZ, unused MAZs blocked&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;Flag for MAZs which are roots&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">,</span> <span class="s2">&quot;Flag for MAZs which are leaves&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Create temp </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2"> attr: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">temp_attributes_and_restore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="n">attributes</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;MAZ assign for period </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2"> scenario </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">):</span>
                    <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="c1"># delete sp path files</span>
                    <span class="k">for</span> <span class="n">bin_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span><span class="p">)):</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.ebp&quot;</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate link cost (travel time + bridge tolls + operating cost) and load network.</span>

<span class="sd">        Reads Emme network from disk for later node lookups. Optimized to only load</span>
<span class="sd">        attribute values of interest, additional attributes must be added in</span>
<span class="sd">        order to be read from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">has_traffic_results</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;(@free_flow_time.max.timau)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;@free_flow_time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculating link costs using time </span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">value_of_time</span>
        <span class="n">op_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">operating_cost_per_mile</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">net_calc</span><span class="p">(</span>
            <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2"> + 0.6 / </span><span class="si">{</span><span class="n">vot</span><span class="si">}</span><span class="s2"> * (length * </span><span class="si">{</span><span class="n">op_cost</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Link cost calculation report&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;#node_county&quot;</span><span class="p">],</span> <span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;temp_flow&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_county_mazs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeNode</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get all MAZ nodes which are located in one of these counties.</span>

<span class="sd">        Used the node attribute #node_county to identify the node location.</span>
<span class="sd">        Name must be an exact match. Catches a mapping of the county names</span>
<span class="sd">        to nodes so nodes are processed only once.</span>

<span class="sd">        Args:</span>
<span class="sd">            counties: list of county names</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of MAZ nodes (Emme Node) which are in these counties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Processing county MAZs for </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">counties</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span>
        <span class="c1"># NOTE: every maz must have a valid #node_county</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_county&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">mazs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
            <span class="n">mazs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span><span class="p">[</span><span class="n">county</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Num MAZs </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mazs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mazs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_process_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeNode</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Loads the demand from file and groups by origin node.</span>

<span class="sd">        Sets the demand to self._demand for later processing, grouping the demand in</span>
<span class="sd">        a dictionary by origin node (Emme Node object) to list of dictionaries</span>
<span class="sd">        {&quot;orig&quot;: orig_node, &quot;dest&quot;: dest_node, &quot;dem&quot;: demand, &quot;dist&quot;: dist}</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            index: group index of the demand file, used to find the file by name</span>
<span class="sd">            maz_ids: indexed list of MAZ ID nodes for the county group</span>
<span class="sd">                (active counties for this demand file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Process demand for time period </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2"> index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand_array</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">origins</span><span class="p">,</span> <span class="n">destinations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;non-zero origins </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span><span class="si">}</span><span class="s2"> destinations </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">destinations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">total_demand</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">orig</span><span class="p">,</span> <span class="n">dest</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">origins</span><span class="p">,</span> <span class="n">destinations</span><span class="p">):</span>
            <span class="c1"># skip intra-maz demand</span>
            <span class="k">if</span> <span class="n">orig</span> <span class="o">==</span> <span class="n">dest</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">orig_node</span> <span class="o">=</span> <span class="n">maz_ids</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span>
            <span class="n">dest_node</span> <span class="o">=</span> <span class="n">maz_ids</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">_sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="n">dest_node</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">orig_node</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dest_node</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">orig_node</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="n">dist</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">orig</span><span class="p">][</span><span class="n">dest</span><span class="p">]</span>
            <span class="n">total_demand</span> <span class="o">+=</span> <span class="n">demand</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span><span class="p">[</span><span class="n">orig_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;orig&quot;</span><span class="p">:</span> <span class="n">orig_node</span><span class="p">,</span>
                    <span class="s2">&quot;dest&quot;</span><span class="p">:</span> <span class="n">dest_node</span><span class="p">,</span>
                    <span class="s2">&quot;dem&quot;</span><span class="p">:</span> <span class="n">demand</span><span class="p">,</span>
                    <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max distance found </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total inter-zonal demand </span><span class="si">{</span><span class="n">total_demand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_demand_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load the demand from file with the specified time and index name.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            index: group index of the demand file, used to find the file by name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_file</span><span class="p">)</span>
        <span class="n">omx_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="n">file_path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading demand from </span><span class="si">{</span><span class="n">omx_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">omx_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">demand_array</span> <span class="o">=</span> <span class="n">omx_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;M0&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">demand_array</span>

    <span class="k">def</span> <span class="nf">_group_demand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]]]]:</span>
        <span class="sd">&quot;&quot;&quot;Process the demand loaded from files \</span>
<span class="sd">            and create groups based on the origin to the furthest destination with demand.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;Grouping demand in distance buckets&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
        <span class="c1"># group demand from same origin into distance bins by furthest</span>
        <span class="c1"># distance destination to limit shortest path search radius</span>
        <span class="n">bin_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">/</span> <span class="mf">5280.0</span><span class="p">:</span>
            <span class="n">bin_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">/</span> <span class="mf">5280.0</span><span class="p">)</span>

        <span class="n">demand_groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">edge</span><span class="p">,</span> <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="p">[]}</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mf">5280.0</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">max_dist</span> <span class="o">&lt;</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]:</span>
                    <span class="n">group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;bin dist </span><span class="si">{</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Filter out groups without any demand</span>
        <span class="n">demand_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span> <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">demand_groups</span>

    <span class="k">def</span> <span class="nf">_find_roots_and_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]):</span>
        <span class="sd">&quot;&quot;&quot;Label available MAZ root nodes and leaf nodes for the path calculation.</span>

<span class="sd">        The MAZ nodes which are found as origins in the demand are &quot;activated&quot;</span>
<span class="sd">        by setting @maz_root to non-zero, and similarly the leaves have @maz_leaf</span>
<span class="sd">        set to non-zero.</span>

<span class="sd">        Args:</span>
<span class="sd">            demand: list of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span>
        <span class="n">attrs_to_init</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]),</span> <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;maz_cost&quot;</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attrs_to_init</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
                    <span class="n">network</span><span class="o">.</span><span class="n">delete_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">root_maz_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">leaf_maz_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
            <span class="n">o_node</span><span class="p">,</span> <span class="n">d_node</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span>
            <span class="n">root_maz_ids</span><span class="p">[</span><span class="n">o_node</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">o_node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
            <span class="n">leaf_maz_ids</span><span class="p">[</span><span class="n">d_node</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_node</span><span class="p">[</span><span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">root_maz_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()))}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">q</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">leaf_maz_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()))}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attr_values</span><span class="p">(</span>
            <span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_link_cost_maz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set link cost used in the shortest path forbidden using unavailable connectors.</span>

<span class="sd">        Copy the pre-calculated cost @link_cost to @link_cost_maz,</span>
<span class="sd">        setting value to 1e20 on connectors to unused zone leaves / from</span>
<span class="sd">        unused roots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># forbid egress from MAZ nodes which are not demand roots /</span>
        <span class="c1">#        access to MAZ nodes which are not demand leafs</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;1e20&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root=0 and !@maz_id=0&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;1e20&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leafj=0 and !@maz_idj=0&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_run_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the shortest path tool to generate paths between the marked nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            max_radius: max unit coordinate distance to limit search tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shortest_paths_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.network_calculation.shortest_path&quot;</span>
        <span class="p">)</span>
        <span class="n">max_radius</span> <span class="o">=</span> <span class="n">max_radius</span> <span class="o">*</span> <span class="mi">5280</span> <span class="o">+</span> <span class="mi">100</span>  <span class="c1"># add some buffer for rounding error</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;ebp&quot;</span> <span class="k">if</span> <span class="n">_USE_BINARY</span> <span class="k">else</span> <span class="s2">&quot;txt&quot;</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mode_code</span><span class="p">],</span>
            <span class="s2">&quot;root_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span>
            <span class="s2">&quot;leaf_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;link_cost&quot;</span><span class="p">:</span> <span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path_constraints&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_radius&quot;</span><span class="p">:</span> <span class="n">max_radius</span><span class="p">,</span>
                <span class="s2">&quot;uturn_allowed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_leaves&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_centroids&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;exclude_forbidden_turns&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;skim_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;return_numpy&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;analyses&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">},</span>
                <span class="s2">&quot;path_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;BINARY&quot;</span> <span class="k">if</span> <span class="n">_USE_BINARY</span> <span class="k">else</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">num_processors</span><span class="p">,</span>
                <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">shortest_paths_tool</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_USE_BINARY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow_binary</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow_text</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_flow_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        The paths are read from a text format file, see Emme help for details.</span>
<span class="sd">        Demand is summed in self._network (in memory) using temp_flow attribute</span>
<span class="sd">        and written to scenario (Emmebank / disk) @maz_flow.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containin the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_text_format_paths</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">)</span>
        <span class="n">not_assigned</span><span class="p">,</span> <span class="n">assigned</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
            <span class="n">orig</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">dem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">not_assigned</span> <span class="o">+=</span> <span class="n">dem</span>
                <span class="k">continue</span>
            <span class="n">i_node</span> <span class="o">=</span> <span class="n">orig</span>
            <span class="k">for</span> <span class="n">j_node</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">i_node</span><span class="p">,</span> <span class="n">j_node</span><span class="p">)</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dem</span>
                <span class="n">i_node</span> <span class="o">=</span> <span class="n">j_node</span>
            <span class="n">assigned</span> <span class="o">+=</span> <span class="n">dem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ASSIGN bin </span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">: total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;assigned: </span><span class="si">{</span><span class="n">assigned</span><span class="si">}</span><span class="s2">, not assigned: </span><span class="si">{</span><span class="n">not_assigned</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_text_format_paths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;Load all paths from text file and return as nested dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>

<span class="sd">        Returns:</span>
<span class="sd">            All paths as a nested dictionary, path = paths[origin][destination],</span>
<span class="sd">            using the node IDs as integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">paths_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">paths_file</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
                <span class="n">paths</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span> <span class="nf">_assign_flow_binary</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        The paths are read from a binary format file, see Emme help for details.</span>
<span class="sd">        Demand is summed in self._network (in memory) using temp_flow attribute</span>
<span class="sd">        and written to scenario (Emmebank / disk) @maz_flow.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containin the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.ebp&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">paths_file</span><span class="p">:</span>
            <span class="c1"># read set of path pointers by Orig-Dest sequence from file</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path_indices</span><span class="p">(</span><span class="n">paths_file</span><span class="p">)</span>
            <span class="n">assigned</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">not_assigned</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">bytes_read</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="mi">8</span>
            <span class="c1"># for all orig-dest pairs with demand, load path from file</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
                <span class="c1"># get file position based on orig-dest index</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path_location</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span>
                <span class="p">)</span>
                <span class="c1"># no path found, disconnected zone</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                    <span class="n">not_assigned</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="n">paths_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assign_path_flow</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">])</span>
                <span class="n">assigned</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
                <span class="n">bytes_read</span> <span class="o">+=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attr_values</span><span class="p">(</span>
            <span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;@maz_flow&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ASSIGN bin </span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">, total </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span><span class="si">}</span><span class="s2">, assign &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assigned</span><span class="si">}</span><span class="s2">, not assign </span><span class="si">{</span><span class="n">not_assigned</span><span class="si">}</span><span class="s2">, bytes </span><span class="si">{</span><span class="n">bytes_read</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_path_indices</span><span class="p">(</span><span class="n">paths_file</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the path header indices.</span>

<span class="sd">        See the Emme Shortest path tool doc for additional details on reading</span>
<span class="sd">        this file.</span>

<span class="sd">        Args:</span>
<span class="sd">            paths_file: binary file access to the generated paths file</span>

<span class="sd">        Returns:</span>
<span class="sd">            2 ints + array of ints: offset, leafs_nb, path_indicies</span>
<span class="sd">            offset: starting index to read the paths</span>
<span class="sd">            leafs_nb: number of leafs in the shortest path file</span>
<span class="sd">            path_indicies: array of the start index for each root, leaf path in paths_file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read first 4 integers from file (Q=64-bit unsigned integers)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">roots_nb</span><span class="p">,</span> <span class="n">leaves_nb</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="c1"># Load sequence of path indices (positions by orig-dest index),</span>
        <span class="c1"># pointing to list of path node IDs in file</span>
        <span class="n">path_indicies</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">path_indicies</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">roots_nb</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">roots_nb</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="n">offset</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span>

    <span class="k">def</span> <span class="nf">_get_path_location</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">orig</span><span class="p">:</span> <span class="n">EmmeNode</span><span class="p">,</span>
        <span class="n">dest</span><span class="p">:</span> <span class="n">EmmeNode</span><span class="p">,</span>
        <span class="n">leaves_nb</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">path_indicies</span><span class="p">:</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the location in the paths_file to read.</span>

<span class="sd">        Args:</span>
<span class="sd">            orig: Emme Node object, origin MAZ to query the path</span>
<span class="sd">            dest: Emme Node object, destination MAZ to query the path</span>
<span class="sd">            leaves_nb: number of leaves</span>
<span class="sd">            path_indicies: array of the start index for each root, leaf path in paths_file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Two integers, start, end</span>
<span class="sd">            start: starting index to read Node ID bytes from paths_file</span>
<span class="sd">            end: ending index to read bytes from paths_file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span>
        <span class="n">q_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">p_index</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="n">q_index</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">path_indicies</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">path_indicies</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>

    <span class="k">def</span> <span class="nf">_assign_path_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">paths_file</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add demand to link temp_flow for the path.</span>

<span class="sd">        Args:</span>
<span class="sd">            paths_file: binary file access to read path from</span>
<span class="sd">            start: starting index to read Node ID bytes from paths_file</span>
<span class="sd">            end: ending index to read bytes from paths_file</span>
<span class="sd">            demand: flow demand to add on link</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># load sequence of Node IDs which define the path (L=32-bit unsigned integers)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">path</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
        <span class="c1"># process path to sequence of links and add flow</span>
        <span class="n">path_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">i_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">path_iter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j_node</span> <span class="ow">in</span> <span class="n">path_iter</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">i_node</span><span class="p">,</span> <span class="n">j_node</span><span class="p">)</span>
            <span class="n">link</span><span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">demand</span>
            <span class="n">i_node</span> <span class="o">=</span> <span class="n">j_node</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>MAZ-to-MAZ shortest-path highway assignment.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>parent Controller object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent Controller object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># bins: performance parameter: crow-fly distance bins</span>
    <span class="c1">#       to limit shortest path calculation by origin to furthest destination</span>
    <span class="c1">#       semi-exposed for performance testing</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span> <span class="o">=</span> <span class="n">_default_bin_edges</span>

    <span class="c1"># Lazily-loaded Emme Properties</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Internal attributes to track data through the sequence of steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run MAZ-to-MAZ shortest path assignment.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run MAZ-to-MAZ shortest path assignment.&quot;&quot;&quot;</span>

    <span class="n">county_groups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
        <span class="n">county_groups</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">counties</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">county_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">maz_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_county_mazs</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maz_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;warning: no mazs for counties </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_demand</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">)</span>
            <span class="n">demand_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_demand</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">demand_bins</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_find_roots_and_leaves</span><span class="p">(</span><span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_cost_maz</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate inputs files are correct, raise if an error is found.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="doc doc-heading">
        <code>SkimMAZCosts</code>


<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>MAZ-to-MAZ shortest-path skim of time, distance and toll.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SkimMAZCosts</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent RunController object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_period_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skim_period</span>
        <span class="c1"># TODO add config requirement that most be a valid time period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_period_name</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</span>

<span class="sd">        Runs a shortest path builder for each county, using a maz_skim_cost</span>
<span class="sd">        to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)</span>
<span class="sd">        are written to CSV at the output_skim_file path:</span>
<span class="sd">        FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span>

<span class="sd">        The following config inputs are used directly in this component. Note also</span>
<span class="sd">        that the network mode_code is prepared in the highway_network component</span>
<span class="sd">        using the excluded_links.</span>

<span class="sd">        config.highway.maz_to_maz:</span>
<span class="sd">            skim_period: name of the period used for the skim, must match one the</span>
<span class="sd">                defined config.time_periods</span>
<span class="sd">            demand_county_groups: used for the list of counties, creates a list out</span>
<span class="sd">                of all listed counties under [].counties</span>
<span class="sd">            output_skim_file: relative path to save the skims</span>
<span class="sd">            value_of_time: value of time used to convert tolls and auto operating cost</span>
<span class="sd">            operating_cost_per_mile: auto operating cost</span>
<span class="sd">            max_skim_cost: max cost value used to limit the shortest path search</span>
<span class="sd">            mode_code:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># prepare output file and write header</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">counties</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">counties</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
                <span class="n">num_roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mark_roots</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_roots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">sp_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">sp_values</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates the temp attributes used in the component.&quot;&quot;&quot;</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;total cost MAZ-MAZ&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;selected roots (origins)&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">temp_attributes_and_restore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="n">attributes</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear network obj ref to free memory</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_prepare_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the link cost in @link_cost and loads the network to self._network.&quot;&quot;&quot;</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">has_traffic_results</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;(@free_flow_time.max.timau)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;@free_flow_time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time attribute </span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">value_of_time</span>
        <span class="n">op_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">operating_cost_per_mile</span>
        <span class="n">net_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2"> + 0.6 / </span><span class="si">{</span><span class="n">vot</span><span class="si">}</span><span class="s2"> * (length * </span><span class="si">{</span><span class="n">op_cost</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span> <span class="s2">&quot;#node_county&quot;</span><span class="p">]}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mark_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">county</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mark the available roots in the county.&quot;&quot;&quot;</span>
        <span class="n">count_roots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_county&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">county</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
                <span class="n">count_roots</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">],</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">count_roots</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_run_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Run shortest paths tool and return dictionary of skim results name, numpy arrays.</span>

<span class="sd">        O-D pairs are limited by a max cost value from config.highway.maz_to_maz.max_skim_cost,</span>
<span class="sd">        from roots marked by @maz_root to all available leaves at @maz_id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with keys &quot;COST&quot;, &quot;DISTANCE&quot;, and &quot;BRIDGETOLL&quot;, and numpy</span>
<span class="sd">            arrays of SP values for available O-D pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shortest_paths_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.network_calculation.shortest_path&quot;</span>
        <span class="p">)</span>
        <span class="n">max_cost</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_skim_cost</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mode_code</span><span class="p">],</span>
            <span class="s2">&quot;root_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span>
            <span class="s2">&quot;leaf_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;link_cost&quot;</span><span class="p">:</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path_constraints&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_cost&quot;</span><span class="p">:</span> <span class="n">max_cost</span><span class="p">,</span>
                <span class="s2">&quot;uturn_allowed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_leaves&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_centroids&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;exclude_forbidden_turns&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;skim_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;return_numpy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;analyses&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH_COST&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;COST&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;DISTANCE&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;@bridgetoll_da&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;OMX&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">num_processors</span><span class="p">,</span>
                <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">sp_values</span> <span class="o">=</span> <span class="n">shortest_paths_tool</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sp_values</span>

    <span class="k">def</span> <span class="nf">_export_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Write matrix skims to CSV.</span>

<span class="sd">        The matrices are filtered to omit rows for which the COST is</span>
<span class="sd">        &lt; 0 or &gt; 1e19 (Emme uses 1e20 to indicate inaccessible zone pairs).</span>

<span class="sd">        sp_values: dictionary of matrix costs, with the three keys</span>
<span class="sd">            &quot;COST&quot;, &quot;DISTANCE&quot;, and &quot;BRIDGETOLL&quot; and Numpy arrays of values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get list of MAZ IDS</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]]</span>
        <span class="c1"># build dataframe with output data and to/from MAZ ids</span>
        <span class="n">root_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">roots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaves</span><span class="p">))</span>
        <span class="n">leaf_ids</span> <span class="o">=</span> <span class="n">leaves</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;FROM_ZONE&quot;</span><span class="p">:</span> <span class="n">root_ids</span><span class="p">,</span>
                <span class="s2">&quot;TO_ZONE&quot;</span><span class="p">:</span> <span class="n">leaf_ids</span><span class="p">,</span>
                <span class="s2">&quot;COST&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;COST&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="s2">&quot;DISTANCE&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;DISTANCE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># drop 0&#39;s / 1e20</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;COST &gt; 0 &amp; COST &lt; 1e19&quot;</span><span class="p">)</span>
        <span class="c1"># write remaining values to text file</span>
        <span class="c1"># FROM_ZONE,TO_ZONE,COST,DISTANCE,BRIDGETOLL</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
            <span class="n">result_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>MAZ-to-MAZ shortest-path skim of time, distance and toll.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>parent RunController object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ref_period_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">skim_period</span>
    <span class="c1"># TODO add config requirement that most be a valid time period</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</p>
<p>Runs a shortest path builder for each county, using a maz_skim_cost
to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)
are written to CSV at the output_skim_file path:
FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</p>
<p>The following config inputs are used directly in this component. Note also
that the network mode_code is prepared in the highway_network component
using the excluded_links.</p>
<p>config.highway.maz_to_maz:
    skim_period: name of the period used for the skim, must match one the
        defined config.time_periods
    demand_county_groups: used for the list of counties, creates a list out
        of all listed counties under [].counties
    output_skim_file: relative path to save the skims
    value_of_time: value of time used to convert tolls and auto operating cost
    operating_cost_per_mile: auto operating cost
    max_skim_cost: max cost value used to limit the shortest path search
    mode_code:</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</span>

<span class="sd">    Runs a shortest path builder for each county, using a maz_skim_cost</span>
<span class="sd">    to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)</span>
<span class="sd">    are written to CSV at the output_skim_file path:</span>
<span class="sd">    FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span>

<span class="sd">    The following config inputs are used directly in this component. Note also</span>
<span class="sd">    that the network mode_code is prepared in the highway_network component</span>
<span class="sd">    using the excluded_links.</span>

<span class="sd">    config.highway.maz_to_maz:</span>
<span class="sd">        skim_period: name of the period used for the skim, must match one the</span>
<span class="sd">            defined config.time_periods</span>
<span class="sd">        demand_county_groups: used for the list of counties, creates a list out</span>
<span class="sd">            of all listed counties under [].counties</span>
<span class="sd">        output_skim_file: relative path to save the skims</span>
<span class="sd">        value_of_time: value of time used to convert tolls and auto operating cost</span>
<span class="sd">        operating_cost_per_mile: auto operating cost</span>
<span class="sd">        max_skim_cost: max cost value used to limit the shortest path search</span>
<span class="sd">        mode_code:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># prepare output file and write header</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">counties</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">counties</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
            <span class="n">num_roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mark_roots</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_roots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sp_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">sp_values</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">()</span></code>

<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.validate_inputs" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Validate inputs files are correct, raise if an error is found.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
    <span class="c1"># TODO</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.HighwayMazToMazConfig" class="doc doc-heading">
        <code>tm2py.config.HighwayMazToMazConfig</code>


<a href="#tm2py.config.HighwayMazToMazConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Highway MAZ to MAZ shortest path assignment and skim parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">HighwayMazToMazConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway MAZ to MAZ shortest path assignment and skim parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords,</span>
<span class="sd">            plus including MAZ connectors.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        max_skim_cost: max shortest path distance to search for MAZ-to-MAZ</span>
<span class="sd">            skims, in generized costs units (includes operating cost</span>
<span class="sd">            converted to minutes)</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</span>
<span class="sd">        demand_file: relative path to find the input demand files</span>
<span class="sd">            can have use a placeholder for {period} and {number}, where the</span>
<span class="sd">            {period} is the time_period.name (see TimePeriodConfig)</span>
<span class="sd">            and {number} is the demand_count_groups[].number</span>
<span class="sd">            (see DemandCountyGroupConfig)</span>
<span class="sd">            e.g.: auto_{period}_MAZ_AUTO_{number}_{period}.omx</span>
<span class="sd">        demand_county_groups: List of demand county names and</span>
<span class="sd">        skim_period: period name to use for the shotest path skims, must</span>
<span class="sd">            match one of the names listed in the time_periods</span>
<span class="sd">        output_skim_file: relative path to resulting MAZ-to-MAZ skims</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_skim_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_county_groups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DemandCountyGroupConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skim_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_file</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

<a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate list of demand_county_groups has unique .number values.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h3 id="transit-network-components">Transit Network Components<a class="headerlink" href="#transit-network-components" title="Permanent link"> ¶</a></h3>


<div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.transit.transit_assign" class="doc doc-heading">
          <code>tm2py.components.network.transit.transit_assign</code>


<a href="#tm2py.components.network.transit.transit_assign" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Transit assignment module.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.transit.transit_assign.TransitAssignment" class="doc doc-heading">
        <code>TransitAssignment</code>


<a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Run transit assignment.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TransitAssignment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run transit assignment.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.transit.transit_skim" class="doc doc-heading">
          <code>tm2py.components.network.transit.transit_skim</code>


<a href="#tm2py.components.network.transit.transit_skim" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Transit skims module.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.transit.transit_skim.TransitSkim" class="doc doc-heading">
        <code>TransitSkim</code>


<a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a></code></p>

  
      <p>Run transit skims.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TransitSkim</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run transit skims.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.TransitModeConfig" class="doc doc-heading">
        <code>tm2py.config.TransitModeConfig</code>


<a href="#tm2py.config.TransitModeConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Transit mode definition (see also mode in the Emme API).</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitModeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit mode definition (see also mode in the Emme API).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;WALK&quot;</span><span class="p">,</span> <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;EGRESS&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCAL&quot;</span><span class="p">,</span> <span class="s2">&quot;PREMIUM&quot;</span><span class="p">]</span>
    <span class="n">assign_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="n">mode_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">in_vehicle_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">speed_miles_per_hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/config.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.TransitConfig" class="doc doc-heading">
        <code>tm2py.config.TransitConfig</code>


<a href="#tm2py.config.TransitConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Transit assignment parameters.</p>


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TransitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit assignment parameters.&quot;&quot;&quot;</span>

    <span class="n">modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitModeConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">vehicles</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitVehicleConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

    <span class="n">apply_msa_demand</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">effective_headway_source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">initial_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">initial_boarding_penalty</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_boarding_penalty</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_transfers</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fares_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fare_matrix_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">fare_max_transfer_distance_miles</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">use_fares</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">override_connector_times</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">input_connector_access_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">input_connector_egress_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_stop_usage_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h3 id="active-network-components">Active Network Components<a class="headerlink" href="#active-network-components" title="Permanent link"> ¶</a></h3>
<p>To come.</p>
<h2 id="emme-wrappers">Emme Wrappers<a class="headerlink" href="#emme-wrappers" title="Permanent link"> ¶</a></h2>


<div class="doc doc-object doc-module">



<h3 id="tm2py.emme" class="doc doc-heading">
          <code>tm2py.emme</code>


<a href="#tm2py.emme" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Emme components module.</p>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="tm2py.config.EmmeConfig" class="doc doc-heading">
        <code>tm2py.config.EmmeConfig</code>


<a href="#tm2py.config.EmmeConfig" class="headerlink" title="Permanent link"> ¶</a></h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a></code></p>

  
      <p>Emme-specific parameters.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EmmeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Emme-specific parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        all_day_scenario_id: scenario ID to use for all day</span>
<span class="sd">            (initial imported) scenario with all time period data</span>
<span class="sd">        project_path: relative path from run_dir to Emme desktop project (.emp)</span>
<span class="sd">        highway_database_path: relative path to highway Emmebank</span>
<span class="sd">        active_database_paths: list of relative paths to active mode Emmebanks</span>
<span class="sd">        transit_database_path: relative path to transit Emmebank</span>
<span class="sd">        num_processors: the number of processors to use in Emme procedures,</span>
<span class="sd">            either as an integer, or value MAX, MAX-N. Typically recommend</span>
<span class="sd">            using MAX-1 (on desktop systems) or MAX-2 (on servers with many</span>
<span class="sd">            logical processors) to leave capacity for background / other tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_day_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">project_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">highway_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">active_database_paths</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">transit_database_path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">num_processors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^MAX$|^MAX-\d+$|^\d+$&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="errata">Errata<a class="headerlink" href="#errata" title="Permanent link"> ¶</a></h2>


<div class="doc doc-object doc-module">



<h3 id="tm2py.logger" class="doc doc-heading">
          <code>tm2py.logger</code>


<a href="#tm2py.logger" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Logging module.</p>
<p>Note the general definition of logging levels as used in tm2py:</p>

<details class="trace">
  <summary>highly detailed level information which would rarely be of interest</summary>
  <p>except for detailed debugging by a developer</p>
</details>
<details class="debug">
  <summary>diagnostic information which would generally be useful to a developer</summary>
  <p>debugging the model code; this may also be useful to a model operator in
some cases.</p>
</details>
<details class="detail">
  <summary>more detail than would normally be of interest, but might be useful</summary>
  <p>to a model operator debugging a model run / data or understanding
model results</p>
</details>      

<details class="status">
  <summary>top-level, model is running type messages. There should be</summary>
  <p>relatively few of these, generally one per component, or one per time
period if the procedure is long.</p>
</details>      

<details class="error">
  <summary>problem causing operation to halt which is normal</summary>
  <p>(or not unexpected) in scope, e.g. file does not exist
Includes general Python exceptions.</p>
</details>      

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogCache" class="doc doc-heading">
        <code>LogCache</code>


<a href="#tm2py.logger.LogCache" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.logger.LogFormatter" href="#tm2py.logger.LogFormatter">LogFormatter</a></code></p>

  
      <p>Caches all messages for later recording in on error logfile.</p>

<details class="properties">
  <summary>Properties</summary>
  <ul>
<li>file_path: the absolute file path to write to</li>
</ul>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogCache</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Caches all messages for later recording in on error logfile.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogCache object.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path (str): the absolute file path to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize log file (remove).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Format and store text for later recording.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write all cached messages.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">LEVELS_INT_TO_STR</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">:</span><span class="s2">6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear message cache.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogCache.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogCache.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for LogCache object.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the absolute file path to write to.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogCache object.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): the absolute file path to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogCache.clear" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">clear</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogCache.clear" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Clear message cache.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clear message cache.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogCache.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogCache.log" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Format and store text for later recording.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>logging level</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamp</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>formatted datetime as a string or None</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Format and store text for later recording.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogCache.open" class="doc doc-heading">
<code class="codehilite language-python"><span class="nb">open</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogCache.open" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Initialize log file (remove).</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize log file (remove).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogCache.write_cache" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">write_cache</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogCache.write_cache" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Write all cached messages.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write all cached messages.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">LEVELS_INT_TO_STR</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">:</span><span class="s2">6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogDisplay" class="doc doc-heading">
        <code>LogDisplay</code>


<a href="#tm2py.logger.LogDisplay" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.logger.LogFormatter" href="#tm2py.logger.LogFormatter">LogFormatter</a></code></p>

  
      <p>Format and print log text to console / Notebook.</p>

<details class="properties">
  <summary>Properties</summary>
  <ul>
<li>level: the log level as an int</li>
</ul>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogDisplay</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format and print log text to console / Notebook.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Format and display text on screen (print).</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogDisplay.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogDisplay.log" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Format and display text on screen (print).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>logging level</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamp</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>formatted datetime as a string or None</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Format and display text on screen (print).</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogFile" class="doc doc-heading">
        <code>LogFile</code>


<a href="#tm2py.logger.LogFile" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.logger.LogFormatter" href="#tm2py.logger.LogFormatter">LogFormatter</a></code></p>

  
      <p>Format and write log text to file.</p>

<details class="properties">
  <summary>Properties</summary>
  <ul>
<li>level: the log level as an int</li>
<li>file_path: the absolute file path to write to</li>
</ul>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogFile</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format and write log text to file.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogFile object.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (int): the log level as an int.</span>
<span class="sd">            file_path (str): the absolute file path to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the log file for writing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">        Note that log will not write to file until opened with a context.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the open log file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFile.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFile.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for LogFile object.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the log level as an int.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>file_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the absolute file path to write to.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogFile object.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (int): the log level as an int.</span>
<span class="sd">        file_path (str): the absolute file path to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFile.close" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">close</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogFile.close" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Close the open log file.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Close the open log file.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFile.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFile.log" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text to file and display depending upon log level and config.</p>
<p>Note that log will not write to file until opened with a context.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>logging level</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamp</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>formatted datetime as a string or None for timestamp</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">    Note that log will not write to file until opened with a context.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFile.open" class="doc doc-heading">
<code class="codehilite language-python"><span class="nb">open</span><span class="p">()</span></code>

<a href="#tm2py.logger.LogFile.open" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Open the log file for writing.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open the log file for writing.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogFileLevelOverride" class="doc doc-heading">
        <code>LogFileLevelOverride</code>


<a href="#tm2py.logger.LogFileLevelOverride" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="tm2py.logger.LogFile" href="#tm2py.logger.LogFile">LogFile</a></code></p>

  
      <p>Format and write log text to file.</p>

<details class="properties">
  <summary>Properties</summary>
  <ul>
<li>level: the log level as an int</li>
<li>file_path: the absolute file path to write to</li>
<li>iter_component_level: TODO</li>
<li>controller: TODO</li>
</ul>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogFileLevelOverride</span><span class="p">(</span><span class="n">LogFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format and write log text to file.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">        - iter_component_level: TODO</span>
<span class="sd">        - controller: TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogFileLevelOverride object.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (_type_): TODO</span>
<span class="sd">            file_path (_type_): TODO</span>
<span class="sd">            iter_component_level (_type_): TODO</span>
<span class="sd">            controller (_type_): TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">iter_component_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Current log level with iter_component_level config override.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iter_component</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFileLevelOverride.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFileLevelOverride.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for LogFileLevelOverride object.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p>TODO</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>file_path</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p>TODO</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>iter_component_level</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p>TODO</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p>TODO</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogFileLevelOverride object.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (_type_): TODO</span>
<span class="sd">        file_path (_type_): TODO</span>
<span class="sd">        iter_component_level (_type_): TODO</span>
<span class="sd">        controller (_type_): TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">iter_component_level</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFileLevelOverride.level" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">level</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.logger.LogFileLevelOverride.level" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Current log level with iter_component_level config override.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Current log level with iter_component_level config override.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iter_component</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogFormatter" class="doc doc-heading">
        <code>LogFormatter</code>


<a href="#tm2py.logger.LogFormatter" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">

  
      <p>Base class for recording text to log.</p>

<details class="properties">
  <summary>Properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogFormatter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for recording text to log.</span>

<span class="sd">    Properties:</span>
<span class="sd">        indent: current indentation level for the LogFormatter</span>
<span class="sd">        level: log filter level (as an int)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogFormatter.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (int): log filter level (as an int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The current filter level for the LogFormatter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>

    <span class="k">def</span> <span class="nf">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increase current indent if the log level is filtered in.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">decrease_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decrease current indent if the log level is filtered in.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format and log message text.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_format_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format text for logging.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to format</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts and</span>
<span class="sd">                timestamp width</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;                        &quot;</span> <span class="k">if</span> <span class="n">indent</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">indent</span><span class="p">:</span>
            <span class="n">num_indents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">num_indents</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">level_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:&gt;6}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">LEVELS_INT_TO_STR</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}{</span><span class="n">level_str</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">indent</span><span class="si">}{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFormatter.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFormatter.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for LogFormatter.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>log filter level (as an int)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogFormatter.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (int): log filter level (as an int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFormatter.decrease_indent" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">decrease_indent</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFormatter.decrease_indent" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Decrease current indent if the log level is filtered in.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">decrease_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decrease current indent if the log level is filtered in.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFormatter.increase_indent" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">increase_indent</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogFormatter.increase_indent" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Increase current indent if the log level is filtered in.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Increase current indent if the log level is filtered in.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFormatter.level" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">level</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.logger.LogFormatter.level" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>The current filter level for the LogFormatter.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The current filter level for the LogFormatter.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogFormatter.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

<a href="#tm2py.logger.LogFormatter.log" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Format and log message text.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>logging level</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamp</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>formatted datetime as a string or None</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format and log message text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogStartEnd" class="doc doc-heading">
        <code>LogStartEnd</code>


<a href="#tm2py.logger.LogStartEnd" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">

  
      <p>Log the start and end time with optional message.</p>
<p>Used as a Component method decorator. If msg is not provided a default
message is generated with the object class and method name.</p>
<p>Example::
    @LogStartEnd(&ldquo;Highway assignment and skims&rdquo;, level=&rdquo;STATUS&rdquo;)
    def run(self):
        pass</p>

<details class="properties">
  <summary>Properties</summary>
  <p>text (str): message text to use in the start and end record.
level (str): logging level as a string.</p>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LogStartEnd</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Log the start and end time with optional message.</span>

<span class="sd">    Used as a Component method decorator. If msg is not provided a default</span>
<span class="sd">    message is generated with the object class and method name.</span>

<span class="sd">    Example::</span>
<span class="sd">        @LogStartEnd(&quot;Highway assignment and skims&quot;, level=&quot;STATUS&quot;)</span>
<span class="sd">        def run(self):</span>
<span class="sd">            pass</span>

<span class="sd">    Properties:</span>
<span class="sd">        text (str): message text to use in the start and end record.</span>
<span class="sd">        level (str): logging level as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogStartEnd object.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str, optional): message text to use in the start and end record.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            level (str, optional): logging level as a string. Defaults to &quot;INFO&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ability to call logger.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (_type_): _description_</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">with</span> <span class="n">obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogStartEnd.__call__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogStartEnd.__call__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Ability to call logger.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>func</code></td>
          <td>
                <code>_type_</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>_type_</code></td>          <td>
          </td>
          <td><p><em>description</em></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ability to call logger.</span>

<span class="sd">    Args:</span>
<span class="sd">        func (_type_): _description_</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">with</span> <span class="n">obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.LogStartEnd.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span></code>

<a href="#tm2py.logger.LogStartEnd.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for LogStartEnd object.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>message text to use in the start and end record.
Defaults to None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>logging level as a string. Defaults to &ldquo;INFO&rdquo;.</p></td>
          <td>
                <code>&#39;INFO&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogStartEnd object.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str, optional): message text to use in the start and end record.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        level (str, optional): logging level as a string. Defaults to &quot;INFO&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.logger.Logger" class="doc doc-heading">
        <code>Logger</code>


<a href="#tm2py.logger.Logger" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">

  
      <p>Logging of message text for display, text file, and Emme logbook, as well as notify to slack.</p>
<p>The log message levels can be one of:
TRACE, DEBUG, DETAIL, INFO, STATUS, WARN, ERROR, FATAL
Which will filter all messages of that severity and higher.
See module note on use of descriptive level names.</p>
<p>logger.log(&ldquo;a message&rdquo;)
with logger.log_start_end(&ldquo;Running a set of steps&rdquo;):
    logger.log(&ldquo;Message with timestamp&rdquo;)
    logger.log(&ldquo;A debug message&rdquo;, level=&rdquo;DEBUG&rdquo;)
    # equivalently, use the .debug:
    logger.debug(&ldquo;Another debug message&rdquo;)
    if logger.debug_enabled:
        # only generate this report if logging DEBUG
        logger.log(&ldquo;A debug report that takes time to produce&rdquo;, level=&rdquo;DEBUG&rdquo;)
    logger.notify_slack(&ldquo;A slack message&rdquo;)</p>
<p>Methods can also be decorated with LogStartEnd (see class for more).</p>
<p>Note that the Logger should only be initialized once per model run.
In places where the controller is not available, the last Logger
initialized can be obtained from the class method get_logger::</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>logger = Logger.get_logger()
</code></pre></div></td></tr></table></div>

<details class="internal-properties">
  <summary>Internal properties</summary>
  
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Logger</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Logging of message text for display, text file, and Emme logbook, as well as notify to slack.</span>

<span class="sd">    The log message levels can be one of:</span>
<span class="sd">    TRACE, DEBUG, DETAIL, INFO, STATUS, WARN, ERROR, FATAL</span>
<span class="sd">    Which will filter all messages of that severity and higher.</span>
<span class="sd">    See module note on use of descriptive level names.</span>

<span class="sd">    logger.log(&quot;a message&quot;)</span>
<span class="sd">    with logger.log_start_end(&quot;Running a set of steps&quot;):</span>
<span class="sd">        logger.log(&quot;Message with timestamp&quot;)</span>
<span class="sd">        logger.log(&quot;A debug message&quot;, level=&quot;DEBUG&quot;)</span>
<span class="sd">        # equivalently, use the .debug:</span>
<span class="sd">        logger.debug(&quot;Another debug message&quot;)</span>
<span class="sd">        if logger.debug_enabled:</span>
<span class="sd">            # only generate this report if logging DEBUG</span>
<span class="sd">            logger.log(&quot;A debug report that takes time to produce&quot;, level=&quot;DEBUG&quot;)</span>
<span class="sd">        logger.notify_slack(&quot;A slack message&quot;)</span>

<span class="sd">    Methods can also be decorated with LogStartEnd (see class for more).</span>

<span class="sd">    Note that the Logger should only be initialized once per model run.</span>
<span class="sd">    In places where the controller is not available, the last Logger</span>
<span class="sd">    initialized can be obtained from the class method get_logger::</span>

<span class="sd">        logger = Logger.get_logger()</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _log_cache: the LogCache object</span>
<span class="sd">        _log_formatters: list of objects that format text and record, either</span>
<span class="sd">            to file, display (print to screen) or cache for log on error</span>
<span class="sd">        _use_emme_logbook: whether Emme logbook is enabled</span>
<span class="sd">        _slack_notifier: SlackNotifier object for sending messages to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># used to cache last initialized Logger</span>
    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Logger __new__ method override. TODO.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): TODO.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Logger</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for Logger object.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Associated RunController instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="n">log_config</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span>
        <span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">log_config</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">iter_component_level</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">iter_component_level</span>
        <span class="p">)</span>
        <span class="n">display_logger</span> <span class="o">=</span> <span class="n">LogDisplay</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">display_level</span><span class="p">])</span>
        <span class="n">run_log_formatter</span> <span class="o">=</span> <span class="n">LogFile</span><span class="p">(</span>
            <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">run_file_level</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">run_file_path</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">standard_log_formatter</span> <span class="o">=</span> <span class="n">LogFileLevelOverride</span><span class="p">(</span>
            <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">log_file_level</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_file_path</span><span class="p">),</span>
            <span class="n">iter_component_level</span><span class="p">,</span>
            <span class="n">controller</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="o">=</span> <span class="n">LogCache</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_on_error_file_path</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">display_logger</span><span class="p">,</span>
            <span class="n">run_log_formatter</span><span class="p">,</span>
            <span class="n">standard_log_formatter</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">use_emme_logbook</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span> <span class="o">=</span> <span class="n">SlackNotifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># open log formatters</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">):</span>
                <span class="n">log_formatter</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destructor for logger object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
                <span class="n">log_formatter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the last initialized logger object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="nf">notify_slack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send message to slack if enabled by config.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to send to slack</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span><span class="o">.</span><span class="n">post_message</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y (%H:%M:%S) &quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=TRACE.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;TRACE&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=DEBUG.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=DETAIL.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DETAIL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=INFO.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=STATUS.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=WARN.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;WARN&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=ERROR.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=FATAL.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;FATAL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with timestamp and &#39;Start&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">increase_indent</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_log_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with timestamp and &#39;End&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">decrease_indent</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">log_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use with &#39;with&#39; statement to log the start and end time with message.</span>

<span class="sd">        If using the Emme logbook (config.logging.use_emme_logbook is True), will</span>
<span class="sd">        also create a logbook nest in the tree view using logbook_trace.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_start</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format dictionary to string and log as text.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">),</span> <span class="n">level</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_skip_emme_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Temporary disable Emme logging (if enabled) and restore on exit.</span>

<span class="sd">        Intended use is with the log_start_end context and LogStartEnd decorator</span>
<span class="sd">        to allow use of the Emme context without double logging of the</span>
<span class="sd">        messages in the Emme logbook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">,</span> <span class="n">use_emme</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span>
        <span class="k">yield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="n">use_emme</span>

    <span class="k">def</span> <span class="nf">clear_msg_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear all log messages from cache.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">debug_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns True if DEBUG is currently filtered for display or print to file.</span>

<span class="sd">        Can be used to enable / disable debug logging which may have a performance</span>
<span class="sd">        impact.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="ow">and</span> <span class="n">log_formatter</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trace_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns True if TRACE is currently filtered for display or print to file.</span>

<span class="sd">        Can be used to enable / disable trace logging which may have a performance</span>
<span class="sd">        impact.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="s2">&quot;TRACE&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="ow">and</span> <span class="n">log_formatter</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.__del__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__del__</span><span class="p">()</span></code>

<a href="#tm2py.logger.Logger.__del__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Destructor for logger object</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Destructor for logger object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for Logger object.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>Associated RunController instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for Logger object.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Associated RunController instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
    <span class="n">log_config</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span>
    <span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">log_config</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="n">iter_component_level</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">iter_component_level</span>
    <span class="p">)</span>
    <span class="n">display_logger</span> <span class="o">=</span> <span class="n">LogDisplay</span><span class="p">(</span><span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">display_level</span><span class="p">])</span>
    <span class="n">run_log_formatter</span> <span class="o">=</span> <span class="n">LogFile</span><span class="p">(</span>
        <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">run_file_level</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">run_file_path</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">standard_log_formatter</span> <span class="o">=</span> <span class="n">LogFileLevelOverride</span><span class="p">(</span>
        <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">log_file_level</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_file_path</span><span class="p">),</span>
        <span class="n">iter_component_level</span><span class="p">,</span>
        <span class="n">controller</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="o">=</span> <span class="n">LogCache</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_on_error_file_path</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">display_logger</span><span class="p">,</span>
        <span class="n">run_log_formatter</span><span class="p">,</span>
        <span class="n">standard_log_formatter</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">use_emme_logbook</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span> <span class="o">=</span> <span class="n">SlackNotifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># open log formatters</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">):</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.__new__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.__new__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Logger <strong>new</strong> method override. TODO.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>controller</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.controller.RunController" href="#tm2py.controller.RunController">RunController</a></code>
          </td>
          <td><p>TODO.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Logger __new__ method override. TODO.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): TODO.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=unused-argument</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Logger</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.clear_msg_cache" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">clear_msg_cache</span><span class="p">()</span></code>

<a href="#tm2py.logger.Logger.clear_msg_cache" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Clear all log messages from cache.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clear_msg_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clear all log messages from cache.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.debug" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">debug</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.debug" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text with level=DEBUG.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=DEBUG.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.debug_enabled" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">debug_enabled</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.logger.Logger.debug_enabled" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Returns True if DEBUG is currently filtered for display or print to file.</p>
<p>Can be used to enable / disable debug logging which may have a performance
impact.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">debug_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns True if DEBUG is currently filtered for display or print to file.</span>

<span class="sd">    Can be used to enable / disable debug logging which may have a performance</span>
<span class="sd">    impact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">log_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="ow">and</span> <span class="n">log_formatter</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.detail" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">detail</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.detail" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text with level=DETAIL.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=DETAIL.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DETAIL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.error" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">error</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.error" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text with level=ERROR.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=ERROR.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.fatal" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">fatal</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.fatal" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text with level=FATAL.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=FATAL.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;FATAL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.get_logger" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_logger</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.logger.Logger.get_logger" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Return the last initialized logger object.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the last initialized logger object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.info" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">info</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.info" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text with level=INFO.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=INFO.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.log" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text to file and display depending upon log level and config.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>logging level</p></td>
          <td>
                <code>&#39;INFO&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (str): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y (%H:%M:%S) &quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="n">log_formatter</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">has_emme</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.log_dict" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log_dict</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.log_dict" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Format dictionary to string and log as text.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format dictionary to string and log as text.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">),</span> <span class="n">level</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.log_start_end" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log_start_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;STATUS&#39;</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.log_start_end" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Use with &lsquo;with&rsquo; statement to log the start and end time with message.</p>
<p>If using the Emme logbook (config.logging.use_emme_logbook is True), will
also create a logbook nest in the tree view using logbook_trace.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>message text</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>level</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>logging level</p></td>
          <td>
                <code>&#39;STATUS&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_context</span>
<span class="k">def</span> <span class="nf">log_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use with &#39;with&#39; statement to log the start and end time with message.</span>

<span class="sd">    If using the Emme logbook (config.logging.use_emme_logbook is True), will</span>
<span class="sd">    also create a logbook nest in the tree view using logbook_trace.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): message text</span>
<span class="sd">        level (str): logging level</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_start</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">yield</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.notify_slack" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">notify_slack</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.notify_slack" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Send message to slack if enabled by config.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to send to slack</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">notify_slack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Send message to slack if enabled by config.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to send to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span><span class="o">.</span><span class="n">post_message</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.status" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">status</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.status" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text with level=STATUS.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=STATUS.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.trace" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">trace</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.trace" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text with level=TRACE.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=TRACE.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;TRACE&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.trace_enabled" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">trace_enabled</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#tm2py.logger.Logger.trace_enabled" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Returns True if TRACE is currently filtered for display or print to file.</p>
<p>Can be used to enable / disable trace logging which may have a performance
impact.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">trace_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns True if TRACE is currently filtered for display or print to file.</span>

<span class="sd">    Can be used to enable / disable trace logging which may have a performance</span>
<span class="sd">    impact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">LEVELS_STR_TO_INT</span><span class="p">[</span><span class="s2">&quot;TRACE&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">log_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="ow">and</span> <span class="n">log_formatter</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">trace</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.Logger.warn" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">warn</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#tm2py.logger.Logger.warn" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Log text with level=WARN.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>text to log</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>indent</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if true indent text based on the number of open contexts</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=WARN.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;WARN&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="tm2py.logger.SlackNotifier" class="doc doc-heading">
        <code>SlackNotifier</code>


<a href="#tm2py.logger.SlackNotifier" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">

  
      <p>Notify slack of model run status.</p>
<p>The slack channel can be input directly, or is configured via text file found at
&ldquo;M:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if on MTC server)
rr&rdquo;C:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if local)</p>

<details class="properties">
  <summary>Properties</summary>
  <ul>
<li>logger (Logger): object for logging of trace messages</li>
<li>slack_webhook_url (str): optional, url to use for sending the message to slack</li>
</ul>
</details>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SlackNotifier</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Notify slack of model run status.</span>

<span class="sd">    The slack channel can be input directly, or is configured via text file found at</span>
<span class="sd">    &quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">    rr&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if local)</span>

<span class="sd">    Properties:</span>
<span class="sd">        - logger (Logger): object for logging of trace messages</span>
<span class="sd">        - slack_webhook_url (str): optional, url to use for sending the message to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructor for SlackNotifier object.</span>

<span class="sd">        Args:</span>
<span class="sd">            logger (Logger): logger instance.</span>
<span class="sd">            slack_webhook_url (str, optional): . Defaults to None, which is replaced by either:</span>
<span class="sd">                - r&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">                - r&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (otherwise)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">hostname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mtc.ca.gov&quot;</span><span class="p">):</span>
                <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on non-mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">url_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">url_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">slack_webhook_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SlackNotifier using slack webhook url </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">post_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Posts text to the slack channel via the webhook if slack_webhook_url is found.</span>

<span class="sd">        Args:</span>
<span class="sd">           text: text message to send to slack</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending message to slack: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receiving response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.SlackNotifier.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#tm2py.logger.SlackNotifier.__init__" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Constructor for SlackNotifier object.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>logger</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="tm2py.logger.Logger" href="#tm2py.logger.Logger">Logger</a></code>
          </td>
          <td><p>logger instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>slack_webhook_url</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>. Defaults to None, which is replaced by either:
- r&rdquo;M:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if on MTC server)
- r&rdquo;C:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (otherwise)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructor for SlackNotifier object.</span>

<span class="sd">    Args:</span>
<span class="sd">        logger (Logger): logger instance.</span>
<span class="sd">        slack_webhook_url (str, optional): . Defaults to None, which is replaced by either:</span>
<span class="sd">            - r&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">            - r&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (otherwise)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hostname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mtc.ca.gov&quot;</span><span class="p">):</span>
            <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on non-mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">url_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">url_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">slack_webhook_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;SlackNotifier using slack webhook url </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="tm2py.logger.SlackNotifier.post_message" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">post_message</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#tm2py.logger.SlackNotifier.post_message" class="headerlink" title="Permanent link"> ¶</a></h5>


  <div class="doc doc-contents ">
  
      <p>Posts text to the slack channel via the webhook if slack_webhook_url is found.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
          </td>
          <td><p>text message to send to slack</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/logger.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">post_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Posts text to the slack channel via the webhook if slack_webhook_url is found.</span>

<span class="sd">    Args:</span>
<span class="sd">       text: text message to send to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending message to slack: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receiving response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tm2py.tools" class="doc doc-heading">
          <code>tm2py.tools</code>


<a href="#tm2py.tools" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Tools module for common resources / shared code and &ldquo;utilities&rdquo; in the tm2py package.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tm2py.tools.download_unzip" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">download_unzip</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">out_base_dir</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">,</span> <span class="n">zip_filename</span><span class="o">=</span><span class="s1">&#39;test_data.zip&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.download_unzip" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Download and unzips a file from a URL. The zip file is removed after extraction.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>url</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Full URL do download from.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>out_base_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Where to unzip the file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>What to unzip the file as.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>zip_filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Filename to store zip file as. Defaults to &ldquo;test_data.zip&rdquo;.</p></td>
          <td>
                <code>&#39;test_data.zip&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/tools.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_unzip</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test_data.zip&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Download and unzips a file from a URL. The zip file is removed after extraction.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): Full URL do download from.</span>
<span class="sd">        out_base_dir (str): Where to unzip the file.</span>
<span class="sd">        target_dir (str): What to unzip the file as.</span>
<span class="sd">        zip_filename (str, optional): Filename to store zip file as. Defaults to &quot;test_data.zip&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target_zip</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">)</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">_download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">target_zip</span><span class="p">)</span>
    <span class="n">_unzip</span><span class="p">(</span><span class="n">target_zip</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target_zip</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.tools.emme_context" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_context</span><span class="p">()</span></code>

<a href="#tm2py.tools.emme_context" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Return True if Emme is installed.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/tools.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">emme_context</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return True if Emme is installed.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">pkg_resources</span>

    <span class="n">_inro_package</span> <span class="o">=</span> <span class="s2">&quot;inro-emme&quot;</span>
    <span class="n">_avail_packages</span> <span class="o">=</span> <span class="p">[</span><span class="n">pkg</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">pkg</span> <span class="ow">in</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">working_set</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">_inro_package</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_avail_packages</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inro not found. Skipping inro setup.&quot;</span><span class="p">)</span>
        <span class="n">mocked_inro_context</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">inro</span>

        <span class="k">if</span> <span class="s2">&quot;MagicMock&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">inro</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.tools.interpolate_dfs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">interpolate_dfs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ref_points</span><span class="p">,</span> <span class="n">target_point</span><span class="p">,</span> <span class="n">ref_col_name</span><span class="o">=</span><span class="s1">&#39;ends_with&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.interpolate_dfs" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Interpolate for the model year assuming linear growth between the reference years.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>dataframe to interpolate on, with ref points contained in column
name per ref_col_name.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_points</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[<span title="typing.Union">Union</span>[float, int]]</code>
          </td>
          <td><p>reference years to interpolate between</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>target_point</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[float, int]</code>
          </td>
          <td><p>target year</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>ref_col_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>column name to use for reference years.
Defaults to &ldquo;ends_with&rdquo;.</p></td>
          <td>
                <code>&#39;ends_with&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/tools.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_dfs</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">ref_points</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">target_point</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
    <span class="n">ref_col_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ends_with&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Interpolate for the model year assuming linear growth between the reference years.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): dataframe to interpolate on, with ref points contained in column</span>
<span class="sd">            name per ref_col_name.</span>
<span class="sd">        ref_points (Collection[Union[float,int]]): reference years to interpolate between</span>
<span class="sd">        target_point (Union[float,int]): target year</span>
<span class="sd">        ref_col_name (str, optional): column name to use for reference years.</span>
<span class="sd">            Defaults to &quot;ends_with&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ref_col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ends_with&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_col_name</span><span class="si">}</span><span class="s2"> not implemented&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref_points</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_points</span><span class="si">}</span><span class="s2"> reference points not implemented&quot;</span><span class="p">)</span>

    <span class="n">_ref_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ref_points</span><span class="p">))</span>
    <span class="n">_target_point</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">target_point</span><span class="p">)</span>

    <span class="n">_ref_points</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">_start_point</span><span class="p">,</span> <span class="n">_end_point</span> <span class="o">=</span> <span class="n">_ref_points</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_start_point</span> <span class="o">&lt;=</span> <span class="n">_target_point</span> <span class="o">&lt;=</span> <span class="n">_end_point</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Target Point: </span><span class="si">{</span><span class="n">_target_point</span><span class="si">}</span><span class="s2"> not within range of </span><span class="se">\</span>
<span class="s2">            Reference Points: </span><span class="si">{</span><span class="n">_ref_points</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">_start_ref_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_end_ref_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_start_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">_end_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2"> have different number of columns:</span><span class="se">\n\</span>
<span class="s2">           </span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2"> Columns: </span><span class="si">{</span><span class="n">_start_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="se">\n\</span>
<span class="s2">           </span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2"> Columns: </span><span class="si">{</span><span class="n">_end_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="se">\</span>
<span class="s2">        &quot;</span>
        <span class="p">)</span>

    <span class="n">_start_ref_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">_end_ref_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_scale_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">target_point</span> <span class="o">-</span> <span class="n">_start_point</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">_end_point</span> <span class="o">-</span> <span class="n">_start_point</span><span class="p">)</span>

    <span class="n">interpolated_df</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">_scale_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">_start_ref_df</span> <span class="o">+</span> <span class="n">_scale_factor</span> <span class="o">*</span> <span class="n">_end_ref_df</span>

    <span class="k">return</span> <span class="n">interpolated_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.tools.mocked_inro_context" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">mocked_inro_context</span><span class="p">()</span></code>

<a href="#tm2py.tools.mocked_inro_context" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Mocking of modules which need to be mocked for tests.</p>

      <details class="quote">
        <summary>Source code in <code>tm2py/tools.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">mocked_inro_context</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Mocking of modules which need to be mocked for tests.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">MagicMock</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.database.emmebank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.database.emmebank.path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.network&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.database.scenario&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.database.matrix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.network.node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.emme.desktop.app&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;inro.modeller&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;tm2py.emme.manager.EmmeManager.project&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="s2">&quot;tm2py.emme.manager.EmmeManager.emmebank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.tools.run_process" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.run_process" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Run system level commands as blocking process and log output and error messages.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>commands</code></td>
          <td>
                <code><span title="typing.Collection">Collection</span>[str]</code>
          </td>
          <td><p>list of one or more commands to execute</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional name to use for the temp bat file</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/tools.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run system level commands as blocking process and log output and error messages.</span>

<span class="sd">    Args:</span>
<span class="sd">        commands: list of one or more commands to execute</span>
<span class="sd">        name: optional name to use for the temp bat file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># when merged with develop_logging branch can use get_logger</span>
    <span class="c1"># logger = Logger.get_logger</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="n">temp_file</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.bat&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="n">bat_file</span><span class="p">,</span> <span class="n">bat_file_path</span><span class="p">):</span>
        <span class="n">bat_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">commands</span><span class="p">))</span>
        <span class="n">bat_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
            <span class="c1"># temporary file to capture output error messages generated by Java</span>
            <span class="c1"># Note: temp file created in the current working directory</span>
            <span class="k">with</span> <span class="n">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w+&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_error.log&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="n">err_file</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">_subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                        <span class="n">bat_file_path</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">err_file</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">_subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
                    <span class="k">raise</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">err_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">err_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">bat_file_path</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.tools.temp_file" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.temp_file" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Temp file wrapper to return open file handle and named path.</p>
<p>A named temporary file (using mkstemp) with specified prefix and
suffix is created and opened with the specified mode. The file
handle and path are returned. The file is closed and deleted on exit.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>mode to open file, [rw][+][b]</p></td>
          <td>
                <code>&#39;w+&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional text to start temp file name</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>suffix</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional text to end temp file name</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/tools.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@_context</span>
<span class="k">def</span> <span class="nf">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;w+&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Temp file wrapper to return open file handle and named path.</span>

<span class="sd">    A named temporary file (using mkstemp) with specified prefix and</span>
<span class="sd">    suffix is created and opened with the specified mode. The file</span>
<span class="sd">    handle and path are returned. The file is closed and deleted on exit.</span>

<span class="sd">    Args:</span>
<span class="sd">        mode: mode to open file, [rw][+][b]</span>
<span class="sd">        prefix: optional text to start temp file name</span>
<span class="sd">        suffix: optional text to end temp file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_ref</span><span class="p">,</span> <span class="n">file_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">file_ref</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">file</span><span class="p">,</span> <span class="n">file_path</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="tm2py.tools.zonal_csv_to_matrices" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">zonal_csv_to_matrices</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">i_column</span><span class="o">=</span><span class="s1">&#39;ORIG&#39;</span><span class="p">,</span> <span class="n">j_column</span><span class="o">=</span><span class="s1">&#39;DEST&#39;</span><span class="p">,</span> <span class="n">value_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VALUE&#39;</span><span class="p">],</span> <span class="n">default_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fill_zones</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_zone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span></code>

<a href="#tm2py.tools.zonal_csv_to_matrices" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Read a CSV file with zonal data and into dataframes.</p>
<p>Input CSV file should have a header row specifying the I, J, and Value column names.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>csv_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p><em>description</em></p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>i_column</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of j zone column. Defaults to &ldquo;ORIG&rdquo;.</p></td>
          <td>
                <code>&#39;ORIG&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>j_column</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of i zone column. Defaults to &ldquo;DEST&rdquo;.</p></td>
          <td>
                <code>&#39;DEST&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>value_columns</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>List of columns to turn into matrices.
Defaults to [&ldquo;VALUE&rdquo;].</p></td>
          <td>
                <code>[&#39;VALUE&#39;]</code>
          </td>
        </tr>
        <tr>
          <td><code>default_value</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Value to fill empty cells with. Defaults to 0.0.</p></td>
          <td>
                <code>0.0</code>
          </td>
        </tr>
        <tr>
          <td><code>fill_zones</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If true, will fill zones without values to max zone with
default value. Defaults to False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>max_zone</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>If fill_zones is True, used to determine matrix size.
Defaults to max(I, J).</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>delimiter</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Input file delimeter. Defaults to &ldquo;,&rdquo;.</p></td>
          <td>
                <code>&#39;,&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
                <code><span title="typing.Mapping">Mapping</span>[str, <span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span>]</code>
          </td>
          <td><p>Dictionary of Pandas dataframes with matrix names as keys.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/tools.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">zonal_csv_to_matrices</span><span class="p">(</span>
    <span class="n">csv_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">i_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ORIG&quot;</span><span class="p">,</span>
    <span class="n">j_column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DEST&quot;</span><span class="p">,</span>
    <span class="n">value_columns</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;VALUE&quot;</span><span class="p">],</span>
    <span class="n">default_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">fill_zones</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">max_zone</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Read a CSV file with zonal data and into dataframes.</span>

<span class="sd">    Input CSV file should have a header row specifying the I, J, and Value column names.</span>

<span class="sd">    Args:</span>
<span class="sd">        csv_file (str): _description_</span>
<span class="sd">        i_column (str, optional): Name of j zone column. Defaults to &quot;ORIG&quot;.</span>
<span class="sd">        j_column (str, optional): Name of i zone column. Defaults to &quot;DEST&quot;.</span>
<span class="sd">        value_columns (str, optional): List of columns to turn into matrices.</span>
<span class="sd">            Defaults to [&quot;VALUE&quot;].</span>
<span class="sd">        default_value (float, optional): Value to fill empty cells with. Defaults to 0.0.</span>
<span class="sd">        fill_zones (bool, optional): If true, will fill zones without values to max zone with</span>
<span class="sd">            default value. Defaults to False.</span>
<span class="sd">        max_zone (int, optional): If fill_zones is True, used to determine matrix size.</span>
<span class="sd">            Defaults to max(I, J).</span>
<span class="sd">        delimiter (str, optional): Input file delimeter. Defaults to &quot;,&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary of Pandas dataframes with matrix names as keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO Create a test</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
    <span class="n">_df_idx</span> <span class="o">=</span> <span class="n">_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">i_column</span><span class="p">,</span> <span class="n">j_column</span><span class="p">])</span>

    <span class="n">_dfs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">_df_idx</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value_columns</span><span class="p">}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fill_zones</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_dfs_dict</span>

    <span class="k">if</span> <span class="n">max_zone</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">max_zone</span> <span class="o">=</span> <span class="n">_df</span><span class="p">[[</span><span class="n">i_column</span><span class="p">,</span> <span class="n">j_column</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">_zone_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_zone</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">_df</span> <span class="ow">in</span> <span class="n">_dfs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">_df</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">_zone_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">_zone_list</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">default_value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_dfs_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="tm2py.examples" class="doc doc-heading">
          <code>tm2py.examples</code>


<a href="#tm2py.examples" class="headerlink" title="Permanent link"> ¶</a></h3>

  <div class="doc doc-contents first">
  
      <p>Download and unzip examples for tm2py, used in tests.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="tm2py.examples.get_example" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_example</span><span class="p">(</span><span class="n">example_name</span><span class="o">=</span><span class="n">_DEFAULT_EXAMPLE_NAME</span><span class="p">,</span> <span class="n">example_subdir</span><span class="o">=</span><span class="n">_DEFAULT_EXAMPLE_SUBDIR</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="n">_ROOT_DIR</span><span class="p">,</span> <span class="n">retrieval_url</span><span class="o">=</span><span class="n">_DEFAULT_EXAMPLE_URL</span><span class="p">)</span></code>

<a href="#tm2py.examples.get_example" class="headerlink" title="Permanent link"> ¶</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns example directory; downloads if necessary from retrieval URL.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>example_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Used to retrieve sub-folder or create it if doesn&rsquo;t exist.
Defaults to _DEFAULT_EXAMPLE_NAME.</p></td>
          <td>
                <code>_DEFAULT_EXAMPLE_NAME</code>
          </td>
        </tr>
        <tr>
          <td><code>example_subdir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Where to find examples within root dir. Defaults
to _DEFAULT_EXAMPLE_SUBDIR.</p></td>
          <td>
                <code>_DEFAULT_EXAMPLE_SUBDIR</code>
          </td>
        </tr>
        <tr>
          <td><code>root_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Root dir of project. Defaults to _ROOT_DIR.</p></td>
          <td>
                <code>_ROOT_DIR</code>
          </td>
        </tr>
        <tr>
          <td><code>retrieval_url</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>URL to retrieve example data zip from. Defaults
to _DEFAULT_EXAMPLE_URL.</p></td>
          <td>
                <code>_DEFAULT_EXAMPLE_URL</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>FileNotFoundError</code>
          </td>
          <td><p>If can&rsquo;t find the files after trying to download it.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>Path to example data.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>tm2py/examples.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_example</span><span class="p">(</span>
    <span class="n">example_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_NAME</span><span class="p">,</span>
    <span class="n">example_subdir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_SUBDIR</span><span class="p">,</span>
    <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_ROOT_DIR</span><span class="p">,</span>
    <span class="n">retrieval_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_URL</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns example directory; downloads if necessary from retrieval URL.</span>

<span class="sd">    Args:</span>
<span class="sd">        example_name (str, optional): Used to retrieve sub-folder or create it if doesn&#39;t exist.</span>
<span class="sd">            Defaults to _DEFAULT_EXAMPLE_NAME.</span>
<span class="sd">        example_subdir (str, optional): Where to find examples within root dir. Defaults</span>
<span class="sd">            to _DEFAULT_EXAMPLE_SUBDIR.</span>
<span class="sd">        root_dir (str, optional): Root dir of project. Defaults to _ROOT_DIR.</span>
<span class="sd">        retrieval_url (str, optional): URL to retrieve example data zip from. Defaults</span>
<span class="sd">            to _DEFAULT_EXAMPLE_URL.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If can&#39;t find the files after trying to download it.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to example data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_example_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">example_subdir</span><span class="p">)</span>
    <span class="n">_this_example_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_example_dir</span><span class="p">,</span> <span class="n">example_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">_this_example_dir</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_this_example_dir</span>

    <span class="n">download_unzip</span><span class="p">(</span><span class="n">retrieval_url</span><span class="p">,</span> <span class="n">_example_dir</span><span class="p">,</span> <span class="n">_this_example_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">_this_example_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;example </span><span class="si">{</span><span class="n">_this_example_dir</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_this_example_dir</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../architecture/" class="md-footer__link md-footer__link--next" aria-label="Next: Architecture" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Architecture
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "content.code.annotate", "content.tabs.link", "navigation.indexes"], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.078830c0.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.0/dist/mermaid.min.js"></script>
      
    
  </body>
</html>