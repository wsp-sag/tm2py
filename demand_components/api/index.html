
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://bayareametro.github.io/tm2py/demand_components/api/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.14">
    
    
      
        <title>API Documentation - Travel Model Two Python Package: tm2py</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3de6f41f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Travel Model Two Python Package: tm2py" class="md-header__button md-logo" aria-label="Travel Model Two Python Package: tm2py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Travel Model Two Python Package: tm2py
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Documentation
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bayareametro/tm2py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      API Documentation
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../architecture/" class="md-tabs__link">
      Architecture
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../contributing/development/" class="md-tabs__link">
        Contributing
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../examples/" class="md-tabs__link">
        Examples
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Travel Model Two Python Package: tm2py" class="md-nav__button md-logo" aria-label="Travel Model Two Python Package: tm2py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Travel Model Two Python Package: tm2py
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bayareametro/tm2py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API Documentation
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
    <nav class="md-nav" aria-label="Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller" class="md-nav__link">
    controller
  </a>
  
    <nav class="md-nav" aria-label="controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController" class="md-nav__link">
    RunController
  </a>
  
    <nav class="md-nav" aria-label="RunController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.emme_manager" class="md-nav__link">
    emme_manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iter_component" class="md-nav__link">
    iter_component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iteration" class="md-nav__link">
    iteration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_dir" class="md-nav__link">
    run_dir
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_iterations" class="md-nav__link">
    run_iterations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component" class="md-nav__link">
    component()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config" class="md-nav__link">
    config
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="md-nav__link">
    ActiveModeShortestPathSkimConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModesConfig" class="md-nav__link">
    ActiveModesConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig" class="md-nav__link">
    AirPassengerConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    AirPassengerDemandAggregationConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem" class="md-nav__link">
    ConfigItem
  </a>
  
    <nav class="md-nav" aria-label="ConfigItem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.__getitem__" class="md-nav__link">
    __getitem__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.items" class="md-nav__link">
    items()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.__pydantic_model__.maz_skim_period_exists" class="md-nav__link">
    maz_skim_period_exists()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.load_toml" class="md-nav__link">
    load_toml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.maz_skim_period_exists" class="md-nav__link">
    maz_skim_period_exists()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    DemandCountyGroupConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    EmmeConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.GateFactorConfig" class="md-nav__link">
    GateFactorConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayCapClassConfig" class="md-nav__link">
    HighwayCapClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    HighwayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassDemandConfig" class="md-nav__link">
    HighwayClassDemandConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    HighwayConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    HighwayMazToMazConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    HighwayTollsConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    HouseholdConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    InternalExternalConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.LoggingConfig" class="md-nav__link">
    LoggingConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig" class="md-nav__link">
    RunConfig
  </a>
  
    <nav class="md-nav" aria-label="RunConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.__pydantic_model__.end_iteration_gt_start" class="md-nav__link">
    end_iteration_gt_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.__pydantic_model__.start_component_used" class="md-nav__link">
    start_component_used()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="md-nav__link">
    end_iteration_gt_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.start_component_used" class="md-nav__link">
    start_component_used()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ScenarioConfig" class="md-nav__link">
    ScenarioConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDaySplitConfig" class="md-nav__link">
    TimeOfDaySplitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimePeriodConfig" class="md-nav__link">
    TimePeriodConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    TransitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    TransitModeConfig
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitVehicleConfig" class="md-nav__link">
    TransitVehicleConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    TruckConfig
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-component" class="md-nav__link">
    Base Component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component" class="md-nav__link">
    component
  </a>
  
    <nav class="md-nav" aria-label="component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component" class="md-nav__link">
    Component
  </a>
  
    <nav class="md-nav" aria-label="Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.controller" class="md-nav__link">
    controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.logger" class="md-nav__link">
    logger
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.top_sheet" class="md-nav__link">
    top_sheet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.trace" class="md-nav__link">
    trace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_abs_path" class="md-nav__link">
    get_abs_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_emme_scenario" class="md-nav__link">
    get_emme_scenario()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.report_progress" class="md-nav__link">
    report_progress()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.test_component" class="md-nav__link">
    test_component()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.time_period_names" class="md-nav__link">
    time_period_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.verify" class="md-nav__link">
    verify()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.write_top_sheet" class="md-nav__link">
    write_top_sheet()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError" class="md-nav__link">
    FileFormatError
  </a>
  
    <nav class="md-nav" aria-label="FileFormatError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demand-components" class="md-nav__link">
    Demand Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand" class="md-nav__link">
    demand
  </a>
  
    <nav class="md-nav" aria-label="demand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareDemand" class="md-nav__link">
    PrepareDemand
  </a>
  
    <nav class="md-nav" aria-label="PrepareDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareHighwayDemand" class="md-nav__link">
    PrepareHighwayDemand
  </a>
  
    <nav class="md-nav" aria-label="PrepareHighwayDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareHighwayDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareHighwayDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#household-demand" class="md-nav__link">
    Household Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household" class="md-nav__link">
    household
  </a>
  
    <nav class="md-nav" aria-label="household">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel" class="md-nav__link">
    HouseholdModel
  </a>
  
    <nav class="md-nav" aria-label="HouseholdModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    HouseholdConfig
  </a>
  
    <nav class="md-nav" aria-label="HouseholdConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#air-passenger-demand" class="md-nav__link">
    Air Passenger Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger" class="md-nav__link">
    air_passenger
  </a>
  
    <nav class="md-nav" aria-label="air_passenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger" class="md-nav__link">
    AirPassenger
  </a>
  
    <nav class="md-nav" aria-label="AirPassenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    AirPassengerDemandAggregationConfig
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerDemandAggregationConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commercial-demand" class="md-nav__link">
    Commercial Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial" class="md-nav__link">
    commercial
  </a>
  
    <nav class="md-nav" aria-label="commercial">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="md-nav__link">
    CommercialVehicleModel
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel--trip-generation" class="md-nav__link">
    Trip generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel--trip-distribution" class="md-nav__link">
    Trip distribution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel--time-of-day" class="md-nav__link">
    Time of day
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel--toll-choice" class="md-nav__link">
    Toll choice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    TruckConfig
  </a>
  
    <nav class="md-nav" aria-label="TruckConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inter-regional-demand" class="md-nav__link">
    Inter-regional Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external" class="md-nav__link">
    internal_external
  </a>
  
    <nav class="md-nav" aria-label="internal_external">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal" class="md-nav__link">
    InternalExternal
  </a>
  
    <nav class="md-nav" aria-label="InternalExternal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal--create-daily-demand-growth-forecast" class="md-nav__link">
    Create daily demand (growth forecast)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal--time-of-day-split" class="md-nav__link">
    Time of day split
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal--toll-choice" class="md-nav__link">
    Toll choice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    InternalExternalConfig
  </a>
  
    <nav class="md-nav" aria-label="InternalExternalConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visitor-demand" class="md-nav__link">
    Visitor Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.visitor" class="md-nav__link">
    visitor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#highway-network-components" class="md-nav__link">
    Highway Network Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network" class="md-nav__link">
    highway_network
  </a>
  
    <nav class="md-nav" aria-label="highway_network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="md-nav__link">
    PrepareNetwork
  </a>
  
    <nav class="md-nav" aria-label="PrepareNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign" class="md-nav__link">
    highway_assign
  </a>
  
    <nav class="md-nav" aria-label="highway_assign">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass" class="md-nav__link">
    AssignmentClass
  </a>
  
    <nav class="md-nav" aria-label="AssignmentClass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_class_analysis" class="md-nav__link">
    emme_class_analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_highway_class_spec" class="md-nav__link">
    emme_highway_class_spec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_matrices" class="md-nav__link">
    skim_matrices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_analysis_spec" class="md-nav__link">
    emme_analysis_spec()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_analysis_link_attribute" class="md-nav__link">
    skim_analysis_link_attribute()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="md-nav__link">
    HighwayAssignment
  </a>
  
    <nav class="md-nav" aria-label="HighwayAssignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    HighwayConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    HighwayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    HighwayTollsConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    DemandCountyGroupConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz" class="md-nav__link">
    highway_maz
  </a>
  
    <nav class="md-nav" aria-label="highway_maz">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="md-nav__link">
    AssignMAZSPDemand
  </a>
  
    <nav class="md-nav" aria-label="AssignMAZSPDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="md-nav__link">
    SkimMAZCosts
  </a>
  
    <nav class="md-nav" aria-label="SkimMAZCosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    HighwayMazToMazConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transit-network-components" class="md-nav__link">
    Transit Network Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign" class="md-nav__link">
    transit_assign
  </a>
  
    <nav class="md-nav" aria-label="transit_assign">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="md-nav__link">
    TransitAssignment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim" class="md-nav__link">
    transit_skim
  </a>
  
    <nav class="md-nav" aria-label="transit_skim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="md-nav__link">
    TransitSkim
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    TransitModeConfig
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    TransitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-network-components" class="md-nav__link">
    Active Network Components
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emme-wrappers" class="md-nav__link">
    Emme Wrappers
  </a>
  
    <nav class="md-nav" aria-label="Emme Wrappers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme" class="md-nav__link">
    emme
  </a>
  
    <nav class="md-nav" aria-label="emme">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager" class="md-nav__link">
    manager
  </a>
  
    <nav class="md-nav" aria-label="manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager" class="md-nav__link">
    EmmeManager
  </a>
  
    <nav class="md-nav" aria-label="EmmeManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.change_emmebank_dimensions" class="md-nav__link">
    change_emmebank_dimensions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.close_all" class="md-nav__link">
    close_all()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.copy_attr_values" class="md-nav__link">
    copy_attr_values()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.create_project" class="md-nav__link">
    create_project()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.emmebank" class="md-nav__link">
    emmebank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.get_network" class="md-nav__link">
    get_network()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.logbook_trace" class="md-nav__link">
    logbook_trace()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.logbook_write" class="md-nav__link">
    logbook_write()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.modeller" class="md-nav__link">
    modeller()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.project" class="md-nav__link">
    project()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.temp_attributes_and_restore" class="md-nav__link">
    temp_attributes_and_restore()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.tool" class="md-nav__link">
    tool()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix" class="md-nav__link">
    matrix
  </a>
  
    <nav class="md-nav" aria-label="matrix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache" class="md-nav__link">
    MatrixCache
  </a>
  
    <nav class="md-nav" aria-label="MatrixCache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache.clear" class="md-nav__link">
    clear()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache.get_data" class="md-nav__link">
    get_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache.set_data" class="md-nav__link">
    set_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager" class="md-nav__link">
    OMXManager
  </a>
  
    <nav class="md-nav" aria-label="OMXManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.read_hdf5" class="md-nav__link">
    read_hdf5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.write_array" class="md-nav__link">
    write_array()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.write_clipped_array" class="md-nav__link">
    write_clipped_array()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.write_matrices" class="md-nav__link">
    write_matrices()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.write_matrix" class="md-nav__link">
    write_matrix()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator" class="md-nav__link">
    TollChoiceCalculator
  </a>
  
    <nav class="md-nav" aria-label="TollChoiceCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator.calc_exp_util" class="md-nav__link">
    calc_exp_util()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator.mask_non_available" class="md-nav__link">
    mask_non_available()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator.set_omx_manager" class="md-nav__link">
    set_omx_manager()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network" class="md-nav__link">
    network
  </a>
  
    <nav class="md-nav" aria-label="network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator" class="md-nav__link">
    NetworkCalculator
  </a>
  
    <nav class="md-nav" aria-label="NetworkCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator.add_calc" class="md-nav__link">
    add_calc()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    EmmeConfig
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errata" class="md-nav__link">
    Errata
  </a>
  
    <nav class="md-nav" aria-label="Errata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache" class="md-nav__link">
    LogCache
  </a>
  
    <nav class="md-nav" aria-label="LogCache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.clear" class="md-nav__link">
    clear()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.write_cache" class="md-nav__link">
    write_cache()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay" class="md-nav__link">
    LogDisplay
  </a>
  
    <nav class="md-nav" aria-label="LogDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile" class="md-nav__link">
    LogFile
  </a>
  
    <nav class="md-nav" aria-label="LogFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride" class="md-nav__link">
    LogFileLevelOverride
  </a>
  
    <nav class="md-nav" aria-label="LogFileLevelOverride">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.level" class="md-nav__link">
    level
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter" class="md-nav__link">
    LogFormatter
  </a>
  
    <nav class="md-nav" aria-label="LogFormatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.level" class="md-nav__link">
    level
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.decrease_indent" class="md-nav__link">
    decrease_indent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.increase_indent" class="md-nav__link">
    increase_indent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd" class="md-nav__link">
    LogStartEnd
  </a>
  
    <nav class="md-nav" aria-label="LogStartEnd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger" class="md-nav__link">
    Logger
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.debug_enabled" class="md-nav__link">
    debug_enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.trace_enabled" class="md-nav__link">
    trace_enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.clear_msg_cache" class="md-nav__link">
    clear_msg_cache()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.debug" class="md-nav__link">
    debug()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.detail" class="md-nav__link">
    detail()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.error" class="md-nav__link">
    error()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.fatal" class="md-nav__link">
    fatal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.get_logger" class="md-nav__link">
    get_logger()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.info" class="md-nav__link">
    info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_dict" class="md-nav__link">
    log_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_start_end" class="md-nav__link">
    log_start_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_time" class="md-nav__link">
    log_time()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.notify_slack" class="md-nav__link">
    notify_slack()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.status" class="md-nav__link">
    status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.trace" class="md-nav__link">
    trace()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.warn" class="md-nav__link">
    warn()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier" class="md-nav__link">
    SlackNotifier
  </a>
  
    <nav class="md-nav" aria-label="SlackNotifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.post_message" class="md-nav__link">
    post_message()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools" class="md-nav__link">
    tools
  </a>
  
    <nav class="md-nav" aria-label="tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.download_unzip" class="md-nav__link">
    download_unzip()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.interpolate_dfs" class="md-nav__link">
    interpolate_dfs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.parse_num_processors" class="md-nav__link">
    parse_num_processors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.run_process" class="md-nav__link">
    run_process()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.temp_file" class="md-nav__link">
    temp_file()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.examples" class="md-nav__link">
    examples
  </a>
  
    <nav class="md-nav" aria-label="examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.examples.get_example" class="md-nav__link">
    get_example()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Contributing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contributing" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/development/" class="md-nav__link">
        Development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/documentation/" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../examples/">Examples</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/restart_model/" class="md-nav__link">
        Restart Model Run
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/run_model/" class="md-nav__link">
        Run model
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
    <nav class="md-nav" aria-label="Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller" class="md-nav__link">
    controller
  </a>
  
    <nav class="md-nav" aria-label="controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController" class="md-nav__link">
    RunController
  </a>
  
    <nav class="md-nav" aria-label="RunController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.emme_manager" class="md-nav__link">
    emme_manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iter_component" class="md-nav__link">
    iter_component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.iteration" class="md-nav__link">
    iteration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_dir" class="md-nav__link">
    run_dir
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run_iterations" class="md-nav__link">
    run_iterations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.component" class="md-nav__link">
    component()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.controller.RunController.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config" class="md-nav__link">
    config
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="md-nav__link">
    ActiveModeShortestPathSkimConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ActiveModesConfig" class="md-nav__link">
    ActiveModesConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerConfig" class="md-nav__link">
    AirPassengerConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    AirPassengerDemandAggregationConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem" class="md-nav__link">
    ConfigItem
  </a>
  
    <nav class="md-nav" aria-label="ConfigItem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.__getitem__" class="md-nav__link">
    __getitem__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.get" class="md-nav__link">
    get()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ConfigItem.items" class="md-nav__link">
    items()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.__pydantic_model__.maz_skim_period_exists" class="md-nav__link">
    maz_skim_period_exists()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.load_toml" class="md-nav__link">
    load_toml()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.Configuration.maz_skim_period_exists" class="md-nav__link">
    maz_skim_period_exists()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    DemandCountyGroupConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    EmmeConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.GateFactorConfig" class="md-nav__link">
    GateFactorConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayCapClassConfig" class="md-nav__link">
    HighwayCapClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    HighwayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassDemandConfig" class="md-nav__link">
    HighwayClassDemandConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    HighwayConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    HighwayMazToMazConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    HighwayTollsConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    HouseholdConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    InternalExternalConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.LoggingConfig" class="md-nav__link">
    LoggingConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig" class="md-nav__link">
    RunConfig
  </a>
  
    <nav class="md-nav" aria-label="RunConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.__pydantic_model__.end_iteration_gt_start" class="md-nav__link">
    end_iteration_gt_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.__pydantic_model__.start_component_used" class="md-nav__link">
    start_component_used()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="md-nav__link">
    end_iteration_gt_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.RunConfig.start_component_used" class="md-nav__link">
    start_component_used()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.ScenarioConfig" class="md-nav__link">
    ScenarioConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimeOfDaySplitConfig" class="md-nav__link">
    TimeOfDaySplitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TimePeriodConfig" class="md-nav__link">
    TimePeriodConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    TransitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    TransitModeConfig
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitVehicleConfig" class="md-nav__link">
    TransitVehicleConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    TruckConfig
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#base-component" class="md-nav__link">
    Base Component
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component" class="md-nav__link">
    component
  </a>
  
    <nav class="md-nav" aria-label="component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component" class="md-nav__link">
    Component
  </a>
  
    <nav class="md-nav" aria-label="Component">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.controller" class="md-nav__link">
    controller
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.logger" class="md-nav__link">
    logger
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.top_sheet" class="md-nav__link">
    top_sheet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.trace" class="md-nav__link">
    trace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_abs_path" class="md-nav__link">
    get_abs_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.get_emme_scenario" class="md-nav__link">
    get_emme_scenario()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.report_progress" class="md-nav__link">
    report_progress()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.test_component" class="md-nav__link">
    test_component()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.time_period_names" class="md-nav__link">
    time_period_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.verify" class="md-nav__link">
    verify()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.Component.write_top_sheet" class="md-nav__link">
    write_top_sheet()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError" class="md-nav__link">
    FileFormatError
  </a>
  
    <nav class="md-nav" aria-label="FileFormatError">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.component.FileFormatError.__str__" class="md-nav__link">
    __str__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demand-components" class="md-nav__link">
    Demand Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand" class="md-nav__link">
    demand
  </a>
  
    <nav class="md-nav" aria-label="demand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareDemand" class="md-nav__link">
    PrepareDemand
  </a>
  
    <nav class="md-nav" aria-label="PrepareDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareHighwayDemand" class="md-nav__link">
    PrepareHighwayDemand
  </a>
  
    <nav class="md-nav" aria-label="PrepareHighwayDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareHighwayDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.demand.PrepareHighwayDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#household-demand" class="md-nav__link">
    Household Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household" class="md-nav__link">
    household
  </a>
  
    <nav class="md-nav" aria-label="household">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel" class="md-nav__link">
    HouseholdModel
  </a>
  
    <nav class="md-nav" aria-label="HouseholdModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.household.HouseholdModel.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HouseholdConfig" class="md-nav__link">
    HouseholdConfig
  </a>
  
    <nav class="md-nav" aria-label="HouseholdConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#air-passenger-demand" class="md-nav__link">
    Air Passenger Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger" class="md-nav__link">
    air_passenger
  </a>
  
    <nav class="md-nav" aria-label="air_passenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger" class="md-nav__link">
    AirPassenger
  </a>
  
    <nav class="md-nav" aria-label="AirPassenger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="md-nav__link">
    AirPassengerDemandAggregationConfig
  </a>
  
    <nav class="md-nav" aria-label="AirPassengerDemandAggregationConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commercial-demand" class="md-nav__link">
    Commercial Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial" class="md-nav__link">
    commercial
  </a>
  
    <nav class="md-nav" aria-label="commercial">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="md-nav__link">
    CommercialVehicleModel
  </a>
  
    <nav class="md-nav" aria-label="CommercialVehicleModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel--trip-generation" class="md-nav__link">
    Trip generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel--trip-distribution" class="md-nav__link">
    Trip distribution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel--time-of-day" class="md-nav__link">
    Time of day
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel--toll-choice" class="md-nav__link">
    Toll choice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TruckConfig" class="md-nav__link">
    TruckConfig
  </a>
  
    <nav class="md-nav" aria-label="TruckConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inter-regional-demand" class="md-nav__link">
    Inter-regional Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external" class="md-nav__link">
    internal_external
  </a>
  
    <nav class="md-nav" aria-label="internal_external">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal" class="md-nav__link">
    InternalExternal
  </a>
  
    <nav class="md-nav" aria-label="InternalExternal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal--create-daily-demand-growth-forecast" class="md-nav__link">
    Create daily demand (growth forecast)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal--time-of-day-split" class="md-nav__link">
    Time of day split
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal--toll-choice" class="md-nav__link">
    Toll choice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.InternalExternalConfig" class="md-nav__link">
    InternalExternalConfig
  </a>
  
    <nav class="md-nav" aria-label="InternalExternalConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#visitor-demand" class="md-nav__link">
    Visitor Demand
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.demand.visitor" class="md-nav__link">
    visitor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#highway-network-components" class="md-nav__link">
    Highway Network Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network" class="md-nav__link">
    highway_network
  </a>
  
    <nav class="md-nav" aria-label="highway_network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="md-nav__link">
    PrepareNetwork
  </a>
  
    <nav class="md-nav" aria-label="PrepareNetwork">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="md-nav__link">
    validate_inputs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign" class="md-nav__link">
    highway_assign
  </a>
  
    <nav class="md-nav" aria-label="highway_assign">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass" class="md-nav__link">
    AssignmentClass
  </a>
  
    <nav class="md-nav" aria-label="AssignmentClass">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_class_analysis" class="md-nav__link">
    emme_class_analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_highway_class_spec" class="md-nav__link">
    emme_highway_class_spec
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_matrices" class="md-nav__link">
    skim_matrices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_analysis_spec" class="md-nav__link">
    emme_analysis_spec()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_analysis_link_attribute" class="md-nav__link">
    skim_analysis_link_attribute()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="md-nav__link">
    HighwayAssignment
  </a>
  
    <nav class="md-nav" aria-label="HighwayAssignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig" class="md-nav__link">
    HighwayConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="md-nav__link">
    unique_capclass_numbers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.unique_class_names" class="md-nav__link">
    unique_class_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="md-nav__link">
    validate_class_keyword_lists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="md-nav__link">
    validate_class_mode_excluded_links()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayClassConfig" class="md-nav__link">
    HighwayClassConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig" class="md-nav__link">
    HighwayTollsConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayTollsConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="md-nav__link">
    dst_vehicle_group_names_length()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.DemandCountyGroupConfig" class="md-nav__link">
    DemandCountyGroupConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz" class="md-nav__link">
    highway_maz
  </a>
  
    <nav class="md-nav" aria-label="highway_maz">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="md-nav__link">
    AssignMAZSPDemand
  </a>
  
    <nav class="md-nav" aria-label="AssignMAZSPDemand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="md-nav__link">
    SkimMAZCosts
  </a>
  
    <nav class="md-nav" aria-label="SkimMAZCosts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig" class="md-nav__link">
    HighwayMazToMazConfig
  </a>
  
    <nav class="md-nav" aria-label="HighwayMazToMazConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="md-nav__link">
    unique_group_numbers()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transit-network-components" class="md-nav__link">
    Transit Network Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign" class="md-nav__link">
    transit_assign
  </a>
  
    <nav class="md-nav" aria-label="transit_assign">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="md-nav__link">
    TransitAssignment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim" class="md-nav__link">
    transit_skim
  </a>
  
    <nav class="md-nav" aria-label="transit_skim">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="md-nav__link">
    TransitSkim
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig" class="md-nav__link">
    TransitModeConfig
  </a>
  
    <nav class="md-nav" aria-label="TransitModeConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__" class="md-nav__link">
    __pydantic_model__
  </a>
  
    <nav class="md-nav" aria-label="__pydantic_model__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.__pydantic_model__.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="md-nav__link">
    in_vehicle_perception_factor_valid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="md-nav__link">
    speed_miles_per_hour_valid()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.TransitConfig" class="md-nav__link">
    TransitConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-network-components" class="md-nav__link">
    Active Network Components
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emme-wrappers" class="md-nav__link">
    Emme Wrappers
  </a>
  
    <nav class="md-nav" aria-label="Emme Wrappers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme" class="md-nav__link">
    emme
  </a>
  
    <nav class="md-nav" aria-label="emme">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager" class="md-nav__link">
    manager
  </a>
  
    <nav class="md-nav" aria-label="manager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager" class="md-nav__link">
    EmmeManager
  </a>
  
    <nav class="md-nav" aria-label="EmmeManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.change_emmebank_dimensions" class="md-nav__link">
    change_emmebank_dimensions()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.close_all" class="md-nav__link">
    close_all()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.copy_attr_values" class="md-nav__link">
    copy_attr_values()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.create_project" class="md-nav__link">
    create_project()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.emmebank" class="md-nav__link">
    emmebank()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.get_network" class="md-nav__link">
    get_network()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.logbook_trace" class="md-nav__link">
    logbook_trace()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.logbook_write" class="md-nav__link">
    logbook_write()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.modeller" class="md-nav__link">
    modeller()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.project" class="md-nav__link">
    project()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.temp_attributes_and_restore" class="md-nav__link">
    temp_attributes_and_restore()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.manager.EmmeManager.tool" class="md-nav__link">
    tool()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix" class="md-nav__link">
    matrix
  </a>
  
    <nav class="md-nav" aria-label="matrix">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache" class="md-nav__link">
    MatrixCache
  </a>
  
    <nav class="md-nav" aria-label="MatrixCache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache.clear" class="md-nav__link">
    clear()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache.get_data" class="md-nav__link">
    get_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.MatrixCache.set_data" class="md-nav__link">
    set_data()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager" class="md-nav__link">
    OMXManager
  </a>
  
    <nav class="md-nav" aria-label="OMXManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.read" class="md-nav__link">
    read()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.read_hdf5" class="md-nav__link">
    read_hdf5()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.write_array" class="md-nav__link">
    write_array()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.write_clipped_array" class="md-nav__link">
    write_clipped_array()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.write_matrices" class="md-nav__link">
    write_matrices()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.OMXManager.write_matrix" class="md-nav__link">
    write_matrix()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator" class="md-nav__link">
    TollChoiceCalculator
  </a>
  
    <nav class="md-nav" aria-label="TollChoiceCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator.calc_exp_util" class="md-nav__link">
    calc_exp_util()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator.mask_non_available" class="md-nav__link">
    mask_non_available()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.matrix.TollChoiceCalculator.set_omx_manager" class="md-nav__link">
    set_omx_manager()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network" class="md-nav__link">
    network
  </a>
  
    <nav class="md-nav" aria-label="network">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator" class="md-nav__link">
    NetworkCalculator
  </a>
  
    <nav class="md-nav" aria-label="NetworkCalculator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator.add_calc" class="md-nav__link">
    add_calc()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.emme.network.NetworkCalculator.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.config.EmmeConfig" class="md-nav__link">
    EmmeConfig
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#errata" class="md-nav__link">
    Errata
  </a>
  
    <nav class="md-nav" aria-label="Errata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache" class="md-nav__link">
    LogCache
  </a>
  
    <nav class="md-nav" aria-label="LogCache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.clear" class="md-nav__link">
    clear()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogCache.write_cache" class="md-nav__link">
    write_cache()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay" class="md-nav__link">
    LogDisplay
  </a>
  
    <nav class="md-nav" aria-label="LogDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogDisplay.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile" class="md-nav__link">
    LogFile
  </a>
  
    <nav class="md-nav" aria-label="LogFile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFile.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride" class="md-nav__link">
    LogFileLevelOverride
  </a>
  
    <nav class="md-nav" aria-label="LogFileLevelOverride">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.level" class="md-nav__link">
    level
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFileLevelOverride.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter" class="md-nav__link">
    LogFormatter
  </a>
  
    <nav class="md-nav" aria-label="LogFormatter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.level" class="md-nav__link">
    level
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.decrease_indent" class="md-nav__link">
    decrease_indent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.increase_indent" class="md-nav__link">
    increase_indent()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogFormatter.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd" class="md-nav__link">
    LogStartEnd
  </a>
  
    <nav class="md-nav" aria-label="LogStartEnd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__call__" class="md-nav__link">
    __call__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.LogStartEnd.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger" class="md-nav__link">
    Logger
  </a>
  
    <nav class="md-nav" aria-label="Logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.debug_enabled" class="md-nav__link">
    debug_enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.trace_enabled" class="md-nav__link">
    trace_enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__enter__" class="md-nav__link">
    __enter__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__exit__" class="md-nav__link">
    __exit__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.clear_msg_cache" class="md-nav__link">
    clear_msg_cache()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.debug" class="md-nav__link">
    debug()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.detail" class="md-nav__link">
    detail()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.error" class="md-nav__link">
    error()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.fatal" class="md-nav__link">
    fatal()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.get_logger" class="md-nav__link">
    get_logger()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.info" class="md-nav__link">
    info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log" class="md-nav__link">
    log()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_dict" class="md-nav__link">
    log_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_start_end" class="md-nav__link">
    log_start_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.log_time" class="md-nav__link">
    log_time()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.notify_slack" class="md-nav__link">
    notify_slack()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.status" class="md-nav__link">
    status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.trace" class="md-nav__link">
    trace()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.Logger.warn" class="md-nav__link">
    warn()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier" class="md-nav__link">
    SlackNotifier
  </a>
  
    <nav class="md-nav" aria-label="SlackNotifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.logger.SlackNotifier.post_message" class="md-nav__link">
    post_message()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools" class="md-nav__link">
    tools
  </a>
  
    <nav class="md-nav" aria-label="tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.download_unzip" class="md-nav__link">
    download_unzip()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.interpolate_dfs" class="md-nav__link">
    interpolate_dfs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.parse_num_processors" class="md-nav__link">
    parse_num_processors()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.run_process" class="md-nav__link">
    run_process()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.tools.temp_file" class="md-nav__link">
    temp_file()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tm2py.examples" class="md-nav__link">
    examples
  </a>
  
    <nav class="md-nav" aria-label="examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tm2py.examples.get_example" class="md-nav__link">
    get_example()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/bayareametro/tm2py/edit/master/docs/api.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="api-documentation">API Documentation<a class="headerlink" href="#api-documentation" title="Permanent link"> </a></h1>
<h2 id="controller">Controller<a class="headerlink" href="#controller" title="Permanent link"> </a></h2>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.controller" class="doc doc-heading">
        <code>tm2py.controller</code>



<a href="#tm2py.controller" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>RunController - model operation controller.</p>
<p>Main interface to start a TM2PY model run. Provide one or more configuration
files in .toml format (by convention a scenario.toml and a model.toml)</p>
<p>Typical usage example:
  from tm2py.controller import RunController
  controller = RunController(
    [&ldquo;scenario.toml&rdquo;, &ldquo;model.toml&rdquo;])
  controller.run()</p>
<p>Or from the command-line:
  <code>python &lt;path&gt;/tm2py/tm2py/controller.py s scenario.toml m model.toml</code></p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="tm2py.controller.RunController" class="doc doc-heading">
        <code>
RunController        </code>



<a href="#tm2py.controller.RunController" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Main operational interface for model runs.</p>
<p>Provide one or more config files in TOML (*.toml) format, and a run directory.
If the run directory is not provided the root directory of the first config_file is used.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition emme_manager">
<p class="admonition-title">EmmeManager object for centralized Emme-related (highway and</p>
<p>transit assignments and skims) utilities.</p>
</div>
<div class="admonition complete_components">
<p class="admonition-title">list of components which have completed, tuple of</p>
<p>(iteration, name, Component object)</p>
</div>
</div>
<p>Internal properties:
    _emme_manager: EmmeManager object, cached on first access
    _iteration: current iteration
    _component: current running / last run Component
    _component_name: name of the current / last run component
    _queued_components: list of iteration, name, Component</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/controller.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">RunController</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Main operational interface for model runs.</span>

<span class="sd">    Provide one or more config files in TOML (*.toml) format, and a run directory.</span>
<span class="sd">    If the run directory is not provided the root directory of the first config_file is used.</span>

<span class="sd">    Properties:</span>
<span class="sd">        config: root Configuration object</span>
<span class="sd">        logger: logger object</span>
<span class="sd">        top_sheet: placeholder for top sheet functionality (not implemented yet)</span>
<span class="sd">        trace: placeholder for trace functionality (not implemented yet)</span>
<span class="sd">        run_dir: root run directory for the model run</span>
<span class="sd">        iteration: current running (or last started) iteration</span>
<span class="sd">        component: current running (or last started) Component object</span>
<span class="sd">        emme_manager: EmmeManager object for centralized Emme-related (highway and</span>
<span class="sd">            transit assignments and skims) utilities.</span>
<span class="sd">        complete_components: list of components which have completed, tuple of</span>
<span class="sd">            (iteration, name, Component object)</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _emme_manager: EmmeManager object, cached on first access</span>
<span class="sd">        _iteration: current iteration</span>
<span class="sd">        _component: current running / last run Component</span>
<span class="sd">        _component_name: name of the current / last run component</span>
<span class="sd">        _queued_components: list of iteration, name, Component</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">run_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for the RunController.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_file (Union[List[str], str], optional): Configuration TOML filenames or list</span>
<span class="sd">                of files. Defaults to None.</span>
<span class="sd">            run_dir (str, optional): Model run base directory. Defaults to where first listed</span>
<span class="sd">                config file is located.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">config_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">config_file</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">run_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">run_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">run_dir</span><span class="p">):</span>
            <span class="n">run_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">run_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span> <span class="o">=</span> <span class="n">run_dir</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load_toml</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
        <span class="c1"># NOTE: Logger opens log file on __enter__ (in run), not ready for logging yet</span>
        <span class="c1"># Logger uses self.config.logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_sheet</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># mapping from defined names referenced in config to Component objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">run_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The root run directory of the model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">run_iterations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;List of iterations for this model run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_iteration</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Current iteration of model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iter_component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Tuple of the current iteration and component name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span>

    <span class="k">def</span> <span class="nf">component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Current component of model.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeManager</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Cached Emme Manager object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_emme_manager</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span>

    <span class="k">def</span> <span class="nf">_init_emme_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize Emme manager, start Emme desktop App, and initialize Modeller.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="n">EmmeManager</span><span class="p">()</span>
        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span><span class="o">.</span><span class="n">project</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">project_path</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Initialize Modeller to use Emme assignment tools and other APIs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span><span class="o">.</span><span class="n">modeller</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Main interface to run model.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_inputs</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">!=</span> <span class="n">iteration</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">iteration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">component</span>
            <span class="n">component</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_queue_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add components per iteration to queue according to input Config.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="s2">&quot;Components already queued, returning without re-queuing.&quot;</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_c_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">initial_components</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># Queue components which are run for each iteration</span>
        <span class="n">_iteration_x_components</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_iterations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">global_iteration_components</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_iteration</span><span class="p">,</span> <span class="n">_c_name</span> <span class="ow">in</span> <span class="n">_iteration_x_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="n">_iteration</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># Queue components which are run after final iteration</span>
        <span class="n">_finalizer_iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">end_iteration</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">c_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">final_components</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_component_to_queue</span><span class="p">(</span><span class="n">_finalizer_iteration</span><span class="p">,</span> <span class="n">_c_name</span><span class="p">)</span>

        <span class="c1"># If start_component specified, remove things before its first occurance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span><span class="p">:</span>
            <span class="n">_queued_c_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">]</span>
            <span class="n">_start_c_index</span> <span class="o">=</span> <span class="n">_queued_c_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="o">.</span><span class="n">start_component</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">[</span><span class="n">_start_c_index</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_add_component_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add component to queue (self._queued_components), first validating its inputs.</span>

<span class="sd">        Args:</span>
<span class="sd">            iteration (int): iteration to add component to.</span>
<span class="sd">            component_name (Component): Component to add to queue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">component_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span><span class="p">:</span>
            <span class="n">_component</span><span class="o">.</span><span class="n">validate_inputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">component_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span><span class="p">,</span> <span class="n">component_name</span><span class="p">,</span> <span class="n">_component</span><span class="p">))</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.controller.RunController.emme_manager" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_manager</span><span class="p">:</span> <span class="n">EmmeManager</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.controller.RunController.emme_manager" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Cached Emme Manager object.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.controller.RunController.iter_component" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">iter_component</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.controller.RunController.iter_component" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Tuple of the current iteration and component name.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.controller.RunController.iteration" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.controller.RunController.iteration" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Current iteration of model.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.controller.RunController.run_dir" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run_dir</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.controller.RunController.run_dir" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>The root run directory of the model run.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.controller.RunController.run_iterations" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run_iterations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.controller.RunController.run_iterations" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>List of iterations for this model run.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="tm2py.controller.RunController.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.controller.RunController.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for the RunController.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>config_file</code></td>
        <td><code>Union[List[str], str]</code></td>
        <td><p>Configuration TOML filenames or list
of files. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>run_dir</code></td>
        <td><code>str</code></td>
        <td><p>Model run base directory. Defaults to where first listed
config file is located.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/controller.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">run_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for the RunController.</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file (Union[List[str], str], optional): Configuration TOML filenames or list</span>
<span class="sd">            of files. Defaults to None.</span>
<span class="sd">        run_dir (str, optional): Model run base directory. Defaults to where first listed</span>
<span class="sd">            config file is located.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">config_file</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">run_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">config_file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">run_dir</span><span class="p">):</span>
        <span class="n">run_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">run_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_dir</span> <span class="o">=</span> <span class="n">run_dir</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Configuration</span><span class="o">.</span><span class="n">load_toml</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
    <span class="c1"># NOTE: Logger opens log file on __enter__ (in run), not ready for logging yet</span>
    <span class="c1"># Logger uses self.config.logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">top_sheet</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># mapping from defined names referenced in config to Component objects</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">component_cls_map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validated_components</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emme_manager</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_component_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.controller.RunController.component" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.controller.RunController.component" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Current component of model.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/controller.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Current component of model.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.controller.RunController.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.controller.RunController.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Main interface to run model.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/controller.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main interface to run model.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validate_inputs</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queued_components</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">!=</span> <span class="n">iteration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iteration</span> <span class="o">=</span> <span class="n">iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_component</span> <span class="o">=</span> <span class="n">component</span>
        <span class="n">component</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completed_components</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iteration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">component</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>

<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link"> </a></h2>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.config" class="doc doc-heading">
        <code>tm2py.config</code>



<a href="#tm2py.config" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Config implementation and schema.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.ActiveModeShortestPathSkimConfig" class="doc doc-heading">
        <code>
ActiveModeShortestPathSkimConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.ActiveModeShortestPathSkimConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Active mode skim entry.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ActiveModeShortestPathSkimConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Active mode skim entry.&quot;&quot;&quot;</span>

    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">roots</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">output</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">max_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.ActiveModesConfig" class="doc doc-heading">
        <code>
ActiveModesConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.ActiveModesConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Active Mode skim parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ActiveModesConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Active Mode skim parameters.&quot;&quot;&quot;</span>

    <span class="n">emme_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">shortest_path_skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ActiveModeShortestPathSkimConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.AirPassengerConfig" class="doc doc-heading">
        <code>
AirPassengerConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.AirPassengerConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Air passenger model parameters.</p>
<p>Properties</p>
<div class="admonition reference_start_year">
<p class="admonition-title">base start year for input demand tables</p>
<p>used to calculate the linear interpolation, as well as
in the file name template {year}_{direction}{airport}.csv</p>
</div>
<div class="admonition reference_end_year">
<p class="admonition-title">end year for input demand tables</p>
<p>used to calculate the linear interpolation, as well as
in the file name template {year}_{direction}{airport}.csv</p>
</div>
<div class="admonition airport_names">
<p class="admonition-title">list of one or more airport names / codes as used in</p>
<p>the input file names</p>
</div>
<div class="admonition demand_aggregation">
<p class="admonition-title">specification of aggregation of by-access mode</p>
<p>demand to highway class demand</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AirPassengerConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Air passenger model parameters.</span>

<span class="sd">    Properties</span>

<span class="sd">    highway_demand_file: output OMX file</span>
<span class="sd">    input_demand_folder: location to find the input</span>
<span class="sd">    reference_start_year: base start year for input demand tables</span>
<span class="sd">        used to calculate the linear interpolation, as well as</span>
<span class="sd">        in the file name template {year}_{direction}{airport}.csv</span>
<span class="sd">    reference_end_year: end year for input demand tables</span>
<span class="sd">        used to calculate the linear interpolation, as well as</span>
<span class="sd">        in the file name template {year}_{direction}{airport}.csv</span>
<span class="sd">    airport_names: list of one or more airport names / codes as used in</span>
<span class="sd">        the input file names</span>
<span class="sd">    demand_aggregation: specification of aggregation of by-access mode</span>
<span class="sd">        demand to highway class demand</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">input_demand_folder</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reference_start_year</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reference_end_year</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">airport_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">demand_aggregation</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">AirPassengerDemandAggregationConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.AirPassengerDemandAggregationConfig" class="doc doc-heading">
        <code>
AirPassengerDemandAggregationConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Air passenger demand aggregation input parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition result_class_name">
<p class="admonition-title">name used in the output OMX matrix names, note</p>
<p>that this should match the expected naming convention in the
HighwayClassDemandConfig name(s)</p>
</div>
<div class="admonition src_group_name">
<p class="admonition-title">name used for the class group in the input columns</p>
<p>for the trip tables,</p>
</div>
<div class="admonition access_modes">
<p class="admonition-title">list of names used for the access modes in the input</p>
<p>columns for the trip tables</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AirPassengerDemandAggregationConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Air passenger demand aggregation input parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        result_class_name: name used in the output OMX matrix names, note</span>
<span class="sd">            that this should match the expected naming convention in the</span>
<span class="sd">            HighwayClassDemandConfig name(s)</span>
<span class="sd">        src_group_name: name used for the class group in the input columns</span>
<span class="sd">            for the trip tables,</span>
<span class="sd">        access_modes: list of names used for the access modes in the input</span>
<span class="sd">            columns for the trip tables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result_class_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">src_group_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.ConfigItem" class="doc doc-heading">
        <code>
ConfigItem            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#tm2py.config.ConfigItem" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Base class to add partial dict-like interface to tm2py model configuration.</p>
<p>Allow use of .items() [&ldquo;X&rdquo;] and .get(&ldquo;X&rdquo;) .to_dict() from configuration.</p>
<p>Not to be constructed directly. To be used a mixin for dataclasses
representing config schema.
Do not use &ldquo;get&rdquo; &ldquo;to_dict&rdquo;, or &ldquo;items&rdquo; for key names.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ConfigItem</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class to add partial dict-like interface to tm2py model configuration.</span>

<span class="sd">    Allow use of .items() [&quot;X&quot;] and .get(&quot;X&quot;) .to_dict() from configuration.</span>

<span class="sd">    Not to be constructed directly. To be used a mixin for dataclasses</span>
<span class="sd">    representing config schema.</span>
<span class="sd">    Do not use &quot;get&quot; &quot;to_dict&quot;, or &quot;items&quot; for key names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The sub-config objects in config.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the value for key if key is in the dictionary, else default.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.ConfigItem.__getitem__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.config.ConfigItem.__getitem__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get item for config. D[key] -&gt; D[key] if key in D, else raise KeyError.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.ConfigItem.get" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#tm2py.config.ConfigItem.get" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Return the value for key if key is in the dictionary, else default.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the value for key if key is in the dictionary, else default.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.ConfigItem.items" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.config.ConfigItem.items" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>The sub-config objects in config.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The sub-config objects in config.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.Configuration" class="doc doc-heading">
        <code>
Configuration            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.Configuration" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Configuration: root of the model configuration.&quot;&quot;&quot;</span>

    <span class="n">scenario</span><span class="p">:</span> <span class="n">ScenarioConfig</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">RunConfig</span>
    <span class="n">time_periods</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TimePeriodConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">household</span><span class="p">:</span> <span class="n">HouseholdConfig</span>
    <span class="n">air_passenger</span><span class="p">:</span> <span class="n">AirPassengerConfig</span>
    <span class="n">internal_external</span><span class="p">:</span> <span class="n">InternalExternalConfig</span>
    <span class="n">truck</span><span class="p">:</span> <span class="n">TruckConfig</span>
    <span class="n">active_modes</span><span class="p">:</span> <span class="n">ActiveModesConfig</span>
    <span class="n">highway</span><span class="p">:</span> <span class="n">HighwayConfig</span>
    <span class="n">transit</span><span class="p">:</span> <span class="n">TransitConfig</span>
    <span class="n">emme</span><span class="p">:</span> <span class="n">EmmeConfig</span>
    <span class="n">logging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoggingConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">LoggingConfig</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_toml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="sd">&quot;&quot;&quot;Load configuration from .toml files(s).</span>

<span class="sd">        Normally the config is split into a scenario_config.toml file and a</span>
<span class="sd">        model_config.toml file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: a valid system path to a TOML format config file or list of paths</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Configuration object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">path_item</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path_item</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">maz_skim_period_exists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;time_periods&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">time_period_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">])</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span> <span class="ow">in</span> <span class="n">time_period_names</span>
            <span class="p">),</span> <span class="s2">&quot;maz_to_maz -&gt; skim_period -&gt; name not found in time_periods list&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  <div class="doc doc-object doc-class">



<h5 id="tm2py.config.Configuration.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.Configuration.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Configuration</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Configuration: root of the model configuration.&quot;&quot;&quot;</span>

    <span class="n">scenario</span><span class="p">:</span> <span class="n">ScenarioConfig</span>
    <span class="n">run</span><span class="p">:</span> <span class="n">RunConfig</span>
    <span class="n">time_periods</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TimePeriodConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">household</span><span class="p">:</span> <span class="n">HouseholdConfig</span>
    <span class="n">air_passenger</span><span class="p">:</span> <span class="n">AirPassengerConfig</span>
    <span class="n">internal_external</span><span class="p">:</span> <span class="n">InternalExternalConfig</span>
    <span class="n">truck</span><span class="p">:</span> <span class="n">TruckConfig</span>
    <span class="n">active_modes</span><span class="p">:</span> <span class="n">ActiveModesConfig</span>
    <span class="n">highway</span><span class="p">:</span> <span class="n">HighwayConfig</span>
    <span class="n">transit</span><span class="p">:</span> <span class="n">TransitConfig</span>
    <span class="n">emme</span><span class="p">:</span> <span class="n">EmmeConfig</span>
    <span class="n">logging</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoggingConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">LoggingConfig</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_toml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
        <span class="sd">&quot;&quot;&quot;Load configuration from .toml files(s).</span>

<span class="sd">        Normally the config is split into a scenario_config.toml file and a</span>
<span class="sd">        model_config.toml file.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: a valid system path to a TOML format config file or list of paths</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Configuration object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">path_item</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path_item</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">maz_skim_period_exists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;time_periods&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">time_period_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">])</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span> <span class="ow">in</span> <span class="n">time_period_names</span>
            <span class="p">),</span> <span class="s2">&quot;maz_to_maz -&gt; skim_period -&gt; name not found in time_periods list&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">























  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.Configuration.__pydantic_model__.maz_skim_period_exists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">maz_skim_period_exists</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.Configuration.__pydantic_model__.maz_skim_period_exists" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate highway.maz_to_maz.skim_period refers to a valid period.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">maz_skim_period_exists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;time_periods&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">time_period_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span> <span class="ow">in</span> <span class="n">time_period_names</span>
        <span class="p">),</span> <span class="s2">&quot;maz_to_maz -&gt; skim_period -&gt; name not found in time_periods list&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.Configuration.load_toml" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">load_toml</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.Configuration.load_toml" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Load configuration from .toml files(s).</p>
<p>Normally the config is split into a scenario_config.toml file and a
model_config.toml file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[str, List[str]]</code></td>
        <td><p>a valid system path to a TOML format config file or list of paths</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>A Configuration object</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load_toml</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]):</span>
    <span class="sd">&quot;&quot;&quot;Load configuration from .toml files(s).</span>

<span class="sd">    Normally the config is split into a scenario_config.toml file and a</span>
<span class="sd">    model_config.toml file.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: a valid system path to a TOML format config file or list of paths</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Configuration object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">path_item</span> <span class="ow">in</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">_merge_dicts</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">_load_toml</span><span class="p">(</span><span class="n">path_item</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.Configuration.maz_skim_period_exists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">maz_skim_period_exists</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.Configuration.maz_skim_period_exists" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate highway.maz_to_maz.skim_period refers to a valid period.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;highway&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">maz_skim_period_exists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate highway.maz_to_maz.skim_period refers to a valid period.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;time_periods&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">time_period_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;time_periods&quot;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span> <span class="ow">in</span> <span class="n">time_period_names</span>
        <span class="p">),</span> <span class="s2">&quot;maz_to_maz -&gt; skim_period -&gt; name not found in time_periods list&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.DemandCountyGroupConfig" class="doc doc-heading">
        <code>
DemandCountyGroupConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.DemandCountyGroupConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Grouping of counties for assignment and demand files.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<p>number: id number for this group, must be unique
counties: list of one or more county names</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DemandCountyGroupConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grouping of counties for assignment and demand files.</span>

<span class="sd">    Properties:</span>
<span class="sd">        number: id number for this group, must be unique</span>
<span class="sd">        counties: list of one or more county names</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">counties</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">COUNTY_NAMES</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.EmmeConfig" class="doc doc-heading">
        <code>
EmmeConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.EmmeConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Emme-specific parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition all_day_scenario_id">
<p class="admonition-title">scenario ID to use for all day</p>
<p>(initial imported) scenario with all time period data</p>
</div>
<div class="admonition num_processors">
<p class="admonition-title">the number of processors to use in Emme procedures,</p>
<p>either as an integer, or value MAX, MAX-N. Typically recommend
using MAX-1 (on desktop systems) or MAX-2 (on servers with many
logical processors) to leave capacity for background / other tasks.</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EmmeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Emme-specific parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        all_day_scenario_id: scenario ID to use for all day</span>
<span class="sd">            (initial imported) scenario with all time period data</span>
<span class="sd">        project_path: relative path to Emme desktop project (.emp)</span>
<span class="sd">        highway_database_path: relative path to highway Emmebank</span>
<span class="sd">        active_database_paths: list of relative paths to active mode Emmebanks</span>
<span class="sd">        transit_database_path: relative path to transit Emmebank</span>
<span class="sd">        num_processors: the number of processors to use in Emme procedures,</span>
<span class="sd">            either as an integer, or value MAX, MAX-N. Typically recommend</span>
<span class="sd">            using MAX-1 (on desktop systems) or MAX-2 (on servers with many</span>
<span class="sd">            logical processors) to leave capacity for background / other tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_day_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">highway_database_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">active_database_paths</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">transit_database_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">num_processors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?i)^MAX$|^MAX[\s]*-[\s]*[\d]+$|^[\d]+$&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.GateFactorConfig" class="doc doc-heading">
        <code>
GateFactorConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.GateFactorConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Mapping of gateway (zone ordering ID) to factor value.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">GateFactorConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mapping of gateway (zone ordering ID) to factor value.&quot;&quot;&quot;</span>

    <span class="n">zone_index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayCapClassConfig" class="doc doc-heading">
        <code>
HighwayCapClassConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayCapClassConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway link capacity and speed (&lsquo;capclass&rsquo;) index entry.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition critical_speed">
<p class="admonition-title">value for critical speed (Ja) used in Akcelik</p>
<p>type functions</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayCapClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway link capacity and speed (&#39;capclass&#39;) index entry.</span>

<span class="sd">    Properties:</span>
<span class="sd">        capclass: cross index for link @capclass lookup</span>
<span class="sd">        capacity: value for link capacity, PCE / hour</span>
<span class="sd">        free_flow_speed: value for link free flow speed, miles / hour</span>
<span class="sd">        critical_speed: value for critical speed (Ja) used in Akcelik</span>
<span class="sd">            type functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">capclass</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">capacity</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">free_flow_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">critical_speed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayClassConfig" class="doc doc-heading">
        <code>
HighwayClassConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayClassConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway assignment class definition.</p>
<p>Note that excluded_links, skims and toll attribute names include
vehicle groups (&ldquo;{vehicle}&rdquo;) which reference the list of
highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).
The default example model config uses:
&ldquo;da&rdquo;, &ldquo;sr2&rdquo;, &ldquo;sr3&rdquo;, &ldquo;vsm&rdquo;, sml&rdquo;, &ldquo;med&rdquo;, &ldquo;lrg&rdquo;</p>
<p>Example single class config:
    name = &ldquo;da&rdquo;
    description= &ldquo;drive alone&rdquo;
    mode_code= &ldquo;d&rdquo;
    [[highway.classes.demand]]
        source = &ldquo;household&rdquo;
        name = &ldquo;SOV_GP_{period}&rdquo;
    [[highway.classes.demand]]
        source = &ldquo;air_passenger&rdquo;
        name = &ldquo;da&rdquo;
    [[highway.classes.demand]]
        source = &ldquo;internal_external&rdquo;
        name = &ldquo;da&rdquo;
    excluded_links = [&ldquo;is_toll_da&rdquo;, &ldquo;is_sr2&rdquo;],
    value_of_time = 18.93,  # $ / hr
    operating_cost_per_mile = 17.23,  # cents / mile
    toll = [&ldquo;@bridgetoll_da&rdquo;]
    skims = [&ldquo;time&rdquo;, &ldquo;dist&rdquo;, &ldquo;freeflowtime&rdquo;, &ldquo;bridgetoll_da&rdquo;],</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition name">
<p class="admonition-title">short (up to 10 character) unique reference name for the class.</p>
<p>used in attribute and matrix names</p>
</div>
<div class="admonition mode_code">
<p class="admonition-title">single character mode, used to generate link.modes to</p>
<p>identify subnetwork, generated from &ldquo;excluded_links&rdquo; keywords.
Should be unique in list of classes, unless multiple classes
have identical excluded_links specification. Cannot be the
same as used for highway.maz_to_maz.mode_code.</p>
</div>
<div class="admonition demand">
<p class="admonition-title">list of OMX file and matrix keyname references,</p>
<p>see HighwayClassDemandConfig</p>
</div>
<div class="admonition excluded_links">
<p class="admonition-title">list of keywords to identify links to exclude from</p>
<p>this class&rsquo; available subnetwork (generate link.modes)
Options are:
    - &ldquo;is_sr&rdquo;: is reserved for shared ride (@useclass in 2,3)
    - &ldquo;is_sr2&rdquo;: is reserved for shared ride 2+ (@useclass == 2)
    - &ldquo;is_sr3&rdquo;: is reserved for shared ride 3+ (@useclass == 3)
    - &ldquo;is_auto_only&rdquo;: is reserved for autos (non-truck) (@useclass != 1)
    - &ldquo;is_toll_{vehicle}&rdquo;: has a value (non-bridge) toll for the {vehicle} toll group</p>
</div>
<div class="admonition toll">
<p class="admonition-title">list of additional toll cost link attribute (values stored in cents),</p>
<p>summed, one of &ldquo;@bridgetoll_{vehicle}&rdquo;, &ldquo;@valuetoll_{vehicle}&rdquo;</p>
</div>
<div class="admonition pce">
<p class="admonition-title">optional, passenger car equivalent to convert assigned demand in</p>
<p>PCE units to vehicles for total assigned vehicle calculations</p>
</div>
<div class="admonition skims">
<p class="admonition-title">list of skim matrices to generate</p>
<p>Options are:
    &ldquo;time&rdquo;: pure travel time in minutes
    &ldquo;dist&rdquo;: distance in miles
    &ldquo;hovdist&rdquo;: distance on HOV facilities (is_sr2 or is_sr3)
    &ldquo;tolldist&rdquo;: distance on toll facilities
        (@tollbooth &gt; highway.tolls.tollbooth_start_index)
    &ldquo;freeflowtime&rdquo;: free flow travel time in minutes
    &ldquo;bridgetoll_{vehicle}&rdquo;: bridge tolls, {vehicle} refers to toll group
    &ldquo;valuetoll_{vehicle}&rdquo;: other, non-bridge tolls, {vehicle} refers to toll group</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment class definition.</span>

<span class="sd">    Note that excluded_links, skims and toll attribute names include</span>
<span class="sd">    vehicle groups (&quot;{vehicle}&quot;) which reference the list of</span>
<span class="sd">    highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).</span>
<span class="sd">    The default example model config uses:</span>
<span class="sd">    &quot;da&quot;, &quot;sr2&quot;, &quot;sr3&quot;, &quot;vsm&quot;, sml&quot;, &quot;med&quot;, &quot;lrg&quot;</span>

<span class="sd">    Example single class config:</span>
<span class="sd">        name = &quot;da&quot;</span>
<span class="sd">        description= &quot;drive alone&quot;</span>
<span class="sd">        mode_code= &quot;d&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;household&quot;</span>
<span class="sd">            name = &quot;SOV_GP_{period}&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;air_passenger&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;internal_external&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        excluded_links = [&quot;is_toll_da&quot;, &quot;is_sr2&quot;],</span>
<span class="sd">        value_of_time = 18.93,  # $ / hr</span>
<span class="sd">        operating_cost_per_mile = 17.23,  # cents / mile</span>
<span class="sd">        toll = [&quot;@bridgetoll_da&quot;]</span>
<span class="sd">        skims = [&quot;time&quot;, &quot;dist&quot;, &quot;freeflowtime&quot;, &quot;bridgetoll_da&quot;],</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: short (up to 10 character) unique reference name for the class.</span>
<span class="sd">            used in attribute and matrix names</span>
<span class="sd">        description: longer text used in attribute and matrix descriptions</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords.</span>
<span class="sd">            Should be unique in list of classes, unless multiple classes</span>
<span class="sd">            have identical excluded_links specification. Cannot be the</span>
<span class="sd">            same as used for highway.maz_to_maz.mode_code.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        demand: list of OMX file and matrix keyname references,</span>
<span class="sd">            see HighwayClassDemandConfig</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            this class&#39; available subnetwork (generate link.modes)</span>
<span class="sd">            Options are:</span>
<span class="sd">                - &quot;is_sr&quot;: is reserved for shared ride (@useclass in 2,3)</span>
<span class="sd">                - &quot;is_sr2&quot;: is reserved for shared ride 2+ (@useclass == 2)</span>
<span class="sd">                - &quot;is_sr3&quot;: is reserved for shared ride 3+ (@useclass == 3)</span>
<span class="sd">                - &quot;is_auto_only&quot;: is reserved for autos (non-truck) (@useclass != 1)</span>
<span class="sd">                - &quot;is_toll_{vehicle}&quot;: has a value (non-bridge) toll for the {vehicle} toll group</span>
<span class="sd">        toll: list of additional toll cost link attribute (values stored in cents),</span>
<span class="sd">            summed, one of &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">        toll_factor: optional, factor to apply to toll values in cost calculation</span>
<span class="sd">        pce: optional, passenger car equivalent to convert assigned demand in</span>
<span class="sd">            PCE units to vehicles for total assigned vehicle calculations</span>
<span class="sd">        skims: list of skim matrices to generate</span>
<span class="sd">            Options are:</span>
<span class="sd">                &quot;time&quot;: pure travel time in minutes</span>
<span class="sd">                &quot;dist&quot;: distance in miles</span>
<span class="sd">                &quot;hovdist&quot;: distance on HOV facilities (is_sr2 or is_sr3)</span>
<span class="sd">                &quot;tolldist&quot;: distance on toll facilities</span>
<span class="sd">                    (@tollbooth &gt; highway.tolls.tollbooth_start_index)</span>
<span class="sd">                &quot;freeflowtime&quot;: free flow travel time in minutes</span>
<span class="sd">                &quot;bridgetoll_{vehicle}&quot;: bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">                &quot;valuetoll_{vehicle}&quot;: other, non-bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pce</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Note that excluded_links, skims, and tolls validated under HighwayConfig to include</span>
    <span class="c1"># highway.toll.dst_vehicle_group_names names</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassDemandConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">































  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayClassDemandConfig" class="doc doc-heading">
        <code>
HighwayClassDemandConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayClassDemandConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway class input source for demand.</p>
<p>Used to specify where to find related demand file for this
highway class. Multiple</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition source">
<p class="admonition-title">reference name of the component section for the<p>source &ldquo;highway_demand_file&rdquo; location, one of:
&ldquo;household&rdquo;, &ldquo;air_passenger&rdquo;, &ldquo;internal_external&rdquo;, &ldquo;truck&rdquo;</p>
</p>
</div>
<div class="admonition name">
<p class="admonition-title">name of matrix in the OMX file, can include &ldquo;{period}&rdquo;<p>placeholder</p>
</p>
</div>
<div class="admonition factor">
<p class="admonition-title">optional, multiplicative factor to generate PCEs from<p>trucks or convert person-trips to vehicle-trips for HOVs</p>
</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayClassDemandConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway class input source for demand.</span>

<span class="sd">    Used to specify where to find related demand file for this</span>
<span class="sd">    highway class. Multiple</span>

<span class="sd">    Properties:</span>
<span class="sd">        source: reference name of the component section for the</span>
<span class="sd">                source &quot;highway_demand_file&quot; location, one of:</span>
<span class="sd">                &quot;household&quot;, &quot;air_passenger&quot;, &quot;internal_external&quot;, &quot;truck&quot;</span>
<span class="sd">        name: name of matrix in the OMX file, can include &quot;{period}&quot;</span>
<span class="sd">                placeholder</span>
<span class="sd">        factor: optional, multiplicative factor to generate PCEs from</span>
<span class="sd">                trucks or convert person-trips to vehicle-trips for HOVs</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;household&quot;</span><span class="p">,</span> <span class="s2">&quot;air_passenger&quot;</span><span class="p">,</span> <span class="s2">&quot;internal_external&quot;</span><span class="p">,</span> <span class="s2">&quot;truck&quot;</span><span class="p">]</span>
    <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayConfig" class="doc doc-heading">
        <code>
HighwayConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway assignment and skims parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition generic_highway_mode_code">
<p class="admonition-title">single character unique mode ID for entire</p>
<p>highway network (no excluded_links)</p>
</div>
<div class="admonition area_type_buffer_dist_miles">
<p class="admonition-title">used to in calculation to categorize link @areatype</p>
<p>The area type is determined based on the average density of nearby
(within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</p>
</div>
<div class="admonition maz_to_maz">
<p class="admonition-title">maz-to-maz shortest path assignment and skim specification,</p>
<p>see HighwayMazToMazConfig</p>
</div>
<div class="admonition classes">
<p class="admonition-title">highway assignment multi-class setup and skim specification,</p>
<p>see HighwayClassConfig</p>
</div>
<div class="admonition capclass_lookup">
<p class="admonition-title">index cross-reference table from the link @capclass value</p>
<p>to the free-flow speed, capacity, and critical speed values</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skims parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        generic_highway_mode_code: single character unique mode ID for entire</span>
<span class="sd">            highway network (no excluded_links)</span>
<span class="sd">        relative_gap: target relative gap stopping criteria</span>
<span class="sd">        max_iterations: maximum iterations stopping criteria</span>
<span class="sd">        area_type_buffer_dist_miles: used to in calculation to categorize link @areatype</span>
<span class="sd">            The area type is determined based on the average density of nearby</span>
<span class="sd">            (within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</span>
<span class="sd">        output_skim_path: relative path template for output skims in OMX format</span>
<span class="sd">        tolls: input toll specification, see HighwayTollsConfig</span>
<span class="sd">        maz_to_maz: maz-to-maz shortest path assignment and skim specification,</span>
<span class="sd">            see HighwayMazToMazConfig</span>
<span class="sd">        classes: highway assignment multi-class setup and skim specification,</span>
<span class="sd">            see HighwayClassConfig</span>
<span class="sd">        capclass_lookup: index cross-reference table from the link @capclass value</span>
<span class="sd">            to the free-flow speed, capacity, and critical speed values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generic_highway_mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">relative_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">area_type_buffer_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls</span><span class="p">:</span> <span class="n">HighwayTollsConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">maz_to_maz</span><span class="p">:</span> <span class="n">HighwayMazToMazConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">capclass_lookup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayCapClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
        <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
        <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># maz_to_maz.mode_code must be unique</span>
            <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
            <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
            <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
                <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
        <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
        <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
            <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
            <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
            <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
        <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
            <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
                <span class="n">available_link_sets</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  <div class="doc doc-object doc-class">



<h5 id="tm2py.config.HighwayConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skims parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        generic_highway_mode_code: single character unique mode ID for entire</span>
<span class="sd">            highway network (no excluded_links)</span>
<span class="sd">        relative_gap: target relative gap stopping criteria</span>
<span class="sd">        max_iterations: maximum iterations stopping criteria</span>
<span class="sd">        area_type_buffer_dist_miles: used to in calculation to categorize link @areatype</span>
<span class="sd">            The area type is determined based on the average density of nearby</span>
<span class="sd">            (within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</span>
<span class="sd">        output_skim_path: relative path template for output skims in OMX format</span>
<span class="sd">        tolls: input toll specification, see HighwayTollsConfig</span>
<span class="sd">        maz_to_maz: maz-to-maz shortest path assignment and skim specification,</span>
<span class="sd">            see HighwayMazToMazConfig</span>
<span class="sd">        classes: highway assignment multi-class setup and skim specification,</span>
<span class="sd">            see HighwayClassConfig</span>
<span class="sd">        capclass_lookup: index cross-reference table from the link @capclass value</span>
<span class="sd">            to the free-flow speed, capacity, and critical speed values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generic_highway_mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">relative_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">area_type_buffer_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls</span><span class="p">:</span> <span class="n">HighwayTollsConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">maz_to_maz</span><span class="p">:</span> <span class="n">HighwayMazToMazConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">capclass_lookup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayCapClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
        <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
        <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># maz_to_maz.mode_code must be unique</span>
            <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
            <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
            <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
                <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
        <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
        <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
            <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
            <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
            <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
        <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
            <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
                <span class="n">available_link_sets</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




















  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.HighwayConfig.__pydantic_model__.unique_capclass_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_capclass_numbers</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_capclass_numbers" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate list of capclass_lookup has unique .capclass values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
    <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.HighwayConfig.__pydantic_model__.unique_class_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_class_names</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_class_names" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .name values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.HighwayConfig.__pydantic_model__.validate_class_keyword_lists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_keyword_lists</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_keyword_lists" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate classes .skims, .toll, and .excluded_links values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
    <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
    <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
        <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
        <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
        <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
    <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
        <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
            <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
            <span class="n">available_link_sets</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.HighwayConfig.__pydantic_model__.validate_class_mode_excluded_links" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_mode_excluded_links" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .mode_code or .excluded_links match.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
    <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
    <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># maz_to_maz.mode_code must be unique</span>
        <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
        <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
        <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
            <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
            <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
        <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayConfig.unique_capclass_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_capclass_numbers</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate list of capclass_lookup has unique .capclass values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
    <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayConfig.unique_class_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_class_names</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.unique_class_names" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .name values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayConfig.validate_class_keyword_lists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_keyword_lists</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate classes .skims, .toll, and .excluded_links values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
    <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
    <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
        <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
        <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
        <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
    <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
        <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
            <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
            <span class="n">available_link_sets</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .mode_code or .excluded_links match.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
    <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
    <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># maz_to_maz.mode_code must be unique</span>
        <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
        <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
        <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
            <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
            <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
        <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayMazToMazConfig" class="doc doc-heading">
        <code>
HighwayMazToMazConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayMazToMazConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway MAZ to MAZ shortest path assignment and skim parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition mode_code">
<p class="admonition-title">single character mode, used to generate link.modes to</p>
<p>identify subnetwork, generated from &ldquo;excluded_links&rdquo; keywords,
plus including MAZ connectors.</p>
</div>
<div class="admonition max_skim_cost">
<p class="admonition-title">max shortest path distance to search for MAZ-to-MAZ</p>
<p>skims, in generized costs units (includes operating cost
converted to minutes)</p>
</div>
<div class="admonition excluded_links">
<p class="admonition-title">list of keywords to identify links to exclude from</p>
<p>MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</p>
</div>
<div class="admonition demand_file">
<p class="admonition-title">relative path to find the input demand files</p>
<p>can have use a placeholder for {period} and {number}, where the
{period} is the time_period.name (see TimePeriodConfig)
and {number} is the demand_count_groups[].number
(see DemandCountyGroupConfig)
e.g.: auto_{period}<em>MAZ_AUTO</em>{number}_{period}.omx</p>
</div>
<div class="admonition skim_period">
<p class="admonition-title">period name to use for the shotest path skims, must</p>
<p>match one of the names listed in the time_periods</p>
</div>
<p>output_skim_file: relative path to resulting MAZ-to-MAZ skims</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayMazToMazConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway MAZ to MAZ shortest path assignment and skim parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords,</span>
<span class="sd">            plus including MAZ connectors.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        max_skim_cost: max shortest path distance to search for MAZ-to-MAZ</span>
<span class="sd">            skims, in generized costs units (includes operating cost</span>
<span class="sd">            converted to minutes)</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</span>
<span class="sd">        demand_file: relative path to find the input demand files</span>
<span class="sd">            can have use a placeholder for {period} and {number}, where the</span>
<span class="sd">            {period} is the time_period.name (see TimePeriodConfig)</span>
<span class="sd">            and {number} is the demand_count_groups[].number</span>
<span class="sd">            (see DemandCountyGroupConfig)</span>
<span class="sd">            e.g.: auto_{period}_MAZ_AUTO_{number}_{period}.omx</span>
<span class="sd">        demand_county_groups: List of demand county names and</span>
<span class="sd">        skim_period: period name to use for the shotest path skims, must</span>
<span class="sd">            match one of the names listed in the time_periods</span>
<span class="sd">        output_skim_file: relative path to resulting MAZ-to-MAZ skims</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_skim_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_county_groups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DemandCountyGroupConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skim_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  <div class="doc doc-object doc-class">



<h5 id="tm2py.config.HighwayMazToMazConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayMazToMazConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway MAZ to MAZ shortest path assignment and skim parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords,</span>
<span class="sd">            plus including MAZ connectors.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        max_skim_cost: max shortest path distance to search for MAZ-to-MAZ</span>
<span class="sd">            skims, in generized costs units (includes operating cost</span>
<span class="sd">            converted to minutes)</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</span>
<span class="sd">        demand_file: relative path to find the input demand files</span>
<span class="sd">            can have use a placeholder for {period} and {number}, where the</span>
<span class="sd">            {period} is the time_period.name (see TimePeriodConfig)</span>
<span class="sd">            and {number} is the demand_count_groups[].number</span>
<span class="sd">            (see DemandCountyGroupConfig)</span>
<span class="sd">            e.g.: auto_{period}_MAZ_AUTO_{number}_{period}.omx</span>
<span class="sd">        demand_county_groups: List of demand county names and</span>
<span class="sd">        skim_period: period name to use for the shotest path skims, must</span>
<span class="sd">            match one of the names listed in the time_periods</span>
<span class="sd">        output_skim_file: relative path to resulting MAZ-to-MAZ skims</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_skim_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_county_groups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DemandCountyGroupConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skim_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




















  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.HighwayMazToMazConfig.__pydantic_model__.unique_group_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_group_numbers</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__.unique_group_numbers" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate list of demand_county_groups has unique .number values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_group_numbers</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate list of demand_county_groups has unique .number values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayTollsConfig" class="doc doc-heading">
        <code>
HighwayTollsConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayTollsConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway assignment and skim input tolls and related parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition tollbooth_start_index">
<p class="admonition-title">tollbooth separates links with &ldquo;bridge&rdquo; tolls</p>
<p>(index &lt; this value) vs. &ldquo;value&rdquo; tolls. These toll attributes
can then be referenced separately in the highway.classes[].tolls
list</p>
</div>
<div class="admonition src_vehicle_group_names">
<p class="admonition-title">name used for the vehicle toll CSV column IDs,</p>
<p>of the form &ldquo;toll{period}_{vehicle}&rdquo;</p>
</div>
<div class="admonition dst_vehicle_group_names">
<p class="admonition-title">list of names used in destination network</p>
<p>for the corresponding vehicle group. Length of list must be the same
as src_vehicle_group_names. Used for toll related attributes and
resulting skim matrices. Cross-referenced in list of highway.classes[],
valid keywords for:
    excluded_links: &ldquo;is_toll_{vehicle}&rdquo;
    tolls: &ldquo;@bridgetoll_{vehicle}&rdquo;, &ldquo;@valuetoll_{vehicle}&rdquo;
    skims: &ldquo;bridgetoll_{vehicle}&rdquo;, &ldquo;valuetoll_{vehicle}&rdquo;</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayTollsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skim input tolls and related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        file_path: source relative file path for the highway tolls index CSV</span>
<span class="sd">        tollbooth_start_index: tollbooth separates links with &quot;bridge&quot; tolls</span>
<span class="sd">            (index &lt; this value) vs. &quot;value&quot; tolls. These toll attributes</span>
<span class="sd">            can then be referenced separately in the highway.classes[].tolls</span>
<span class="sd">            list</span>
<span class="sd">        src_vehicle_group_names: name used for the vehicle toll CSV column IDs,</span>
<span class="sd">            of the form &quot;toll{period}_{vehicle}&quot;</span>
<span class="sd">        dst_vehicle_group_names: list of names used in destination network</span>
<span class="sd">            for the corresponding vehicle group. Length of list must be the same</span>
<span class="sd">            as src_vehicle_group_names. Used for toll related attributes and</span>
<span class="sd">            resulting skim matrices. Cross-referenced in list of highway.classes[],</span>
<span class="sd">            valid keywords for:</span>
<span class="sd">                excluded_links: &quot;is_toll_{vehicle}&quot;</span>
<span class="sd">                tolls: &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">                skims: &quot;bridgetoll_{vehicle}&quot;, &quot;valuetoll_{vehicle}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tollbooth_start_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">dst_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h5 id="tm2py.config.HighwayTollsConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayTollsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skim input tolls and related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        file_path: source relative file path for the highway tolls index CSV</span>
<span class="sd">        tollbooth_start_index: tollbooth separates links with &quot;bridge&quot; tolls</span>
<span class="sd">            (index &lt; this value) vs. &quot;value&quot; tolls. These toll attributes</span>
<span class="sd">            can then be referenced separately in the highway.classes[].tolls</span>
<span class="sd">            list</span>
<span class="sd">        src_vehicle_group_names: name used for the vehicle toll CSV column IDs,</span>
<span class="sd">            of the form &quot;toll{period}_{vehicle}&quot;</span>
<span class="sd">        dst_vehicle_group_names: list of names used in destination network</span>
<span class="sd">            for the corresponding vehicle group. Length of list must be the same</span>
<span class="sd">            as src_vehicle_group_names. Used for toll related attributes and</span>
<span class="sd">            resulting skim matrices. Cross-referenced in list of highway.classes[],</span>
<span class="sd">            valid keywords for:</span>
<span class="sd">                excluded_links: &quot;is_toll_{vehicle}&quot;</span>
<span class="sd">                tolls: &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">                skims: &quot;bridgetoll_{vehicle}&quot;, &quot;valuetoll_{vehicle}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tollbooth_start_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">dst_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">















  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.HighwayTollsConfig.__pydantic_model__.dst_vehicle_group_names_length" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__.dst_vehicle_group_names_length" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate dst_vehicle_group_names has same length as src_vehicle_group_names.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate dst_vehicle_group_names has same length as src_vehicle_group_names.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HouseholdConfig" class="doc doc-heading">
        <code>
HouseholdConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HouseholdConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Household (residents) model parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HouseholdConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Household (residents) model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">transit_demand_file</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.InternalExternalConfig" class="doc doc-heading">
        <code>
InternalExternalConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.InternalExternalConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Internal &lt;-&gt; External model parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">InternalExternalConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Internal &lt;-&gt; External model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">input_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reference_year</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">toll_choice_time_coefficient</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">shared_ride_2_toll_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">shared_ride_3_toll_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">time_of_day_split</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeOfDaySplitConfig</span><span class="p">]</span>
    <span class="n">annual_growth_rate</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">GateFactorConfig</span><span class="p">]</span>
    <span class="n">special_factor_adjust</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">GateFactorConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span>
    <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">































  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.LoggingConfig" class="doc doc-heading">
        <code>
LoggingConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.LoggingConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Logging parameters. TODO.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition display_level">
<p class="admonition-title">filter level for messages to show in console, default</p>
<p>is STATUS</p>
</div>
<div class="admonition run_file_path">
<p class="admonition-title">relative path to high-level log file for the model run,</p>
<p>default is log_run.txt</p>
</div>
<div class="admonition run_file_level">
<p class="admonition-title">filter level for messages recorded in the run log,</p>
<p>default is INFO</p>
</div>
<div class="admonition log_file_path">
<p class="admonition-title">relative path to general log file with more detail</p>
<p>than the run_file, default is log.txt</p>
</div>
<div class="admonition log_file_level">
<p class="admonition-title">optional, filter level for messages recorded in the</p>
<p>standard log, default is DETAIL</p>
</div>
<div class="admonition log_on_error_file_path">
<p class="admonition-title">relative path to use for fallback log message cache</p>
<p>on error, default is log_on_error.txt</p>
</div>
<div class="admonition use_emme_logbook">
<p class="admonition-title">if True log messages recorded in the standard log file will</p>
<p>also be recorded in the Emme logbook, default is True</p>
</div>
<div class="admonition iter_component_level">
<p class="admonition-title">tuple of tuples of iteration, component name, log level.</p>
<p>Used to override log levels (log_file_level) for debugging and recording
more detail in the log_file_path.
Example: [ [2, &ldquo;highway&rdquo;, &ldquo;TRACE&rdquo;] ] to record all messages
during the highway component run at iteration 2.</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LoggingConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Logging parameters. TODO.</span>

<span class="sd">    Properties:</span>
<span class="sd">        display_level: filter level for messages to show in console, default</span>
<span class="sd">            is STATUS</span>
<span class="sd">        run_file_path: relative path to high-level log file for the model run,</span>
<span class="sd">            default is log_run.txt</span>
<span class="sd">        run_file_level: filter level for messages recorded in the run log,</span>
<span class="sd">            default is INFO</span>
<span class="sd">        log_file_path: relative path to general log file with more detail</span>
<span class="sd">            than the run_file, default is log.txt</span>
<span class="sd">        log_file_level: optional, filter level for messages recorded in the</span>
<span class="sd">            standard log, default is DETAIL</span>
<span class="sd">        log_on_error_file_path: relative path to use for fallback log message cache</span>
<span class="sd">            on error, default is log_on_error.txt</span>
<span class="sd">        notify_slack: if true notify_slack messages will be sent, default is False</span>
<span class="sd">        use_emme_logbook: if True log messages recorded in the standard log file will</span>
<span class="sd">            also be recorded in the Emme logbook, default is True</span>
<span class="sd">        iter_component_level: tuple of tuples of iteration, component name, log level.</span>
<span class="sd">            Used to override log levels (log_file_level) for debugging and recording</span>
<span class="sd">            more detail in the log_file_path.</span>
<span class="sd">            Example: [ [2, &quot;highway&quot;, &quot;TRACE&quot;] ] to record all messages</span>
<span class="sd">            during the highway component run at iteration 2.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">display_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
    <span class="n">run_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;log_run.txt&quot;</span><span class="p">)</span>
    <span class="n">run_file_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
    <span class="n">log_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;log.txt&quot;</span><span class="p">)</span>
    <span class="n">log_file_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LogLevel</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
    <span class="n">log_on_error_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;log_on_error.txt&quot;</span><span class="p">)</span>

    <span class="n">notify_slack</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">use_emme_logbook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">iter_component_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ComponentNames</span><span class="p">,</span> <span class="n">LogLevel</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">





























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.RunConfig" class="doc doc-heading">
        <code>
RunConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.RunConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Model run parameters.</p>
<p>Note that the components will be executed in the order listed.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition start_component">
<p class="admonition-title">name of component to start with, will skip components</p>
<p>list prior to this component</p>
</div>
<div class="admonition global_iteration_components">
<p class="admonition-title">list of component to run at every subsequent</p>
<p>iteration (max(1, start_iteration) to end_iteration), in order.</p>
</div>
<p>final_components: list of components to run after final iteration, in order</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">RunConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Model run parameters.</span>

<span class="sd">    Note that the components will be executed in the order listed.</span>

<span class="sd">    Properties:</span>
<span class="sd">        start_iteration: start iteration number, 0 to include initial_components</span>
<span class="sd">        end_iteration: final iteration number</span>
<span class="sd">        start_component: name of component to start with, will skip components</span>
<span class="sd">            list prior to this component</span>
<span class="sd">        initial_components: list of components to run as initial (0) iteration, in order</span>
<span class="sd">        global_iteration_components: list of component to run at every subsequent</span>
<span class="sd">            iteration (max(1, start_iteration) to end_iteration), in order.</span>
<span class="sd">        final_components: list of components to run after final iteration, in order</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">initial_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">global_iteration_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">final_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">start_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">end_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">start_component</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="n">EmptyString</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">end_iteration_gt_start</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate end_iteration greater than start_iteration.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;must be greater than start_iteration&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">start_component_used</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate start_component is listed in *_components.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;start_component&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;initial_components&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;initial_components&quot;</span><span class="p">]</span>
                    <span class="p">),</span> <span class="s2">&quot;must be one of the components listed in initial_components&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;global_iteration_components&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;global_iteration_components&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="s2">&quot;must be one of the components listed in global_iteration_components&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">













  <div class="doc doc-object doc-class">



<h5 id="tm2py.config.RunConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.RunConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">RunConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Model run parameters.</span>

<span class="sd">    Note that the components will be executed in the order listed.</span>

<span class="sd">    Properties:</span>
<span class="sd">        start_iteration: start iteration number, 0 to include initial_components</span>
<span class="sd">        end_iteration: final iteration number</span>
<span class="sd">        start_component: name of component to start with, will skip components</span>
<span class="sd">            list prior to this component</span>
<span class="sd">        initial_components: list of components to run as initial (0) iteration, in order</span>
<span class="sd">        global_iteration_components: list of component to run at every subsequent</span>
<span class="sd">            iteration (max(1, start_iteration) to end_iteration), in order.</span>
<span class="sd">        final_components: list of components to run after final iteration, in order</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">initial_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">global_iteration_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">final_components</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">start_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">end_iteration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">start_component</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ComponentNames</span><span class="p">,</span> <span class="n">EmptyString</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">end_iteration_gt_start</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate end_iteration greater than start_iteration.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;must be greater than start_iteration&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">start_component_used</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate start_component is listed in *_components.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;start_component&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;initial_components&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;initial_components&quot;</span><span class="p">]</span>
                    <span class="p">),</span> <span class="s2">&quot;must be one of the components listed in initial_components&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;global_iteration_components&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;global_iteration_components&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="s2">&quot;must be one of the components listed in global_iteration_components&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.RunConfig.__pydantic_model__.end_iteration_gt_start" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">end_iteration_gt_start</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.RunConfig.__pydantic_model__.end_iteration_gt_start" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate end_iteration greater than start_iteration.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">end_iteration_gt_start</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate end_iteration greater than start_iteration.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;must be greater than start_iteration&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.RunConfig.__pydantic_model__.start_component_used" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">start_component_used</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.RunConfig.__pydantic_model__.start_component_used" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate start_component is listed in *_components.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">start_component_used</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate start_component is listed in *_components.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;start_component&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;initial_components&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;initial_components&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="s2">&quot;must be one of the components listed in initial_components&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;global_iteration_components&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;global_iteration_components&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;must be one of the components listed in global_iteration_components&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.RunConfig.end_iteration_gt_start" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">end_iteration_gt_start</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.RunConfig.end_iteration_gt_start" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate end_iteration greater than start_iteration.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;end_iteration&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">end_iteration_gt_start</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate end_iteration greater than start_iteration.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;must be greater than start_iteration&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.RunConfig.start_component_used" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">start_component_used</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.RunConfig.start_component_used" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate start_component is listed in *_components.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;start_component&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">start_component_used</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate start_component is listed in *_components.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;start_component&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">if</span> <span class="s2">&quot;start_iteration&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;start_iteration&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;initial_components&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;initial_components&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="s2">&quot;must be one of the components listed in initial_components&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;global_iteration_components&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;global_iteration_components&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;must be one of the components listed in global_iteration_components&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.ScenarioConfig" class="doc doc-heading">
        <code>
ScenarioConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.ScenarioConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Scenario related parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition verify">
<p class="admonition-title">optional, default False if specified as True components will run</p>
<p>additional post-process verify step to validate results / outputs
(not implemented yet)</p>
</div>
<div class="admonition maz_landuse_file">
<p class="admonition-title">relative path to maz_landuse_file used by multiple</p>
<p>components</p>
</div>
<p>year: model year, must be at least 2005</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ScenarioConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Scenario related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        verify: optional, default False if specified as True components will run</span>
<span class="sd">            additional post-process verify step to validate results / outputs</span>
<span class="sd">            (not implemented yet)</span>
<span class="sd">        maz_landuse_file: relative path to maz_landuse_file used by multiple</span>
<span class="sd">            components</span>
<span class="sd">        year: model year, must be at least 2005</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maz_landuse_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span>
    <span class="n">verify</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.TimeOfDaySplitConfig" class="doc doc-heading">
        <code>
TimeOfDaySplitConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TimeOfDaySplitConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Time of day demand split for productions and attractions.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TimeOfDaySplitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Time of day demand split for productions and attractions.&quot;&quot;&quot;</span>

    <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">production</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">attraction</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.TimePeriodConfig" class="doc doc-heading">
        <code>
TimePeriodConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TimePeriodConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Time time period entry.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition highway_capacity_factor">
<p class="admonition-title">factor to use to multiple the per-hour</p>
<p>capacites in the highway network</p>
</div>
<div class="admonition emme_scenario_id">
<p class="admonition-title">scenario ID to use for Emme per-period</p>
<p>assignment (highway and transit) scenarios</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TimePeriodConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Time time period entry.</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: name of the time period, up to four characters</span>
<span class="sd">        length_hours: length of the time period in hours</span>
<span class="sd">        highway_capacity_factor: factor to use to multiple the per-hour</span>
<span class="sd">            capacites in the highway network</span>
<span class="sd">        emme_scenario_id: scenario ID to use for Emme per-period</span>
<span class="sd">            assignment (highway and transit) scenarios</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">length_hours</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">highway_capacity_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">emme_scenario_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.TransitConfig" class="doc doc-heading">
        <code>
TransitConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TransitConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Transit assignment parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit assignment parameters.&quot;&quot;&quot;</span>

    <span class="n">modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitModeConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">vehicles</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitVehicleConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

    <span class="n">apply_msa_demand</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">effective_headway_source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">initial_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">initial_boarding_penalty</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_boarding_penalty</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_transfers</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fares_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fare_matrix_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fare_max_transfer_distance_miles</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">use_fares</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">override_connector_times</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">input_connector_access_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">input_connector_egress_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_stop_usage_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">








































  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.TransitModeConfig" class="doc doc-heading">
        <code>
TransitModeConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Transit mode definition (see also mode in the Emme API).</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitModeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit mode definition (see also mode in the Emme API).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;WALK&quot;</span><span class="p">,</span> <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;EGRESS&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCAL&quot;</span><span class="p">,</span> <span class="s2">&quot;PREMIUM&quot;</span><span class="p">]</span>
    <span class="n">assign_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="n">mode_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">in_vehicle_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">speed_miles_per_hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">













  <div class="doc doc-object doc-class">



<h5 id="tm2py.config.TransitModeConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitModeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit mode definition (see also mode in the Emme API).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;WALK&quot;</span><span class="p">,</span> <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;EGRESS&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCAL&quot;</span><span class="p">,</span> <span class="s2">&quot;PREMIUM&quot;</span><span class="p">]</span>
    <span class="n">assign_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="n">mode_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">in_vehicle_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">speed_miles_per_hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.TransitModeConfig.__pydantic_model__.in_vehicle_perception_factor_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.__pydantic_model__.in_vehicle_perception_factor_valid" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.config.TransitModeConfig.__pydantic_model__.speed_miles_per_hour_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.__pydantic_model__.speed_miles_per_hour_valid" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.TransitVehicleConfig" class="doc doc-heading">
        <code>
TransitVehicleConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TransitVehicleConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Transit vehicle definition (see also transit vehicle in the Emme API).</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitVehicleConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit vehicle definition (see also transit vehicle in the Emme API).&quot;&quot;&quot;</span>

    <span class="n">vehicle_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">auto_equivalent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">seated_capacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">total_capacity</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.TruckConfig" class="doc doc-heading">
        <code>
TruckConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TruckConfig" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Truck model parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TruckConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Truck model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">k_factors_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">friction_factors_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">toll_choice_time_coefficient</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_balance_iterations</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">max_balance_relative_error</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




























  </div>

    </div>

  </div>







  </div>

    </div>

  </div>

<p><strong>Configurations for each component are listed with those components</strong></p>
<h2 id="components">Components<a class="headerlink" href="#components" title="Permanent link"> </a></h2>
<h3 id="base-component">Base Component<a class="headerlink" href="#base-component" title="Permanent link"> </a></h3>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.component" class="doc doc-heading">
        <code>tm2py.components.component</code>



<a href="#tm2py.components.component" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Root component ABC.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.component.Component" class="doc doc-heading">
        <code>
Component            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#tm2py.components.component.Component" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Base component class for tm2py top-level inheritance.</p>

<p><strong>Examples:</strong></p>
    
      <p>::
    class MyComponent(Component):</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code>def __init__(self, controller):
    super().__init__(controller)
    self._parameter = None

def run(self):
    self._step1()
    self._step2()

def _step1(self):
    pass

def _step2(self):
    pass
</code></pre></div></td></tr></table></div>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Component</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base component class for tm2py top-level inheritance.</span>

<span class="sd">    Example:</span>
<span class="sd">    ::</span>
<span class="sd">        class MyComponent(Component):</span>

<span class="sd">        def __init__(self, controller):</span>
<span class="sd">            super().__init__(controller)</span>
<span class="sd">            self._parameter = None</span>

<span class="sd">        def run(self):</span>
<span class="sd">            self._step1()</span>
<span class="sd">            self._step2()</span>

<span class="sd">        def _step1(self):</span>
<span class="sd">            pass</span>

<span class="sd">        def _step2(self):</span>
<span class="sd">            pass</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model component template/abstract base class.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to the run controller object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parent controller.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span>

    <span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the absolute path from the root run directory given a relative path.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emmebank_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeScenario</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the Emme scenario object from the Emmebank at emmebank_path for the time_period ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            emmebank_path: valid Emmebank path, absolute or relative to root run directory</span>
<span class="sd">            time_period: valid time_period ID</span>

<span class="sd">        Returns</span>
<span class="sd">            Emme Scenario object (see Emme API Reference)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">):</span>
            <span class="n">emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
        <span class="n">emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
        <span class="n">scenario_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">tp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">emme_scenario_id</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">}[</span>
            <span class="n">time_period</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">scenario_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to configuration settings loaded from config files.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to top sheet.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">top_sheet</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to logger.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">logger</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reference to trace.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate inputs are correct at model initiation, raise on error.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run model component.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write progress to log file.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_component</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run stand-alone component test.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">write_top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write key outputs to the model top sheet.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Verify component outputs / results.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return input time_period name or names and return list of time_period names.</span>

<span class="sd">        Returns: list of string names of time periods</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.components.component.Component.config" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">config</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.components.component.Component.config" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Reference to configuration settings loaded from config files.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.components.component.Component.controller" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">controller</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.components.component.Component.controller" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Parent controller.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.components.component.Component.logger" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">logger</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.components.component.Component.logger" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Reference to logger.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.components.component.Component.top_sheet" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">top_sheet</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.components.component.Component.top_sheet" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Reference to top sheet.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.components.component.Component.trace" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">trace</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.components.component.Component.trace" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Reference to trace.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.component.Component.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Model component template/abstract base class.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>Reference to the run controller object.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Model component template/abstract base class.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to the run controller object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_controller</span> <span class="o">=</span> <span class="n">controller</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.get_abs_path" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.get_abs_path" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Get the absolute path from the root run directory given a relative path.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the absolute path from the root run directory given a relative path.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.get_emme_scenario" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emmebank_path</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.get_emme_scenario" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Get the Emme scenario object from the Emmebank at emmebank_path for the time_period ID.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>emmebank_path</code></td>
        <td><code>str</code></td>
        <td><p>valid Emmebank path, absolute or relative to root run directory</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>time_period</code></td>
        <td><code>str</code></td>
        <td><p>valid time_period ID</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>      <p>Returns
    Emme Scenario object (see Emme API Reference)</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emmebank_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeScenario</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the Emme scenario object from the Emmebank at emmebank_path for the time_period ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        emmebank_path: valid Emmebank path, absolute or relative to root run directory</span>
<span class="sd">        time_period: valid time_period ID</span>

<span class="sd">    Returns</span>
<span class="sd">        Emme Scenario object (see Emme API Reference)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">):</span>
        <span class="n">emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
    <span class="n">emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="n">emmebank_path</span><span class="p">)</span>
    <span class="n">scenario_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">tp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">emme_scenario_id</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">}[</span>
        <span class="n">time_period</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">scenario_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.report_progress" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.report_progress" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Write progress to log file.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write progress to log file.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Run model component.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run model component.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.test_component" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">test_component</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.test_component" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Run stand-alone component test.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_component</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run stand-alone component test.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.time_period_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.time_period_names" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Return input time_period name or names and return list of time_period names.</p>
<p>Returns: list of string names of time periods</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">time_period_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return input time_period name or names and return list of time_period names.</span>

<span class="sd">    Returns: list of string names of time periods</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">time</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.validate_inputs" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate inputs are correct at model initiation, raise on error.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate inputs are correct at model initiation, raise on error.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.verify" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.verify" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Verify component outputs / results.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Verify component outputs / results.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.Component.write_top_sheet" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">write_top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.component.Component.write_top_sheet" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Write key outputs to the model top sheet.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">write_top_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write key outputs to the model top sheet.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.component.FileFormatError" class="doc doc-heading">
        <code>
FileFormatError            (<span title="Exception">Exception</span>)
        </code>



<a href="#tm2py.components.component.FileFormatError" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Exception raised when a file is not in the expected format.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">FileFormatError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception raised when a file is not in the expected format.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exception for invalid file formats.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String representation for FileFormatError.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s2"> is not a valid format.&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.FileFormatError.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.component.FileFormatError.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Exception for invalid file formats.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exception for invalid file formats.&quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">f</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.component.FileFormatError.__str__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.component.FileFormatError.__str__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>String representation for FileFormatError.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/component.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;String representation for FileFormatError.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="si">}</span><span class="s2"> is not a valid format.&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>

<h3 id="demand-components">Demand Components<a class="headerlink" href="#demand-components" title="Permanent link"> </a></h3>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.demand" class="doc doc-heading">
        <code>tm2py.components.demand.demand</code>



<a href="#tm2py.components.demand.demand" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Demand loading from OMX to Emme database.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.demand.PrepareDemand" class="doc doc-heading">
        <code>
PrepareDemand            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>, <span title="abc.ABC">ABC</span>)
        </code>



<a href="#tm2py.components.demand.demand.PrepareDemand" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Abstract base class to import and average demand.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/demand.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareDemand</span><span class="p">(</span><span class="n">Component</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract base class to import and average demand.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for PrepareDemand class.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for the current run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">omx_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">demand</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redim_demand</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">demand</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_redim_demand</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
        <span class="n">_shape</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">_shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">num_zones</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">demand</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">demand</span>

    <span class="c1"># Disable too many arguments recommendation</span>
    <span class="c1"># pylint: disable=R0913</span>
    <span class="k">def</span> <span class="nf">_save_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">demand</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">apply_msa</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="n">msa_iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">apply_msa</span> <span class="ow">or</span> <span class="n">msa_iteration</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">available_matrix_identifier</span><span class="p">(</span><span class="s2">&quot;FULL&quot;</span><span class="p">)</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
                <span class="n">matrix</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">matrix</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;error averaging demand: matrix </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
            <span class="n">prev_demand</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get_numpy_data</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">prev_demand</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">msa_iteration</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">demand</span> <span class="o">-</span> <span class="n">prev_demand</span><span class="p">)</span>

        <span class="n">matrix</span><span class="o">.</span><span class="n">set_numpy_data</span><span class="p">(</span><span class="n">demand</span><span class="p">,</span> <span class="n">scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_zero_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">zero_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="s1">&#39;ms&quot;zero&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zero_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ident</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">available_matrix_identifier</span><span class="p">(</span><span class="s2">&quot;SCALAR&quot;</span><span class="p">)</span>
            <span class="n">zero_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
            <span class="n">zero_matrix</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;zero&quot;</span>
            <span class="n">zero_matrix</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;zero demand matrix&quot;</span>
        <span class="n">zero_matrix</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.demand.PrepareDemand.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.demand.demand.PrepareDemand.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for PrepareDemand class.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>Run controller for the current run.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/demand.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for PrepareDemand class.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for the current run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.demand.PrepareHighwayDemand" class="doc doc-heading">
        <code>
PrepareHighwayDemand            (<a class="autorefs autorefs-internal" title="tm2py.components.demand.demand.PrepareDemand" href="#tm2py.components.demand.demand.PrepareDemand">PrepareDemand</a>)
        </code>



<a href="#tm2py.components.demand.demand.PrepareHighwayDemand" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Import and average highway demand.</p>
<p>Demand is imported from OMX files based on reference file paths and OMX
matrix names in highway assignment config (highway.classes).
The demand is average using MSA with the current demand matrices
(in the Emmebank) if the controller.iteration &gt; 1.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>parent RunController object</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/demand.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareHighwayDemand</span><span class="p">(</span><span class="n">PrepareDemand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import and average highway demand.</span>

<span class="sd">    Demand is imported from OMX files based on reference file paths and OMX</span>
<span class="sd">    matrix names in highway assignment config (highway.classes).</span>
<span class="sd">    The demand is average using MSA with the current demand matrices</span>
<span class="sd">    (in the Emmebank) if the controller.iteration &gt; 1.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for PrepareHighwayDemand.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to run controller object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># @LogStartEnd(&quot;prepare highway demand&quot;)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open combined demand OMX files from demand models and prepare for assignment.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_zero_matrix</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_demand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">demand_config</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load demand from OMX files and save to Emme matrix for highway assignment.</span>

<span class="sd">        Average with previous demand (MSA) if the current iteration &gt; 1</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of the highway assignment class</span>
<span class="sd">            description (str): the description for the highway assignment class</span>
<span class="sd">            demand_config (dict): the list of file cross-reference(s) for the demand to be loaded</span>
<span class="sd">                {&quot;source&quot;: &lt;name of demand model component&gt;,</span>
<span class="sd">                 &quot;name&quot;: &lt;OMX key name&gt;,</span>
<span class="sd">                 &quot;factor&quot;: &lt;factor to apply to demand in this file&gt;}</span>
<span class="sd">            time_period (str): the time time_period ID (name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span><span class="p">,</span> <span class="n">time_period</span><span class="p">)</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand</span><span class="p">(</span><span class="n">demand_config</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_config</span> <span class="ow">in</span> <span class="n">demand_config</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">demand</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand</span><span class="p">(</span><span class="n">file_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">)</span>
        <span class="n">demand_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2"> demand&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_demand</span><span class="p">(</span><span class="n">demand_name</span><span class="p">,</span> <span class="n">demand</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">apply_msa</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">):</span>
        <span class="c1"># Load demand from cross-referenced source file,</span>
        <span class="c1"># the named demand model component under the key highway_demand_file</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">file_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">file_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;factor&quot;</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">highway_demand_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">),</span> <span class="n">name</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.demand.PrepareHighwayDemand.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.demand.demand.PrepareHighwayDemand.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for PrepareHighwayDemand.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>Reference to run controller object.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/demand.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for PrepareHighwayDemand.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to run controller object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.demand.PrepareHighwayDemand.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.demand.demand.PrepareHighwayDemand.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Open combined demand OMX files from demand models and prepare for assignment.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/demand.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open combined demand OMX files from demand models and prepare for assignment.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_emmebank_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_zero_matrix</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_demand</span><span class="p">(</span><span class="n">klass</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">demand</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>

<h4 id="household-demand">Household Demand<a class="headerlink" href="#household-demand" title="Permanent link"> </a></h4>
<p>Personal travel demand generated by household members.</p>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.household" class="doc doc-heading">
        <code>tm2py.components.demand.household</code>



<a href="#tm2py.components.demand.household" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Placeholder docstring for CT-RAMP related components for household residents&rsquo; model</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.household.HouseholdModel" class="doc doc-heading">
        <code>
HouseholdModel            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.demand.household.HouseholdModel" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Run household resident model.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/household.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HouseholdModel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run household resident model.&quot;&quot;&quot;</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the the household resident travel demand model.</span>

<span class="sd">        Steps:</span>
<span class="sd">            1. Starts household manager.</span>
<span class="sd">            2. Starts matrix manager.</span>
<span class="sd">            3. Starts resident travel model (CTRAMP).</span>
<span class="sd">            4. Cleans up CTRAMP java.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_household_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_matrix_manager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_resident_model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stop_java</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_start_household_manager</span><span class="p">():</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CALL CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\r</span><span class="s2">untime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\b</span><span class="s2">in;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="s1">&#39;CALL CTRAMP</span><span class="se">\\</span><span class="s1">runtime</span><span class="se">\\</span><span class="s1">runHhMgr.cmd &quot;%JAVA_PATH%&quot; &quot;%HOST_IP_ADDRESS%&quot;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_household_manager&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_start_matrix_manager</span><span class="p">():</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CALL CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\r</span><span class="s2">untime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\b</span><span class="s2">in;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="s1">&#39;CALL CTRAMP</span><span class="se">\r</span><span class="s1">untime</span><span class="se">\r</span><span class="s1">unMtxMgr.cmd %HOST_IP_ADDRESS% &quot;%JAVA_PATH%&quot;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;start_matrix_manager&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_resident_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sample_rate_iteration</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mf">0.02</span><span class="p">}</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
        <span class="n">sample_rate</span> <span class="o">=</span> <span class="n">sample_rate_iteration</span><span class="p">[</span><span class="n">iteration</span><span class="p">]</span>
        <span class="n">_shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s2">&quot;CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">mtctm2.properties&quot;</span><span class="p">,</span> <span class="s2">&quot;mtctm2.properties&quot;</span><span class="p">)</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CALL CTRAMP</span><span class="se">\\</span><span class="s2">runtime</span><span class="se">\\</span><span class="s2">CTRampEnv.bat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;set PATH=%CD%</span><span class="se">\\</span><span class="s2">CTRAMP</span><span class="se">\r</span><span class="s2">untime;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32;%JAVA_PATH%</span><span class="se">\b</span><span class="s2">in;&quot;</span>
            <span class="s2">&quot;%TPP_PATH%;%PYTHON_PATH%;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">condabin;%PYTHON_PATH%</span><span class="se">\\</span><span class="s2">envs&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s1">&#39;CALL CTRAMP</span><span class="se">\r</span><span class="s1">untime</span><span class="se">\r</span><span class="s1">unMTCTM2ABM.cmd </span><span class="si">{</span><span class="n">sample_rate</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s1"> &quot;%JAVA_PATH%&quot;&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;run_resident_model&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_stop_java</span><span class="p">():</span>
        <span class="n">run_process</span><span class="p">([</span><span class="s1">&#39;taskkill /im &quot;java.exe&quot; /F&#39;</span><span class="p">])</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.household.HouseholdModel.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.demand.household.HouseholdModel.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Run the the household resident travel demand model.</p>
<div class="admonition steps">
<p class="admonition-title">Steps</p>
<ol>
<li>Starts household manager.</li>
<li>Starts matrix manager.</li>
<li>Starts resident travel model (CTRAMP).</li>
<li>Cleans up CTRAMP java.</li>
</ol>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/household.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the the household resident travel demand model.</span>

<span class="sd">    Steps:</span>
<span class="sd">        1. Starts household manager.</span>
<span class="sd">        2. Starts matrix manager.</span>
<span class="sd">        3. Starts resident travel model (CTRAMP).</span>
<span class="sd">        4. Cleans up CTRAMP java.</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_household_manager</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_matrix_manager</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_resident_model</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_stop_java</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.HouseholdConfig" class="doc doc-heading">
        <code>
tm2py.config.HouseholdConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HouseholdConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Household (residents) model parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HouseholdConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Household (residents) model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">transit_demand_file</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>

<h4 id="air-passenger-demand">Air Passenger Demand<a class="headerlink" href="#air-passenger-demand" title="Permanent link"> </a></h4>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.air_passenger" class="doc doc-heading">
        <code>tm2py.components.demand.air_passenger</code>



<a href="#tm2py.components.demand.air_passenger" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Module containing the AirPassenger class which builds the airport trip matrices.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.air_passenger.AirPassenger" class="doc doc-heading">
        <code>
AirPassenger            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.demand.air_passenger.AirPassenger" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Builds the airport trip matrices.</p>
<p>input: nonres/{year}_{tofrom}{airport}.csv
output: five time-of-day-specific OMX files with matrices DA, SR2, SR3</p>
<p>NOTES:</p>
<p>These are independent of level-of-service.</p>
<p>Note that the reference names, years, file paths and other key details
are controlled via the config, air_passenger section. See the
AirPassengerConfig doc for details on specifying these inputs.</p>
<p>The following details are based on the default config values.</p>
<p>Creates air passenger vehicle trip tables for the Bay Area&rsquo;s three major
airports, namely SFO, OAK, and SJC.  Geoff Gosling, a consultant, created
vehicle trip tables segmented by time of day, travel mode, and access/egress
direction (i.e. to the airport or from the airport) for years 2007 and 2035.
The tables are based on a 2006 Air Passenger survey, which was conducted
at SFO and OAK (but not SJC).</p>
<p>The travel modes are as follows:
    (a) escort (drive alone, shared ride 2, and shared ride 3+)
    (b) park (da, sr2, &amp; sr3+)
    &copy; rental car (da, sr2, &amp; sr3+)
    (d) taxi ((da, sr2, &amp; sr3+)
    (e) limo (da, sr2, &amp; sr3+)
    (f) shared ride van (all assumed to be sr3);
    (g) hotel shuttle (all assumed to be sr3); and,
    (h) charter bus (all assumed to be sr3).</p>
<p>The shared ride van, hotel shuttle, and charter bus modes are assumed to
have no deadhead travel. The return escort trip is included, as are the
deadhead limo and taxi trips.</p>
<p>The scripts reads in csv files adapted from Mr. Gosling&rsquo;s Excel files,
and creates a highway-assignment ready OMX matrix file for each time-of-day
interval.</p>
<p>Assumes that no air passengers use HOT lanes (probably not exactly true
in certain future year scenarios, but the assumption is made here as a
simplification).  Simple linear interpolations are used to estimate vehicle
demand in years other than 2007 and 2035, including 2015, 2020, 2025, 2030,
and 2040.</p>
<p>Transit travel to the airports is not included in these vehicle trip tables.</p>
<div class="admonition input">
<p class="admonition-title">Input</p>
<p>Year-, access/egress-, and airport-specific database file with 90 columns
of data for each TAZ.  There are 18 columns for each time-of-day interval
as follows:
        (1)   Escort, drive alone
        (2)   Escort, shared ride 2
        (3)   Escort, shared ride 3+
        (4)   Park, drive alone
        (5)   Park, shared ride 2
        (6)   Park, shared ride 3+
        (7)   Rental car, drive alone
        (8)   Rental car, shared ride 2
        (9)   Rental car, shared ride 3+
        (10)  Taxi, drive alone
        (11)  Taxi, shared ride 2
        (12)  Taxi, shared ride 3+
        (13)  Limo, drive alone
        (14)  Limo, shared ride 2
        (15)  Limo, shared ride 3+
        (16)  Shared ride van, shared ride 3+
        (17)  Hotel shuttle, shared ride 3+
        (18)  Charter bus, shared ride 3+</p>
</div>
<p>Output:
 Five time-of-day-specific tables, each containing origin/destination vehicle
 matrices for the following modes:
           (1) drive alone (DA)
           (2) shared ride 2 (SR2)
           (3) shared ride 3+ (SR3)</p>
<p>Internal properties:
    _start_year
    _end_year
    _mode_groups:
    _out_names:</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AirPassenger</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Builds the airport trip matrices.</span>

<span class="sd">    input: nonres/{year}_{tofrom}{airport}.csv</span>
<span class="sd">    output: five time-of-day-specific OMX files with matrices DA, SR2, SR3</span>

<span class="sd">    NOTES:</span>

<span class="sd">    These are independent of level-of-service.</span>

<span class="sd">    Note that the reference names, years, file paths and other key details</span>
<span class="sd">    are controlled via the config, air_passenger section. See the</span>
<span class="sd">    AirPassengerConfig doc for details on specifying these inputs.</span>

<span class="sd">    The following details are based on the default config values.</span>

<span class="sd">    Creates air passenger vehicle trip tables for the Bay Area&#39;s three major</span>
<span class="sd">    airports, namely SFO, OAK, and SJC.  Geoff Gosling, a consultant, created</span>
<span class="sd">    vehicle trip tables segmented by time of day, travel mode, and access/egress</span>
<span class="sd">    direction (i.e. to the airport or from the airport) for years 2007 and 2035.</span>
<span class="sd">    The tables are based on a 2006 Air Passenger survey, which was conducted</span>
<span class="sd">    at SFO and OAK (but not SJC).</span>

<span class="sd">    The travel modes are as follows:</span>
<span class="sd">        (a) escort (drive alone, shared ride 2, and shared ride 3+)</span>
<span class="sd">        (b) park (da, sr2, &amp; sr3+)</span>
<span class="sd">        (c) rental car (da, sr2, &amp; sr3+)</span>
<span class="sd">        (d) taxi ((da, sr2, &amp; sr3+)</span>
<span class="sd">        (e) limo (da, sr2, &amp; sr3+)</span>
<span class="sd">        (f) shared ride van (all assumed to be sr3);</span>
<span class="sd">        (g) hotel shuttle (all assumed to be sr3); and,</span>
<span class="sd">        (h) charter bus (all assumed to be sr3).</span>

<span class="sd">    The shared ride van, hotel shuttle, and charter bus modes are assumed to</span>
<span class="sd">    have no deadhead travel. The return escort trip is included, as are the</span>
<span class="sd">    deadhead limo and taxi trips.</span>

<span class="sd">    The scripts reads in csv files adapted from Mr. Gosling&#39;s Excel files,</span>
<span class="sd">    and creates a highway-assignment ready OMX matrix file for each time-of-day</span>
<span class="sd">    interval.</span>

<span class="sd">    Assumes that no air passengers use HOT lanes (probably not exactly true</span>
<span class="sd">    in certain future year scenarios, but the assumption is made here as a</span>
<span class="sd">    simplification).  Simple linear interpolations are used to estimate vehicle</span>
<span class="sd">    demand in years other than 2007 and 2035, including 2015, 2020, 2025, 2030,</span>
<span class="sd">    and 2040.</span>

<span class="sd">    Transit travel to the airports is not included in these vehicle trip tables.</span>

<span class="sd">    Input:</span>
<span class="sd">        Year-, access/egress-, and airport-specific database file with 90 columns</span>
<span class="sd">        of data for each TAZ.  There are 18 columns for each time-of-day interval</span>
<span class="sd">        as follows:</span>
<span class="sd">                (1)   Escort, drive alone</span>
<span class="sd">                (2)   Escort, shared ride 2</span>
<span class="sd">                (3)   Escort, shared ride 3+</span>
<span class="sd">                (4)   Park, drive alone</span>
<span class="sd">                (5)   Park, shared ride 2</span>
<span class="sd">                (6)   Park, shared ride 3+</span>
<span class="sd">                (7)   Rental car, drive alone</span>
<span class="sd">                (8)   Rental car, shared ride 2</span>
<span class="sd">                (9)   Rental car, shared ride 3+</span>
<span class="sd">                (10)  Taxi, drive alone</span>
<span class="sd">                (11)  Taxi, shared ride 2</span>
<span class="sd">                (12)  Taxi, shared ride 3+</span>
<span class="sd">                (13)  Limo, drive alone</span>
<span class="sd">                (14)  Limo, shared ride 2</span>
<span class="sd">                (15)  Limo, shared ride 3+</span>
<span class="sd">                (16)  Shared ride van, shared ride 3+</span>
<span class="sd">                (17)  Hotel shuttle, shared ride 3+</span>
<span class="sd">                (18)  Charter bus, shared ride 3+</span>

<span class="sd">     Output:</span>
<span class="sd">     Five time-of-day-specific tables, each containing origin/destination vehicle</span>
<span class="sd">     matrices for the following modes:</span>
<span class="sd">               (1) drive alone (DA)</span>
<span class="sd">               (2) shared ride 2 (SR2)</span>
<span class="sd">               (3) shared ride 3+ (SR3)</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _start_year</span>
<span class="sd">        _end_year</span>
<span class="sd">        _mode_groups:</span>
<span class="sd">        _out_names:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the airport trip matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent Controller object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_year</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_year</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_names</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the airport trip matrices&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">reference_start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">reference_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">demand_aggregation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;src_group_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;access_modes&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_out_names</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;src_group_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;result_class_name&quot;</span><span class="p">]</span>

        <span class="n">input_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_demand</span><span class="p">()</span>
        <span class="n">aggr_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_demand</span><span class="p">(</span><span class="n">input_demand</span><span class="p">)</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate</span><span class="p">(</span><span class="n">aggr_demand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_result</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Loads demand from the CSV files into pandas dataframe.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">rename_columns</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEST&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">name</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">input_data_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">input_demand_folder</span>
        <span class="n">input_demand</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_year</span><span class="p">]:</span>
            <span class="n">input_dataframes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">airport</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">airport_names</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">]:</span>
                    <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">direction</span><span class="si">}{</span><span class="n">airport</span><span class="si">}</span><span class="s2">.csv&quot;</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">input_data_folder</span><span class="p">,</span> <span class="n">file_name</span>
                    <span class="p">)</span>
                    <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="n">input_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">input_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_df</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">input_dataframes</span><span class="p">)</span>
            <span class="n">input_demand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">input_demand</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_demand</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEST&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;ORIG&quot;</span><span class="p">,</span> <span class="s2">&quot;DEST&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">grouped</span>

    <span class="k">def</span> <span class="nf">_aggregate_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_demand</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Aggregate demand into the assignable classes for each year.&quot;&quot;&quot;</span>
        <span class="n">aggr_demand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_year</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_periods</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">access_modes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">input_demand</span><span class="p">[</span>
                        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">access</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">access</span> <span class="ow">in</span> <span class="n">access_modes</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="n">aggr_demand</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">aggr_demand</span>

    <span class="k">def</span> <span class="nf">_interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggr_demand</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Interpolate for the model year assuming linear growth between the reference years.&quot;&quot;&quot;</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start_year</span><span class="p">)</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_year</span><span class="p">)</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">]:</span>
            <span class="c1"># no interpolation is needed</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">aggr_demand</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">aggr_demand</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">rename_columns</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">demand</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_columns</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">demand</span>

        <span class="c1"># In the cube .job script, the formula is:</span>
        <span class="c1"># token_scale = (%MODEL_YEAR% - 2007)/(2035 - %MODEL_YEAR%)</span>
        <span class="c1"># and it should be: token_scale = (%MODEL_YEAR% - 2007)/(2035 - 2007)</span>
        <span class="c1"># scale = float((int(year) - 2007)) / (2035 - int(year))</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">-</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">end_year</span> <span class="o">-</span> <span class="n">start_year</span><span class="p">)</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_periods</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">demand</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">scale</span><span class="p">)</span> <span class="o">*</span> <span class="n">aggr_demand</span><span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">]</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">aggr_demand</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">demand</span>

    <span class="k">def</span> <span class="nf">_export_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export resulting model year demand to OMX files by period.&quot;&quot;&quot;</span>
        <span class="c1"># dropping ORIG and DEST index for calculation of numpy array index</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="c1"># get all used Zone IDs to produce index and zone mapping in OMX file</span>
        <span class="n">zone_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">demand</span><span class="p">[</span><span class="s2">&quot;ORIG&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">demand</span><span class="p">[</span><span class="s2">&quot;DEST&quot;</span><span class="p">])))</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone_ids</span><span class="p">)</span>
        <span class="n">zone_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">z</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zone_ids</span><span class="p">))</span>
        <span class="c1"># calculate index of entries in numpy array list</span>
        <span class="n">demand</span><span class="p">[</span><span class="s2">&quot;INDEX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">demand</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">zone_map</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;ORIG&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone_ids</span><span class="p">)</span> <span class="o">+</span> <span class="n">zone_map</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;DEST&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">path_tmplt</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">highway_demand_file</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_tmplt</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_periods</span><span class="p">:</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
            <span class="n">omx_file</span> <span class="o">=</span> <span class="n">_omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">omx_file</span><span class="o">.</span><span class="n">create_mapping</span><span class="p">(</span><span class="s2">&quot;zone_number&quot;</span><span class="p">,</span> <span class="n">zone_ids</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span><span class="p">:</span>
                    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_zones</span><span class="p">,</span> <span class="n">num_zones</span><span class="p">))</span>
                    <span class="c1"># Insert values at the calculated indices in array</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
                        <span class="n">array</span><span class="p">,</span>
                        <span class="n">demand</span><span class="p">[</span><span class="s2">&quot;INDEX&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                        <span class="n">demand</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="n">omx_file</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_out_names</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">obj</span><span class="o">=</span><span class="n">array</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">omx_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.air_passenger.AirPassenger.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.demand.air_passenger.AirPassenger.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Build the airport trip matrices.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>parent Controller object</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build the airport trip matrices.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent Controller object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">()]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_year</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_end_year</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_names</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.air_passenger.AirPassenger.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.demand.air_passenger.AirPassenger.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Build the airport trip matrices</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/air_passenger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build the airport trip matrices&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">reference_start_year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">reference_end_year</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_out_names</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">air_passenger</span><span class="o">.</span><span class="n">demand_aggregation</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode_groups</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;src_group_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;access_modes&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_out_names</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;src_group_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;result_class_name&quot;</span><span class="p">]</span>

    <span class="n">input_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_demand</span><span class="p">()</span>
    <span class="n">aggr_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_demand</span><span class="p">(</span><span class="n">input_demand</span><span class="p">)</span>
    <span class="n">demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate</span><span class="p">(</span><span class="n">aggr_demand</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_result</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.AirPassengerDemandAggregationConfig" class="doc doc-heading">
        <code>
tm2py.config.AirPassengerDemandAggregationConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.AirPassengerDemandAggregationConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Air passenger demand aggregation input parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition result_class_name">
<p class="admonition-title">name used in the output OMX matrix names, note</p>
<p>that this should match the expected naming convention in the
HighwayClassDemandConfig name(s)</p>
</div>
<div class="admonition src_group_name">
<p class="admonition-title">name used for the class group in the input columns</p>
<p>for the trip tables,</p>
</div>
<div class="admonition access_modes">
<p class="admonition-title">list of names used for the access modes in the input</p>
<p>columns for the trip tables</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AirPassengerDemandAggregationConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Air passenger demand aggregation input parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        result_class_name: name used in the output OMX matrix names, note</span>
<span class="sd">            that this should match the expected naming convention in the</span>
<span class="sd">            HighwayClassDemandConfig name(s)</span>
<span class="sd">        src_group_name: name used for the class group in the input columns</span>
<span class="sd">            for the trip tables,</span>
<span class="sd">        access_modes: list of names used for the access modes in the input</span>
<span class="sd">            columns for the trip tables</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result_class_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">src_group_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">























  </div>

    </div>

  </div>

<h4 id="commercial-demand">Commercial Demand<a class="headerlink" href="#commercial-demand" title="Permanent link"> </a></h4>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.commercial" class="doc doc-heading">
        <code>tm2py.components.demand.commercial</code>



<a href="#tm2py.components.demand.commercial" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Commercial vehicle / truck model module.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.commercial.CommercialVehicleModel" class="doc doc-heading">
        <code>
CommercialVehicleModel            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.demand.commercial.CommercialVehicleModel" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Commercial vehicle (truck) demand model for 4 sizes of truck, toll choice, and time of day.</p>
<p>Based on the BAYCAST truck model, note that there are no significant updates or changes.</p>
<p>The four truck types are: very small trucks (two-axle, four-tire),
small trucks (two-axle, six-tire), medium trucks (three-axle),
and large or combination (four or more axle) trucks.</p>
<div class="admonition input">
<p class="admonition-title">(1) MAZ csv data file with the employment and household counts.<p>(2) highway skims for truck, time, distance, bridgetoll and value toll
(3) friction factors lookup table
(4) k-factors matrix</p>
</p>
</div>
<p>Ouput:  Trips by time-of-day for 4 truck sizes X 2 types, toll and nontoll</p>
<p>Notes:
(1) Based on the BAYCAST truck model, no significant updates.
(2) Combined Chuck&rsquo;s calibration adjustments into the NAICS-based model coefficients.</p>
<h6 id="tm2py.components.demand.commercial.CommercialVehicleModel--trip-generation">Trip generation<a class="headerlink" href="#tm2py.components.demand.commercial.CommercialVehicleModel--trip-generation" title="Permanent link"> </a></h6>
<p>Use linear regression models to generate trip ends,
balancing attractions to productions. Based on BAYCAST truck model.</p>
<p>The truck trip generation models for small trucks (two-axle, six tire),
medium trucks (three-axle), and large or combination (four or more axle)
trucks are taken directly from the study: &ldquo;I-880 Intermodal Corridor Study:
Truck Travel in the San Francisco Bay Area&rdquo;, prepared by Barton Aschman in
December 1992.  The coefficients are on page 223 of this report.</p>
<p>The very small truck generation model is based on the Phoenix four-tire
truck model documented in the TMIP Quick Response Freight Manual.</p>
<p>Note that certain production models previously used SIC-based employment
categories.  To both maintain consistency with the BAYCAST truck model and
update the model to use NAICS-based employment categories, new regression
models were estimated relating the NAICS-based employment data with the
SIC-based-predicted trips.  The goal here is not to create a new truck
model, but to mimic the old model with the available data.  Please see
the excel spreadsheet TruckModel.xlsx for details.  The NAICS-based model
results replicate the SIC-based model results quite well.</p>
<h6 id="tm2py.components.demand.commercial.CommercialVehicleModel--trip-distribution">Trip distribution<a class="headerlink" href="#tm2py.components.demand.commercial.CommercialVehicleModel--trip-distribution" title="Permanent link"> </a></h6>
<p>A simple gravity model is used to distribute the truck trips, with
separate friction factors used for each class of truck.</p>
<p>A blended travel time is used as the impedance measure, specifically the weighted average
of the AM travel time (one-third weight) and the midday travel time (two-thirds weight).</p>
<div class="admonition input">
<p class="admonition-title">Input</p>
<p>Level-of-service matrices for the AM peak period (6 am to 10 am) and midday
period (10 am to 3 pm) which contain truck-class specific estimates of
congested travel time (in minutes)</p>
<p>A matrix of k-factors, as calibrated by Chuck Purvis.  Note the very small truck model
does not use k-factors; the small, medium, and large trucks use the same k-factors.</p>
<p>A table of friction factors in text format with the following fields, space separated:
- impedance measure (blended travel time);
- friction factors for very small trucks;
- friction factors for small trucks;
- friction factors for medium trucks; and,
- friction factors for large trucks.</p>
</div>
<p>Results: four total daily trips by truck type</p>
<h6 id="tm2py.components.demand.commercial.CommercialVehicleModel--time-of-day">Time of day<a class="headerlink" href="#tm2py.components.demand.commercial.CommercialVehicleModel--time-of-day" title="Permanent link"> </a></h6>
<p>Segment daily estimates of truck flows into time-period-specific flows.
The diurnal factors are taken from the BAYCAST-90 model with adjustments made
during calibration to the very small truck values to better match counts.</p>
<p>Input: four total daily trips by truck type</p>
<p>Results: five time of days to four truck types each, for twenty trip tables</p>
<h6 id="tm2py.components.demand.commercial.CommercialVehicleModel--toll-choice">Toll choice<a class="headerlink" href="#tm2py.components.demand.commercial.CommercialVehicleModel--toll-choice" title="Permanent link"> </a></h6>
<p>A binomial choice model for very small, small, medium, and large trucks.
A separate value toll paying versus no value toll paying path choice
model is applied to each of the twenty time period and vehicle type combinations.</p>
<div class="admonition input">
<p class="admonition-title">(1) Trip tables by time of day and trip type<p>(2) Skims providing the time and cost for value toll and non-value toll paths
for each; the matrix names in the OMX files are:
    &ldquo;{period}<em>{cls_name}_time&rdquo;
    &ldquo;{period}</em>{cls_name}<em>dist&rdquo;
    &ldquo;{period}</em>{cls_name}<em>bridgetoll{grp_name}&rdquo;
    &ldquo;{period}</em>{cls_name}toll_time&rdquo;
    &ldquo;{period}<em>{cls_name}toll_dist&rdquo;
    &ldquo;{period}</em>{cls_name}toll_bridgetoll{grp_name}&rdquo;
    &ldquo;{period}_{cls_name}toll_valuetoll{grp_name}&rdquo;
Where period is the assignment period, cls_name is the truck assignment
class name (as very small, small and medium truck are assigned as the
same class) and grp_name is the truck type name (as the tolls are
calculated separately for very small, small and medium).</p>
</p>
</div>
<p>Results: a total of forty demand matrices, by time of day, truck type and toll/non-toll.</p>
<div class="admonition notes">
<p class="admonition-title">(1)  TOLLCLASS is a code, 1 through 10 are reserved for bridges; 11 and up is<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code> <span class="nv">reserved</span> <span class="k">for</span> <span class="nv">value</span> <span class="nv">toll</span> <span class="nv">facilities</span>.
</code></pre></div></td></tr></table></div>

<p>(2)  All costs should be coded in year 2000 cents
(3)  The 2-axle fee is used for very small trucks
(4)  The 2-axle fee is used for small trucks
(5)  The 3-axle fee is used for medium trucks
(6)  The average of the 5-axle and 6-axle fee is used for large trucks
     (about the midpoint of the fee schedule).
(7)  The in-vehicle time coefficient is from the work trip mode choice model.</p>
</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">CommercialVehicleModel</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Commercial vehicle (truck) demand model for 4 sizes of truck, toll choice, and time of day.</span>

<span class="sd">    Based on the BAYCAST truck model, note that there are no significant updates or changes.</span>

<span class="sd">    The four truck types are: very small trucks (two-axle, four-tire),</span>
<span class="sd">    small trucks (two-axle, six-tire), medium trucks (three-axle),</span>
<span class="sd">    and large or combination (four or more axle) trucks.</span>

<span class="sd">    Input:  (1) MAZ csv data file with the employment and household counts.</span>
<span class="sd">            (2) highway skims for truck, time, distance, bridgetoll and value toll</span>
<span class="sd">            (3) friction factors lookup table</span>
<span class="sd">            (4) k-factors matrix</span>
<span class="sd">    Ouput:  Trips by time-of-day for 4 truck sizes X 2 types, toll and nontoll</span>

<span class="sd">    Notes:</span>
<span class="sd">    (1) Based on the BAYCAST truck model, no significant updates.</span>
<span class="sd">    (2) Combined Chuck&#39;s calibration adjustments into the NAICS-based model coefficients.</span>

<span class="sd">    Trip generation</span>
<span class="sd">    ---------------</span>
<span class="sd">    Use linear regression models to generate trip ends,</span>
<span class="sd">    balancing attractions to productions. Based on BAYCAST truck model.</span>

<span class="sd">    The truck trip generation models for small trucks (two-axle, six tire),</span>
<span class="sd">    medium trucks (three-axle), and large or combination (four or more axle)</span>
<span class="sd">    trucks are taken directly from the study: &quot;I-880 Intermodal Corridor Study:</span>
<span class="sd">    Truck Travel in the San Francisco Bay Area&quot;, prepared by Barton Aschman in</span>
<span class="sd">    December 1992.  The coefficients are on page 223 of this report.</span>

<span class="sd">    The very small truck generation model is based on the Phoenix four-tire</span>
<span class="sd">    truck model documented in the TMIP Quick Response Freight Manual.</span>

<span class="sd">    Note that certain production models previously used SIC-based employment</span>
<span class="sd">    categories.  To both maintain consistency with the BAYCAST truck model and</span>
<span class="sd">    update the model to use NAICS-based employment categories, new regression</span>
<span class="sd">    models were estimated relating the NAICS-based employment data with the</span>
<span class="sd">    SIC-based-predicted trips.  The goal here is not to create a new truck</span>
<span class="sd">    model, but to mimic the old model with the available data.  Please see</span>
<span class="sd">    the excel spreadsheet TruckModel.xlsx for details.  The NAICS-based model</span>
<span class="sd">    results replicate the SIC-based model results quite well.</span>


<span class="sd">    Trip distribution</span>
<span class="sd">    -----------------</span>
<span class="sd">    A simple gravity model is used to distribute the truck trips, with</span>
<span class="sd">    separate friction factors used for each class of truck.</span>

<span class="sd">    A blended travel time is used as the impedance measure, specifically the weighted average</span>
<span class="sd">    of the AM travel time (one-third weight) and the midday travel time (two-thirds weight).</span>

<span class="sd">    Input:</span>
<span class="sd">        Level-of-service matrices for the AM peak period (6 am to 10 am) and midday</span>
<span class="sd">        period (10 am to 3 pm) which contain truck-class specific estimates of</span>
<span class="sd">        congested travel time (in minutes)</span>

<span class="sd">        A matrix of k-factors, as calibrated by Chuck Purvis.  Note the very small truck model</span>
<span class="sd">        does not use k-factors; the small, medium, and large trucks use the same k-factors.</span>

<span class="sd">        A table of friction factors in text format with the following fields, space separated:</span>
<span class="sd">        - impedance measure (blended travel time);</span>
<span class="sd">        - friction factors for very small trucks;</span>
<span class="sd">        - friction factors for small trucks;</span>
<span class="sd">        - friction factors for medium trucks; and,</span>
<span class="sd">        - friction factors for large trucks.</span>

<span class="sd">    Results: four total daily trips by truck type</span>


<span class="sd">    Time of day</span>
<span class="sd">    -----------</span>
<span class="sd">    Segment daily estimates of truck flows into time-period-specific flows.</span>
<span class="sd">    The diurnal factors are taken from the BAYCAST-90 model with adjustments made</span>
<span class="sd">    during calibration to the very small truck values to better match counts.</span>

<span class="sd">    Input: four total daily trips by truck type</span>

<span class="sd">    Results: five time of days to four truck types each, for twenty trip tables</span>


<span class="sd">    Toll choice</span>
<span class="sd">    -----------</span>
<span class="sd">    A binomial choice model for very small, small, medium, and large trucks.</span>
<span class="sd">    A separate value toll paying versus no value toll paying path choice</span>
<span class="sd">    model is applied to each of the twenty time period and vehicle type combinations.</span>

<span class="sd">    Input:  (1) Trip tables by time of day and trip type</span>
<span class="sd">            (2) Skims providing the time and cost for value toll and non-value toll paths</span>
<span class="sd">            for each; the matrix names in the OMX files are:</span>
<span class="sd">                &quot;{period}_{cls_name}_time&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}_dist&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}_bridgetoll{grp_name}&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_time&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_dist&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_bridgetoll{grp_name}&quot;</span>
<span class="sd">                &quot;{period}_{cls_name}toll_valuetoll{grp_name}&quot;</span>
<span class="sd">            Where period is the assignment period, cls_name is the truck assignment</span>
<span class="sd">            class name (as very small, small and medium truck are assigned as the</span>
<span class="sd">            same class) and grp_name is the truck type name (as the tolls are</span>
<span class="sd">            calculated separately for very small, small and medium).</span>

<span class="sd">    Results: a total of forty demand matrices, by time of day, truck type and toll/non-toll.</span>

<span class="sd">    Notes:  (1)  TOLLCLASS is a code, 1 through 10 are reserved for bridges; 11 and up is</span>
<span class="sd">                 reserved for value toll facilities.</span>
<span class="sd">            (2)  All costs should be coded in year 2000 cents</span>
<span class="sd">            (3)  The 2-axle fee is used for very small trucks</span>
<span class="sd">            (4)  The 2-axle fee is used for small trucks</span>
<span class="sd">            (5)  The 3-axle fee is used for medium trucks</span>
<span class="sd">            (6)  The average of the 5-axle and 6-axle fee is used for large trucks</span>
<span class="sd">                 (about the midpoint of the fee schedule).</span>
<span class="sd">            (7)  The in-vehicle time coefficient is from the work trip mode choice model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleModel component.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Run controller for model run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="n">parse_num_processors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">num_processors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run truck sub-model to generate assignable truck class demand.&quot;&quot;&quot;</span>
        <span class="c1"># future note: should not round intermediate results</span>
        <span class="c1"># future note: could use skim matrix cache from assignment (in same process)</span>
        <span class="c1">#              (save disk read time, minor optimization)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_emme</span><span class="p">()</span>
        <span class="n">taz_landuse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_landuse</span><span class="p">()</span>
        <span class="n">trip_ends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generation</span><span class="p">(</span><span class="n">taz_landuse</span><span class="p">)</span>
        <span class="n">daily_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span><span class="p">(</span><span class="n">trip_ends</span><span class="p">)</span>
        <span class="n">period_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_of_day</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span>
        <span class="n">class_demands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">class_demands</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_emme</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create matrices for balancing.&quot;&quot;&quot;</span>
        <span class="c1"># Note: using the highway assignment Emmebank</span>
        <span class="n">emmebank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># use first valid scenario for reference Zone IDs</span>
        <span class="n">ref_scenario_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">emme_scenario_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">scenario</span><span class="p">(</span><span class="n">ref_scenario_id</span><span class="p">)</span>
        <span class="c1"># matrix names, internal to this class and Emme database</span>
        <span class="c1"># (used in _matrix_balancing method)</span>
        <span class="c1"># NOTE: possible improvement: could use temporary matrices (delete when finished)</span>
        <span class="c1">#       prefer retaining matrices for now for transparency</span>
        <span class="n">matrices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;FULL&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;vsmtrk_friction&quot;</span><span class="p">,</span> <span class="s2">&quot;very small truck friction factors&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;smltrk_friction&quot;</span><span class="p">,</span> <span class="s2">&quot;small truck friction factors&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;medtrk_friction&quot;</span><span class="p">,</span> <span class="s2">&quot;medium truck friction factors&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;lrgtrk_friction&quot;</span><span class="p">,</span> <span class="s2">&quot;large truck friction factors&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;vsmtrk_daily_demand&quot;</span><span class="p">,</span> <span class="s2">&quot;very small truck daily demand&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;smltrk_daily_demand&quot;</span><span class="p">,</span> <span class="s2">&quot;small truck daily demand&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;medtrk_daily_demand&quot;</span><span class="p">,</span> <span class="s2">&quot;medium truck daily demand&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;lrgtrk_daily_demand&quot;</span><span class="p">,</span> <span class="s2">&quot;large truck daily demand&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="s2">&quot;ORIGIN&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;vsmtrk_prod&quot;</span><span class="p">,</span> <span class="s2">&quot;very small truck daily productions&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;smltrk_prod&quot;</span><span class="p">,</span> <span class="s2">&quot;small truck daily productions&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;medtrk_prod&quot;</span><span class="p">,</span> <span class="s2">&quot;medium truck daily productions&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;lrgtrk_prod&quot;</span><span class="p">,</span> <span class="s2">&quot;large truck daily productions&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="s2">&quot;DESTINATION&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;vsmtrk_attr&quot;</span><span class="p">,</span> <span class="s2">&quot;very small truck daily attractions&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;smltrk_attr&quot;</span><span class="p">,</span> <span class="s2">&quot;small truck daily attractions&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;medtrk_attr&quot;</span><span class="p">,</span> <span class="s2">&quot;medium truck daily attractions&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;lrgtrk_attr&quot;</span><span class="p">,</span> <span class="s2">&quot;large truck daily attractions&quot;</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">matrix_type</span><span class="p">,</span> <span class="n">matrix_names</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">matrix_names</span><span class="p">:</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                    <span class="n">ident</span> <span class="o">=</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">available_matrix_identifier</span><span class="p">(</span><span class="n">matrix_type</span><span class="p">)</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span><span class="n">ident</span><span class="p">)</span>
                    <span class="n">matrix</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="n">matrix</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">desc</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_aggregate_landuse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Aggregates landuse data from input CSV by MAZ to TAZ and employment groups.</span>
<span class="sd">        TOTEMP, total employment (same regardless of classification system)</span>
<span class="sd">        RETEMPN, retail trade employment per the NAICS classification system</span>
<span class="sd">        FPSEMPN, financial and professional services employment per NAICS</span>
<span class="sd">        HEREMPN, health, educational, and recreational employment per  NAICS</span>
<span class="sd">        OTHEMPN, other employment per the NAICS classification system</span>
<span class="sd">        AGREMPN, agricultural employment per the NAICS classificatin system</span>
<span class="sd">        MWTEMPN, manufacturing, warehousing, and transportation employment per NAICS</span>
<span class="sd">        TOTHH, total households</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">maz_data_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">maz_landuse_file</span><span class="p">)</span>
        <span class="n">maz_input_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">maz_data_file</span><span class="p">)</span>
        <span class="n">zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">zone_numbers</span>
        <span class="n">maz_input_data</span> <span class="o">=</span> <span class="n">maz_input_data</span><span class="p">[</span><span class="n">maz_input_data</span><span class="p">[</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">zones</span><span class="p">)]</span>
        <span class="n">taz_input_data</span> <span class="o">=</span> <span class="n">maz_input_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">taz_input_data</span> <span class="o">=</span> <span class="n">taz_input_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;TAZ_ORIGINAL&quot;</span><span class="p">)</span>
        <span class="c1"># combine categories</span>
        <span class="n">taz_landuse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">total_column</span><span class="p">,</span> <span class="n">sub_categories</span> <span class="ow">in</span> <span class="n">_land_use_aggregation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">taz_landuse</span><span class="p">[</span><span class="n">total_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">taz_input_data</span><span class="p">[</span><span class="n">sub_categories</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">taz_landuse</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">taz_landuse</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">landuse</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run truck trip generation on input landuse dataframe.</span>

<span class="sd">        This step applies simple generation models, balances attractions</span>
<span class="sd">        and productions, sums linked and unlinked trips and returns vectors</span>
<span class="sd">        of production and attactions as a pandas dataframe.</span>

<span class="sd">        Expected columns for landuse are: AGREMPN, RETEMPN, FPSEMPN, HEREMPN,</span>
<span class="sd">        MWTEMPN, OTHEMPN, TOTEMP, TOTHH</span>

<span class="sd">        Returned columns are: vsmtrk_prod, vsmtrk_attr, smltrk_prod,</span>
<span class="sd">        smltrk_attr, medtrk_prod, medtrk_attr, lrgtrk_prod, lrgtrk_attr</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">link_trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="c1"># linked trips (non-garage-based) - productions</span>
        <span class="c1"># (very small updated with NAICS coefficients)</span>
        <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;vsmtrk_prod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.96</span>
            <span class="o">*</span> <span class="p">(</span>
                <span class="mf">0.95409</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">RETEMPN</span>
                <span class="o">+</span> <span class="mf">0.54333</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">FPSEMPN</span>
                <span class="o">+</span> <span class="mf">0.50769</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">HEREMPN</span>
                <span class="o">+</span> <span class="mf">0.63558</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">OTHEMPN</span>
                <span class="o">+</span> <span class="mf">1.10181</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">AGREMPN</span>
                <span class="o">+</span> <span class="mf">0.81576</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">MWTEMPN</span>
                <span class="o">+</span> <span class="mf">0.26565</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">TOTHH</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_prod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0324</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">TOTEMP</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_prod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0039</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">TOTEMP</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_prod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0073</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">TOTEMP</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="c1"># linked trips (non-garage-based) - attractions (equal productions)</span>
        <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;vsmtrk_attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;vsmtrk_prod&quot;</span><span class="p">]</span>
        <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_prod&quot;</span><span class="p">]</span>
        <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_prod&quot;</span><span class="p">]</span>
        <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_prod&quot;</span><span class="p">]</span>
        <span class="n">garage_trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="c1"># garage-based - productions (updated NAICS coefficients)</span>
        <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_prod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.02146</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">RETEMPN</span>
            <span class="o">+</span> <span class="mf">0.02424</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">FPSEMPN</span>
            <span class="o">+</span> <span class="mf">0.01320</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">HEREMPN</span>
            <span class="o">+</span> <span class="mf">0.04325</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">OTHEMPN</span>
            <span class="o">+</span> <span class="mf">0.05021</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">AGREMPN</span>
            <span class="o">+</span> <span class="mf">0.01960</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">MWTEMPN</span>
        <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_prod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.00102</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">RETEMPN</span>
            <span class="o">+</span> <span class="mf">0.00147</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">FPSEMPN</span>
            <span class="o">+</span> <span class="mf">0.00025</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">HEREMPN</span>
            <span class="o">+</span> <span class="mf">0.00331</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">OTHEMPN</span>
            <span class="o">+</span> <span class="mf">0.00445</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">AGREMPN</span>
            <span class="o">+</span> <span class="mf">0.00165</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">MWTEMPN</span>
        <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_prod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.00183</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">RETEMPN</span>
            <span class="o">+</span> <span class="mf">0.00482</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">FPSEMPN</span>
            <span class="o">+</span> <span class="mf">0.00274</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">HEREMPN</span>
            <span class="o">+</span> <span class="mf">0.00795</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">OTHEMPN</span>
            <span class="o">+</span> <span class="mf">0.01125</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">AGREMPN</span>
            <span class="o">+</span> <span class="mf">0.00486</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">MWTEMPN</span>
        <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="c1"># garage-based - attractions</span>
        <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0234</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">TOTEMP</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0046</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">TOTEMP</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0136</span> <span class="o">*</span> <span class="n">landuse</span><span class="o">.</span><span class="n">TOTEMP</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="c1"># balance attractions to productions (applies to garage trips only)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;smltrk&quot;</span><span class="p">,</span> <span class="s2">&quot;medtrk&quot;</span><span class="p">,</span> <span class="s2">&quot;lrgtrk&quot;</span><span class="p">]:</span>
            <span class="n">total_attract</span> <span class="o">=</span> <span class="n">garage_trips</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_attr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">total_prod</span> <span class="o">=</span> <span class="n">garage_trips</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_prod&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">garage_trips</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_attr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">garage_trips</span><span class="p">[</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_attr&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">total_prod</span> <span class="o">/</span> <span class="n">total_attract</span>
            <span class="p">)</span>

        <span class="n">trip_ends</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;vsmtrk_prod&quot;</span><span class="p">:</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;vsmtrk_prod&quot;</span><span class="p">],</span>
                <span class="s2">&quot;vsmtrk_attr&quot;</span><span class="p">:</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;vsmtrk_attr&quot;</span><span class="p">],</span>
                <span class="s2">&quot;smltrk_prod&quot;</span><span class="p">:</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_prod&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_prod&quot;</span><span class="p">],</span>
                <span class="s2">&quot;smltrk_attr&quot;</span><span class="p">:</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_attr&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;smltrk_attr&quot;</span><span class="p">],</span>
                <span class="s2">&quot;medtrk_prod&quot;</span><span class="p">:</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_prod&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_prod&quot;</span><span class="p">],</span>
                <span class="s2">&quot;medtrk_attr&quot;</span><span class="p">:</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_attr&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;medtrk_attr&quot;</span><span class="p">],</span>
                <span class="s2">&quot;lrgtrk_prod&quot;</span><span class="p">:</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_prod&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_prod&quot;</span><span class="p">],</span>
                <span class="s2">&quot;lrgtrk_attr&quot;</span><span class="p">:</span> <span class="n">link_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_attr&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">garage_trips</span><span class="p">[</span><span class="s2">&quot;lrgtrk_attr&quot;</span><span class="p">],</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="n">trip_ends</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">trip_ends</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trip_ends</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trip_ends</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Run trip distribution model for 4 truck types using Emme matrix balancing.</span>

<span class="sd">        Notes on distribution steps:</span>
<span class="sd">            load nonres/truck_kfactors_taz.csv</span>
<span class="sd">            load nonres/truckFF.dat</span>
<span class="sd">            Apply friction factors and kfactors to produce balancing matrix</span>
<span class="sd">            apply the gravity models using friction factors from nonres/truckFF.dat</span>
<span class="sd">            (note the very small trucks do not use the K-factors)</span>
<span class="sd">            Can use Emme matrix balancing for this - important note: reference</span>
<span class="sd">            matrices by name and ensure names are unique</span>
<span class="sd">            Trips rounded to 0.01, causes some instability in results</span>

<span class="sd">        Args:</span>
<span class="sd">            trip_ends: pandas dataframe of the production / attraction vectors</span>

<span class="sd">        Returns:</span>
<span class="sd">             Pandas dataframe of the the daily truck trip matrices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># load skims from OMX file</span>
        <span class="n">trk_blend_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_blended_time</span><span class="p">(</span><span class="s2">&quot;trk&quot;</span><span class="p">)</span>
        <span class="n">lrgtrk_blend_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_blended_time</span><span class="p">(</span><span class="s2">&quot;lrgtrk&quot;</span><span class="p">)</span>
        <span class="c1"># note that very small, small and medium are assigned as one class</span>
        <span class="c1"># and share the same output skims</span>
        <span class="n">ffactors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_ff_lookup_tables</span><span class="p">()</span>
        <span class="n">k_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_k_factors</span><span class="p">()</span>
        <span class="n">friction_calculations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;vsmtrk&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">trk_blend_time</span><span class="p">,</span> <span class="s2">&quot;use_k_factors&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;smltrk&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">trk_blend_time</span><span class="p">,</span> <span class="s2">&quot;use_k_factors&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;medtrk&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">trk_blend_time</span><span class="p">,</span> <span class="s2">&quot;use_k_factors&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;lrgtrk&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">lrgtrk_blend_time</span><span class="p">,</span> <span class="s2">&quot;use_k_factors&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">]</span>
        <span class="n">daily_demand</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">friction_calculations</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="c1"># lookup friction factor values from table with interpolation</span>
            <span class="c1"># and multiply by k-factors (no k-factors for very small truck)</span>
            <span class="n">friction_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">ffactors</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">ffactors</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;use_k_factors&quot;</span><span class="p">]:</span>
                <span class="n">friction_matrix</span> <span class="o">=</span> <span class="n">friction_matrix</span> <span class="o">*</span> <span class="n">k_factors</span>
            <span class="c1"># run matrix balancing</span>
            <span class="n">prod_attr_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_balancing</span><span class="p">(</span>
                <span class="n">friction_matrix</span><span class="p">,</span>
                <span class="n">trip_ends</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_prod&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">trip_ends</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_attr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                <span class="n">name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">daily_demand</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mf">0.5</span> <span class="o">*</span> <span class="n">prod_attr_matrix</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">prod_attr_matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, prod sum: </span><span class="si">{</span><span class="n">prod_attr_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;daily sum: </span><span class="si">{</span><span class="n">daily_demand</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">daily_demand</span>

    <span class="k">def</span> <span class="nf">_get_blended_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Blend AM and MD truck times for distribution calculations.</span>

<span class="sd">        Uses 1/3 * AM + 2/3 * MD, sources skims from generated OMX files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">skim_path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">output_skim_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">skim_path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="s2">&quot;AM&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">am_file</span><span class="p">:</span>
            <span class="n">am_time</span> <span class="o">=</span> <span class="n">am_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;am_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">skim_path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="s2">&quot;MD&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">md_file</span><span class="p">:</span>
            <span class="n">md_time</span> <span class="o">=</span> <span class="n">md_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;md_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">)</span>
        <span class="c1"># blend truck times</span>
        <span class="c1"># compute blended truck time as an average 1/3 AM and 2/3 MD</span>
        <span class="c1">#     NOTE: Cube outputs skims\COM_HWYSKIMAM_taz.tpp, skims\COM_HWYSKIMMD_taz.tpp</span>
        <span class="c1">#           are in the highway_skims_{period}.omx files in Emme version</span>
        <span class="c1">#           with updated matrix names, {period}_trk_time, {period}_lrgtrk_time.</span>
        <span class="c1">#           Also, there will no longer be separate very small, small and medium</span>
        <span class="c1">#           truck times, as they are assigned together as the same class.</span>
        <span class="c1">#           There is only the trk_time.</span>
        <span class="n">blend_time</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">am_time</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">md_time</span>
        <span class="k">return</span> <span class="n">blend_time</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_time_of_day</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">daily_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Apply period factors to convert daily demand totals to per-period demands.</span>

<span class="sd">        Args:</span>
<span class="sd">            daily_demand: dictionary of truck type name to numpy array of</span>
<span class="sd">                truck type daily demand</span>

<span class="sd">        Returns:</span>
<span class="sd">             Nested dictionary of period name to truck type name to numpy array</span>
<span class="sd">             of per period demand.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">period_demand</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
            <span class="n">factor_map</span> <span class="o">=</span> <span class="n">_time_of_day_split</span><span class="p">[</span><span class="n">period</span><span class="p">]</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">factor_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">demand</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">daily_demand</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">period_demand</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">=</span> <span class="n">demand</span>
        <span class="k">return</span> <span class="n">period_demand</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_toll_choice</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">period_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Split per-period truck demands into nontoll and toll classes.</span>

<span class="sd">        Args:</span>
<span class="sd">            period_demand: nested dictionary of period name to truck type name to numpy array</span>
<span class="sd">                of per period demand.</span>

<span class="sd">        Returns:</span>
<span class="sd">             Nested dictionary of period name to truck type name, either with toll</span>
<span class="sd">              of without toll, to numpy array assignable demand.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># input: time-of-day matrices</span>
        <span class="c1"># skims: skims\COM_HWYSKIM@token_period@_taz.tpp -&gt; traffic_skims_{period}.omx</span>
        <span class="c1">#        NOTE matrix name changes in Emme version, using {period}_{class}_{skim}</span>
        <span class="c1">#        format</span>
        <span class="n">calculator</span> <span class="o">=</span> <span class="n">TollChoiceCalculator</span><span class="p">(</span>
            <span class="n">value_of_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span><span class="o">.</span><span class="n">value_of_time</span><span class="p">,</span>
            <span class="n">coeff_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span><span class="o">.</span><span class="n">toll_choice_time_coefficient</span><span class="p">,</span>
            <span class="n">operating_cost_per_mile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span><span class="o">.</span><span class="n">operating_cost_per_mile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">class_demand</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">demands</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">skim_path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">output_skim_path</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">skim_path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">))</span> <span class="k">as</span> <span class="n">skims</span><span class="p">:</span>
                <span class="n">calculator</span><span class="o">.</span><span class="n">set_omx_manager</span><span class="p">(</span><span class="n">skims</span><span class="p">)</span>
                <span class="n">split_demand</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">total_trips</span> <span class="ow">in</span> <span class="n">demands</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">cls_name</span> <span class="o">=</span> <span class="s2">&quot;trk&quot;</span> <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;lrgtrk&quot;</span> <span class="k">else</span> <span class="s2">&quot;lrgtrk&quot;</span>
                    <span class="n">e_util_nontoll</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">calc_exp_util</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">_dist&quot;</span><span class="p">,</span>
                        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">_bridgetoll</span><span class="si">{</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">e_util_toll</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">calc_exp_util</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">toll_time&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">toll_dist&quot;</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">toll_bridgetoll</span><span class="si">{</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">toll_valuetoll</span><span class="si">{</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">prob_nontoll</span> <span class="o">=</span> <span class="n">e_util_nontoll</span> <span class="o">/</span> <span class="p">(</span><span class="n">e_util_toll</span> <span class="o">+</span> <span class="n">e_util_nontoll</span><span class="p">)</span>
                    <span class="n">calculator</span><span class="o">.</span><span class="n">mask_non_available</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">toll_valuetoll</span><span class="si">{</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">,</span>
                        <span class="n">prob_nontoll</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">split_demand</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_nontoll</span> <span class="o">*</span> <span class="n">total_trips</span>
                    <span class="n">split_demand</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prob_nontoll</span><span class="p">)</span> <span class="o">*</span> <span class="n">total_trips</span>

                <span class="n">class_demand</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_demand</span>
        <span class="k">return</span> <span class="n">class_demand</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_export_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_demand</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export assignable class demands to OMX files by time-of-day.&quot;&quot;&quot;</span>
        <span class="n">path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span><span class="o">.</span><span class="n">highway_demand_file</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_tmplt</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">matrices</span> <span class="ow">in</span> <span class="n">class_demand</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">output_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_matrix_balancing</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">friction_matrix</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">orig_totals</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">dest_totals</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run Emme matrix balancing tool using input arrays.&quot;&quot;&quot;</span>
        <span class="n">matrix_balancing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.matrix_calculation.matrix_balancing&quot;</span>
        <span class="p">)</span>
        <span class="n">matrix_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.matrix_calculation.matrix_controlled_rounding&quot;</span>
        <span class="p">)</span>
        <span class="n">od_values_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_friction&quot;</span>
        <span class="n">orig_totals_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_prod&quot;</span>
        <span class="n">dest_totals_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_attr&quot;</span>
        <span class="n">result_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_daily_demand&quot;</span>
        <span class="c1"># save O-D friction, prod and dest total values to Emmebank matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_emme_matrix</span><span class="p">(</span><span class="n">od_values_name</span><span class="p">,</span> <span class="n">friction_matrix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_emme_matrix</span><span class="p">(</span><span class="n">orig_totals_name</span><span class="p">,</span> <span class="n">orig_totals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_emme_matrix</span><span class="p">(</span><span class="n">dest_totals_name</span><span class="p">,</span> <span class="n">dest_totals</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;od_values_to_balance&quot;</span><span class="p">:</span> <span class="n">od_values_name</span><span class="p">,</span>
            <span class="s2">&quot;origin_totals&quot;</span><span class="p">:</span> <span class="n">orig_totals_name</span><span class="p">,</span>
            <span class="s2">&quot;destination_totals&quot;</span><span class="p">:</span> <span class="n">dest_totals_name</span><span class="p">,</span>
            <span class="s2">&quot;allowable_difference&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
            <span class="s2">&quot;max_relative_error&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span><span class="o">.</span><span class="n">max_balance_relative_error</span><span class="p">,</span>
            <span class="s2">&quot;max_iterations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span><span class="o">.</span><span class="n">max_balance_iterations</span><span class="p">,</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;od_balanced_values&quot;</span><span class="p">:</span> <span class="n">result_name</span><span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;allowed_memory&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MATRIX_BALANCING&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">matrix_balancing</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="n">matrix_round</span><span class="p">(</span>
            <span class="n">result_name</span><span class="p">,</span>
            <span class="n">result_name</span><span class="p">,</span>
            <span class="n">min_demand</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="n">values_to_round</span><span class="o">=</span><span class="s2">&quot;ALL_NON_ZERO&quot;</span><span class="p">,</span>
            <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">result_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get_numpy_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_to_emme_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save numpy data to Emme matrix (in Emmebank) with specified name.&quot;&quot;&quot;</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="c1"># reshape (e.g. pad externals) with zeros</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">num_zones</span><span class="p">:</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">dim_shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim_shape</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">set_numpy_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_ff_lookup_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Load friction factors lookup tables from file [config.truck.friction_factors_file].&quot;&quot;&quot;</span>
        <span class="c1">#   time is in column 0, very small FF in 1, small FF in 2,</span>
        <span class="c1">#   medium FF in 3, and large FF in 4</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;vsmtrk&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;smltrk&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;medtrk&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;lrgtrk&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span><span class="o">.</span><span class="n">friction_factors_file</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">truck_ff</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">truck_ff</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">factors</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">tokens</span><span class="p">):</span>
                    <span class="n">factors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">token</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">factors</span>

    <span class="k">def</span> <span class="nf">_load_k_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load k-factors table from CSV file [config.truck.k_factors_file].&quot;&quot;&quot;</span>
        <span class="c1"># NOTE: loading from this text format to numpy is pretty slow (~10 seconds)</span>
        <span class="c1">#       would be better to use a different format</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">truck</span><span class="o">.</span><span class="n">k_factors_file</span><span class="p">))</span>
        <span class="n">zones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;I_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">num_data_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zones</span><span class="p">)</span>
        <span class="n">row_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">zones</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;I_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">col_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">zones</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;J_taz_tm2_v2_2&quot;</span><span class="p">])</span>
        <span class="n">k_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_data_zones</span><span class="p">,</span> <span class="n">num_data_zones</span><span class="p">))</span>
        <span class="n">k_factors</span><span class="p">[</span><span class="n">row_index</span><span class="p">,</span> <span class="n">col_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;truck_k&quot;</span><span class="p">]</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_data_zones</span> <span class="o">&lt;</span> <span class="n">num_zones</span><span class="p">:</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">num_data_zones</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_zones</span> <span class="o">-</span> <span class="n">num_data_zones</span><span class="p">))</span>
            <span class="n">k_factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">k_factors</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k_factors</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for the CommercialVehicleModel component.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>Run controller for model run.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for the CommercialVehicleModel component.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Run controller for model run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="n">parse_num_processors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">num_processors</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.commercial.CommercialVehicleModel.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.demand.commercial.CommercialVehicleModel.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Run truck sub-model to generate assignable truck class demand.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/commercial.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run truck sub-model to generate assignable truck class demand.&quot;&quot;&quot;</span>
    <span class="c1"># future note: should not round intermediate results</span>
    <span class="c1"># future note: could use skim matrix cache from assignment (in same process)</span>
    <span class="c1">#              (save disk read time, minor optimization)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_emme</span><span class="p">()</span>
    <span class="n">taz_landuse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aggregate_landuse</span><span class="p">()</span>
    <span class="n">trip_ends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generation</span><span class="p">(</span><span class="n">taz_landuse</span><span class="p">)</span>
    <span class="n">daily_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span><span class="p">(</span><span class="n">trip_ends</span><span class="p">)</span>
    <span class="n">period_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_of_day</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span>
    <span class="n">class_demands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">class_demands</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.TruckConfig" class="doc doc-heading">
        <code>
tm2py.config.TruckConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TruckConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Truck model parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TruckConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Truck model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">k_factors_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">friction_factors_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">toll_choice_time_coefficient</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_balance_iterations</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">max_balance_relative_error</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




























  </div>

    </div>

  </div>

<h4 id="inter-regional-demand">Inter-regional Demand<a class="headerlink" href="#inter-regional-demand" title="Permanent link"> </a></h4>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.internal_external" class="doc doc-heading">
        <code>tm2py.components.demand.internal_external</code>



<a href="#tm2py.components.demand.internal_external" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Module containing Internal &lt;-&gt; External trip model.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.demand.internal_external.InternalExternal" class="doc doc-heading">
        <code>
InternalExternal            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.demand.internal_external.InternalExternal" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Create Internal &lt;-&gt; External trip tables.</p>
<h6 id="tm2py.components.demand.internal_external.InternalExternal--create-daily-demand-growth-forecast">Create daily demand (growth forecast)<a class="headerlink" href="#tm2py.components.demand.internal_external.InternalExternal--create-daily-demand-growth-forecast" title="Permanent link"> </a></h6>
<p>Create a daily matrix that includes internal/external, external/internal,
and external/external passenger vehicle travel (based on Census 2000 journey-to-work flows).
These trip tables are based on total traffic counts, which include trucks, but trucks are
not explicitly segmented from passenger vehicles.  This short-coming is a hold-over from
BAYCAST and will be addressed in the next model update.</p>
<p>The row and column totals are taken from count station data provided by Caltrans.  The
BAYCAST 2006 IX matrix is used as the base matrix and scaled to match forecast year growth
assumptions. The script generates estimates for the model forecast year; the growth rates
were discussed with neighboring MPOs as part of the SB 375 target setting process.</p>
<p>!!! input &ldquo;(1)  Station-specific assumed growth rates for each forecast year (the lack of&rdquo;
              external/external movements through the region allows simple factoring of
              cells without re-balancing);
         (2)  An input base matrix derived from the Census journey-to-work data.</p>
<p>!!! output &ldquo;(1) Four-table, forecast-year specific trip tables containing internal/external,&rdquo;
             external/internal, and external/external vehicle (xxx or person xxx) travel.</p>
<h6 id="tm2py.components.demand.internal_external.InternalExternal--time-of-day-split">Time of day split<a class="headerlink" href="#tm2py.components.demand.internal_external.InternalExternal--time-of-day-split" title="Permanent link"> </a></h6>
<p>Apply diurnal factors to the daily estimate of internal/external personal vehicle trips.
A separate sketch process is used to generate the internal/external trip table, which is
independent of land use patterns and congestion in the current implementation. The
internal/external trip table includes only passenger vehicles, and does not include trucks.</p>
<p>The diurnal factors are taken from the BAYCAST model.  The entire estimation of
internal/external travel demand is taken from the BAYCAST model and is not improved for
Travel Model One.</p>
<div class="admonition input">
<p class="admonition-title">(1)  A daily trip table, containing trips in production/attraction format for: drive<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code> alone (i.e. single-occupant personal passenger vehicle), shared ride 2
 (double-occupant personal passenger vehicle), and shared ride 3+
 (three-or-more-occupants personal passenger vehicle).
</code></pre></div></td></tr></table></div>

</p>
</div>
<p>!!! output &ldquo;(1)  time-of-day-specific estimates of internal/external demand, each&rdquo;
              time-of-day-specific matrices containing four tables, one for drive alone (da),
              one for shared ride 2 (sr2), and one for shared ride 3 (sr3).</p>
<h6 id="tm2py.components.demand.internal_external.InternalExternal--toll-choice">Toll choice<a class="headerlink" href="#tm2py.components.demand.internal_external.InternalExternal--toll-choice" title="Permanent link"> </a></h6>
<p>Apply a binomial choice model for drive alone, shared ride 2, and shared ride 3
internal/external personal vehicle travel.</p>
<div class="admonition input">
<p class="admonition-title">(1) Time-period-specific origin/destination matrices of drive alone, shared ride 2,<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>and share ride 3+ internal/external trip tables.
</code></pre></div></td></tr></table></div>

<p>(2) Skims providing the time and cost for value toll and non-value toll paths for each</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code>traffic_skims_{period}.omx, where {period} is the time period ID,
{class} is the class name da, sr2, sr2, with the following matrix names
  Non-value-toll paying time: {period}_{class}_time,
  Non-value-toll distance: {period}_{class}_dist,
  Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},
  Value-toll paying time is: {period}_{class}toll_time,
  Value-toll paying distance is: {period}_{class}toll_dist,
  Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},
  Value-toll value toll is: {period}_{class}toll_valuetoll_{class},
</code></pre></div></td></tr></table></div>

</p>
</div>
<p>!!! output &ldquo;Five, six-table trip matrices, one for each time period.  Two tables for each vehicle&rdquo;
         class representing value-toll paying path trips and non-value-toll paying path trips.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">InternalExternal</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create Internal &lt;-&gt; External trip tables.</span>

<span class="sd">    Create daily demand (growth forecast)</span>
<span class="sd">    -------------------------------------</span>
<span class="sd">    Create a daily matrix that includes internal/external, external/internal,</span>
<span class="sd">    and external/external passenger vehicle travel (based on Census 2000 journey-to-work flows).</span>
<span class="sd">    These trip tables are based on total traffic counts, which include trucks, but trucks are</span>
<span class="sd">    not explicitly segmented from passenger vehicles.  This short-coming is a hold-over from</span>
<span class="sd">    BAYCAST and will be addressed in the next model update.</span>

<span class="sd">    The row and column totals are taken from count station data provided by Caltrans.  The</span>
<span class="sd">    BAYCAST 2006 IX matrix is used as the base matrix and scaled to match forecast year growth</span>
<span class="sd">    assumptions. The script generates estimates for the model forecast year; the growth rates</span>
<span class="sd">    were discussed with neighboring MPOs as part of the SB 375 target setting process.</span>

<span class="sd">     Input:  (1)  Station-specific assumed growth rates for each forecast year (the lack of</span>
<span class="sd">                  external/external movements through the region allows simple factoring of</span>
<span class="sd">                  cells without re-balancing);</span>
<span class="sd">             (2)  An input base matrix derived from the Census journey-to-work data.</span>

<span class="sd">     Output: (1) Four-table, forecast-year specific trip tables containing internal/external,</span>
<span class="sd">                 external/internal, and external/external vehicle (xxx or person xxx) travel.</span>

<span class="sd">    Time of day split</span>
<span class="sd">    -----------------</span>
<span class="sd">    Apply diurnal factors to the daily estimate of internal/external personal vehicle trips.</span>
<span class="sd">    A separate sketch process is used to generate the internal/external trip table, which is</span>
<span class="sd">    independent of land use patterns and congestion in the current implementation. The</span>
<span class="sd">    internal/external trip table includes only passenger vehicles, and does not include trucks.</span>

<span class="sd">    The diurnal factors are taken from the BAYCAST model.  The entire estimation of</span>
<span class="sd">    internal/external travel demand is taken from the BAYCAST model and is not improved for</span>
<span class="sd">    Travel Model One.</span>

<span class="sd">    Input:  (1)  A daily trip table, containing trips in production/attraction format for: drive</span>
<span class="sd">                 alone (i.e. single-occupant personal passenger vehicle), shared ride 2</span>
<span class="sd">                 (double-occupant personal passenger vehicle), and shared ride 3+</span>
<span class="sd">                 (three-or-more-occupants personal passenger vehicle).</span>

<span class="sd">     Output: (1)  time-of-day-specific estimates of internal/external demand, each</span>
<span class="sd">                  time-of-day-specific matrices containing four tables, one for drive alone (da),</span>
<span class="sd">                  one for shared ride 2 (sr2), and one for shared ride 3 (sr3).</span>

<span class="sd">    Toll choice</span>
<span class="sd">    -----------</span>
<span class="sd">    Apply a binomial choice model for drive alone, shared ride 2, and shared ride 3</span>
<span class="sd">    internal/external personal vehicle travel.</span>

<span class="sd">    Input:  (1) Time-period-specific origin/destination matrices of drive alone, shared ride 2,</span>
<span class="sd">                and share ride 3+ internal/external trip tables.</span>
<span class="sd">            (2) Skims providing the time and cost for value toll and non-value toll paths for each</span>

<span class="sd">                traffic_skims_{period}.omx, where {period} is the time period ID,</span>
<span class="sd">                {class} is the class name da, sr2, sr2, with the following matrix names</span>
<span class="sd">                  Non-value-toll paying time: {period}_{class}_time,</span>
<span class="sd">                  Non-value-toll distance: {period}_{class}_dist,</span>
<span class="sd">                  Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},</span>
<span class="sd">                  Value-toll paying time is: {period}_{class}toll_time,</span>
<span class="sd">                  Value-toll paying distance is: {period}_{class}toll_dist,</span>
<span class="sd">                  Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},</span>
<span class="sd">                  Value-toll value toll is: {period}_{class}toll_valuetoll_{class},</span>

<span class="sd">     Output: Five, six-table trip matrices, one for each time period.  Two tables for each vehicle</span>
<span class="sd">             class representing value-toll paying path trips and non-value-toll paying path trips.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Docstring for component run.&quot;&quot;&quot;</span>
        <span class="n">input_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
        <span class="n">daily_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_growth_forecast</span><span class="p">(</span><span class="n">input_demand</span><span class="p">)</span>
        <span class="n">period_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_of_day</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span>
        <span class="n">class_demands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">class_demands</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Load reference matrices from .omx</span>

<span class="sd">        input file: config.internal_external.input_demand_file,</span>
<span class="sd">            default is inputs/nonres/ixDaily2006x4.may2208.new.omx</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">input_demand_file</span><span class="p">)</span>
        <span class="n">omx_file</span> <span class="o">=</span> <span class="n">_omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;da&quot;</span><span class="p">:</span> <span class="n">omx_file</span><span class="p">[</span><span class="s2">&quot;IX_Daily_DA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
            <span class="s2">&quot;sr2&quot;</span><span class="p">:</span> <span class="n">omx_file</span><span class="p">[</span><span class="s2">&quot;IX_Daily_SR2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
            <span class="s2">&quot;sr3&quot;</span><span class="p">:</span> <span class="n">omx_file</span><span class="p">[</span><span class="s2">&quot;IX_Daily_SR3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">omx_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">demand</span>

    <span class="k">def</span> <span class="nf">_growth_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Calculate adjusted demand based on scenario year and growth rates.</span>

<span class="sd">        Steps:</span>
<span class="sd">        - 1.1 apply special factors to certain gateways based on ID</span>
<span class="sd">          NOTE: these should be expressed such that we can put</span>
<span class="sd">                them in the config later</span>
<span class="sd">        - 1.2 apply gateway-specific annual growth rates to results of step 1</span>
<span class="sd">           to generate year specific forecast</span>

<span class="sd">        Args:</span>
<span class="sd">            demand: dictionary of input daily demand matrices (numpy arrays)</span>

<span class="sd">        Returns:</span>
<span class="sd">             Dictionary of Numpy matrices of daily PA by class mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Build adjustment matrix to be applied to all input matrices</span>
        <span class="c1"># special gateway adjustments based on zone index</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">scenario</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">demand</span><span class="p">[</span><span class="s2">&quot;da&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">special_factor_adjust</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">zone_index</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">factor</span>
            <span class="n">adj_matrix</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="n">factor</span>
            <span class="n">adj_matrix</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">num_years</span> <span class="o">=</span> <span class="n">year</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">reference_year</span><span class="p">)</span>
        <span class="c1"># apply total growth from annual growth rates at each gateway</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">annual_growth_rate</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">zone_index</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">num_years</span><span class="p">)</span>
            <span class="n">adj_matrix</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="n">factor</span>
            <span class="n">adj_matrix</span><span class="p">[:,</span> <span class="n">index</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">daily_prod_attract</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">*</span> <span class="n">adj_matrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">demand</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">daily_prod_attract</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_time_of_day</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">daily_prod_attract</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Calculate time of day matrices.</span>

<span class="sd">        input: results of _ix_forecast, daily PA matrices</span>
<span class="sd">        STEPS:</span>
<span class="sd">        2.1 apply time of day factors to convert 3 PA matrices into 15</span>
<span class="sd">            time of day O-D matrices</span>

<span class="sd">        Args:</span>
<span class="sd">            daily_prod_attract: dictionary of numpy arrays of daily PA totals</span>
<span class="sd">                with growth factors applied (factored to the scenario year)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Nested dictionary by period and class name of Numpy matrices of</span>
<span class="sd">            time period demand</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">period_demand</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">time_of_day_split</span><span class="p">:</span>
            <span class="n">class_demand</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">demand</span> <span class="ow">in</span> <span class="n">daily_prod_attract</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">prod</span><span class="p">,</span> <span class="n">attract</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">entry</span><span class="o">.</span><span class="n">production</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">entry</span><span class="o">.</span><span class="n">attraction</span>
                <span class="n">class_demand</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span> <span class="o">*</span> <span class="n">demand</span> <span class="o">+</span> <span class="n">attract</span> <span class="o">*</span> <span class="n">demand</span><span class="o">.</span><span class="n">T</span>
            <span class="n">period_demand</span><span class="p">[</span><span class="n">entry</span><span class="o">.</span><span class="n">time_period</span><span class="p">]</span> <span class="o">=</span> <span class="n">class_demand</span>
        <span class="k">return</span> <span class="n">period_demand</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_toll_choice</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">period_demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Binary toll / non-toll choice model by class.</span>

<span class="sd">        input: result of _ix_time_of_day</span>
<span class="sd">        skims:</span>
<span class="sd">            traffic_skims_{period}.omx, where {period} is the time period ID,</span>
<span class="sd">            {class} is the class name da, sr2, sr2, with the following matrix names</span>
<span class="sd">              Non-value-toll paying time: {period}_{class}_time,</span>
<span class="sd">              Non-value-toll distance: {period}_{class}_dist,</span>
<span class="sd">              Non-value-toll bridge toll is: {period}_{class}_bridgetoll_{class},</span>
<span class="sd">              Value-toll paying time is: {period}_{class}toll_time,</span>
<span class="sd">              Value-toll paying distance is: {period}_{class}toll_dist,</span>
<span class="sd">              Value-toll bridge toll is: {period}_{class}toll_bridgetoll_{class},</span>
<span class="sd">              Value-toll value toll is: {period}_{class}toll_valuetoll_{class},</span>

<span class="sd">        STEPS:</span>
<span class="sd">        3.1: For each time of day, for each da, sr2, sr3, calculate</span>
<span class="sd">             - utility of toll and nontoll</span>
<span class="sd">             - probability of toll / nontoll</span>
<span class="sd">             - split demand into toll and nontoll matrices</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toll_factors</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sr2&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">shared_ride_2_toll_factor</span><span class="p">,</span>
            <span class="s2">&quot;sr3&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">shared_ride_3_toll_factor</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">calculator</span> <span class="o">=</span> <span class="n">TollChoiceCalculator</span><span class="p">(</span>
            <span class="n">value_of_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">value_of_time</span><span class="p">,</span>
            <span class="n">coeff_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">toll_choice_time_coefficient</span><span class="p">,</span>
            <span class="n">operating_cost_per_mile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">operating_cost_per_mile</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">class_demand</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">demands</span> <span class="ow">in</span> <span class="n">period_demand</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">skim_path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">output_skim_path</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">skim_path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">))</span> <span class="k">as</span> <span class="n">skims</span><span class="p">:</span>
                <span class="n">calculator</span><span class="o">.</span><span class="n">set_omx_manager</span><span class="p">(</span><span class="n">skims</span><span class="p">)</span>
                <span class="n">split_demand</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">total_trips</span> <span class="ow">in</span> <span class="n">demands</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">e_util_nontoll</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">calc_exp_util</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_dist&quot;</span><span class="p">,</span>
                        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_bridgetoll</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
                        <span class="n">toll_factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">e_util_toll</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">calc_exp_util</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">toll_time&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">toll_dist&quot;</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_bridgetoll</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">toll_valuetoll</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">],</span>
                        <span class="n">toll_factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">prob_nontoll</span> <span class="o">=</span> <span class="n">e_util_nontoll</span> <span class="o">/</span> <span class="p">(</span><span class="n">e_util_toll</span> <span class="o">+</span> <span class="n">e_util_nontoll</span><span class="p">)</span>
                    <span class="n">calculator</span><span class="o">.</span><span class="n">mask_non_available</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">toll_valuetoll</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">,</span>
                        <span class="n">prob_nontoll</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">split_demand</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_nontoll</span> <span class="o">*</span> <span class="n">total_trips</span>
                    <span class="n">split_demand</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">toll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prob_nontoll</span><span class="p">)</span> <span class="o">*</span> <span class="n">total_trips</span>

                <span class="n">class_demand</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_demand</span>
        <span class="k">return</span> <span class="n">class_demand</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_export_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]]):</span>
        <span class="sd">&quot;&quot;&quot;Export assignable class demands to OMX files by time-of-day.&quot;&quot;&quot;</span>
        <span class="n">path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">internal_external</span><span class="o">.</span><span class="n">highway_demand_file</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path_tmplt</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">period</span><span class="p">,</span> <span class="n">matrices</span> <span class="ow">in</span> <span class="n">demand</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">output_file</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.demand.internal_external.InternalExternal.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.demand.internal_external.InternalExternal.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Docstring for component run.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/demand/internal_external.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Docstring for component run.&quot;&quot;&quot;</span>
    <span class="n">input_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
    <span class="n">daily_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_growth_forecast</span><span class="p">(</span><span class="n">input_demand</span><span class="p">)</span>
    <span class="n">period_demand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_time_of_day</span><span class="p">(</span><span class="n">daily_demand</span><span class="p">)</span>
    <span class="n">class_demands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toll_choice</span><span class="p">(</span><span class="n">period_demand</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">class_demands</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.InternalExternalConfig" class="doc doc-heading">
        <code>
tm2py.config.InternalExternalConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.InternalExternalConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Internal &lt;-&gt; External model parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">InternalExternalConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Internal &lt;-&gt; External model parameters.&quot;&quot;&quot;</span>

    <span class="n">highway_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">input_demand_file</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reference_year</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">toll_choice_time_coefficient</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">shared_ride_2_toll_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">shared_ride_3_toll_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">time_of_day_split</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TimeOfDaySplitConfig</span><span class="p">]</span>
    <span class="n">annual_growth_rate</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">GateFactorConfig</span><span class="p">]</span>
    <span class="n">special_factor_adjust</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">GateFactorConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span>
    <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">































  </div>

    </div>

  </div>

<h4 id="visitor-demand">Visitor Demand<a class="headerlink" href="#visitor-demand" title="Permanent link"> </a></h4>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.demand.visitor" class="doc doc-heading">
        <code>tm2py.components.demand.visitor</code>



<a href="#tm2py.components.demand.visitor" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Visitor module.</p>


    </div>

  </div>

<h3 id="highway-network-components">Highway Network Components<a class="headerlink" href="#highway-network-components" title="Permanent link"> </a></h3>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.highway.highway_network" class="doc doc-heading">
        <code>tm2py.components.network.highway.highway_network</code>



<a href="#tm2py.components.network.highway.highway_network" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Module for highway network preparation steps.</p>
<p>Creates required attributes and populates input values needed
for highway assignments. The toll values, VDFs, per-class cost
(tolls+operating costs), modes and skim link attributes are calculated.</p>
<p>The following link attributes are used as input:
    - &ldquo;@capclass&rdquo;: link capclass index
    - &ldquo;length&rdquo;: standard link length, in miles
    - &ldquo;@tollbooth&rdquo;: label to separate bridgetolls from valuetolls
    - &ldquo;@tollseg&rdquo;: toll segment, used to index toll value lookups from the toll file
        (under config.highway.tolls.file_path)
    - &ldquo;@ft&rdquo;: functional class, used to assign VDFs</p>
<p>The following keys and tables are used from the config:
    highway.tolls.file_path: relative path to input toll file
    highway.tolls.src_vehicle_group_names: names used in tolls file for
        toll class values
    highway.tolls.dst_vehicle_group_names: corresponding names used in
        network attributes toll classes
    highway.tolls.tollbooth_start_index: index to split point bridge tolls
        (&lt; this value) from distance value tolls (&gt;= this value)
    highway.classes: the list of assignment classes, see the notes under
        highway_assign for detailed explanation
    highway.capclass_lookup: the lookup table mapping the link @capclass setting
        to capacity (@capacity), free_flow_speed (@free_flow_speec) and
        critical_speed (used to calculate @ja for akcelik type functions)
    highway.generic_highway_mode_code: unique (with other mode_codes) single
        character used to label entire auto network in Emme
    highway.maz_to_maz.mode_code: unique (with other mode_codes) single
        character used to label MAZ local auto network including connectors</p>
<p>The following link attributes are created (overwritten) and are subsequently used in
the highway assignments.
    - &ldquo;@flow_XX&rdquo;: link PCE flows per class, where XX is the class name in the config
    - &ldquo;@maz_flow&rdquo;: Assigned MAZ-to-MAZ flow</p>
<p>The following attributes are calculated:
    - vdf: volume delay function to use
    - &ldquo;@capacity&rdquo;: total link capacity
    - &ldquo;@ja&rdquo;: akcelik delay parameter
    - &ldquo;@hov_length&rdquo;: length with HOV lanes
    - &ldquo;@toll_length&rdquo;: length with tolls
    - &ldquo;@bridgetoll_YY&rdquo;: the bridge toll for class subgroup YY
    - &ldquo;@valuetoll_YY&rdquo;: the &ldquo;value&rdquo;, non-bridge toll for class subgroup YY
    - &ldquo;@cost_YY&rdquo;: total cost for class YY</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_network.PrepareNetwork" class="doc doc-heading">
        <code>
PrepareNetwork            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway network preparation.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PrepareNetwork</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway network preparation.&quot;&quot;&quot;</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare network attributes and modes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run network preparation step.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;prepare for highway assignment </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">):</span>
                <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">time</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_class_attributes</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="n">network</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_tolls</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_vdf_attributes</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_modes</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_skim_lengths</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_class_costs</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
                <span class="n">scenario</span><span class="o">.</span><span class="n">publish_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
        <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Tolls file (config.highway.tolls.file_path) does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tolls file does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">src_veh_groups</span><span class="p">:</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">vehicle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
            <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                    <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Tolls file missing column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FileFormatError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Tolls file missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_class_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create required network attributes including per-class cost and flow attributes.&quot;&quot;&quot;</span>
        <span class="n">create_attribute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.extra_attribute.create_extra_attribute&quot;</span>
        <span class="p">)</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;@capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;total link capacity&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@ja&quot;</span><span class="p">,</span> <span class="s2">&quot;akcelik delay parameter&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@maz_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;Assigned MAZ-to-MAZ flow&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">,</span> <span class="s2">&quot;length with HOV lanes&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">,</span> <span class="s2">&quot;length with tolls&quot;</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="c1"># toll field attributes by bridge and value and toll definition</span>
        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="k">for</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="n">dst_veh_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">toll_type</span> <span class="ow">in</span> <span class="s2">&quot;bridge&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span>
                <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;@</span><span class="si">{</span><span class="n">toll_type</span><span class="si">}</span><span class="s2">toll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toll_type</span><span class="si">}</span><span class="s2"> toll value for </span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># results for link cost and assigned flow</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> total costs&#39;</span><span class="p">[:</span><span class="mi">40</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;LINK&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@flow_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> link volume&#39;</span><span class="p">[:</span><span class="mi">40</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">create_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_tolls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the tolls in the network from the toll reference file.&quot;&quot;&quot;</span>
        <span class="n">toll_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_toll_indices</span><span class="p">()</span>
        <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="n">tollbooth_start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">tollbooth_start_index</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
                    <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollseg&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span>
                    <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">data_row</span> <span class="o">=</span> <span class="n">toll_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data_row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;set tolls failed index lookup </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">, link </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>  <span class="c1"># tolls will remain at zero</span>
                <span class="c1"># if index is below tollbooth start index then this is a bridge</span>
                <span class="c1"># (point toll), available for all traffic assignment classes</span>
                <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tollbooth_start_index</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">src_veh</span><span class="p">,</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_veh_groups</span><span class="p">,</span> <span class="n">dst_veh_groups</span><span class="p">):</span>
                        <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@bridgetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">data_row</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">src_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># else, this is a tollway with a per-mile charge</span>
                    <span class="k">for</span> <span class="n">src_veh</span><span class="p">,</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_veh_groups</span><span class="p">,</span> <span class="n">dst_veh_groups</span><span class="p">):</span>
                        <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">data_row</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time_period</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">src_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
                            <span class="o">*</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
                            <span class="o">*</span> <span class="mi">100</span>
                        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_toll_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get the mapping of toll lookup table from the toll reference file.&quot;&quot;&quot;</span>
        <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll_file_path </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tolls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">toll_file</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span>
                <span class="n">tolls</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">tolls</span>

    <span class="k">def</span> <span class="nf">_set_vdf_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set capacity, VDF and critical speed on links.&quot;&quot;&quot;</span>
        <span class="n">capacity_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">critical_speed_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">capclass_lookup</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">capacity_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;capclass&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capacity&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;critical_speed&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">critical_speed_map</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;capclass&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;critical_speed&quot;</span><span class="p">)</span>
        <span class="n">tp_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">tp</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tp</span><span class="o">.</span><span class="n">highway_capacity_factor</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span>
        <span class="p">}</span>
        <span class="n">period_capacity_factor</span> <span class="o">=</span> <span class="n">tp_mapping</span><span class="p">[</span><span class="n">time_period</span><span class="p">]</span>
        <span class="n">akcelik_vdfs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">cap_lanehour</span> <span class="o">=</span> <span class="n">capacity_map</span><span class="p">[</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capclass&quot;</span><span class="p">]]</span>
            <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capacity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cap_lanehour</span> <span class="o">*</span> <span class="n">period_capacity_factor</span> <span class="o">*</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">]</span>
            <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ft&quot;</span><span class="p">])</span>
            <span class="c1"># re-mapping links with type 99 to type 7 &quot;local road of minor importance&quot;</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">==</span> <span class="mi">99</span><span class="p">:</span>
                <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="o">=</span> <span class="mi">7</span>
            <span class="c1"># num_lanes not used directly, but set for reference</span>
            <span class="n">link</span><span class="o">.</span><span class="n">num_lanes</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mf">9.9</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@lanes&quot;</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">volume_delay_func</span> <span class="ow">in</span> <span class="n">akcelik_vdfs</span> <span class="ow">and</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@free_flow_speed&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
                <span class="n">critical_speed</span> <span class="o">=</span> <span class="n">critical_speed_map</span><span class="p">[</span><span class="n">link</span><span class="p">[</span><span class="s2">&quot;@capclass&quot;</span><span class="p">]]</span>
                <span class="n">t_c</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">critical_speed</span>
                <span class="n">t_o</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@free_flow_speed&quot;</span><span class="p">]</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@ja&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_c</span> <span class="o">-</span> <span class="n">t_o</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_set_link_modes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the link modes based on the per-class &#39;excluded_links&#39; set.&quot;&quot;&quot;</span>
        <span class="c1"># first reset link modes (script run more than once)</span>
        <span class="c1"># &quot;generic_highway_mode_code&quot; must already be created (in import to Emme script)</span>
        <span class="n">auto_mode</span> <span class="o">=</span> <span class="p">{</span><span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">generic_highway_mode_code</span><span class="p">)}</span>
        <span class="n">used_modes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span>
        <span class="p">}</span>
        <span class="n">used_modes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">mode_code</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">-=</span> <span class="n">used_modes</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@drive_link&quot;</span><span class="p">]:</span>
                <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">|=</span> <span class="n">auto_mode</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">used_modes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">network</span><span class="o">.</span><span class="n">delete_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

        <span class="c1"># Create special access/egress mode for MAZ connectors</span>
        <span class="n">maz_access_mode</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">create_mode</span><span class="p">(</span>
            <span class="s2">&quot;AUX_AUTO&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">mode_code</span>
        <span class="p">)</span>
        <span class="n">maz_access_mode</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;MAZ access&quot;</span>
        <span class="c1"># create modes from class spec</span>
        <span class="c1"># (duplicate mode codes allowed provided the excluded_links is the same)</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>
                    <span class="o">!=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span>
                    <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;config error: highway.classes, duplicated mode codes &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(&#39;</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="si">}</span><span class="s2">&#39;) with different excluded &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">create_mode</span><span class="p">(</span><span class="s2">&quot;AUX_AUTO&quot;</span><span class="p">,</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">)</span>
            <span class="n">mode</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">name</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span>

        <span class="n">dst_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="n">modes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">link</span><span class="o">.</span><span class="n">modes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">i_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">link</span><span class="o">.</span><span class="n">j_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">modes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">maz_access_mode</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">modes</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@drive_link&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">exclude_links_map</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;is_sr&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                <span class="s2">&quot;is_sr2&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s2">&quot;is_sr3&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span>
                <span class="s2">&quot;is_auto_only&quot;</span><span class="p">:</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">dst_veh</span> <span class="ow">in</span> <span class="n">dst_veh_groups</span><span class="p">:</span>
                <span class="n">exclude_links_map</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">link</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">dst_veh</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_apply_exclusions</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">excluded_links</span><span class="p">,</span>
                <span class="n">maz_access_mode</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">modes</span><span class="p">,</span>
                <span class="n">exclude_links_map</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_apply_exclusions</span><span class="p">(</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">excluded_links</span><span class="p">,</span>
                    <span class="n">assign_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">,</span>
                    <span class="n">modes</span><span class="p">,</span>
                    <span class="n">exclude_links_map</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">link</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="n">modes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_apply_exclusions</span><span class="p">(</span>
        <span class="n">excluded_links_criteria</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">modes_set</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">link_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Apply the exclusion criteria to set the link modes.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">criteria</span> <span class="ow">in</span> <span class="n">excluded_links_criteria</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link_values</span><span class="p">[</span><span class="n">criteria</span><span class="p">]:</span>
                <span class="k">return</span>
        <span class="n">modes_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mode_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calc_link_skim_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the length attributes used in the highway skims.&quot;&quot;&quot;</span>
        <span class="n">tollbooth_start_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">tollbooth_start_index</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
            <span class="c1"># distance in hov lanes / facilities</span>
            <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@useclass&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@hov_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># distance on non-bridge toll facilities</span>
            <span class="k">if</span> <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@tollbooth&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">tollbooth_start_index</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;@toll_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_calc_link_class_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">network</span><span class="p">:</span> <span class="n">EmmeNetwork</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the per-class link cost from the tolls and operating costs.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">assign_class</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
            <span class="n">cost_attr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="n">assign_class</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">op_cost</span> <span class="o">=</span> <span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;operating_cost_per_mile&quot;</span><span class="p">]</span>
            <span class="n">toll_factor</span> <span class="o">=</span> <span class="n">assign_class</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;toll_factor&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">toll_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">toll_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">links</span><span class="p">():</span>
                <span class="n">toll_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="n">toll_attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">toll_attr</span> <span class="ow">in</span> <span class="n">assign_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">])</span>
                <span class="n">link</span><span class="p">[</span><span class="n">cost_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">length</span> <span class="o">*</span> <span class="n">op_cost</span> <span class="o">+</span> <span class="n">toll_value</span> <span class="o">*</span> <span class="n">toll_factor</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Run network preparation step.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Prepare network attributes and modes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run network preparation step.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;prepare for highway assignment </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">):</span>
            <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">time</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_class_attributes</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="n">network</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tolls</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_vdf_attributes</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_modes</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_skim_lengths</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calc_link_class_costs</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">publish_network</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.network.highway.highway_network.PrepareNetwork.validate_inputs" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate inputs files are correct, raise if an error is found.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_network.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate inputs files are correct, raise if an error is found.&quot;&quot;&quot;</span>
    <span class="n">toll_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Tolls file (config.highway.tolls.file_path) does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tolls file does not exist: </span><span class="si">{</span><span class="n">toll_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">src_veh_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">tolls</span><span class="o">.</span><span class="n">src_vehicle_group_names</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fac_index&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">src_veh_groups</span><span class="p">:</span>
            <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;toll</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">vehicle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">toll_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">toll_file</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">next</span><span class="p">(</span><span class="n">toll_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Tolls file missing column: </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span>
                <span class="p">)</span>
    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">FileFormatError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Tolls file missing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2"> columns: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.highway.highway_assign" class="doc doc-heading">
        <code>tm2py.components.network.highway.highway_assign</code>



<a href="#tm2py.components.network.highway.highway_assign" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Highway assignment and skim component.</p>
<p>Performs equilibrium traffic assignment and generates resulting skims.
The assignmend is configured using the &ldquo;highway&rdquo; table in the source config.
See the config documentation for details. The traffic assignment runs according
to the list of assignment classes under highway.classes.</p>
<p>Other relevant parameters from the config are:
- emme.num_processors: number of processors as integer or &ldquo;MAX&rdquo; or &ldquo;MAX-N&rdquo;
- time_periods[].emme_scenario_id: Emme scenario number to use for each period
- time_periods[].highway_capacity_factor</p>
<p>The Emme network must have the following attributes available:</p>
<p>Link - attributes:
- &ldquo;length&rdquo; in feet
- &ldquo;vdf&rdquo;, volume delay function (volume delay functions must also be setup)
- &ldquo;@useclass&rdquo;, vehicle-class restrictions classification, auto-only, HOV only
- &ldquo;@free_flow_time&rdquo;, the free flow time (in minutes)
- &ldquo;@tollXX_YY&rdquo;, the toll for period XX and class subgroup (see truck
    class) named YY, used together with @tollbooth to generate @bridgetoll_YY
    and @valuetoll_YY
- &ldquo;@maz_flow&rdquo;, the background traffic MAZ-to-MAZ SP assigned flow from highway_maz,
    if controller.iteration &gt; 0
- modes: must be set on links and match the specified mode codes in
    the traffic config</p>
<p>Network results - attributes:
- @flow_XX: link PCE flows per class, where XX is the class name in the config
- timau: auto travel time
- volau: total assigned flow in PCE</p>
<p>Notes:
- Output matrices are in miles, minutes, and cents (2010 dollars) and are stored/
as real values;
- Intrazonal distance/time is one half the distance/time to the nearest neighbor;
- Intrazonal bridge and value tolls are assumed to be zero</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_assign.AssignmentClass" class="doc doc-heading">
        <code>
AssignmentClass        </code>



<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway assignment class, represents data from config and conversion to Emme specs.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AssignmentClass</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment class, represents data from config and conversion to Emme specs.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">iteration</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor of Highway Assignment class.</span>

<span class="sd">        Args:</span>
<span class="sd">            class_config (_type_): _description_</span>
<span class="sd">            time_period (_type_): _description_</span>
<span class="sd">            iteration (_type_): _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span> <span class="o">=</span> <span class="n">class_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_period</span> <span class="o">=</span> <span class="n">time_period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skims</span> <span class="o">=</span> <span class="n">class_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skims&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_highway_class_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeHighwayClassSpec</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Construct and return Emme traffic assignment class specification.</span>

<span class="sd">        Converted from input config (highway.classes), see Emme Help for</span>
<span class="sd">        SOLA traffic assignment for specification details.</span>
<span class="sd">        Adds time_period as part of demand and skim matrix names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A nested dictionary corresponding to the expected Emme traffic</span>
<span class="sd">            class specification used in the SOLA assignment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">demand_matrix</span> <span class="o">=</span> <span class="s1">&#39;ms&quot;zero&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">demand_matrix</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="n">class_spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">mode_code</span><span class="p">,</span>
            <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="n">demand_matrix</span><span class="p">,</span>
            <span class="s2">&quot;generalized_cost&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;link_costs&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># cost in $0.01</span>
                <span class="c1"># $/hr -&gt; min/$0.01</span>
                <span class="s2">&quot;perception_factor&quot;</span><span class="p">:</span> <span class="mf">0.6</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span><span class="o">.</span><span class="n">value_of_time</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;link_volumes&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@flow_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;od_travel_times&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;shortest_paths&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;path_analyses&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">emme_class_analysis</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">class_spec</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">emme_class_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeHighwayAnalysisSpec</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Construct and return a list of path analyses specs which generate the required skims.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of nested dictionaries corresponding to the Emme path analysis</span>
<span class="sd">            (per-class) specification used in the SOLA assignment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">class_analysis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
            <span class="n">class_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emme_analysis_spec</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;@cost_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                    <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_cost&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">skim_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skim_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">skim_type</span><span class="p">:</span>
                <span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">skim_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">skim_type</span><span class="si">}{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">class_analysis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">emme_analysis_spec</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span><span class="p">),</span>
                    <span class="n">matrix_name</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">class_analysis</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">skim_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Returns: List of skim matrix names for this class.&quot;&quot;&quot;</span>
        <span class="n">skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
            <span class="n">skim_matrices</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_time&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_cost&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">skim_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skims</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skim_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">skim_type</span><span class="p">:</span>
                <span class="n">skim_type</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">skim_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">skim_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">skim_type</span><span class="si">}{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">skim_matrices</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">emme_analysis_spec</span><span class="p">(</span><span class="n">link_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeHighwayAnalysisSpec</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns Emme highway class path analysis spec.</span>

<span class="sd">        See Emme Help for SOLA assignment for full specification details.</span>
<span class="sd">        Args:</span>
<span class="sd">            link_attr: input link attribute for which to sum values along the paths</span>
<span class="sd">            matrix_name: full matrix name to store the result of the path analysis</span>

<span class="sd">        Returns:</span>
<span class="sd">            The nested dictionary specification which will generate the skim</span>
<span class="sd">            of link attribute values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis_spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;link_component&quot;</span><span class="p">:</span> <span class="n">link_attr</span><span class="p">,</span>
            <span class="s2">&quot;turn_component&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selection_threshold&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
            <span class="s2">&quot;path_to_od_composition&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;considered_paths&quot;</span><span class="p">:</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
                <span class="s2">&quot;multiply_path_proportions_by&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;analyzed_demand&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;path_value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;od_values&quot;</span><span class="p">:</span> <span class="n">matrix_name</span><span class="p">,</span>
                <span class="s2">&quot;selected_link_volumes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;selected_turn_volumes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">analysis_spec</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the link attribute name for the specified skim type and group.</span>

<span class="sd">        Args:</span>
<span class="sd">            skim: name of skim requested, one of dist, hovdist, tolldist, freeflowtime,</span>
<span class="sd">                bridgetoll, or valuetoll</span>
<span class="sd">            group: subgroup name for the bridgetoll or valuetoll, corresponds to one of</span>
<span class="sd">                the names from config.highway.tolls.dst_vehicle_group_names</span>
<span class="sd">        Returns:</span>
<span class="sd">            A string of the link attribute name used in the analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>  <span class="c1"># NOTE: length must be in miles</span>
            <span class="s2">&quot;hovdist&quot;</span><span class="p">:</span> <span class="s2">&quot;@hov_length&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tolldist&quot;</span><span class="p">:</span> <span class="s2">&quot;@toll_length&quot;</span><span class="p">,</span>
            <span class="s2">&quot;freeflowtime&quot;</span><span class="p">:</span> <span class="s2">&quot;@free_flow_time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bridgetoll&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@bridgetoll_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;valuetoll&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">lookup</span><span class="p">[</span><span class="n">skim</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.emme_class_analysis" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_class_analysis</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeHighwayAnalysisSpec</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_class_analysis" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Construct and return a list of path analyses specs which generate the required skims.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[EmmeHighwayAnalysisSpec]</code></td>
      <td><p>A list of nested dictionaries corresponding to the Emme path analysis
(per-class) specification used in the SOLA assignment.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.emme_highway_class_spec" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_highway_class_spec</span><span class="p">:</span> <span class="n">EmmeHighwayClassSpec</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_highway_class_spec" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Construct and return Emme traffic assignment class specification.</p>
<p>Converted from input config (highway.classes), see Emme Help for
SOLA traffic assignment for specification details.
Adds time_period as part of demand and skim matrix names.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>EmmeHighwayClassSpec</code></td>
      <td><p>A nested dictionary corresponding to the expected Emme traffic
class specification used in the SOLA assignment.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.skim_matrices" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">skim_matrices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_matrices" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor of Highway Assignment class.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>class_config</code></td>
        <td><code>_type_</code></td>
        <td><p><em>description</em></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>time_period</code></td>
        <td><code>_type_</code></td>
        <td><p><em>description</em></p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>iteration</code></td>
        <td><code>_type_</code></td>
        <td><p><em>description</em></p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_config</span><span class="p">,</span> <span class="n">time_period</span><span class="p">,</span> <span class="n">iteration</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor of Highway Assignment class.</span>

<span class="sd">    Args:</span>
<span class="sd">        class_config (_type_): _description_</span>
<span class="sd">        time_period (_type_): _description_</span>
<span class="sd">        iteration (_type_): _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">class_config</span> <span class="o">=</span> <span class="n">class_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_period</span> <span class="o">=</span> <span class="n">time_period</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">skims</span> <span class="o">=</span> <span class="n">class_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skims&quot;</span><span class="p">,</span> <span class="p">[])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.emme_analysis_spec" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emme_analysis_spec</span><span class="p">(</span><span class="n">link_attr</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.emme_analysis_spec" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Returns Emme highway class path analysis spec.</p>
<p>See Emme Help for SOLA assignment for full specification details.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>link_attr</code></td>
        <td><code>str</code></td>
        <td><p>input link attribute for which to sum values along the paths</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>matrix_name</code></td>
        <td><code>str</code></td>
        <td><p>full matrix name to store the result of the path analysis</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>EmmeHighwayAnalysisSpec</code></td>
      <td><p>The nested dictionary specification which will generate the skim
of link attribute values.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">emme_analysis_spec</span><span class="p">(</span><span class="n">link_attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeHighwayAnalysisSpec</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns Emme highway class path analysis spec.</span>

<span class="sd">    See Emme Help for SOLA assignment for full specification details.</span>
<span class="sd">    Args:</span>
<span class="sd">        link_attr: input link attribute for which to sum values along the paths</span>
<span class="sd">        matrix_name: full matrix name to store the result of the path analysis</span>

<span class="sd">    Returns:</span>
<span class="sd">        The nested dictionary specification which will generate the skim</span>
<span class="sd">        of link attribute values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analysis_spec</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;link_component&quot;</span><span class="p">:</span> <span class="n">link_attr</span><span class="p">,</span>
        <span class="s2">&quot;turn_component&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
        <span class="s2">&quot;selection_threshold&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
        <span class="s2">&quot;path_to_od_composition&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;considered_paths&quot;</span><span class="p">:</span> <span class="s2">&quot;ALL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;multiply_path_proportions_by&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;analyzed_demand&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;path_value&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;od_values&quot;</span><span class="p">:</span> <span class="n">matrix_name</span><span class="p">,</span>
            <span class="s2">&quot;selected_link_volumes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;selected_turn_volumes&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">analysis_spec</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_assign.AssignmentClass.skim_analysis_link_attribute" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.AssignmentClass.skim_analysis_link_attribute" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Return the link attribute name for the specified skim type and group.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>skim</code></td>
        <td><code>str</code></td>
        <td><p>name of skim requested, one of dist, hovdist, tolldist, freeflowtime,
bridgetoll, or valuetoll</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>group</code></td>
        <td><code>str</code></td>
        <td><p>subgroup name for the bridgetoll or valuetoll, corresponds to one of
the names from config.highway.tolls.dst_vehicle_group_names</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>A string of the link attribute name used in the analysis.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">skim_analysis_link_attribute</span><span class="p">(</span><span class="n">skim</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return the link attribute name for the specified skim type and group.</span>

<span class="sd">    Args:</span>
<span class="sd">        skim: name of skim requested, one of dist, hovdist, tolldist, freeflowtime,</span>
<span class="sd">            bridgetoll, or valuetoll</span>
<span class="sd">        group: subgroup name for the bridgetoll or valuetoll, corresponds to one of</span>
<span class="sd">            the names from config.highway.tolls.dst_vehicle_group_names</span>
<span class="sd">    Returns:</span>
<span class="sd">        A string of the link attribute name used in the analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lookup</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>  <span class="c1"># NOTE: length must be in miles</span>
        <span class="s2">&quot;hovdist&quot;</span><span class="p">:</span> <span class="s2">&quot;@hov_length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tolldist&quot;</span><span class="p">:</span> <span class="s2">&quot;@toll_length&quot;</span><span class="p">,</span>
        <span class="s2">&quot;freeflowtime&quot;</span><span class="p">:</span> <span class="s2">&quot;@free_flow_time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bridgetoll&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@bridgetoll_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;valuetoll&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;@valuetoll_</span><span class="si">{</span><span class="n">group</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">lookup</span><span class="p">[</span><span class="n">skim</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_assign.HighwayAssignment" class="doc doc-heading">
        <code>
HighwayAssignment            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Highway assignment and skims.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>parent RunController object</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayAssignment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skims.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for HighwayAssignment components.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Reference to current run controller.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">parse_num_processors</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">num_processors</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Highway assignment and skims&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run highway assignment.&quot;&quot;&quot;</span>
        <span class="n">demand</span> <span class="o">=</span> <span class="n">PrepareHighwayDemand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">demand</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
            <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">time</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
                <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
                <span class="n">assign_classes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">AssignmentClass</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_copy_maz_flow</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_background_traffic</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_skim_matrices</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">assign_classes</span><span class="p">)</span>
                <span class="n">assign_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_assignment_spec</span><span class="p">(</span><span class="n">assign_classes</span><span class="p">)</span>
                <span class="c1"># self.logger.log_dict(assign_spec, level=&quot;DEBUG&quot;)</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                    <span class="s2">&quot;Run SOLA assignment with path analyses&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
                <span class="p">):</span>
                    <span class="n">assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
                        <span class="s2">&quot;inro.emme.traffic_assignment.sola_traffic_assignment&quot;</span>
                    <span class="p">)</span>
                    <span class="n">assign</span><span class="p">(</span><span class="n">assign_spec</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">chart_log_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Subtract non-time costs from gen cost to get the raw travel time</span>
                <span class="k">for</span> <span class="n">emme_class_spec</span> <span class="ow">in</span> <span class="n">assign_spec</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_calc_time_skim</span><span class="p">(</span><span class="n">emme_class_spec</span><span class="p">)</span>
                <span class="c1"># Set intra-zonal for time and dist to be 1/2 nearest neighbour</span>
                <span class="k">for</span> <span class="n">class_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_intrazonal_values</span><span class="p">(</span>
                        <span class="n">time</span><span class="p">,</span>
                        <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                        <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_skims</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_enabled</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug_report</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setup and teardown for Emme Matrix cache and list of skim matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">            time_period: time period name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="n">MatrixCache</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Highway assignment for period </span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_copy_maz_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy maz_flow from MAZ demand assignment to ul1 for background traffic.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span>
            <span class="s2">&quot;Copy @maz_flow to ul1 for background traffic&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="p">(</span><span class="s2">&quot;ul1&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_flow&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reset_background_traffic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set ul1 for background traffic to 0 (no maz-maz flow).</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span>
            <span class="s2">&quot;Set ul1 to 0 for background traffic&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="p">(</span><span class="s2">&quot;ul1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_skim_matrices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">assign_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AssignmentClass</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create matrices to store skim results in Emme database.</span>

<span class="sd">        Also add the matrices to list of self._skim_matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">            assign_classes: list of AssignmentClass objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">create_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.matrix.create_matrix&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="s2">&quot;Creating skim matrices&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">assign_classes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">matrix_name</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="n">skim_matrices</span><span class="p">:</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mf&quot;</span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">matrix</span><span class="p">:</span>
                        <span class="n">matrix</span> <span class="o">=</span> <span class="n">create_matrix</span><span class="p">(</span>
                            <span class="s2">&quot;mf&quot;</span><span class="p">,</span> <span class="n">matrix_name</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="n">scenario</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Create matrix name: </span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s2">, id: </span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_assignment_spec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">assign_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AssignmentClass</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeTrafficAssignmentSpec</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate template Emme SOLA assignment specification.</span>

<span class="sd">        Args:</span>
<span class="sd">            assign_classes: list of AssignmentClass objects</span>

<span class="sd">        Returns</span>
<span class="sd">            Emme specification for SOLA traffic assignment</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relative_gap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">relative_gap</span>
        <span class="n">max_iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">max_iterations</span>
        <span class="c1"># NOTE: mazmazvol as background traffic in link.data1 (&quot;ul1&quot;)</span>
        <span class="n">base_spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SOLA_TRAFFIC_ASSIGNMENT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;background_traffic&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;link_component&quot;</span><span class="p">:</span> <span class="s2">&quot;ul1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;turn_component&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;add_transit_vehicles&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;classes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">klass</span><span class="o">.</span><span class="n">emme_highway_class_spec</span> <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="n">assign_classes</span><span class="p">],</span>
            <span class="s2">&quot;stopping_criteria&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_iterations&quot;</span><span class="p">:</span> <span class="n">max_iterations</span><span class="p">,</span>
                <span class="s2">&quot;best_relative_gap&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">&quot;relative_gap&quot;</span><span class="p">:</span> <span class="n">relative_gap</span><span class="p">,</span>
                <span class="s2">&quot;normalized_gap&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span><span class="p">},</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">base_spec</span>

    <span class="k">def</span> <span class="nf">_calc_time_skim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emme_class_spec</span><span class="p">:</span> <span class="n">EmmeHighwayClassSpec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the real time skim =gen_cost-per_fac*link_costs.</span>

<span class="sd">        Args:</span>
<span class="sd">            emme_class_spec: dictionary of the per-class spec sub-section from the</span>
<span class="sd">                Emme SOLA assignment spec, classes list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">od_travel_times</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;od_travel_times&quot;</span><span class="p">][</span>
            <span class="s2">&quot;shortest_paths&quot;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">od_travel_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Total link costs is always the first analysis</span>
            <span class="n">cost</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;path_analyses&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;od_values&quot;</span><span class="p">]</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="n">emme_class_spec</span><span class="p">[</span><span class="s2">&quot;generalized_cost&quot;</span><span class="p">][</span><span class="s2">&quot;perception_factor&quot;</span><span class="p">]</span>
            <span class="n">gencost_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">od_travel_times</span><span class="p">)</span>
            <span class="n">cost_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">cost</span><span class="p">)</span>
            <span class="n">time_data</span> <span class="o">=</span> <span class="n">gencost_data</span> <span class="o">-</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">cost_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">od_travel_times</span><span class="p">,</span> <span class="n">time_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_intrazonal_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">skims</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the intrazonal values to 1/2 nearest neighbour for time and distance skims.</span>

<span class="sd">        Args:</span>
<span class="sd">            time_period: time period name (from config)</span>
<span class="sd">            class_name: highway class name (from config)</span>
<span class="sd">            skims: list of requested skims (from config)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">skim_name</span> <span class="ow">in</span> <span class="n">skims</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skim_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">]:</span>
                <span class="n">matrix_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mf</span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">skim_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting intrazonals to 0.5*min for </span><span class="si">{</span><span class="n">matrix_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">)</span>
                <span class="c1"># NOTE: sets values for external zones as well</span>
                <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">matrix_name</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_export_skims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Export skims to OMX files by period.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">            time_period: time period name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: skims in separate file by period</span>
        <span class="n">omx_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">output_skim_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time_period</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;export </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">)</span><span class="si">}</span><span class="s2"> skim matrices to </span><span class="si">{</span><span class="n">omx_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">omx_file_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span>
            <span class="n">omx_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">matrix_cache</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">omx_file</span><span class="o">.</span><span class="n">write_matrices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_debug_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">num_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">zone_numbers</span><span class="p">)</span>
        <span class="n">num_cells</span> <span class="o">=</span> <span class="n">num_zones</span> <span class="o">*</span> <span class="n">num_zones</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Highway skim summary for period </span><span class="si">{</span><span class="n">time_period</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of zones: </span><span class="si">{</span><span class="n">num_zones</span><span class="si">}</span><span class="s2">. Number of O-D pairs: </span><span class="si">{</span><span class="n">num_cells</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Values outside -9999999, 9999999 are masked in summaries.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;name                            min       max      mean           sum&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">-</span><span class="mi">9999999</span><span class="p">,</span> <span class="mi">9999999</span><span class="p">)</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">9.4g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2"> 13.7g</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for HighwayAssignment components.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>Reference to current run controller.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for HighwayAssignment components.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Reference to current run controller.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_processors</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">parse_num_processors</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">num_processors</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_matrix_cache</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_skim_matrices</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.network.highway.highway_assign.HighwayAssignment.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Run highway assignment.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_assign.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">(</span><span class="s2">&quot;Highway assignment and skims&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;STATUS&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run highway assignment.&quot;&quot;&quot;</span>
    <span class="n">demand</span> <span class="o">=</span> <span class="n">PrepareHighwayDemand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">demand</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">time</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
            <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iteration</span>
            <span class="n">assign_classes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">AssignmentClass</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy_maz_flow</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reset_background_traffic</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_skim_matrices</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">assign_classes</span><span class="p">)</span>
            <span class="n">assign_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_assignment_spec</span><span class="p">(</span><span class="n">assign_classes</span><span class="p">)</span>
            <span class="c1"># self.logger.log_dict(assign_spec, level=&quot;DEBUG&quot;)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                <span class="s2">&quot;Run SOLA assignment with path analyses&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span>
            <span class="p">):</span>
                <span class="n">assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
                    <span class="s2">&quot;inro.emme.traffic_assignment.sola_traffic_assignment&quot;</span>
                <span class="p">)</span>
                <span class="n">assign</span><span class="p">(</span><span class="n">assign_spec</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">chart_log_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Subtract non-time costs from gen cost to get the raw travel time</span>
            <span class="k">for</span> <span class="n">emme_class_spec</span> <span class="ow">in</span> <span class="n">assign_spec</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_time_skim</span><span class="p">(</span><span class="n">emme_class_spec</span><span class="p">)</span>
            <span class="c1"># Set intra-zonal for time and dist to be 1/2 nearest neighbour</span>
            <span class="k">for</span> <span class="n">class_config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_intrazonal_values</span><span class="p">(</span>
                    <span class="n">time</span><span class="p">,</span>
                    <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="n">class_config</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_skims</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug_enabled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_debug_report</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.HighwayConfig" class="doc doc-heading">
        <code>
tm2py.config.HighwayConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Highway assignment and skims parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition generic_highway_mode_code">
<p class="admonition-title">single character unique mode ID for entire</p>
<p>highway network (no excluded_links)</p>
</div>
<div class="admonition area_type_buffer_dist_miles">
<p class="admonition-title">used to in calculation to categorize link @areatype</p>
<p>The area type is determined based on the average density of nearby
(within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</p>
</div>
<div class="admonition maz_to_maz">
<p class="admonition-title">maz-to-maz shortest path assignment and skim specification,</p>
<p>see HighwayMazToMazConfig</p>
</div>
<div class="admonition classes">
<p class="admonition-title">highway assignment multi-class setup and skim specification,</p>
<p>see HighwayClassConfig</p>
</div>
<div class="admonition capclass_lookup">
<p class="admonition-title">index cross-reference table from the link @capclass value</p>
<p>to the free-flow speed, capacity, and critical speed values</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skims parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        generic_highway_mode_code: single character unique mode ID for entire</span>
<span class="sd">            highway network (no excluded_links)</span>
<span class="sd">        relative_gap: target relative gap stopping criteria</span>
<span class="sd">        max_iterations: maximum iterations stopping criteria</span>
<span class="sd">        area_type_buffer_dist_miles: used to in calculation to categorize link @areatype</span>
<span class="sd">            The area type is determined based on the average density of nearby</span>
<span class="sd">            (within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</span>
<span class="sd">        output_skim_path: relative path template for output skims in OMX format</span>
<span class="sd">        tolls: input toll specification, see HighwayTollsConfig</span>
<span class="sd">        maz_to_maz: maz-to-maz shortest path assignment and skim specification,</span>
<span class="sd">            see HighwayMazToMazConfig</span>
<span class="sd">        classes: highway assignment multi-class setup and skim specification,</span>
<span class="sd">            see HighwayClassConfig</span>
<span class="sd">        capclass_lookup: index cross-reference table from the link @capclass value</span>
<span class="sd">            to the free-flow speed, capacity, and critical speed values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generic_highway_mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">relative_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">area_type_buffer_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls</span><span class="p">:</span> <span class="n">HighwayTollsConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">maz_to_maz</span><span class="p">:</span> <span class="n">HighwayMazToMazConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">capclass_lookup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayCapClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
        <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
        <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># maz_to_maz.mode_code must be unique</span>
            <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
            <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
            <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
                <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
        <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
        <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
            <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
            <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
            <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
        <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
            <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
                <span class="n">available_link_sets</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skims parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        generic_highway_mode_code: single character unique mode ID for entire</span>
<span class="sd">            highway network (no excluded_links)</span>
<span class="sd">        relative_gap: target relative gap stopping criteria</span>
<span class="sd">        max_iterations: maximum iterations stopping criteria</span>
<span class="sd">        area_type_buffer_dist_miles: used to in calculation to categorize link @areatype</span>
<span class="sd">            The area type is determined based on the average density of nearby</span>
<span class="sd">            (within this buffer distance) MAZs, using (pop+jobs*2.5)/acres</span>
<span class="sd">        output_skim_path: relative path template for output skims in OMX format</span>
<span class="sd">        tolls: input toll specification, see HighwayTollsConfig</span>
<span class="sd">        maz_to_maz: maz-to-maz shortest path assignment and skim specification,</span>
<span class="sd">            see HighwayMazToMazConfig</span>
<span class="sd">        classes: highway assignment multi-class setup and skim specification,</span>
<span class="sd">            see HighwayClassConfig</span>
<span class="sd">        capclass_lookup: index cross-reference table from the link @capclass value</span>
<span class="sd">            to the free-flow speed, capacity, and critical speed values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generic_highway_mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">relative_gap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">area_type_buffer_dist_miles</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tolls</span><span class="p">:</span> <span class="n">HighwayTollsConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">maz_to_maz</span><span class="p">:</span> <span class="n">HighwayMazToMazConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">classes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">capclass_lookup</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayCapClassConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
        <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
        <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
        <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># maz_to_maz.mode_code must be unique</span>
            <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span>
                    <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
                <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
            <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
            <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
                <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
                <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
            <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
        <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
        <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
            <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
            <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
            <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
        <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
            <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
            <span class="n">check_keywords</span><span class="p">(</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
                <span class="n">available_link_sets</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




















  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayConfig.__pydantic_model__.unique_capclass_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_capclass_numbers</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_capclass_numbers" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate list of capclass_lookup has unique .capclass values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
    <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayConfig.__pydantic_model__.unique_class_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_class_names</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__.unique_class_names" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .name values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayConfig.__pydantic_model__.validate_class_keyword_lists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_keyword_lists</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_keyword_lists" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate classes .skims, .toll, and .excluded_links values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
    <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
    <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
        <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
        <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
        <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
    <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
        <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
            <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
            <span class="n">available_link_sets</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayConfig.__pydantic_model__.validate_class_mode_excluded_links" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.__pydantic_model__.validate_class_mode_excluded_links" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .mode_code or .excluded_links match.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
    <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
    <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># maz_to_maz.mode_code must be unique</span>
        <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
        <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
        <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
            <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
            <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
        <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h4 id="tm2py.config.HighwayConfig.unique_capclass_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_capclass_numbers</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.unique_capclass_numbers" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Validate list of capclass_lookup has unique .capclass values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;capclass_lookup&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_capclass_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of capclass_lookup has unique .capclass values.&quot;&quot;&quot;</span>
    <span class="n">capclass_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">capclass</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; capclass value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">capclass_ids</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="tm2py.config.HighwayConfig.unique_class_names" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_class_names</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.unique_class_names" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .name values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_class_names</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .name values.&quot;&quot;&quot;</span>
    <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;-&gt; name value must be unique in list&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">class_names</span><span class="p">)),</span> <span class="n">error_msg</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="tm2py.config.HighwayConfig.validate_class_keyword_lists" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_keyword_lists</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.validate_class_keyword_lists" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Validate classes .skims, .toll, and .excluded_links values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_keyword_lists</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate classes .skims, .toll, and .excluded_links values.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;tolls&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="n">avail_skims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;hovdist&quot;</span><span class="p">,</span> <span class="s2">&quot;tolldist&quot;</span><span class="p">,</span> <span class="s2">&quot;freeflowtime&quot;</span><span class="p">]</span>
    <span class="n">available_link_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is_sr&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr2&quot;</span><span class="p">,</span> <span class="s2">&quot;is_sr3&quot;</span><span class="p">,</span> <span class="s2">&quot;is_auto_only&quot;</span><span class="p">]</span>
    <span class="n">avail_toll_attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;tolls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dst_vehicle_group_names</span><span class="p">:</span>
        <span class="n">toll_types</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;bridgetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;valuetoll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">avail_skims</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">toll_types</span><span class="p">)</span>
        <span class="n">avail_toll_attrs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_types</span><span class="p">])</span>
        <span class="n">available_link_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;is_toll_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># validate class skim name list and toll attribute against toll setup</span>
    <span class="k">def</span> <span class="nf">check_keywords</span><span class="p">(</span><span class="n">class_num</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">available</span><span class="p">):</span>
        <span class="n">extra_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">available</span><span class="p">)</span>
        <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot; -&gt; </span><span class="si">{</span><span class="n">class_num</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: unrecognized </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> name(s): &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra_keys</span><span class="p">)</span><span class="si">}</span><span class="s2">.  Available names are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">extra_keys</span><span class="p">,</span> <span class="n">error_msg</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;skim&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;skims&quot;</span><span class="p">],</span> <span class="n">avail_skims</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;toll&quot;</span><span class="p">,</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;toll&quot;</span><span class="p">],</span> <span class="n">avail_toll_attrs</span><span class="p">)</span>
        <span class="n">check_keywords</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="s2">&quot;excluded_links&quot;</span><span class="p">,</span>
            <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">],</span>
            <span class="n">available_link_sets</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayConfig.validate_class_mode_excluded_links" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Validate list of classes has unique .mode_code or .excluded_links match.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;classes&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_class_mode_excluded_links</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of classes has unique .mode_code or .excluded_links match.&quot;&quot;&quot;</span>
    <span class="c1"># validate if any mode IDs are used twice, that they have the same excluded links sets</span>
    <span class="n">mode_excluded_links</span> <span class="o">=</span> <span class="p">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;generic_highway_mode_code&quot;</span><span class="p">]:</span> <span class="nb">set</span><span class="p">([])}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">highway_class</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="c1"># maz_to_maz.mode_code must be unique</span>
        <span class="k">if</span> <span class="s2">&quot;maz_to_maz&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;maz_to_maz&quot;</span><span class="p">][</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> -&gt; mode_code: cannot be the same as the highway.maz_to_maz.mode_code&quot;</span>
        <span class="c1"># make sure that if any mode IDs are used twice, they have the same excluded links sets</span>
        <span class="k">if</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span> <span class="ow">in</span> <span class="n">mode_excluded_links</span><span class="p">:</span>
            <span class="n">ex_links1</span> <span class="o">=</span> <span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;excluded_links&quot;</span><span class="p">]</span>
            <span class="n">ex_links2</span> <span class="o">=</span> <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="p">[</span><span class="s2">&quot;mode_code&quot;</span><span class="p">]]</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-&gt; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: duplicated mode codes (&#39;</span><span class="si">{</span><span class="n">highway_class</span><span class="p">[</span><span class="s1">&#39;mode_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;with different excluded links: </span><span class="si">{</span><span class="n">ex_links1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">ex_links2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">ex_links1</span> <span class="o">==</span> <span class="n">ex_links2</span><span class="p">,</span> <span class="n">error_msg</span>
        <span class="n">mode_excluded_links</span><span class="p">[</span><span class="n">highway_class</span><span class="o">.</span><span class="n">mode_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">highway_class</span><span class="o">.</span><span class="n">excluded_links</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.HighwayClassConfig" class="doc doc-heading">
        <code>
tm2py.config.HighwayClassConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayClassConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Highway assignment class definition.</p>
<p>Note that excluded_links, skims and toll attribute names include
vehicle groups (&ldquo;{vehicle}&rdquo;) which reference the list of
highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).
The default example model config uses:
&ldquo;da&rdquo;, &ldquo;sr2&rdquo;, &ldquo;sr3&rdquo;, &ldquo;vsm&rdquo;, sml&rdquo;, &ldquo;med&rdquo;, &ldquo;lrg&rdquo;</p>
<p>Example single class config:
    name = &ldquo;da&rdquo;
    description= &ldquo;drive alone&rdquo;
    mode_code= &ldquo;d&rdquo;
    [[highway.classes.demand]]
        source = &ldquo;household&rdquo;
        name = &ldquo;SOV_GP_{period}&rdquo;
    [[highway.classes.demand]]
        source = &ldquo;air_passenger&rdquo;
        name = &ldquo;da&rdquo;
    [[highway.classes.demand]]
        source = &ldquo;internal_external&rdquo;
        name = &ldquo;da&rdquo;
    excluded_links = [&ldquo;is_toll_da&rdquo;, &ldquo;is_sr2&rdquo;],
    value_of_time = 18.93,  # $ / hr
    operating_cost_per_mile = 17.23,  # cents / mile
    toll = [&ldquo;@bridgetoll_da&rdquo;]
    skims = [&ldquo;time&rdquo;, &ldquo;dist&rdquo;, &ldquo;freeflowtime&rdquo;, &ldquo;bridgetoll_da&rdquo;],</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition name">
<p class="admonition-title">short (up to 10 character) unique reference name for the class.</p>
<p>used in attribute and matrix names</p>
</div>
<div class="admonition mode_code">
<p class="admonition-title">single character mode, used to generate link.modes to</p>
<p>identify subnetwork, generated from &ldquo;excluded_links&rdquo; keywords.
Should be unique in list of classes, unless multiple classes
have identical excluded_links specification. Cannot be the
same as used for highway.maz_to_maz.mode_code.</p>
</div>
<div class="admonition demand">
<p class="admonition-title">list of OMX file and matrix keyname references,</p>
<p>see HighwayClassDemandConfig</p>
</div>
<div class="admonition excluded_links">
<p class="admonition-title">list of keywords to identify links to exclude from</p>
<p>this class&rsquo; available subnetwork (generate link.modes)
Options are:
    - &ldquo;is_sr&rdquo;: is reserved for shared ride (@useclass in 2,3)
    - &ldquo;is_sr2&rdquo;: is reserved for shared ride 2+ (@useclass == 2)
    - &ldquo;is_sr3&rdquo;: is reserved for shared ride 3+ (@useclass == 3)
    - &ldquo;is_auto_only&rdquo;: is reserved for autos (non-truck) (@useclass != 1)
    - &ldquo;is_toll_{vehicle}&rdquo;: has a value (non-bridge) toll for the {vehicle} toll group</p>
</div>
<div class="admonition toll">
<p class="admonition-title">list of additional toll cost link attribute (values stored in cents),</p>
<p>summed, one of &ldquo;@bridgetoll_{vehicle}&rdquo;, &ldquo;@valuetoll_{vehicle}&rdquo;</p>
</div>
<div class="admonition pce">
<p class="admonition-title">optional, passenger car equivalent to convert assigned demand in</p>
<p>PCE units to vehicles for total assigned vehicle calculations</p>
</div>
<div class="admonition skims">
<p class="admonition-title">list of skim matrices to generate</p>
<p>Options are:
    &ldquo;time&rdquo;: pure travel time in minutes
    &ldquo;dist&rdquo;: distance in miles
    &ldquo;hovdist&rdquo;: distance on HOV facilities (is_sr2 or is_sr3)
    &ldquo;tolldist&rdquo;: distance on toll facilities
        (@tollbooth &gt; highway.tolls.tollbooth_start_index)
    &ldquo;freeflowtime&rdquo;: free flow travel time in minutes
    &ldquo;bridgetoll_{vehicle}&rdquo;: bridge tolls, {vehicle} refers to toll group
    &ldquo;valuetoll_{vehicle}&rdquo;: other, non-bridge tolls, {vehicle} refers to toll group</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayClassConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment class definition.</span>

<span class="sd">    Note that excluded_links, skims and toll attribute names include</span>
<span class="sd">    vehicle groups (&quot;{vehicle}&quot;) which reference the list of</span>
<span class="sd">    highway.toll.dst_vehicle_group_names (see HighwayTollsConfig).</span>
<span class="sd">    The default example model config uses:</span>
<span class="sd">    &quot;da&quot;, &quot;sr2&quot;, &quot;sr3&quot;, &quot;vsm&quot;, sml&quot;, &quot;med&quot;, &quot;lrg&quot;</span>

<span class="sd">    Example single class config:</span>
<span class="sd">        name = &quot;da&quot;</span>
<span class="sd">        description= &quot;drive alone&quot;</span>
<span class="sd">        mode_code= &quot;d&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;household&quot;</span>
<span class="sd">            name = &quot;SOV_GP_{period}&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;air_passenger&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        [[highway.classes.demand]]</span>
<span class="sd">            source = &quot;internal_external&quot;</span>
<span class="sd">            name = &quot;da&quot;</span>
<span class="sd">        excluded_links = [&quot;is_toll_da&quot;, &quot;is_sr2&quot;],</span>
<span class="sd">        value_of_time = 18.93,  # $ / hr</span>
<span class="sd">        operating_cost_per_mile = 17.23,  # cents / mile</span>
<span class="sd">        toll = [&quot;@bridgetoll_da&quot;]</span>
<span class="sd">        skims = [&quot;time&quot;, &quot;dist&quot;, &quot;freeflowtime&quot;, &quot;bridgetoll_da&quot;],</span>

<span class="sd">    Properties:</span>
<span class="sd">        name: short (up to 10 character) unique reference name for the class.</span>
<span class="sd">            used in attribute and matrix names</span>
<span class="sd">        description: longer text used in attribute and matrix descriptions</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords.</span>
<span class="sd">            Should be unique in list of classes, unless multiple classes</span>
<span class="sd">            have identical excluded_links specification. Cannot be the</span>
<span class="sd">            same as used for highway.maz_to_maz.mode_code.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        demand: list of OMX file and matrix keyname references,</span>
<span class="sd">            see HighwayClassDemandConfig</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            this class&#39; available subnetwork (generate link.modes)</span>
<span class="sd">            Options are:</span>
<span class="sd">                - &quot;is_sr&quot;: is reserved for shared ride (@useclass in 2,3)</span>
<span class="sd">                - &quot;is_sr2&quot;: is reserved for shared ride 2+ (@useclass == 2)</span>
<span class="sd">                - &quot;is_sr3&quot;: is reserved for shared ride 3+ (@useclass == 3)</span>
<span class="sd">                - &quot;is_auto_only&quot;: is reserved for autos (non-truck) (@useclass != 1)</span>
<span class="sd">                - &quot;is_toll_{vehicle}&quot;: has a value (non-bridge) toll for the {vehicle} toll group</span>
<span class="sd">        toll: list of additional toll cost link attribute (values stored in cents),</span>
<span class="sd">            summed, one of &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">        toll_factor: optional, factor to apply to toll values in cost calculation</span>
<span class="sd">        pce: optional, passenger car equivalent to convert assigned demand in</span>
<span class="sd">            PCE units to vehicles for total assigned vehicle calculations</span>
<span class="sd">        skims: list of skim matrices to generate</span>
<span class="sd">            Options are:</span>
<span class="sd">                &quot;time&quot;: pure travel time in minutes</span>
<span class="sd">                &quot;dist&quot;: distance in miles</span>
<span class="sd">                &quot;hovdist&quot;: distance on HOV facilities (is_sr2 or is_sr3)</span>
<span class="sd">                &quot;tolldist&quot;: distance on toll facilities</span>
<span class="sd">                    (@tollbooth &gt; highway.tolls.tollbooth_start_index)</span>
<span class="sd">                &quot;freeflowtime&quot;: free flow travel time in minutes</span>
<span class="sd">                &quot;bridgetoll_{vehicle}&quot;: bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">                &quot;valuetoll_{vehicle}&quot;: other, non-bridge tolls, {vehicle} refers to toll group</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pce</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Note that excluded_links, skims, and tolls validated under HighwayConfig to include</span>
    <span class="c1"># highway.toll.dst_vehicle_group_names names</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skims</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">toll_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">demand</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">HighwayClassDemandConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">































  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.HighwayTollsConfig" class="doc doc-heading">
        <code>
tm2py.config.HighwayTollsConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayTollsConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Highway assignment and skim input tolls and related parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition tollbooth_start_index">
<p class="admonition-title">tollbooth separates links with &ldquo;bridge&rdquo; tolls</p>
<p>(index &lt; this value) vs. &ldquo;value&rdquo; tolls. These toll attributes
can then be referenced separately in the highway.classes[].tolls
list</p>
</div>
<div class="admonition src_vehicle_group_names">
<p class="admonition-title">name used for the vehicle toll CSV column IDs,</p>
<p>of the form &ldquo;toll{period}_{vehicle}&rdquo;</p>
</div>
<div class="admonition dst_vehicle_group_names">
<p class="admonition-title">list of names used in destination network</p>
<p>for the corresponding vehicle group. Length of list must be the same
as src_vehicle_group_names. Used for toll related attributes and
resulting skim matrices. Cross-referenced in list of highway.classes[],
valid keywords for:
    excluded_links: &ldquo;is_toll_{vehicle}&rdquo;
    tolls: &ldquo;@bridgetoll_{vehicle}&rdquo;, &ldquo;@valuetoll_{vehicle}&rdquo;
    skims: &ldquo;bridgetoll_{vehicle}&rdquo;, &ldquo;valuetoll_{vehicle}&rdquo;</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayTollsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skim input tolls and related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        file_path: source relative file path for the highway tolls index CSV</span>
<span class="sd">        tollbooth_start_index: tollbooth separates links with &quot;bridge&quot; tolls</span>
<span class="sd">            (index &lt; this value) vs. &quot;value&quot; tolls. These toll attributes</span>
<span class="sd">            can then be referenced separately in the highway.classes[].tolls</span>
<span class="sd">            list</span>
<span class="sd">        src_vehicle_group_names: name used for the vehicle toll CSV column IDs,</span>
<span class="sd">            of the form &quot;toll{period}_{vehicle}&quot;</span>
<span class="sd">        dst_vehicle_group_names: list of names used in destination network</span>
<span class="sd">            for the corresponding vehicle group. Length of list must be the same</span>
<span class="sd">            as src_vehicle_group_names. Used for toll related attributes and</span>
<span class="sd">            resulting skim matrices. Cross-referenced in list of highway.classes[],</span>
<span class="sd">            valid keywords for:</span>
<span class="sd">                excluded_links: &quot;is_toll_{vehicle}&quot;</span>
<span class="sd">                tolls: &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">                skims: &quot;bridgetoll_{vehicle}&quot;, &quot;valuetoll_{vehicle}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tollbooth_start_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">dst_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayTollsConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayTollsConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway assignment and skim input tolls and related parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        file_path: source relative file path for the highway tolls index CSV</span>
<span class="sd">        tollbooth_start_index: tollbooth separates links with &quot;bridge&quot; tolls</span>
<span class="sd">            (index &lt; this value) vs. &quot;value&quot; tolls. These toll attributes</span>
<span class="sd">            can then be referenced separately in the highway.classes[].tolls</span>
<span class="sd">            list</span>
<span class="sd">        src_vehicle_group_names: name used for the vehicle toll CSV column IDs,</span>
<span class="sd">            of the form &quot;toll{period}_{vehicle}&quot;</span>
<span class="sd">        dst_vehicle_group_names: list of names used in destination network</span>
<span class="sd">            for the corresponding vehicle group. Length of list must be the same</span>
<span class="sd">            as src_vehicle_group_names. Used for toll related attributes and</span>
<span class="sd">            resulting skim matrices. Cross-referenced in list of highway.classes[],</span>
<span class="sd">            valid keywords for:</span>
<span class="sd">                excluded_links: &quot;is_toll_{vehicle}&quot;</span>
<span class="sd">                tolls: &quot;@bridgetoll_{vehicle}&quot;, &quot;@valuetoll_{vehicle}&quot;</span>
<span class="sd">                skims: &quot;bridgetoll_{vehicle}&quot;, &quot;valuetoll_{vehicle}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">tollbooth_start_index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">src_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">dst_vehicle_group_names</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
            <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">















  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayTollsConfig.__pydantic_model__.dst_vehicle_group_names_length" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayTollsConfig.__pydantic_model__.dst_vehicle_group_names_length" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate dst_vehicle_group_names has same length as src_vehicle_group_names.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h4 id="tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayTollsConfig.dst_vehicle_group_names_length" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Validate dst_vehicle_group_names has same length as src_vehicle_group_names.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;dst_vehicle_group_names&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dst_vehicle_group_names_length</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate dst_vehicle_group_names has same length as src_vehicle_group_names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;src_vehicle_group_names&quot;</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;src_vehicle_group_names&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be same length as src_vehicle_group_names&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;dst_vehicle_group_names must be 4 characters or less&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.DemandCountyGroupConfig" class="doc doc-heading">
        <code>
tm2py.config.DemandCountyGroupConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.DemandCountyGroupConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Grouping of counties for assignment and demand files.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<p>number: id number for this group, must be unique
counties: list of one or more county names</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DemandCountyGroupConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Grouping of counties for assignment and demand files.</span>

<span class="sd">    Properties:</span>
<span class="sd">        number: id number for this group, must be unique</span>
<span class="sd">        counties: list of one or more county names</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">counties</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">COUNTY_NAMES</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.highway.highway_maz" class="doc doc-heading">
        <code>tm2py.components.network.highway.highway_maz</code>



<a href="#tm2py.components.network.highway.highway_maz" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Assigns and skims MAZ-to-MAZ demand along shortest generalized cost path.</p>
<p>MAZ to MAZ demand is read in from separate OMX matrices as defined under
the config table highway.maz_to_maz.demand_county_groups,</p>
<p>The demand is expected to be short distance (e.g. &lt;0.5 miles), or within the
same TAZ. The demand is grouped into bins of origin -&gt; all destinations, by
distance (straight-line) to furthest destination. This limits the size of the
shortest path calculated to the minimum required.
The bin edges have been predefined after testing as (in miles):
    [0.0, 0.9, 1.2, 1.8, 2.5, 5.0, 10.0, max_dist]</p>
<p>Input:
Emme network with:
    Link attributes:
        - time attribute, either timau (resulting VDF congested time)
          or @free_flow_time
    Node attributes: @maz_id, x, y, and #node_county
Demand matrices under highway.maz_to_maz.demand_file,
and can have a placeholder
    auto_{period}<em>MAZ_AUTO</em>{number}_{period}.omx</p>
<p>Output:
The resulting MAZ-MAZ flows are saved in link @maz_flow which is
used as background traffic in the equilibrium Highway assignment.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="doc doc-heading">
        <code>
AssignMAZSPDemand            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>MAZ-to-MAZ shortest-path highway assignment.</p>
<p>Calculates shortest path between MAZs with demand in the Emme network
and assigns flow.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AssignMAZSPDemand</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">    Calculates shortest path between MAZs with demand in the Emme network</span>
<span class="sd">    and assigns flow.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># skip Too many instance attributes recommendation, it is OK as is</span>
    <span class="c1"># pylint: disable=R0902</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent Controller object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># bins: performance parameter: crow-fly distance bins</span>
        <span class="c1">#       to limit shortest path calculation by origin to furthest destination</span>
        <span class="c1">#       semi-exposed for performance testing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span> <span class="o">=</span> <span class="n">_default_bin_edges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Internal attributes to track data through the sequence of steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run MAZ-to-MAZ shortest path assignment.&quot;&quot;&quot;</span>
        <span class="n">emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
        <span class="n">emmebank</span> <span class="o">=</span> <span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">county_groups</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
            <span class="n">county_groups</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">counties</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span><span class="n">emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">county_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">maz_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_county_mazs</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maz_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;warning: no mazs for counties </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_process_demand</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">)</span>
                <span class="n">demand_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_demand</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">demand_bins</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_find_roots_and_leaves</span><span class="p">(</span><span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_cost_maz</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context setup / teardown, initializes internal attributes.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: name of the time period</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;total cost MAZ-MAZ&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;cost MAZ-MAZ, unused MAZs blocked&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;Flag for MAZs which are roots&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">,</span> <span class="s2">&quot;Flag for MAZs which are leaves&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Create temp </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2"> attr: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">temp_attributes_and_restore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="n">attributes</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;MAZ assign for period </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2"> scenario </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">):</span>
                    <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="c1"># delete sp path files</span>
                    <span class="k">for</span> <span class="n">bin_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span><span class="p">)):</span>
                        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.ebp&quot;</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate link cost (travel time + bridge tolls + operating cost) and load network.</span>

<span class="sd">        Reads Emme network from disk for later node lookups. Optimized to only load</span>
<span class="sd">        attribute values of interest, additional attributes must be added in</span>
<span class="sd">        order to be read from disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">has_traffic_results</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;(@free_flow_time.max.timau)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;@free_flow_time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculating link costs using time </span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">value_of_time</span>
        <span class="n">op_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">operating_cost_per_mile</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">net_calc</span><span class="p">(</span>
            <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2"> + 0.6 / </span><span class="si">{</span><span class="n">vot</span><span class="si">}</span><span class="s2"> * (length * </span><span class="si">{</span><span class="n">op_cost</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="s2">&quot;Link cost calculation report&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;#node_county&quot;</span><span class="p">],</span> <span class="s2">&quot;LINK&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;temp_flow&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_county_mazs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counties</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeNode</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get all MAZ nodes which are located in one of these counties.</span>

<span class="sd">        Used the node attribute #node_county to identify the node location.</span>
<span class="sd">        Name must be an exact match. Catches a mapping of the county names</span>
<span class="sd">        to nodes so nodes are processed only once.</span>

<span class="sd">        Args:</span>
<span class="sd">            counties: list of county names</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of MAZ nodes (Emme Node) which are in these counties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Processing county MAZs for </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">counties</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span>
        <span class="c1"># NOTE: every maz must have a valid #node_county</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_county&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">mazs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
            <span class="n">mazs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span><span class="p">[</span><span class="n">county</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Num MAZs </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mazs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mazs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_process_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EmmeNode</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Loads the demand from file and groups by origin node.</span>

<span class="sd">        Sets the demand to self._demand for later processing, grouping the demand in</span>
<span class="sd">        a dictionary by origin node (Emme Node object) to list of dictionaries</span>
<span class="sd">        {&quot;orig&quot;: orig_node, &quot;dest&quot;: dest_node, &quot;dem&quot;: demand, &quot;dist&quot;: dist}</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            index: group index of the demand file, used to find the file by name</span>
<span class="sd">            maz_ids: indexed list of MAZ ID nodes for the county group</span>
<span class="sd">                (active counties for this demand file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Process demand for time period </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2"> index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_demand_array</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">origins</span><span class="p">,</span> <span class="n">destinations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;non-zero origins </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">origins</span><span class="p">)</span><span class="si">}</span><span class="s2"> destinations </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">destinations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">total_demand</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">orig</span><span class="p">,</span> <span class="n">dest</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">origins</span><span class="p">,</span> <span class="n">destinations</span><span class="p">):</span>
            <span class="c1"># skip intra-maz demand</span>
            <span class="k">if</span> <span class="n">orig</span> <span class="o">==</span> <span class="n">dest</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">orig_node</span> <span class="o">=</span> <span class="n">maz_ids</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span>
            <span class="n">dest_node</span> <span class="o">=</span> <span class="n">maz_ids</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">_sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="n">dest_node</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">orig_node</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dest_node</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">orig_node</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="n">dist</span>
            <span class="n">demand</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">orig</span><span class="p">][</span><span class="n">dest</span><span class="p">]</span>
            <span class="n">total_demand</span> <span class="o">+=</span> <span class="n">demand</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span><span class="p">[</span><span class="n">orig_node</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;orig&quot;</span><span class="p">:</span> <span class="n">orig_node</span><span class="p">,</span>
                    <span class="s2">&quot;dest&quot;</span><span class="p">:</span> <span class="n">dest_node</span><span class="p">,</span>
                    <span class="s2">&quot;dem&quot;</span><span class="p">:</span> <span class="n">demand</span><span class="p">,</span>
                    <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max distance found </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total inter-zonal demand </span><span class="si">{</span><span class="n">total_demand</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_demand_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load the demand from file with the specified time and index name.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            index: group index of the demand file, used to find the file by name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path_tmplt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">demand_file</span><span class="p">)</span>
        <span class="n">omx_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span>
            <span class="n">file_path_tmplt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading demand from </span><span class="si">{</span><span class="n">omx_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">OMXManager</span><span class="p">(</span><span class="n">omx_file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">omx_file</span><span class="p">:</span>
            <span class="n">demand_array</span> <span class="o">=</span> <span class="n">omx_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;M0&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">demand_array</span>

    <span class="k">def</span> <span class="nf">_group_demand</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]]]]:</span>
        <span class="sd">&quot;&quot;&quot;Process the demand loaded from files \</span>
<span class="sd">            and create groups based on the origin to the furthest destination with demand.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="s2">&quot;Grouping demand in distance buckets&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
        <span class="c1"># group demand from same origin into distance bins by furthest</span>
        <span class="c1"># distance destination to limit shortest path search radius</span>
        <span class="n">bin_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="n">bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">/</span> <span class="mf">5280.0</span><span class="p">:</span>
            <span class="n">bin_edges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">/</span> <span class="mf">5280.0</span><span class="p">)</span>

        <span class="n">demand_groups</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">edge</span><span class="p">,</span> <span class="s2">&quot;demand&quot;</span><span class="p">:</span> <span class="p">[]}</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mf">5280.0</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">max_dist</span> <span class="o">&lt;</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]:</span>
                    <span class="n">group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;bin dist </span><span class="si">{</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;demand&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Filter out groups without any demand</span>
        <span class="n">demand_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">demand_groups</span> <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">demand_groups</span>

    <span class="k">def</span> <span class="nf">_find_roots_and_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]):</span>
        <span class="sd">&quot;&quot;&quot;Label available MAZ root nodes and leaf nodes for the path calculation.</span>

<span class="sd">        The MAZ nodes which are found as origins in the demand are &quot;activated&quot;</span>
<span class="sd">        by setting @maz_root to non-zero, and similarly the leaves have @maz_leaf</span>
<span class="sd">        set to non-zero.</span>

<span class="sd">        Args:</span>
<span class="sd">            demand: list of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span>
        <span class="n">attrs_to_init</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]),</span> <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;maz_cost&quot;</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attrs_to_init</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
                    <span class="n">network</span><span class="o">.</span><span class="n">delete_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">network</span><span class="o">.</span><span class="n">create_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">root_maz_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">leaf_maz_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
            <span class="n">o_node</span><span class="p">,</span> <span class="n">d_node</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span>
            <span class="n">root_maz_ids</span><span class="p">[</span><span class="n">o_node</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">o_node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
            <span class="n">leaf_maz_ids</span><span class="p">[</span><span class="n">d_node</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_node</span><span class="p">[</span><span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">root_maz_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()))}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="p">{</span><span class="n">q</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">leaf_maz_ids</span><span class="o">.</span><span class="n">keys</span><span class="p">()))}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attr_values</span><span class="p">(</span>
            <span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_link_cost_maz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set link cost used in the shortest path forbidden using unavailable connectors.</span>

<span class="sd">        Copy the pre-calculated cost @link_cost to @link_cost_maz,</span>
<span class="sd">        setting value to 1e20 on connectors to unused zone leaves / from</span>
<span class="sd">        unused roots.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># forbid egress from MAZ nodes which are not demand roots /</span>
        <span class="c1">#        access to MAZ nodes which are not demand leafs</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;1e20&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root=0 and !@maz_id=0&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">add_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span> <span class="s2">&quot;1e20&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_leafj=0 and !@maz_idj=0&quot;</span><span class="p">)</span>
        <span class="n">net_calc</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_run_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run the shortest path tool to generate paths between the marked nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            max_radius: max unit coordinate distance to limit search tree</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shortest_paths_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.network_calculation.shortest_path&quot;</span>
        <span class="p">)</span>
        <span class="n">max_radius</span> <span class="o">=</span> <span class="n">max_radius</span> <span class="o">*</span> <span class="mi">5280</span> <span class="o">+</span> <span class="mi">100</span>  <span class="c1"># add some buffer for rounding error</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;ebp&quot;</span> <span class="k">if</span> <span class="n">_USE_BINARY</span> <span class="k">else</span> <span class="s2">&quot;txt&quot;</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">num_processors</span> <span class="o">=</span> <span class="n">parse_num_processors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">num_processors</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">mode_code</span><span class="p">],</span>
            <span class="s2">&quot;root_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span>
            <span class="s2">&quot;leaf_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_leaf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;link_cost&quot;</span><span class="p">:</span> <span class="s2">&quot;@link_cost_maz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path_constraints&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_radius&quot;</span><span class="p">:</span> <span class="n">max_radius</span><span class="p">,</span>
                <span class="s2">&quot;uturn_allowed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_leaves&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_centroids&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;exclude_forbidden_turns&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;skim_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;return_numpy&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;analyses&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">},</span>
                <span class="s2">&quot;path_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;BINARY&quot;</span> <span class="k">if</span> <span class="n">_USE_BINARY</span> <span class="k">else</span> <span class="s2">&quot;TEXT&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="n">num_processors</span><span class="p">,</span>
                <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">shortest_paths_tool</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containing the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_USE_BINARY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow_binary</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow_text</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">,</span> <span class="n">demand</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_flow_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        The paths are read from a text format file, see Emme help for details.</span>
<span class="sd">        Demand is summed in self._network (in memory) using temp_flow attribute</span>
<span class="sd">        and written to scenario (Emmebank / disk) @maz_flow.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containin the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_text_format_paths</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">)</span>
        <span class="n">not_assigned</span><span class="p">,</span> <span class="n">assigned</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
            <span class="n">orig</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">dem</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">paths</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">not_assigned</span> <span class="o">+=</span> <span class="n">dem</span>
                <span class="k">continue</span>
            <span class="n">i_node</span> <span class="o">=</span> <span class="n">orig</span>
            <span class="k">for</span> <span class="n">j_node</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">i_node</span><span class="p">,</span> <span class="n">j_node</span><span class="p">)</span>
                <span class="n">link</span><span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dem</span>
                <span class="n">i_node</span> <span class="o">=</span> <span class="n">j_node</span>
            <span class="n">assigned</span> <span class="o">+=</span> <span class="n">dem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ASSIGN bin </span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">: total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;assigned: </span><span class="si">{</span><span class="n">assigned</span><span class="si">}</span><span class="s2">, not assigned: </span><span class="si">{</span><span class="n">not_assigned</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_text_format_paths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]:</span>
        <span class="sd">&quot;&quot;&quot;Load all paths from text file and return as nested dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>

<span class="sd">        Returns:</span>
<span class="sd">            All paths as a nested dictionary, path = paths[origin][destination],</span>
<span class="sd">            using the node IDs as integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">_defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">),</span>
            <span class="s2">&quot;r&quot;</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">paths_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">paths_file</span><span class="p">:</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
                <span class="n">paths</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">nodes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span> <span class="nf">_assign_flow_binary</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bin_no</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">EmmeNode</span><span class="p">]]]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assign the demand along the paths generated from the shortest path tool.</span>

<span class="sd">        The paths are read from a binary format file, see Emme help for details.</span>
<span class="sd">        Demand is summed in self._network (in memory) using temp_flow attribute</span>
<span class="sd">        and written to scenario (Emmebank / disk) @maz_flow.</span>

<span class="sd">        Args:</span>
<span class="sd">            time: time period name</span>
<span class="sd">            bin_no: bin number (id) for this demand segment</span>
<span class="sd">            demand: list of dictionaries, containin the demand in the format</span>
<span class="sd">                {&quot;orig&quot;: EmmeNode, &quot;dest&quot;: EmmeNode, &quot;dem&quot;: float (demand value)}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;sp_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">.ebp&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">paths_file</span><span class="p">:</span>
            <span class="c1"># read set of path pointers by Orig-Dest sequence from file</span>
            <span class="n">offset</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path_indices</span><span class="p">(</span><span class="n">paths_file</span><span class="p">)</span>
            <span class="n">assigned</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">not_assigned</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">bytes_read</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">*</span> <span class="mi">8</span>
            <span class="c1"># for all orig-dest pairs with demand, load path from file</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">demand</span><span class="p">:</span>
                <span class="c1"># get file position based on orig-dest index</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_path_location</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;orig&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span>
                <span class="p">)</span>
                <span class="c1"># no path found, disconnected zone</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                    <span class="n">not_assigned</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
                    <span class="k">continue</span>
                <span class="n">paths_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assign_path_flow</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">])</span>
                <span class="n">assigned</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;dem&quot;</span><span class="p">]</span>
                <span class="n">bytes_read</span> <span class="o">+=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">copy_attr_values</span><span class="p">(</span>
            <span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;@maz_flow&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ASSIGN bin </span><span class="si">{</span><span class="n">bin_no</span><span class="si">}</span><span class="s2">, total </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">demand</span><span class="p">)</span><span class="si">}</span><span class="s2">, assign &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">assigned</span><span class="si">}</span><span class="s2">, not assign </span><span class="si">{</span><span class="n">not_assigned</span><span class="si">}</span><span class="s2">, bytes </span><span class="si">{</span><span class="n">bytes_read</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_path_indices</span><span class="p">(</span><span class="n">paths_file</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the path header indices.</span>

<span class="sd">        See the Emme Shortest path tool doc for additional details on reading</span>
<span class="sd">        this file.</span>

<span class="sd">        Args:</span>
<span class="sd">            paths_file: binary file access to the generated paths file</span>

<span class="sd">        Returns:</span>
<span class="sd">            2 ints + array of ints: offset, leafs_nb, path_indicies</span>
<span class="sd">            offset: starting index to read the paths</span>
<span class="sd">            leafs_nb: number of leafs in the shortest path file</span>
<span class="sd">            path_indicies: array of the start index for each root, leaf path in paths_file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read first 4 integers from file (Q=64-bit unsigned integers)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">roots_nb</span><span class="p">,</span> <span class="n">leaves_nb</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="c1"># Load sequence of path indices (positions by orig-dest index),</span>
        <span class="c1"># pointing to list of path node IDs in file</span>
        <span class="n">path_indicies</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">path_indicies</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">roots_nb</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">roots_nb</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="k">return</span> <span class="n">offset</span><span class="p">,</span> <span class="n">leaves_nb</span><span class="p">,</span> <span class="n">path_indicies</span>

    <span class="k">def</span> <span class="nf">_get_path_location</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">orig</span><span class="p">:</span> <span class="n">EmmeNode</span><span class="p">,</span>
        <span class="n">dest</span><span class="p">:</span> <span class="n">EmmeNode</span><span class="p">,</span>
        <span class="n">leaves_nb</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">path_indicies</span><span class="p">:</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the location in the paths_file to read.</span>

<span class="sd">        Args:</span>
<span class="sd">            orig: Emme Node object, origin MAZ to query the path</span>
<span class="sd">            dest: Emme Node object, destination MAZ to query the path</span>
<span class="sd">            leaves_nb: number of leaves</span>
<span class="sd">            path_indicies: array of the start index for each root, leaf path in paths_file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Two integers, start, end</span>
<span class="sd">            start: starting index to read Node ID bytes from paths_file</span>
<span class="sd">            end: ending index to read bytes from paths_file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span><span class="p">[</span><span class="n">orig</span><span class="p">]</span>
        <span class="n">q_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">p_index</span> <span class="o">*</span> <span class="n">leaves_nb</span> <span class="o">+</span> <span class="n">q_index</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">path_indicies</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">path_indicies</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>

    <span class="k">def</span> <span class="nf">_assign_path_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">paths_file</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demand</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add demand to link temp_flow for the path.</span>

<span class="sd">        Args:</span>
<span class="sd">            paths_file: binary file access to read path from</span>
<span class="sd">            start: starting index to read Node ID bytes from paths_file</span>
<span class="sd">            end: ending index to read bytes from paths_file</span>
<span class="sd">            demand: flow demand to add on link</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># load sequence of Node IDs which define the path (L=32-bit unsigned integers)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">_array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">path</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">paths_file</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
        <span class="c1"># process path to sequence of links and add flow</span>
        <span class="n">path_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">i_node</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">path_iter</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j_node</span> <span class="ow">in</span> <span class="n">path_iter</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">i_node</span><span class="p">,</span> <span class="n">j_node</span><span class="p">)</span>
            <span class="n">link</span><span class="p">[</span><span class="s2">&quot;temp_flow&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">demand</span>
            <span class="n">i_node</span> <span class="o">=</span> <span class="n">j_node</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>MAZ-to-MAZ shortest-path highway assignment.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>parent Controller object</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path highway assignment.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent Controller object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># bins: performance parameter: crow-fly distance bins</span>
    <span class="c1">#       to limit shortest path calculation by origin to furthest destination</span>
    <span class="c1">#       semi-exposed for performance testing</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_bin_edges</span> <span class="o">=</span> <span class="n">_default_bin_edges</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Internal attributes to track data through the sequence of steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mazs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_demand</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_root_index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_leaf_index</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.network.highway.highway_maz.AssignMAZSPDemand.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Run MAZ-to-MAZ shortest path assignment.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run MAZ-to-MAZ shortest path assignment.&quot;&quot;&quot;</span>
    <span class="n">emme_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span>
    <span class="n">emmebank</span> <span class="o">=</span> <span class="n">emme_manager</span><span class="o">.</span><span class="n">emmebank</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eb_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="n">county_groups</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
        <span class="n">county_groups</span><span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">counties</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_period_names</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span><span class="n">emmebank</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">county_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">maz_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_county_mazs</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">maz_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;warning: no mazs for counties </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">names</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_demand</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">maz_ids</span><span class="p">)</span>
            <span class="n">demand_bins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_demand</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">demand_bins</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_find_roots_and_leaves</span><span class="p">(</span><span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_link_cost_maz</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assign_flow</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">demand_group</span><span class="p">[</span><span class="s2">&quot;demand&quot;</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="doc doc-heading">
        <code>
SkimMAZCosts            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>MAZ-to-MAZ shortest-path skim of time, distance and toll.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SkimMAZCosts</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller: parent RunController object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@LogStartEnd</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</span>

<span class="sd">        Runs a shortest path builder for each county, using a maz_skim_cost</span>
<span class="sd">        to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)</span>
<span class="sd">        are written to CSV at the output_skim_file path:</span>
<span class="sd">        FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span>

<span class="sd">        The following config inputs are used directly in this component. Note also</span>
<span class="sd">        that the network mode_code is prepared in the highway_network component</span>
<span class="sd">        using the excluded_links.</span>

<span class="sd">        config.highway.maz_to_maz:</span>
<span class="sd">            skim_period: name of the period used for the skim, must match one the</span>
<span class="sd">                defined config.time_periods</span>
<span class="sd">            demand_county_groups: used for the list of counties, creates a list out</span>
<span class="sd">                of all listed counties under [].counties</span>
<span class="sd">            output_skim_file: relative path to save the skims</span>
<span class="sd">            value_of_time: value of time used to convert tolls and auto operating cost</span>
<span class="sd">            operating_cost_per_mile: auto operating cost</span>
<span class="sd">            max_skim_cost: max cost value used to limit the shortest path search</span>
<span class="sd">            mode_code:</span>

<span class="sd">        config.emme.num_processors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ref_period</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ref_period_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span>
        <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">period</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">ref_period_name</span><span class="p">:</span>
                <span class="n">ref_period</span> <span class="o">=</span> <span class="n">period</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">ref_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;highway.maz_to_maz.skim_period: is not the name of an existing time_period&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">ref_period</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="c1"># prepare output file and write header</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">counties</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
            <span class="n">counties</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">counties</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
                <span class="n">num_roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mark_roots</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_roots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">sp_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">sp_values</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates the temp attributes used in the component.&quot;&quot;&quot;</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;total cost MAZ-MAZ&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span> <span class="s2">&quot;selected roots (origins)&quot;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">temp_attributes_and_restore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="n">attributes</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear network obj ref to free memory</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_prepare_network</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the link cost in @link_cost and loads the network to self._network.&quot;&quot;&quot;</span>
        <span class="n">net_calc</span> <span class="o">=</span> <span class="n">NetworkCalculator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">has_traffic_results</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;(@free_flow_time.max.timau)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_attr</span> <span class="o">=</span> <span class="s2">&quot;@free_flow_time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time attribute </span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">)</span>
        <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">value_of_time</span>
        <span class="n">op_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">operating_cost_per_mile</span>
        <span class="n">net_calc</span><span class="p">(</span><span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_attr</span><span class="si">}</span><span class="s2"> + 0.6 / </span><span class="si">{</span><span class="n">vot</span><span class="si">}</span><span class="s2"> * (length * </span><span class="si">{</span><span class="n">op_cost</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">get_network</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;NODE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span> <span class="s2">&quot;#node_county&quot;</span><span class="p">]}</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mark_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">county</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Mark the available roots in the county.&quot;&quot;&quot;</span>
        <span class="n">count_roots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;#node_county&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">county</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span>
                <span class="n">count_roots</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">],</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">count_roots</span>

    <span class="nd">@LogStartEnd</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;DETAIL&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_run_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Run shortest paths tool and return dictionary of skim results name, numpy arrays.</span>

<span class="sd">        O-D pairs are limited by a max cost value from config.highway.maz_to_maz.max_skim_cost,</span>
<span class="sd">        from roots marked by @maz_root to all available leaves at @maz_id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with keys &quot;COST&quot;, &quot;DISTANCE&quot;, and &quot;BRIDGETOLL&quot;, and numpy</span>
<span class="sd">            arrays of SP values for available O-D pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shortest_paths_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.network_calculation.shortest_path&quot;</span>
        <span class="p">)</span>
        <span class="n">num_processors</span> <span class="o">=</span> <span class="n">parse_num_processors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">num_processors</span><span class="p">)</span>
        <span class="n">max_cost</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">max_skim_cost</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;modes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">mode_code</span><span class="p">],</span>
            <span class="s2">&quot;root_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_root&quot;</span><span class="p">,</span>
            <span class="s2">&quot;leaf_nodes&quot;</span><span class="p">:</span> <span class="s2">&quot;@maz_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;link_cost&quot;</span><span class="p">:</span> <span class="s2">&quot;@link_cost&quot;</span><span class="p">,</span>
            <span class="s2">&quot;path_constraints&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;max_cost&quot;</span><span class="p">:</span> <span class="n">max_cost</span><span class="p">,</span>
                <span class="s2">&quot;uturn_allowed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_leaves&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;through_centroids&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;exclude_forbidden_turns&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;skim_output&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;return_numpy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;analyses&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;SHORTEST_PATH_COST&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;COST&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;DISTANCE&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;component&quot;</span><span class="p">:</span> <span class="s2">&quot;@bridgetoll_da&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;OMX&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;performance_settings&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;number_of_processors&quot;</span><span class="p">:</span> <span class="n">num_processors</span><span class="p">,</span>
                <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>
        <span class="n">sp_values</span> <span class="o">=</span> <span class="n">shortest_paths_tool</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sp_values</span>

    <span class="k">def</span> <span class="nf">_export_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sp_values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NumpyArray</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Write matrix skims to CSV.</span>

<span class="sd">        The matrices are filtered to omit rows for which the COST is</span>
<span class="sd">        &lt; 0 or &gt; 1e19 (Emme uses 1e20 to indicate inaccessible zone pairs).</span>

<span class="sd">        sp_values: dictionary of matrix costs, with the three keys</span>
<span class="sd">            &quot;COST&quot;, &quot;DISTANCE&quot;, and &quot;BRIDGETOLL&quot; and Numpy arrays of values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get list of MAZ IDS</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_root&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="s2">&quot;@maz_id&quot;</span><span class="p">]]</span>
        <span class="c1"># build dataframe with output data and to/from MAZ ids</span>
        <span class="n">root_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">roots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaves</span><span class="p">))</span>
        <span class="n">leaf_ids</span> <span class="o">=</span> <span class="n">leaves</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;FROM_ZONE&quot;</span><span class="p">:</span> <span class="n">root_ids</span><span class="p">,</span>
                <span class="s2">&quot;TO_ZONE&quot;</span><span class="p">:</span> <span class="n">leaf_ids</span><span class="p">,</span>
                <span class="s2">&quot;COST&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;COST&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="s2">&quot;DISTANCE&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;DISTANCE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                <span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">:</span> <span class="n">sp_values</span><span class="p">[</span><span class="s2">&quot;BRIDGETOLL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># drop 0&#39;s / 1e20</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;COST &gt; 0 &amp; COST &lt; 1e19&quot;</span><span class="p">)</span>
        <span class="c1"># write remaining values to text file</span>
        <span class="c1"># FROM_ZONE,TO_ZONE,COST,DISTANCE,BRIDGETOLL</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
            <span class="n">result_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>MAZ-to-MAZ shortest-path skim of time, distance and toll.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>parent RunController object</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;MAZ-to-MAZ shortest-path skim of time, distance and toll.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller: parent RunController object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_network</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.components.network.highway.highway_maz.SkimMAZCosts.run" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</p>
<p>Runs a shortest path builder for each county, using a maz_skim_cost
to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)
are written to CSV at the output_skim_file path:
FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</p>
<p>The following config inputs are used directly in this component. Note also
that the network mode_code is prepared in the highway_network component
using the excluded_links.</p>
<p>config.highway.maz_to_maz:
    !!! skim_period &ldquo;name of the period used for the skim, must match one the&rdquo;
        defined config.time_periods
    !!! demand_county_groups &ldquo;used for the list of counties, creates a list out&rdquo;
        of all listed counties under [].counties
    output_skim_file: relative path to save the skims
    value_of_time: value of time used to convert tolls and auto operating cost
    operating_cost_per_mile: auto operating cost
    max_skim_cost: max cost value used to limit the shortest path search
    mode_code:</p>
<p>config.emme.num_processors</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/highway/highway_maz.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@LogStartEnd</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run shortest path skims for all available MAZ-to-MAZ O-D pairs.</span>

<span class="sd">    Runs a shortest path builder for each county, using a maz_skim_cost</span>
<span class="sd">    to limit the search. The valid gen cost (time + cost), distance and toll (drive alone)</span>
<span class="sd">    are written to CSV at the output_skim_file path:</span>
<span class="sd">    FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span>

<span class="sd">    The following config inputs are used directly in this component. Note also</span>
<span class="sd">    that the network mode_code is prepared in the highway_network component</span>
<span class="sd">    using the excluded_links.</span>

<span class="sd">    config.highway.maz_to_maz:</span>
<span class="sd">        skim_period: name of the period used for the skim, must match one the</span>
<span class="sd">            defined config.time_periods</span>
<span class="sd">        demand_county_groups: used for the list of counties, creates a list out</span>
<span class="sd">            of all listed counties under [].counties</span>
<span class="sd">        output_skim_file: relative path to save the skims</span>
<span class="sd">        value_of_time: value of time used to convert tolls and auto operating cost</span>
<span class="sd">        operating_cost_per_mile: auto operating cost</span>
<span class="sd">        max_skim_cost: max cost value used to limit the shortest path search</span>
<span class="sd">        mode_code:</span>

<span class="sd">    config.emme.num_processors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_period</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ref_period_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">skim_period</span>
    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">time_periods</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">period</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">ref_period_name</span><span class="p">:</span>
            <span class="n">ref_period</span> <span class="o">=</span> <span class="n">period</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">ref_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;highway.maz_to_maz.skim_period: is not the name of an existing time_period&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_emme_scenario</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">emme</span><span class="o">.</span><span class="n">highway_database_path</span><span class="p">,</span> <span class="n">ref_period</span><span class="o">.</span><span class="n">name</span>
    <span class="p">)</span>
    <span class="c1"># prepare output file and write header</span>
    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_abs_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">output_skim_file</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">output</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FROM_ZONE, TO_ZONE, COST, DISTANCE, BRIDGETOLL</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">counties</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">highway</span><span class="o">.</span><span class="n">maz_to_maz</span><span class="o">.</span><span class="n">demand_county_groups</span><span class="p">:</span>
        <span class="n">counties</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">counties</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_network</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
            <span class="n">num_roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mark_roots</span><span class="p">(</span><span class="n">county</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_roots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sp_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_shortest_path</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_export_results</span><span class="p">(</span><span class="n">sp_values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.HighwayMazToMazConfig" class="doc doc-heading">
        <code>
tm2py.config.HighwayMazToMazConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.HighwayMazToMazConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Highway MAZ to MAZ shortest path assignment and skim parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition mode_code">
<p class="admonition-title">single character mode, used to generate link.modes to</p>
<p>identify subnetwork, generated from &ldquo;excluded_links&rdquo; keywords,
plus including MAZ connectors.</p>
</div>
<div class="admonition max_skim_cost">
<p class="admonition-title">max shortest path distance to search for MAZ-to-MAZ</p>
<p>skims, in generized costs units (includes operating cost
converted to minutes)</p>
</div>
<div class="admonition excluded_links">
<p class="admonition-title">list of keywords to identify links to exclude from</p>
<p>MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</p>
</div>
<div class="admonition demand_file">
<p class="admonition-title">relative path to find the input demand files</p>
<p>can have use a placeholder for {period} and {number}, where the
{period} is the time_period.name (see TimePeriodConfig)
and {number} is the demand_count_groups[].number
(see DemandCountyGroupConfig)
e.g.: auto_{period}<em>MAZ_AUTO</em>{number}_{period}.omx</p>
</div>
<div class="admonition skim_period">
<p class="admonition-title">period name to use for the shotest path skims, must</p>
<p>match one of the names listed in the time_periods</p>
</div>
<p>output_skim_file: relative path to resulting MAZ-to-MAZ skims</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayMazToMazConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway MAZ to MAZ shortest path assignment and skim parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords,</span>
<span class="sd">            plus including MAZ connectors.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        max_skim_cost: max shortest path distance to search for MAZ-to-MAZ</span>
<span class="sd">            skims, in generized costs units (includes operating cost</span>
<span class="sd">            converted to minutes)</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</span>
<span class="sd">        demand_file: relative path to find the input demand files</span>
<span class="sd">            can have use a placeholder for {period} and {number}, where the</span>
<span class="sd">            {period} is the time_period.name (see TimePeriodConfig)</span>
<span class="sd">            and {number} is the demand_count_groups[].number</span>
<span class="sd">            (see DemandCountyGroupConfig)</span>
<span class="sd">            e.g.: auto_{period}_MAZ_AUTO_{number}_{period}.omx</span>
<span class="sd">        demand_county_groups: List of demand county names and</span>
<span class="sd">        skim_period: period name to use for the shotest path skims, must</span>
<span class="sd">            match one of the names listed in the time_periods</span>
<span class="sd">        output_skim_file: relative path to resulting MAZ-to-MAZ skims</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_skim_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_county_groups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DemandCountyGroupConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skim_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.HighwayMazToMazConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HighwayMazToMazConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Highway MAZ to MAZ shortest path assignment and skim parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        mode_code: single character mode, used to generate link.modes to</span>
<span class="sd">            identify subnetwork, generated from &quot;excluded_links&quot; keywords,</span>
<span class="sd">            plus including MAZ connectors.</span>
<span class="sd">        value_of_time: value of time for this class in $ / hr</span>
<span class="sd">        operating_cost_per_mile: vehicle operating cost in cents / mile</span>
<span class="sd">        max_skim_cost: max shortest path distance to search for MAZ-to-MAZ</span>
<span class="sd">            skims, in generized costs units (includes operating cost</span>
<span class="sd">            converted to minutes)</span>
<span class="sd">        excluded_links: list of keywords to identify links to exclude from</span>
<span class="sd">            MAZ-to-MAZ paths, see HighwayClassConfig.excluded_links</span>
<span class="sd">        demand_file: relative path to find the input demand files</span>
<span class="sd">            can have use a placeholder for {period} and {number}, where the</span>
<span class="sd">            {period} is the time_period.name (see TimePeriodConfig)</span>
<span class="sd">            and {number} is the demand_count_groups[].number</span>
<span class="sd">            (see DemandCountyGroupConfig)</span>
<span class="sd">            e.g.: auto_{period}_MAZ_AUTO_{number}_{period}.omx</span>
<span class="sd">        demand_county_groups: List of demand county names and</span>
<span class="sd">        skim_period: period name to use for the shotest path skims, must</span>
<span class="sd">            match one of the names listed in the time_periods</span>
<span class="sd">        output_skim_file: relative path to resulting MAZ-to-MAZ skims</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">max_skim_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">excluded_links</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">demand_county_groups</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DemandCountyGroupConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">skim_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>
    <span class="n">output_skim_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">()</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
        <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




















  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.HighwayMazToMazConfig.__pydantic_model__.unique_group_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_group_numbers</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayMazToMazConfig.__pydantic_model__.unique_group_numbers" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate list of demand_county_groups has unique .number values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h4 id="tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">unique_group_numbers</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.HighwayMazToMazConfig.unique_group_numbers" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Validate list of demand_county_groups has unique .number values.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;demand_county_groups&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unique_group_numbers</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate list of demand_county_groups has unique .number values.&quot;&quot;&quot;</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">group</span><span class="o">.</span><span class="n">number</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">group_ids</span><span class="p">)),</span> <span class="s2">&quot;-&gt; number value must be unique&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

<h3 id="transit-network-components">Transit Network Components<a class="headerlink" href="#transit-network-components" title="Permanent link"> </a></h3>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.transit.transit_assign" class="doc doc-heading">
        <code>tm2py.components.network.transit.transit_assign</code>



<a href="#tm2py.components.network.transit.transit_assign" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Transit assignment module.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.transit.transit_assign.TransitAssignment" class="doc doc-heading">
        <code>
TransitAssignment            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.network.transit.transit_assign.TransitAssignment" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Run transit assignment.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/transit/transit_assign.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitAssignment</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run transit assignment.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="tm2py.components.network.transit.transit_skim" class="doc doc-heading">
        <code>tm2py.components.network.transit.transit_skim</code>



<a href="#tm2py.components.network.transit.transit_skim" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Transit skims module.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="tm2py.components.network.transit.transit_skim.TransitSkim" class="doc doc-heading">
        <code>
TransitSkim            (<a class="autorefs autorefs-internal" title="tm2py.components.component.Component" href="#tm2py.components.component.Component">Component</a>)
        </code>



<a href="#tm2py.components.network.transit.transit_skim.TransitSkim" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Run transit skims.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/components/network/transit/transit_skim.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitSkim</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run transit skims.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>


    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.TransitModeConfig" class="doc doc-heading">
        <code>
tm2py.config.TransitModeConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Transit mode definition (see also mode in the Emme API).</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitModeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit mode definition (see also mode in the Emme API).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;WALK&quot;</span><span class="p">,</span> <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;EGRESS&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCAL&quot;</span><span class="p">,</span> <span class="s2">&quot;PREMIUM&quot;</span><span class="p">]</span>
    <span class="n">assign_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="n">mode_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">in_vehicle_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">speed_miles_per_hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">













  <div class="doc doc-object doc-class">



<h4 id="tm2py.config.TransitModeConfig.__pydantic_model__" class="doc doc-heading">
        <code>
__pydantic_model__            (<span title="pydantic.main.BaseModel">BaseModel</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-model"><code>pydantic-model</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.__pydantic_model__" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitModeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit mode definition (see also mode in the Emme API).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;WALK&quot;</span><span class="p">,</span> <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span> <span class="s2">&quot;EGRESS&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCAL&quot;</span><span class="p">,</span> <span class="s2">&quot;PREMIUM&quot;</span><span class="p">]</span>
    <span class="n">assign_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;TRANSIT&quot;</span><span class="p">,</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">]</span>
    <span class="n">mode_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">in_vehicle_perception_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">speed_miles_per_hour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.TransitModeConfig.__pydantic_model__.in_vehicle_perception_factor_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.__pydantic_model__.in_vehicle_perception_factor_valid" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.config.TransitModeConfig.__pydantic_model__.speed_miles_per_hour_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.__pydantic_model__.speed_miles_per_hour_valid" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>













  <div class="doc doc-object doc-method">



<h4 id="tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.in_vehicle_perception_factor_valid" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;in_vehicle_perception_factor&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">in_vehicle_perception_factor_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate in_vehicle_perception_factor exists if assign_type is TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.config.TransitModeConfig.speed_miles_per_hour_valid" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;speed_miles_per_hour&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">speed_miles_per_hour_valid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate speed_miles_per_hour exists if assign_type is AUX_TRANSIT.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;assign_type&quot;</span> <span class="ow">in</span> <span class="n">values</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;assign_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AUX_TRANSIT&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;must be specified when assign_type==AUX_TRANSIT&quot;</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.TransitConfig" class="doc doc-heading">
        <code>
tm2py.config.TransitConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.TransitConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Transit assignment parameters.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TransitConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transit assignment parameters.&quot;&quot;&quot;</span>

    <span class="n">modes</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitModeConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">vehicles</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">TransitVehicleConfig</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

    <span class="n">apply_msa_demand</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">effective_headway_source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">initial_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_wait_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">walk_perception_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">initial_boarding_penalty</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">transfer_boarding_penalty</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_transfers</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">output_skim_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fares_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fare_matrix_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fare_max_transfer_distance_miles</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">use_fares</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">override_connector_times</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">input_connector_access_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">input_connector_egress_times_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">output_stop_usage_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">








































  </div>

    </div>

  </div>

<h3 id="active-network-components">Active Network Components<a class="headerlink" href="#active-network-components" title="Permanent link"> </a></h3>
<p>To come.</p>
<h2 id="emme-wrappers">Emme Wrappers<a class="headerlink" href="#emme-wrappers" title="Permanent link"> </a></h2>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.emme" class="doc doc-heading">
        <code>tm2py.emme</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Emme components module.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h4 id="tm2py.emme.manager" class="doc doc-heading">
        <code>manager</code>



<a href="#tm2py.emme.manager" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Module for Emme Manager for centralized management of Emme projects.</p>
<p>Centralized location for Emme API imports, which are automatically replaced
by unittest.Mock / MagicMock to support testing where Emme is not installed.</p>
<p>Contains EmmeManager class for access to common Emme-related procedures
(common-code / utility-type methods) and caching access to Emme project,
and Modeller.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h5 id="tm2py.emme.manager.EmmeManager" class="doc doc-heading">
        <code>
EmmeManager        </code>



<a href="#tm2py.emme.manager.EmmeManager" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Centralized cache for Emme project and related calls for traffic and transit assignments.</p>
<p>Wraps Emme Desktop API (see Emme API Reference for additional details on the Emme objects).</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EmmeManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Centralized cache for Emme project and related calls for traffic and transit assignments.</span>

<span class="sd">    Wraps Emme Desktop API (see Emme API Reference for additional details on the Emme objects).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The EmmeManager constructor.</span>

<span class="sd">        Maps an Emme project path to Emme Desktop API object for reference</span>
<span class="sd">        (projects are opened only once).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span> <span class="o">=</span> <span class="n">_EMME_PROJECT_REF</span>

    <span class="k">def</span> <span class="nf">close_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close all open cached Emme project(s).</span>

<span class="sd">        Should be called at the end of the model process / Emme assignments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
            <span class="n">app</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeDesktopApp</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create, open and return Emme project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_dir: path to Emme root directory for new Emme project</span>
<span class="sd">            name: name for the Emme project</span>

<span class="sd">        Returns:</span>
<span class="sd">            Emme Desktop App object, see Emme API Reference, Desktop section for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emp_path</span> <span class="o">=</span> <span class="n">_app</span><span class="o">.</span><span class="n">create_project</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">emp_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeDesktopApp</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return already open Emme project, or open new Desktop session if not found.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_path: valid path to Emme project *.emp file</span>

<span class="sd">        Returns:</span>
<span class="sd">            Emme Desktop App object, see Emme API Reference, Desktop section for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">project_path</span><span class="p">))</span>
        <span class="n">emme_project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">emme_project</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># Check if the Emme window was closed</span>
                <span class="n">emme_project</span><span class="o">.</span><span class="n">current_window</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">_socket_error</span><span class="p">:</span>
                <span class="n">emme_project</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># if window is not opened in this process, start a new one</span>
        <span class="k">if</span> <span class="n">emme_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emme project path does not exist </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">emme_project</span> <span class="o">=</span> <span class="n">_app</span><span class="o">.</span><span class="n">start_dedicated</span><span class="p">(</span>
                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user_initials</span><span class="o">=</span><span class="s2">&quot;inro&quot;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">project_path</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="p">[</span><span class="n">project_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">emme_project</span>
        <span class="k">return</span> <span class="n">emme_project</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">emmebank</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Emmebank</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Open and return the Emmebank at path.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: valid system path pointing to an Emmebank file</span>
<span class="sd">        Returns:</span>
<span class="sd">            Emmebank object, see Emme API Reference, Database section for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;emmebank&quot;</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;emmebank&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Emmebank</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">change_emmebank_dimensions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">emmebank</span><span class="p">:</span> <span class="n">Emmebank</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the Emmebank dimensions as specified. See the Emme API help for details.</span>

<span class="sd">        Args:</span>
<span class="sd">            emmebank: the Emmebank object to change the dimensions</span>
<span class="sd">            dimensions: dictionary of the specified dimensions to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">dimensions</span>
        <span class="n">new_dims</span> <span class="o">=</span> <span class="n">dims</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">new_dims</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dims</span> <span class="o">!=</span> <span class="n">new_dims</span><span class="p">:</span>
            <span class="n">change_dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
                <span class="s2">&quot;inro.emme.data.database.change_database_dimensions&quot;</span>
            <span class="p">)</span>
            <span class="n">change_dimensions</span><span class="p">(</span><span class="n">new_dims</span><span class="p">,</span> <span class="n">emmebank</span><span class="p">,</span> <span class="n">keep_backup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">modeller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emme_project</span><span class="p">:</span> <span class="n">EmmeDesktopApp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeModeller</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize and return Modeller object.</span>

<span class="sd">        If Modeller has not already been initialized it will do so on</span>
<span class="sd">        specified Emme project, or the first Emme project opened if not provided.</span>
<span class="sd">        If already initialized Modeller will reference whichever project was used</span>
<span class="sd">        first.</span>

<span class="sd">        Args:</span>
<span class="sd">            emme_project: open &#39;Emme Desktop&#39; application (inro.emme.desktop.app)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Emme Modeller object, see Emme API Reference, Modeller section for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=E0611, E0401, E1101</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">EmmeModeller</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">emme_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="p">:</span>
                    <span class="n">emme_project</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;modeller not yet initialized and no cached Emme project,&quot;</span>
                        <span class="s2">&quot; emme_project arg must be provided&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
            <span class="k">return</span> <span class="n">EmmeModeller</span><span class="p">(</span><span class="n">emme_project</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the Modeller tool at namespace.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Corresponding Tool object, see Emme Help for full details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modeller</span><span class="p">()</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">temp_attributes_and_restore</span><span class="p">(</span>
        <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create temp extra attribute and network field, and backup values and state and restore.</span>

<span class="sd">        Allows the use of temporary attributes which may conflict with existing attributes.</span>
<span class="sd">        The temp created attributes are deleted at the end, and if there were pre-existing</span>
<span class="sd">        attributes with the same names the values are restored.</span>

<span class="sd">        Note that name conflicts may still arise in the shorthand inheritance systems</span>
<span class="sd">        for the network hierarchy tree (@node attribute reserves -&gt; @nodei, @nodej, etc,</span>
<span class="sd">        see Emme help Network calculations for full list) which will raise an error in the</span>
<span class="sd">        Emme API.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object</span>
<span class="sd">            attributes: list of attribute details, where details is a list of 3 items</span>
<span class="sd">                for extra attributes and 4 for network fields: domain, name, description[, atype]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attrs_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fields_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">attrs_to_restore</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;TURN&quot;</span><span class="p">,</span> <span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">details</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">extra_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">network_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">or</span> <span class="n">field</span><span class="p">:</span>
                <span class="n">attrs_to_restore</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">):</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">create_extra_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">desc</span>
                <span class="n">attrs_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atype</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">create_nertwork_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">atype</span><span class="p">)</span>
                <span class="n">field</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">desc</span>
                <span class="n">fields_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">backup</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">attrs_to_restore</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">backup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">names</span><span class="p">))</span>
                <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attrs_to_delete</span><span class="p">:</span>
                <span class="n">scenario</span><span class="o">.</span><span class="n">delete_extra_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields_to_delete</span><span class="p">:</span>
                <span class="n">scenario</span><span class="o">.</span><span class="n">delete_network_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">backup</span><span class="p">:</span>
                <span class="n">scenario</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">copy_attr_values</span><span class="p">(</span>
        <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">src</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">EmmeNetwork</span><span class="p">],</span>
        <span class="n">dst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">EmmeNetwork</span><span class="p">],</span>
        <span class="n">src_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">dst_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy attribute values between Emme scenario (on disk) and network (in memory).</span>

<span class="sd">        Args:</span>
<span class="sd">            domain: attribute domain, one of &quot;NODE&quot;, &quot;LINK&quot;, &quot;TURN&quot;, &quot;TRANSIT_LINE&quot;,</span>
<span class="sd">                &quot;TRANSIT_SEGMENT&quot;</span>
<span class="sd">            src: source Emme scenario or network to load values from</span>
<span class="sd">            dst: destination Emme scenario or network to save values to</span>
<span class="sd">            src_names: names of the attributes for loading values</span>
<span class="sd">            dst_names: optional, names of the attributes to save values as, defaults</span>
<span class="sd">                to using the src_names if not specified</span>

<span class="sd">        Returns:</span>
<span class="sd">            Emme Modeller object, see Emme API Reference, Modeller section for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dst_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dst_names</span> <span class="o">=</span> <span class="n">src_names</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">src_names</span><span class="p">)</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">dst_names</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_network</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeNetwork</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read partial Emme network from the scenario for the domains and attributes specified.</span>

<span class="sd">        Optimized load of network object from scenario (disk / emmebank) for only the</span>
<span class="sd">        domains specified, and only reads the attributes specified. The attributes is a</span>
<span class="sd">        dictionary with keys for the required domains, and values as lists of the</span>
<span class="sd">        attributes required by domain.</span>

<span class="sd">        Wrapper for scenario.get_partial_network followed by scenario.get_attribute_values</span>
<span class="sd">        and network.set_attribute_values.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario: Emme scenario object, see Emme API reference</span>
<span class="sd">            attributes: dictionary of domain names to lists of attribute names</span>

<span class="sd">        Returns:</span>
<span class="sd">            Emme Network object, see Emme API Reference, Network section for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
        <span class="n">network</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_partial_network</span><span class="p">(</span>
            <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">include_attributes</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copy_attr_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">network</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">logbook_write</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write an entry to the Emme Logbook at the current nesting level.</span>

<span class="sd">        Wrapper for inro.modeller.logbook_write.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The title of the logbook entry</span>
<span class="sd">            attributes: Optional. A Python dictionary of key-value pairs to be</span>
<span class="sd">                        displayed in the logbook entry detailed view.</span>
<span class="sd">            value: Optional. An HTML string value to be displayed in main detail</span>
<span class="sd">                   pane of the logbook entry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=E0611, E0401, E1101</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attributes</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="n">logbook_write</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">logbook_trace</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write an entry to the Modeller logbook and create a nest in the Logbook.</span>

<span class="sd">        Wrapper for inro.modeller.logbook_trace. Used in the with statement, e.g.</span>

<span class="sd">        ```</span>
<span class="sd">        with _emme_tools.logbook_trace(&#39;My nest&#39;):</span>
<span class="sd">            _emme_tools.logbook_write(&#39;This entry is nested&#39;)</span>
<span class="sd">        ```</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The title of the logbook entry</span>
<span class="sd">            attributes: Optional. A Python dictionary of key-value pairs to be</span>
<span class="sd">                        displayed in the logbook entry detailed view.</span>
<span class="sd">            value: Optional. An HTML string value to be displayed in main detail</span>
<span class="sd">                   pane of the logbook entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=E0611, E0401, E1101</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attributes</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">logbook_trace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">):</span>
            <span class="k">yield</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme.manager.EmmeManager.__init__" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>The EmmeManager constructor.</p>
<p>Maps an Emme project path to Emme Desktop API object for reference
(projects are opened only once).</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The EmmeManager constructor.</span>

<span class="sd">    Maps an Emme project path to Emme Desktop API object for reference</span>
<span class="sd">    (projects are opened only once).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span> <span class="o">=</span> <span class="n">_EMME_PROJECT_REF</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.change_emmebank_dimensions" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">change_emmebank_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emmebank</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">)</span></code>


<a href="#tm2py.emme.manager.EmmeManager.change_emmebank_dimensions" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Change the Emmebank dimensions as specified. See the Emme API help for details.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>emmebank</code></td>
        <td><code>&lt;MagicMock name=&#39;mock.Emmebank&#39; id=&#39;140138509068224&#39;&gt;</code></td>
        <td><p>the Emmebank object to change the dimensions</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dimensions</code></td>
        <td><code>Dict[str, int]</code></td>
        <td><p>dictionary of the specified dimensions to set.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">change_emmebank_dimensions</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">emmebank</span><span class="p">:</span> <span class="n">Emmebank</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Change the Emmebank dimensions as specified. See the Emme API help for details.</span>

<span class="sd">    Args:</span>
<span class="sd">        emmebank: the Emmebank object to change the dimensions</span>
<span class="sd">        dimensions: dictionary of the specified dimensions to set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="n">emmebank</span><span class="o">.</span><span class="n">dimensions</span>
    <span class="n">new_dims</span> <span class="o">=</span> <span class="n">dims</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">new_dims</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dimensions</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dims</span> <span class="o">!=</span> <span class="n">new_dims</span><span class="p">:</span>
        <span class="n">change_dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.data.database.change_database_dimensions&quot;</span>
        <span class="p">)</span>
        <span class="n">change_dimensions</span><span class="p">(</span><span class="n">new_dims</span><span class="p">,</span> <span class="n">emmebank</span><span class="p">,</span> <span class="n">keep_backup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.close_all" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">close_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.emme.manager.EmmeManager.close_all" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Close all open cached Emme project(s).</p>
<p>Should be called at the end of the model process / Emme assignments.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">close_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Close all open cached Emme project(s).</span>

<span class="sd">    Should be called at the end of the model process / Emme assignments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.copy_attr_values" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">copy_attr_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">src_names</span><span class="p">,</span> <span class="n">dst_names</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.emme.manager.EmmeManager.copy_attr_values" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Copy attribute values between Emme scenario (on disk) and network (in memory).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>domain</code></td>
        <td><code>str</code></td>
        <td><p>attribute domain, one of &ldquo;NODE&rdquo;, &ldquo;LINK&rdquo;, &ldquo;TURN&rdquo;, &ldquo;TRANSIT_LINE&rdquo;,
&ldquo;TRANSIT_SEGMENT&rdquo;</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>src</code></td>
        <td><code>Union[&lt;MagicMock name=&#39;mock.Scenario&#39; id=&#39;140138509096320&#39;&gt;, &lt;MagicMock name=&#39;mock.Network&#39; id=&#39;140138509112416&#39;&gt;]</code></td>
        <td><p>source Emme scenario or network to load values from</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dst</code></td>
        <td><code>Union[&lt;MagicMock name=&#39;mock.Scenario&#39; id=&#39;140138509096320&#39;&gt;, &lt;MagicMock name=&#39;mock.Network&#39; id=&#39;140138509112416&#39;&gt;]</code></td>
        <td><p>destination Emme scenario or network to save values to</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>src_names</code></td>
        <td><code>List[str]</code></td>
        <td><p>names of the attributes for loading values</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dst_names</code></td>
        <td><code>List[str]</code></td>
        <td><p>optional, names of the attributes to save values as, defaults
to using the src_names if not specified</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>Emme Modeller object, see Emme API Reference, Modeller section for details.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">copy_attr_values</span><span class="p">(</span>
    <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">src</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">EmmeNetwork</span><span class="p">],</span>
    <span class="n">dst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">EmmeNetwork</span><span class="p">],</span>
    <span class="n">src_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">dst_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Copy attribute values between Emme scenario (on disk) and network (in memory).</span>

<span class="sd">    Args:</span>
<span class="sd">        domain: attribute domain, one of &quot;NODE&quot;, &quot;LINK&quot;, &quot;TURN&quot;, &quot;TRANSIT_LINE&quot;,</span>
<span class="sd">            &quot;TRANSIT_SEGMENT&quot;</span>
<span class="sd">        src: source Emme scenario or network to load values from</span>
<span class="sd">        dst: destination Emme scenario or network to save values to</span>
<span class="sd">        src_names: names of the attributes for loading values</span>
<span class="sd">        dst_names: optional, names of the attributes to save values as, defaults</span>
<span class="sd">            to using the src_names if not specified</span>

<span class="sd">    Returns:</span>
<span class="sd">        Emme Modeller object, see Emme API Reference, Modeller section for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dst_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dst_names</span> <span class="o">=</span> <span class="n">src_names</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">src_names</span><span class="p">)</span>
    <span class="n">dst</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">dst_names</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.create_project" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


<a href="#tm2py.emme.manager.EmmeManager.create_project" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Create, open and return Emme project.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>project_dir</code></td>
        <td><code>str</code></td>
        <td><p>path to Emme root directory for new Emme project</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>name for the Emme project</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;MagicMock name=&#39;mock.emme.desktop.app.App&#39; id=&#39;140138509184640&#39;&gt;</code></td>
      <td><p>Emme Desktop App object, see Emme API Reference, Desktop section for details.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">create_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeDesktopApp</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create, open and return Emme project.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_dir: path to Emme root directory for new Emme project</span>
<span class="sd">        name: name for the Emme project</span>

<span class="sd">    Returns:</span>
<span class="sd">        Emme Desktop App object, see Emme API Reference, Desktop section for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">emp_path</span> <span class="o">=</span> <span class="n">_app</span><span class="o">.</span><span class="n">create_project</span><span class="p">(</span><span class="n">project_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">emp_path</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.emmebank" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">emmebank</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.emme.manager.EmmeManager.emmebank" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Open and return the Emmebank at path.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>str</code></td>
        <td><p>valid system path pointing to an Emmebank file</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;MagicMock name=&#39;mock.Emmebank&#39; id=&#39;140138509068224&#39;&gt;</code></td>
      <td><p>Emmebank object, see Emme API Reference, Database section for details.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">emmebank</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Emmebank</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Open and return the Emmebank at path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: valid system path pointing to an Emmebank file</span>
<span class="sd">    Returns:</span>
<span class="sd">        Emmebank object, see Emme API Reference, Database section for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;emmebank&quot;</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;emmebank&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Emmebank</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.get_network" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#tm2py.emme.manager.EmmeManager.get_network" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Read partial Emme network from the scenario for the domains and attributes specified.</p>
<p>Optimized load of network object from scenario (disk / emmebank) for only the
domains specified, and only reads the attributes specified. The attributes is a
dictionary with keys for the required domains, and values as lists of the
attributes required by domain.</p>
<p>Wrapper for scenario.get_partial_network followed by scenario.get_attribute_values
and network.set_attribute_values.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>scenario</code></td>
        <td><code>&lt;MagicMock name=&#39;mock.Scenario&#39; id=&#39;140138509096320&#39;&gt;</code></td>
        <td><p>Emme scenario object, see Emme API reference</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>attributes</code></td>
        <td><code>Dict[str, List[str]]</code></td>
        <td><p>dictionary of domain names to lists of attribute names</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;MagicMock name=&#39;mock.Network&#39; id=&#39;140138509112416&#39;&gt;</code></td>
      <td><p>Emme Network object, see Emme API Reference, Network section for details.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_network</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeNetwork</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Read partial Emme network from the scenario for the domains and attributes specified.</span>

<span class="sd">    Optimized load of network object from scenario (disk / emmebank) for only the</span>
<span class="sd">    domains specified, and only reads the attributes specified. The attributes is a</span>
<span class="sd">    dictionary with keys for the required domains, and values as lists of the</span>
<span class="sd">    attributes required by domain.</span>

<span class="sd">    Wrapper for scenario.get_partial_network followed by scenario.get_attribute_values</span>
<span class="sd">    and network.set_attribute_values.</span>

<span class="sd">    Args:</span>
<span class="sd">        scenario: Emme scenario object, see Emme API reference</span>
<span class="sd">        attributes: dictionary of domain names to lists of attribute names</span>

<span class="sd">    Returns:</span>
<span class="sd">        Emme Network object, see Emme API Reference, Network section for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_network</span><span class="p">()</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_partial_network</span><span class="p">(</span>
        <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">include_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">copy_attr_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">network</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.logbook_trace" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">logbook_trace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.emme.manager.EmmeManager.logbook_trace" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Write an entry to the Modeller logbook and create a nest in the Logbook.</p>
<p>Wrapper for inro.modeller.logbook_trace. Used in the with statement, e.g.</p>
<div class="highlight"><pre><span></span><code>with _emme_tools.logbook_trace(&#39;My nest&#39;):
    _emme_tools.logbook_write(&#39;This entry is nested&#39;)
</code></pre></div>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>The title of the logbook entry</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>attributes</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Optional. A Python dictionary of key-value pairs to be
        displayed in the logbook entry detailed view.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>value</code></td>
        <td><code>str</code></td>
        <td><p>Optional. An HTML string value to be displayed in main detail
   pane of the logbook entry.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="nd">@_context</span>
<span class="k">def</span> <span class="nf">logbook_trace</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write an entry to the Modeller logbook and create a nest in the Logbook.</span>

<span class="sd">    Wrapper for inro.modeller.logbook_trace. Used in the with statement, e.g.</span>

<span class="sd">    ```</span>
<span class="sd">    with _emme_tools.logbook_trace(&#39;My nest&#39;):</span>
<span class="sd">        _emme_tools.logbook_write(&#39;This entry is nested&#39;)</span>
<span class="sd">    ```</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The title of the logbook entry</span>
<span class="sd">        attributes: Optional. A Python dictionary of key-value pairs to be</span>
<span class="sd">                    displayed in the logbook entry detailed view.</span>
<span class="sd">        value: Optional. An HTML string value to be displayed in main detail</span>
<span class="sd">               pane of the logbook entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=E0611, E0401, E1101</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attributes</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">logbook_trace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">):</span>
        <span class="k">yield</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.logbook_write" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">logbook_write</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.emme.manager.EmmeManager.logbook_write" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Write an entry to the Emme Logbook at the current nesting level.</p>
<p>Wrapper for inro.modeller.logbook_write.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>The title of the logbook entry</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>attributes</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Optional. A Python dictionary of key-value pairs to be
        displayed in the logbook entry detailed view.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>value</code></td>
        <td><code>str</code></td>
        <td><p>Optional. An HTML string value to be displayed in main detail
   pane of the logbook entry</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">logbook_write</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write an entry to the Emme Logbook at the current nesting level.</span>

<span class="sd">    Wrapper for inro.modeller.logbook_write.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The title of the logbook entry</span>
<span class="sd">        attributes: Optional. A Python dictionary of key-value pairs to be</span>
<span class="sd">                    displayed in the logbook entry detailed view.</span>
<span class="sd">        value: Optional. An HTML string value to be displayed in main detail</span>
<span class="sd">               pane of the logbook entry</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=E0611, E0401, E1101</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span> <span class="k">if</span> <span class="n">attributes</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="n">logbook_write</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="n">attributes</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.modeller" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">modeller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emme_project</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#tm2py.emme.manager.EmmeManager.modeller" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Initialize and return Modeller object.</p>
<p>If Modeller has not already been initialized it will do so on
specified Emme project, or the first Emme project opened if not provided.
If already initialized Modeller will reference whichever project was used
first.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>emme_project</code></td>
        <td><code>&lt;MagicMock name=&#39;mock.emme.desktop.app.App&#39; id=&#39;140138509184640&#39;&gt;</code></td>
        <td><p>open &lsquo;Emme Desktop&rsquo; application (inro.emme.desktop.app)</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;MagicMock name=&#39;mock.Modeller&#39; id=&#39;140138509136416&#39;&gt;</code></td>
      <td><p>Emme Modeller object, see Emme API Reference, Modeller section for details.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">modeller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emme_project</span><span class="p">:</span> <span class="n">EmmeDesktopApp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeModeller</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Initialize and return Modeller object.</span>

<span class="sd">    If Modeller has not already been initialized it will do so on</span>
<span class="sd">    specified Emme project, or the first Emme project opened if not provided.</span>
<span class="sd">    If already initialized Modeller will reference whichever project was used</span>
<span class="sd">    first.</span>

<span class="sd">    Args:</span>
<span class="sd">        emme_project: open &#39;Emme Desktop&#39; application (inro.emme.desktop.app)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Emme Modeller object, see Emme API Reference, Modeller section for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=E0611, E0401, E1101</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">EmmeModeller</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">emme_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="p">:</span>
                <span class="n">emme_project</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;modeller not yet initialized and no cached Emme project,&quot;</span>
                    <span class="s2">&quot; emme_project arg must be provided&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">return</span> <span class="n">EmmeModeller</span><span class="p">(</span><span class="n">emme_project</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.project" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">)</span></code>


<a href="#tm2py.emme.manager.EmmeManager.project" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Return already open Emme project, or open new Desktop session if not found.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>project_path</code></td>
        <td><code>str</code></td>
        <td><p>valid path to Emme project *.emp file</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;MagicMock name=&#39;mock.emme.desktop.app.App&#39; id=&#39;140138509184640&#39;&gt;</code></td>
      <td><p>Emme Desktop App object, see Emme API Reference, Desktop section for details.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeDesktopApp</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return already open Emme project, or open new Desktop session if not found.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_path: valid path to Emme project *.emp file</span>

<span class="sd">    Returns:</span>
<span class="sd">        Emme Desktop App object, see Emme API Reference, Desktop section for details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">project_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">project_path</span><span class="p">))</span>
    <span class="n">emme_project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">emme_project</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Check if the Emme window was closed</span>
            <span class="n">emme_project</span><span class="o">.</span><span class="n">current_window</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">_socket_error</span><span class="p">:</span>
            <span class="n">emme_project</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># if window is not opened in this process, start a new one</span>
    <span class="k">if</span> <span class="n">emme_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">project_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emme project path does not exist </span><span class="si">{</span><span class="n">project_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">emme_project</span> <span class="o">=</span> <span class="n">_app</span><span class="o">.</span><span class="n">start_dedicated</span><span class="p">(</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user_initials</span><span class="o">=</span><span class="s2">&quot;inro&quot;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="n">project_path</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_cache</span><span class="p">[</span><span class="n">project_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">emme_project</span>
    <span class="k">return</span> <span class="n">emme_project</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.temp_attributes_and_restore" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">temp_attributes_and_restore</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">attributes</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.emme.manager.EmmeManager.temp_attributes_and_restore" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Create temp extra attribute and network field, and backup values and state and restore.</p>
<p>Allows the use of temporary attributes which may conflict with existing attributes.
The temp created attributes are deleted at the end, and if there were pre-existing
attributes with the same names the values are restored.</p>
<p>Note that name conflicts may still arise in the shorthand inheritance systems
for the network hierarchy tree (@node attribute reserves -&gt; @nodei, @nodej, etc,
see Emme help Network calculations for full list) which will raise an error in the
Emme API.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>scenario</code></td>
        <td><code>&lt;MagicMock name=&#39;mock.Scenario&#39; id=&#39;140138509096320&#39;&gt;</code></td>
        <td><p>Emme scenario object</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>attributes</code></td>
        <td><code>List[List[str]]</code></td>
        <td><p>list of attribute details, where details is a list of 3 items
for extra attributes and 4 for network fields: domain, name, description[, atype]</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="nd">@_context</span>
<span class="k">def</span> <span class="nf">temp_attributes_and_restore</span><span class="p">(</span>
    <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">,</span> <span class="n">attributes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create temp extra attribute and network field, and backup values and state and restore.</span>

<span class="sd">    Allows the use of temporary attributes which may conflict with existing attributes.</span>
<span class="sd">    The temp created attributes are deleted at the end, and if there were pre-existing</span>
<span class="sd">    attributes with the same names the values are restored.</span>

<span class="sd">    Note that name conflicts may still arise in the shorthand inheritance systems</span>
<span class="sd">    for the network hierarchy tree (@node attribute reserves -&gt; @nodei, @nodej, etc,</span>
<span class="sd">    see Emme help Network calculations for full list) which will raise an error in the</span>
<span class="sd">    Emme API.</span>

<span class="sd">    Args:</span>
<span class="sd">        scenario: Emme scenario object</span>
<span class="sd">        attributes: list of attribute details, where details is a list of 3 items</span>
<span class="sd">            for extra attributes and 4 for network fields: domain, name, description[, atype]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attrs_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fields_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">attrs_to_restore</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;NODE&quot;</span><span class="p">,</span> <span class="s2">&quot;LINK&quot;</span><span class="p">,</span> <span class="s2">&quot;TURN&quot;</span><span class="p">,</span> <span class="s2">&quot;TRANSIT_LINE&quot;</span><span class="p">,</span> <span class="s2">&quot;TRANSIT_SEGMENT&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">details</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">extra_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">network_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="ow">or</span> <span class="n">field</span><span class="p">:</span>
            <span class="n">attrs_to_restore</span><span class="p">[</span><span class="n">domain</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">create_extra_attribute</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">attr</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">desc</span>
            <span class="n">attrs_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">atype</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">create_nertwork_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">atype</span><span class="p">)</span>
            <span class="n">field</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">desc</span>
            <span class="n">fields_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
    <span class="n">backup</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">attrs_to_restore</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">backup</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">names</span><span class="p">))</span>
            <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attrs_to_delete</span><span class="p">:</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">delete_extra_attribute</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields_to_delete</span><span class="p">:</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">delete_network_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">backup</span><span class="p">:</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">set_attribute_values</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.manager.EmmeManager.tool" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span></code>


<a href="#tm2py.emme.manager.EmmeManager.tool" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Return the Modeller tool at namespace.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>Corresponding Tool object, see Emme Help for full details.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/manager.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the Modeller tool at namespace.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Corresponding Tool object, see Emme Help for full details.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modeller</span><span class="p">()</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="tm2py.emme.matrix" class="doc doc-heading">
        <code>matrix</code>



<a href="#tm2py.emme.matrix" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Module for Emme-related matrix management.</p>
<p>Contains the MatrixCache class for write through matrix data management of Emme
matrices (in Emmebank) to avoid repeated read-from-disk of skim matrices
during post-assignment processing and export to OMX.</p>
<p>Contains the OMXManager which is a thin wrapper on the openmatrix (OMX)
library for transfer between Emme (emmebank) &lt;-&gt; OMX files. Integrates with
the MatrixCache to support easy write from Emmebank without re-reading data
from disk.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="tm2py.emme.matrix.MatrixCache" class="doc doc-heading">
        <code>
MatrixCache        </code>



<a href="#tm2py.emme.matrix.MatrixCache" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Write through cache of Emme matrix data via Numpy arrays.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MatrixCache</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Write through cache of Emme matrix data via Numpy arrays.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Contructor for MatrixCache class.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario (EmmeScenario): EmmeScenario reference scenario for the active Emmebank</span>
<span class="sd">                and matrix zone system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="n">scenario</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">emmebank</span>
        <span class="c1"># mapping from matrix object to last read/write timestamp for cache invalidation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># cache of Emme matrix data, key: matrix object, value: numpy array of data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EmmeMatrix</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get Emme matrix data as numpy array.</span>

<span class="sd">        Args:</span>
<span class="sd">            matrix: Emme matrix object or unique name / ID for Emme matrix in Emmebank</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Numpy array of values for this matrix / matrix ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">timestamp</span>
        <span class="n">prev_timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prev_timestamp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="n">prev_timestamp</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">timestamp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get_numpy_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EmmeMatrix</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set numpy array to Emme matrix (write through cache).</span>

<span class="sd">        Args:</span>
<span class="sd">            matrix: Emme matrix object or unique name / ID for Emme matrix in Emmebank</span>
<span class="sd">            data: Numpy array, must match the scenario zone system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">set_numpy_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the cache.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.MatrixCache.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme.matrix.MatrixCache.__init__" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Contructor for MatrixCache class.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>scenario</code></td>
        <td><code>EmmeScenario</code></td>
        <td><p>EmmeScenario reference scenario for the active Emmebank
and matrix zone system</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Contructor for MatrixCache class.</span>

<span class="sd">    Args:</span>
<span class="sd">        scenario (EmmeScenario): EmmeScenario reference scenario for the active Emmebank</span>
<span class="sd">            and matrix zone system</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="n">scenario</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span> <span class="o">=</span> <span class="n">scenario</span><span class="o">.</span><span class="n">emmebank</span>
    <span class="c1"># mapping from matrix object to last read/write timestamp for cache invalidation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># cache of Emme matrix data, key: matrix object, value: numpy array of data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.MatrixCache.clear" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.MatrixCache.clear" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Clear the cache.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clear the cache.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.MatrixCache.get_data" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.MatrixCache.get_data" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Get Emme matrix data as numpy array.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>matrix</code></td>
        <td><code>Union[str, &lt;MagicMock name=&#39;mock.Matrix&#39; id=&#39;140138509084320&#39;&gt;]</code></td>
        <td><p>Emme matrix object or unique name / ID for Emme matrix in Emmebank</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;built-in function array&gt;</code></td>
      <td><p>The Numpy array of values for this matrix / matrix ID.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EmmeMatrix</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get Emme matrix data as numpy array.</span>

<span class="sd">    Args:</span>
<span class="sd">        matrix: Emme matrix object or unique name / ID for Emme matrix in Emmebank</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Numpy array of values for this matrix / matrix ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">timestamp</span>
    <span class="n">prev_timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prev_timestamp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="n">prev_timestamp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">timestamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get_numpy_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.MatrixCache.set_data" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.MatrixCache.set_data" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Set numpy array to Emme matrix (write through cache).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>matrix</code></td>
        <td><code>Union[str, &lt;MagicMock name=&#39;mock.Matrix&#39; id=&#39;140138509084320&#39;&gt;]</code></td>
        <td><p>Emme matrix object or unique name / ID for Emme matrix in Emmebank</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td><code>&lt;built-in function array&gt;</code></td>
        <td><p>Numpy array, must match the scenario zone system</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EmmeMatrix</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set numpy array to Emme matrix (write through cache).</span>

<span class="sd">    Args:</span>
<span class="sd">        matrix: Emme matrix object or unique name / ID for Emme matrix in Emmebank</span>
<span class="sd">        data: Numpy array, must match the scenario zone system</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="n">matrix</span><span class="o">.</span><span class="n">set_numpy_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_timestamps</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">timestamp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">matrix</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="tm2py.emme.matrix.OMXManager" class="doc doc-heading">
        <code>
OMXManager        </code>



<a href="#tm2py.emme.matrix.OMXManager" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Wrapper for the OMX interface to write from Emme matrices and numpy arrays.</p>
<p>Write from Emmebank or Matrix Cache to OMX file, or read from OMX to Numpy.
Supports &ldquo;with&rdquo; statement.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">OMXManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Wrapper for the OMX interface to write from Emme matrices and numpy arrays.</span>

<span class="sd">    Write from Emmebank or Matrix Cache to OMX file, or read from OMX to Numpy.</span>
<span class="sd">    Supports &quot;with&quot; statement.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
        <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">omx_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
        <span class="n">matrix_cache</span><span class="p">:</span> <span class="n">MatrixCache</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_max_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># pylint: disable=R0913</span>
        <span class="sd">&quot;&quot;&quot;The OMXManager constructor.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path (str): path of OMX file</span>
<span class="sd">            mode (str, optional): &quot;r&quot;, &quot;w&quot; or &quot;a&quot;. Defaults to &quot;r&quot;.</span>
<span class="sd">            scenario (EmmeScenario, optional): _description_. Defaults to None.</span>
<span class="sd">            omx_key (str, optional): &quot;ID_NAME&quot;, &quot;NAME&quot;, &quot;ID&quot;, format for generating</span>
<span class="sd">            OMX key from Emme matrix data. Defaults to &quot;NAME&quot;.</span>
<span class="sd">            matrix_cache (MatrixCache, optional): Matrix Cache to support write data</span>
<span class="sd">            from cache (instead of always reading from Emmmebank). Defaults to None.</span>
<span class="sd">            mask_max_value (float, optional): max value above which to write</span>
<span class="sd">            zero instead (&quot;big to zero&quot; behavior). Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="n">scenario</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_omx_key</span> <span class="o">=</span> <span class="n">omx_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mask_max_value</span> <span class="o">=</span> <span class="n">mask_max_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emme_matrix_cache</span> <span class="o">=</span> <span class="n">matrix_cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_generate_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">EmmeMatrix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_key</span> <span class="o">==</span> <span class="s2">&quot;ID_NAME&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_key</span> <span class="o">==</span> <span class="s2">&quot;NAME&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matrix</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_key</span> <span class="o">==</span> <span class="s2">&quot;ID&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matrix</span><span class="o">.</span><span class="n">id</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;invalid omx_key: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_omx_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the OMX file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span> <span class="o">=</span> <span class="n">_omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the OMX file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allows for context-based usage using &#39;with&#39; statement.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="o">.</span><span class="n">create_mapping</span><span class="p">(</span>
                    <span class="s2">&quot;zone_number&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">zone_numbers</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allows for context-based usage using &#39;with&#39; statement.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">EmmeMatrix</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]):</span>
        <span class="sd">&quot;&quot;&quot;Write the list of emme matrices to OMX file.</span>

<span class="sd">        Args:</span>
<span class="sd">            matrices: list of Emme matrix objects or names / IDs</span>
<span class="sd">                of matrices in Emmebank, or dictionary of</span>
<span class="sd">                name: Emme matrix object/ Emme matrix ID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrices</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="n">matrices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EmmeMatrix</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write Emme matrix (as name or ID or Emme matrix object).</span>

<span class="sd">        Args:</span>
<span class="sd">            matrix: Emme matrix object or name / ID of matrix in Emmebank</span>
<span class="sd">            name: optional name to use for OMX key, if not specified the</span>
<span class="sd">                omx_key format will be used to generate a name from the</span>
<span class="sd">                Emme matrix data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="si">}</span><span class="s2">: open in read-only mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_name</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_matrix_cache</span><span class="p">:</span>
            <span class="n">numpy_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get_numpy_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;DESTINATION&quot;</span><span class="p">:</span>
            <span class="n">n_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">)</span>
            <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_zones</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">matrix</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ORIGIN&quot;</span><span class="p">:</span>
            <span class="n">n_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">)</span>
            <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">,</span> <span class="p">(</span><span class="n">n_zones</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">matrix</span><span class="o">.</span><span class="n">description</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_clipped_array</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">numpy_array</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">a_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">a_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attrs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>  <span class="c1"># pylint: disable=R0913</span>
        <span class="sd">&quot;&quot;&quot;Write array with min and max values capped.</span>

<span class="sd">        Args:</span>
<span class="sd">            numpy_array: Numpy array</span>
<span class="sd">            name: name to use for the OMX key</span>
<span class="sd">            a_min: minimum value to clip array data</span>
<span class="sd">            a_max: optional maximum value to clip array data</span>
<span class="sd">            attrs: additional attribute key value pairs to write to OMX file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">a_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a_min</span><span class="p">,</span> <span class="n">a_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a_min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_array</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">numpy_array</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attrs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write array with name and optional attrs to OMX file.</span>

<span class="sd">        Args:</span>
<span class="sd">            numpy_array:: Numpy array</span>
<span class="sd">            name: name to use for the OMX key</span>
<span class="sd">            attrs: additional attribute key value pairs to write to OMX file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="si">}</span><span class="s2">: open in read-only mode&quot;</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">chunkshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chunkshape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_max_value</span><span class="p">:</span>
            <span class="n">numpy_array</span><span class="p">[</span><span class="n">numpy_array</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_max_value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">numpy_array</span><span class="p">,</span> <span class="n">chunkshape</span><span class="o">=</span><span class="n">chunkshape</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read OMX data as numpy array (standard interface).</span>

<span class="sd">        Caches matrix data (arrays) already read from disk.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: name of OMX matrix</span>

<span class="sd">        Returns:</span>
<span class="sd">            Numpy array from OMX file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">read_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read data directly from PyTables interface.</span>

<span class="sd">        Support for hdf5 formats that don&#39;t have full OMX compatibility.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: hdf5 reference path to matrix data</span>

<span class="sd">        Returns:</span>
<span class="sd">            Numpy array from OMX file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.__enter__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme.matrix.OMXManager.__enter__" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Allows for context-based usage using &lsquo;with&rsquo; statement.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allows for context-based usage using &#39;with&#39; statement.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="o">.</span><span class="n">create_mapping</span><span class="p">(</span>
                <span class="s2">&quot;zone_number&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">zone_numbers</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.__exit__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme.matrix.OMXManager.__exit__" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Allows for context-based usage using &lsquo;with&rsquo; statement.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Allows for context-based usage using &#39;with&#39; statement.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">scenario</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">omx_key</span><span class="o">=</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="n">matrix_cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask_max_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme.matrix.OMXManager.__init__" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>The OMXManager constructor.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file_path</code></td>
        <td><code>str</code></td>
        <td><p>path of OMX file</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>mode</code></td>
        <td><code>str</code></td>
        <td><p>&ldquo;r&rdquo;, &ldquo;w&rdquo; or &ldquo;a&rdquo;. Defaults to &ldquo;r&rdquo;.</p></td>
        <td><code>&#39;r&#39;</code></td>
      </tr>
      <tr>
        <td><code>scenario</code></td>
        <td><code>EmmeScenario</code></td>
        <td><p><em>description</em>. Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>omx_key</code></td>
        <td><code>str</code></td>
        <td><p>&ldquo;ID_NAME&rdquo;, &ldquo;NAME&rdquo;, &ldquo;ID&rdquo;, format for generating</p></td>
        <td><code>&#39;NAME&#39;</code></td>
      </tr>
      <tr>
        <td><code>matrix_cache</code></td>
        <td><code>MatrixCache</code></td>
        <td><p>Matrix Cache to support write data</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>mask_max_value</code></td>
        <td><code>float</code></td>
        <td><p>max value above which to write</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span>
    <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">omx_key</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;NAME&quot;</span><span class="p">,</span>
    <span class="n">matrix_cache</span><span class="p">:</span> <span class="n">MatrixCache</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mask_max_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pylint: disable=R0913</span>
    <span class="sd">&quot;&quot;&quot;The OMXManager constructor.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): path of OMX file</span>
<span class="sd">        mode (str, optional): &quot;r&quot;, &quot;w&quot; or &quot;a&quot;. Defaults to &quot;r&quot;.</span>
<span class="sd">        scenario (EmmeScenario, optional): _description_. Defaults to None.</span>
<span class="sd">        omx_key (str, optional): &quot;ID_NAME&quot;, &quot;NAME&quot;, &quot;ID&quot;, format for generating</span>
<span class="sd">        OMX key from Emme matrix data. Defaults to &quot;NAME&quot;.</span>
<span class="sd">        matrix_cache (MatrixCache, optional): Matrix Cache to support write data</span>
<span class="sd">        from cache (instead of always reading from Emmmebank). Defaults to None.</span>
<span class="sd">        mask_max_value (float, optional): max value above which to write</span>
<span class="sd">        zero instead (&quot;big to zero&quot; behavior). Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="n">scenario</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_omx_key</span> <span class="o">=</span> <span class="n">omx_key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_mask_max_value</span> <span class="o">=</span> <span class="n">mask_max_value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_emme_matrix_cache</span> <span class="o">=</span> <span class="n">matrix_cache</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.close" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.OMXManager.close" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Close the OMX file.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Close the OMX file.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.open" class="doc doc-heading">
<code class="codehilite language-python"><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.OMXManager.open" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Open the OMX file.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open the OMX file.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span> <span class="o">=</span> <span class="n">_omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.read" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.OMXManager.read" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Read OMX data as numpy array (standard interface).</p>
<p>Caches matrix data (arrays) already read from disk.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>name of OMX matrix</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;built-in function array&gt;</code></td>
      <td><p>Numpy array from OMX file</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Read OMX data as numpy array (standard interface).</span>

<span class="sd">    Caches matrix data (arrays) already read from disk.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: name of OMX matrix</span>

<span class="sd">    Returns:</span>
<span class="sd">        Numpy array from OMX file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_read_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.read_hdf5" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">read_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.OMXManager.read_hdf5" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Read data directly from PyTables interface.</p>
<p>Support for hdf5 formats that don&rsquo;t have full OMX compatibility.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>str</code></td>
        <td><p>hdf5 reference path to matrix data</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;built-in function array&gt;</code></td>
      <td><p>Numpy array from OMX file</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">read_hdf5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Read data directly from PyTables interface.</span>

<span class="sd">    Support for hdf5 formats that don&#39;t have full OMX compatibility.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: hdf5 reference path to matrix data</span>

<span class="sd">    Returns:</span>
<span class="sd">        Numpy array from OMX file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.write_array" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">write_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numpy_array</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.OMXManager.write_array" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Write array with name and optional attrs to OMX file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>numpy_array</code></td>
        <td><code>&lt;built-in function array&gt;</code></td>
        <td><p>: Numpy array</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>name to use for the OMX key</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>attrs</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>additional attribute key value pairs to write to OMX file</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">write_array</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">numpy_array</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">attrs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write array with name and optional attrs to OMX file.</span>

<span class="sd">    Args:</span>
<span class="sd">        numpy_array:: Numpy array</span>
<span class="sd">        name: name to use for the OMX key</span>
<span class="sd">        attrs: additional attribute key value pairs to write to OMX file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="si">}</span><span class="s2">: open in read-only mode&quot;</span><span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">chunkshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chunkshape</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_max_value</span><span class="p">:</span>
        <span class="n">numpy_array</span><span class="p">[</span><span class="n">numpy_array</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mask_max_value</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_omx_file</span><span class="o">.</span><span class="n">create_matrix</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">numpy_array</span><span class="p">,</span> <span class="n">chunkshape</span><span class="o">=</span><span class="n">chunkshape</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.write_clipped_array" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">write_clipped_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numpy_array</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">a_min</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.OMXManager.write_clipped_array" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Write array with min and max values capped.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>numpy_array</code></td>
        <td><code>&lt;built-in function array&gt;</code></td>
        <td><p>Numpy array</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>name to use for the OMX key</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>a_min</code></td>
        <td><code>float</code></td>
        <td><p>minimum value to clip array data</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>a_max</code></td>
        <td><code>float</code></td>
        <td><p>optional maximum value to clip array data</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>attrs</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>additional attribute key value pairs to write to OMX file</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">write_clipped_array</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">numpy_array</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">a_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">a_max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">attrs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>  <span class="c1"># pylint: disable=R0913</span>
    <span class="sd">&quot;&quot;&quot;Write array with min and max values capped.</span>

<span class="sd">    Args:</span>
<span class="sd">        numpy_array: Numpy array</span>
<span class="sd">        name: name to use for the OMX key</span>
<span class="sd">        a_min: minimum value to clip array data</span>
<span class="sd">        a_max: optional maximum value to clip array data</span>
<span class="sd">        attrs: additional attribute key value pairs to write to OMX file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">a_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a_min</span><span class="p">,</span> <span class="n">a_max</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a_min</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.write_matrices" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">write_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrices</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.OMXManager.write_matrices" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Write the list of emme matrices to OMX file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>matrices</code></td>
        <td><code>List[Union[&lt;MagicMock name=&#39;mock.Matrix&#39; id=&#39;140138509084320&#39;&gt;, str]]</code></td>
        <td><p>list of Emme matrix objects or names / IDs
of matrices in Emmebank, or dictionary of
name: Emme matrix object/ Emme matrix ID</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">write_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">EmmeMatrix</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]):</span>
    <span class="sd">&quot;&quot;&quot;Write the list of emme matrices to OMX file.</span>

<span class="sd">    Args:</span>
<span class="sd">        matrices: list of Emme matrix objects or names / IDs</span>
<span class="sd">            of matrices in Emmebank, or dictionary of</span>
<span class="sd">            name: Emme matrix object/ Emme matrix ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrices</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="n">matrices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">matrix</span> <span class="ow">in</span> <span class="n">matrices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.OMXManager.write_matrix" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">write_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.OMXManager.write_matrix" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Write Emme matrix (as name or ID or Emme matrix object).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>matrix</code></td>
        <td><code>Union[str, &lt;MagicMock name=&#39;mock.Matrix&#39; id=&#39;140138509084320&#39;&gt;]</code></td>
        <td><p>Emme matrix object or name / ID of matrix in Emmebank</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td></td>
        <td><p>optional name to use for OMX key, if not specified the
omx_key format will be used to generate a name from the
Emme matrix data</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">write_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">EmmeMatrix</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write Emme matrix (as name or ID or Emme matrix object).</span>

<span class="sd">    Args:</span>
<span class="sd">        matrix: Emme matrix object or name / ID of matrix in Emmebank</span>
<span class="sd">        name: optional name to use for OMX key, if not specified the</span>
<span class="sd">            omx_key format will be used to generate a name from the</span>
<span class="sd">            Emme matrix data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="si">}</span><span class="s2">: open in read-only mode&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">emmebank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_name</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_matrix_cache</span><span class="p">:</span>
        <span class="n">numpy_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emme_matrix_cache</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">get_numpy_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;DESTINATION&quot;</span><span class="p">:</span>
        <span class="n">n_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">)</span>
        <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_zones</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">matrix</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ORIGIN&quot;</span><span class="p">:</span>
        <span class="n">n_zones</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">)</span>
        <span class="n">numpy_array</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">,</span> <span class="p">(</span><span class="n">n_zones</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">matrix</span><span class="o">.</span><span class="n">description</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">numpy_array</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="tm2py.emme.matrix.TollChoiceCalculator" class="doc doc-heading">
        <code>
TollChoiceCalculator        </code>



<a href="#tm2py.emme.matrix.TollChoiceCalculator" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Implements toll choice calculations.</p>
<p>Centralized implementation of Toll Choice calculations common to
Commercial and Internal-external sub models. Loads input skims
from OMXManager</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition operating_cost_per_mile">
<p class="admonition-title">operating cost value in cents per mile</p>
<p>for converting distance to cost</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TollChoiceCalculator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Implements toll choice calculations.</span>

<span class="sd">    Centralized implementation of Toll Choice calculations common to</span>
<span class="sd">    Commercial and Internal-external sub models. Loads input skims</span>
<span class="sd">    from OMXManager</span>

<span class="sd">    Properties:</span>
<span class="sd">        value_of_time: value of time to use in the utility expression</span>
<span class="sd">        coeff_time: coefficient of time value used in the utility expression</span>
<span class="sd">        operating_cost_per_mile: operating cost value in cents per mile</span>
<span class="sd">            for converting distance to cost</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">coeff_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for TollChoiceCalculator.</span>

<span class="sd">        Args:</span>
<span class="sd">            value_of_time (float): value of time to use in the utility expression</span>
<span class="sd">            coeff_time (float): coefficient of time value used in the utility expression</span>
<span class="sd">            operating_cost_per_mile (float): operating cost value in cents per mile</span>
<span class="sd">                for converting distance to cost</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_of_time</span> <span class="o">=</span> <span class="n">value_of_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coeff_time</span> <span class="o">=</span> <span class="n">coeff_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operating_cost_per_mile</span> <span class="o">=</span> <span class="n">operating_cost_per_mile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">set_omx_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omx_manager</span><span class="p">:</span> <span class="n">OMXManager</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the OMX manager for referencing the skim matrices.</span>

<span class="sd">        Args:</span>
<span class="sd">            omx_manager: OMXManager which accesses the skim file for reading</span>
<span class="sd">                the skim matrices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span> <span class="o">=</span> <span class="n">omx_manager</span>

    <span class="k">def</span> <span class="nf">calc_exp_util</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">dist_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">toll_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">toll_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Calculate the exp(utils) for the time, distance and costs skims.</span>

<span class="sd">        Loads the referenced skim matrices and calculates the result as:</span>
<span class="sd">        exp(coeff_time * time + coeff_cost * (op_cost * dist + cost)))</span>

<span class="sd">        coeff_cost = coeff_time / vot * 0.6</span>

<span class="sd">        Args:</span>
<span class="sd">            time_name: Name of the time skim matrix in the OMX file</span>
<span class="sd">            dist_name: Name of the distance skim matrix in the OMX file</span>
<span class="sd">            toll_names: List of names of the the toll skim matrix in the OMX file</span>
<span class="sd">            toll_factor: Optional factor to apply to the tolls</span>

<span class="sd">        Returns:</span>
<span class="sd">            A numpy array with the calculated exp(util) result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_of_time</span>
        <span class="n">k_ivtt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff_time</span>
        <span class="n">op_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operating_cost_per_mile</span>
        <span class="n">k_cost</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_ivtt</span> <span class="o">/</span> <span class="n">vot</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">time_name</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dist_name</span><span class="p">)</span>
        <span class="n">toll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">toll_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">toll</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toll_factor</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">toll</span> <span class="o">=</span> <span class="n">toll</span> <span class="o">*</span> <span class="n">toll_factor</span>
        <span class="n">e_util</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">k_ivtt</span> <span class="o">*</span> <span class="n">time</span> <span class="o">+</span> <span class="n">k_cost</span> <span class="o">*</span> <span class="p">(</span><span class="n">op_cost</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="n">toll</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">e_util</span>

    <span class="k">def</span> <span class="nf">mask_non_available</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">toll_cost_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">nontoll_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prob_nontoll</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mask the nontoll probability matrix.</span>

<span class="sd">        Set to 1.0 if no toll path toll cost, or to 0.0 if no nontoll time.</span>

<span class="sd">        Args:</span>
<span class="sd">            toll_cost_name: Name of toll available cost (toll) skim matrix</span>
<span class="sd">            nontoll_time: Name of the time for non-toll skim matrix in the OMX file</span>
<span class="sd">            prob_nontoll: numpy array of calculated probability for non-toll</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">toll_tollcost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">toll_cost_name</span><span class="p">)</span>
        <span class="n">nontoll_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nontoll_time</span><span class="p">)</span>
        <span class="n">prob_nontoll</span><span class="p">[(</span><span class="n">toll_tollcost</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">toll_tollcost</span> <span class="o">&gt;</span> <span class="mi">999999</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">prob_nontoll</span><span class="p">[(</span><span class="n">nontoll_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">nontoll_time</span> <span class="o">&gt;</span> <span class="mi">999999</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.TollChoiceCalculator.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_of_time</span><span class="p">,</span> <span class="n">coeff_time</span><span class="p">,</span> <span class="n">operating_cost_per_mile</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme.matrix.TollChoiceCalculator.__init__" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Constructor for TollChoiceCalculator.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value_of_time</code></td>
        <td><code>float</code></td>
        <td><p>value of time to use in the utility expression</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>coeff_time</code></td>
        <td><code>float</code></td>
        <td><p>coefficient of time value used in the utility expression</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>operating_cost_per_mile</code></td>
        <td><code>float</code></td>
        <td><p>operating cost value in cents per mile
for converting distance to cost</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">value_of_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">coeff_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">operating_cost_per_mile</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for TollChoiceCalculator.</span>

<span class="sd">    Args:</span>
<span class="sd">        value_of_time (float): value of time to use in the utility expression</span>
<span class="sd">        coeff_time (float): coefficient of time value used in the utility expression</span>
<span class="sd">        operating_cost_per_mile (float): operating cost value in cents per mile</span>
<span class="sd">            for converting distance to cost</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value_of_time</span> <span class="o">=</span> <span class="n">value_of_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coeff_time</span> <span class="o">=</span> <span class="n">coeff_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operating_cost_per_mile</span> <span class="o">=</span> <span class="n">operating_cost_per_mile</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.TollChoiceCalculator.calc_exp_util" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">calc_exp_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_name</span><span class="p">,</span> <span class="n">dist_name</span><span class="p">,</span> <span class="n">toll_names</span><span class="p">,</span> <span class="n">toll_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.TollChoiceCalculator.calc_exp_util" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Calculate the exp(utils) for the time, distance and costs skims.</p>
<p>Loads the referenced skim matrices and calculates the result as:
exp(coeff_time * time + coeff_cost * (op_cost * dist + cost)))</p>
<p>coeff_cost = coeff_time / vot * 0.6</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>time_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the time skim matrix in the OMX file</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dist_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the distance skim matrix in the OMX file</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>toll_names</code></td>
        <td><code>List[str]</code></td>
        <td><p>List of names of the the toll skim matrix in the OMX file</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>toll_factor</code></td>
        <td><code>float</code></td>
        <td><p>Optional factor to apply to the tolls</p></td>
        <td><code>1.0</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>&lt;built-in function array&gt;</code></td>
      <td><p>A numpy array with the calculated exp(util) result.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">calc_exp_util</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">time_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dist_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">toll_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">toll_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NumpyArray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Calculate the exp(utils) for the time, distance and costs skims.</span>

<span class="sd">    Loads the referenced skim matrices and calculates the result as:</span>
<span class="sd">    exp(coeff_time * time + coeff_cost * (op_cost * dist + cost)))</span>

<span class="sd">    coeff_cost = coeff_time / vot * 0.6</span>

<span class="sd">    Args:</span>
<span class="sd">        time_name: Name of the time skim matrix in the OMX file</span>
<span class="sd">        dist_name: Name of the distance skim matrix in the OMX file</span>
<span class="sd">        toll_names: List of names of the the toll skim matrix in the OMX file</span>
<span class="sd">        toll_factor: Optional factor to apply to the tolls</span>

<span class="sd">    Returns:</span>
<span class="sd">        A numpy array with the calculated exp(util) result.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_of_time</span>
    <span class="n">k_ivtt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeff_time</span>
    <span class="n">op_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operating_cost_per_mile</span>
    <span class="n">k_cost</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_ivtt</span> <span class="o">/</span> <span class="n">vot</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.6</span>
    <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">time_name</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dist_name</span><span class="p">)</span>
    <span class="n">toll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">toll_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">toll_names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">toll</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">toll_factor</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">toll</span> <span class="o">=</span> <span class="n">toll</span> <span class="o">*</span> <span class="n">toll_factor</span>
    <span class="n">e_util</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">k_ivtt</span> <span class="o">*</span> <span class="n">time</span> <span class="o">+</span> <span class="n">k_cost</span> <span class="o">*</span> <span class="p">(</span><span class="n">op_cost</span> <span class="o">*</span> <span class="n">dist</span> <span class="o">+</span> <span class="n">toll</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">e_util</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.TollChoiceCalculator.mask_non_available" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">mask_non_available</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toll_cost_name</span><span class="p">,</span> <span class="n">nontoll_time</span><span class="p">,</span> <span class="n">prob_nontoll</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.TollChoiceCalculator.mask_non_available" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Mask the nontoll probability matrix.</p>
<p>Set to 1.0 if no toll path toll cost, or to 0.0 if no nontoll time.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>toll_cost_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of toll available cost (toll) skim matrix</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>nontoll_time</code></td>
        <td><code>str</code></td>
        <td><p>Name of the time for non-toll skim matrix in the OMX file</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>prob_nontoll</code></td>
        <td><code>&lt;built-in function array&gt;</code></td>
        <td><p>numpy array of calculated probability for non-toll</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">mask_non_available</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">toll_cost_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">nontoll_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">prob_nontoll</span><span class="p">:</span> <span class="n">NumpyArray</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Mask the nontoll probability matrix.</span>

<span class="sd">    Set to 1.0 if no toll path toll cost, or to 0.0 if no nontoll time.</span>

<span class="sd">    Args:</span>
<span class="sd">        toll_cost_name: Name of toll available cost (toll) skim matrix</span>
<span class="sd">        nontoll_time: Name of the time for non-toll skim matrix in the OMX file</span>
<span class="sd">        prob_nontoll: numpy array of calculated probability for non-toll</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">toll_tollcost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">toll_cost_name</span><span class="p">)</span>
    <span class="n">nontoll_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nontoll_time</span><span class="p">)</span>
    <span class="n">prob_nontoll</span><span class="p">[(</span><span class="n">toll_tollcost</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">toll_tollcost</span> <span class="o">&gt;</span> <span class="mi">999999</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">prob_nontoll</span><span class="p">[(</span><span class="n">nontoll_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">nontoll_time</span> <span class="o">&gt;</span> <span class="mi">999999</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.matrix.TollChoiceCalculator.set_omx_manager" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">set_omx_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omx_manager</span><span class="p">)</span></code>


<a href="#tm2py.emme.matrix.TollChoiceCalculator.set_omx_manager" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Set the OMX manager for referencing the skim matrices.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>omx_manager</code></td>
        <td><code>OMXManager</code></td>
        <td><p>OMXManager which accesses the skim file for reading
the skim matrices</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/matrix.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">set_omx_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">omx_manager</span><span class="p">:</span> <span class="n">OMXManager</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the OMX manager for referencing the skim matrices.</span>

<span class="sd">    Args:</span>
<span class="sd">        omx_manager: OMXManager which accesses the skim file for reading</span>
<span class="sd">            the skim matrices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_omx_manager</span> <span class="o">=</span> <span class="n">omx_manager</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="tm2py.emme.network" class="doc doc-heading">
        <code>network</code>



<a href="#tm2py.emme.network" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Module for Emme network calculations.</p>
<p>Contains NetworkCalculator class to generate Emme format specifications for
the Network calculator.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h5 id="tm2py.emme.network.NetworkCalculator" class="doc doc-heading">
        <code>
NetworkCalculator        </code>



<a href="#tm2py.emme.network.NetworkCalculator" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Simple wrapper interface to the Emme Network calculator.</p>
<p>Used to generate the standard network calculator specification (dictionary)
from argument inputs. Useful when NOT (commonly) using selection or
aggregation options, and mostly running link expression calculations</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>scenario</code></td>
        <td><code>&lt;MagicMock name=&#39;mock.Scenario&#39; id=&#39;140138509096320&#39;&gt;</code></td>
        <td><p>Emme scenario object</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/network.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">NetworkCalculator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Simple wrapper interface to the Emme Network calculator.</span>

<span class="sd">    Used to generate the standard network calculator specification (dictionary)</span>
<span class="sd">    from argument inputs. Useful when NOT (commonly) using selection or</span>
<span class="sd">    aggregation options, and mostly running link expression calculations</span>

<span class="sd">    Args:</span>
<span class="sd">        scenario: Emme scenario object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for NetworkCalculator class.</span>

<span class="sd">        Args:</span>
<span class="sd">            scenario (EmmeScenario): Reference EmmeScenario object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="n">scenario</span>
        <span class="n">emme_manager</span> <span class="o">=</span> <span class="n">_manager</span><span class="o">.</span><span class="n">EmmeManager</span><span class="p">()</span>
        <span class="n">modeller</span> <span class="o">=</span> <span class="n">emme_manager</span><span class="o">.</span><span class="n">modeller</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_network_calc</span> <span class="o">=</span> <span class="n">modeller</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
            <span class="s2">&quot;inro.emme.network_calculation.network_calculator&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_specs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">selections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Run a network calculation in the scenario, see the Emme help for more.</span>

<span class="sd">        Args:</span>
<span class="sd">            result: Name of network attribute</span>
<span class="sd">            expression: Calculation expression</span>
<span class="sd">            selections: Selection expression nest. Defaults to {&quot;link&quot;: &quot;all&quot;} if</span>
<span class="sd">                        not specified, and is used as a link selection expression</span>
<span class="sd">                        if specified as a string.</span>
<span class="sd">            aggregation: Aggregation operators if aggregating between network domains.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary report with min, max, average and sum of the calculation</span>
<span class="sd">            expression. See Emme help &#39;Network calculator&#39; for more.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_spec</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">selections</span><span class="p">,</span> <span class="n">aggregation</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_calc</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_calc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">selections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">aggregation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add calculation to list of network calculations to run.</span>

<span class="sd">        Args:</span>
<span class="sd">            result: Name of network attribute</span>
<span class="sd">            expression: Calculation expression</span>
<span class="sd">            selections: Selection expression nest. Defaults to {&quot;link&quot;: &quot;all&quot;} if</span>
<span class="sd">                        not specified, and is used as a link selection expression</span>
<span class="sd">                        if specified as a string.</span>
<span class="sd">            aggregation: Aggregation operators if aggregating between network domains.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_format_spec</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">selections</span><span class="p">,</span> <span class="n">aggregation</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Run accumulated network calculations all at once.</span>

<span class="sd">        Returns</span>
<span class="sd">            A list of dictionary reports with min, max, average and sum of the</span>
<span class="sd">            calculation expression. See Emme help &#39;Network calculator&#39; for more.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_calc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_specs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_specs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">reports</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_format_spec</span><span class="p">(</span>
        <span class="n">result</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">selections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
        <span class="n">aggregation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmmeNetworkCalcSpecification</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="n">expression</span><span class="p">,</span>
            <span class="s2">&quot;aggregation&quot;</span><span class="p">:</span> <span class="n">aggregation</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;NETWORK_CALCULATION&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">selections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">selections</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">selections</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="n">selections</span><span class="p">}</span>
            <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;selections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selections</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;selections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;link&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">spec</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.network.NetworkCalculator.__call__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">selections</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme.network.NetworkCalculator.__call__" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Run a network calculation in the scenario, see the Emme help for more.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>result</code></td>
        <td><code>str</code></td>
        <td><p>Name of network attribute</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>expression</code></td>
        <td><code>str</code></td>
        <td><p>Calculation expression</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>selections</code></td>
        <td><code>Union[str, Dict[str, str]]</code></td>
        <td><p>Selection expression nest. Defaults to {&ldquo;link&rdquo;: &ldquo;all&rdquo;} if
        not specified, and is used as a link selection expression
        if specified as a string.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>aggregation</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Aggregation operators if aggregating between network domains.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, float]</code></td>
      <td><p>A dictionary report with min, max, average and sum of the calculation
expression. See Emme help &lsquo;Network calculator&rsquo; for more.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/network.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">selections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aggregation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Run a network calculation in the scenario, see the Emme help for more.</span>

<span class="sd">    Args:</span>
<span class="sd">        result: Name of network attribute</span>
<span class="sd">        expression: Calculation expression</span>
<span class="sd">        selections: Selection expression nest. Defaults to {&quot;link&quot;: &quot;all&quot;} if</span>
<span class="sd">                    not specified, and is used as a link selection expression</span>
<span class="sd">                    if specified as a string.</span>
<span class="sd">        aggregation: Aggregation operators if aggregating between network domains.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary report with min, max, average and sum of the calculation</span>
<span class="sd">        expression. See Emme help &#39;Network calculator&#39; for more.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_spec</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">selections</span><span class="p">,</span> <span class="n">aggregation</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_calc</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.network.NetworkCalculator.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.emme.network.NetworkCalculator.__init__" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Constructor for NetworkCalculator class.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>scenario</code></td>
        <td><code>EmmeScenario</code></td>
        <td><p>Reference EmmeScenario object</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/network.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scenario</span><span class="p">:</span> <span class="n">EmmeScenario</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for NetworkCalculator class.</span>

<span class="sd">    Args:</span>
<span class="sd">        scenario (EmmeScenario): Reference EmmeScenario object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span> <span class="o">=</span> <span class="n">scenario</span>
    <span class="n">emme_manager</span> <span class="o">=</span> <span class="n">_manager</span><span class="o">.</span><span class="n">EmmeManager</span><span class="p">()</span>
    <span class="n">modeller</span> <span class="o">=</span> <span class="n">emme_manager</span><span class="o">.</span><span class="n">modeller</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_network_calc</span> <span class="o">=</span> <span class="n">modeller</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span>
        <span class="s2">&quot;inro.emme.network_calculation.network_calculator&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_specs</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.network.NetworkCalculator.add_calc" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">add_calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">selections</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#tm2py.emme.network.NetworkCalculator.add_calc" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Add calculation to list of network calculations to run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>result</code></td>
        <td><code>str</code></td>
        <td><p>Name of network attribute</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>expression</code></td>
        <td><code>str</code></td>
        <td><p>Calculation expression</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>selections</code></td>
        <td><code>Union[str, Dict[str, str]]</code></td>
        <td><p>Selection expression nest. Defaults to {&ldquo;link&rdquo;: &ldquo;all&rdquo;} if
        not specified, and is used as a link selection expression
        if specified as a string.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>aggregation</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Aggregation operators if aggregating between network domains.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/emme/network.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">add_calc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">result</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">selections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aggregation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Add calculation to list of network calculations to run.</span>

<span class="sd">    Args:</span>
<span class="sd">        result: Name of network attribute</span>
<span class="sd">        expression: Calculation expression</span>
<span class="sd">        selections: Selection expression nest. Defaults to {&quot;link&quot;: &quot;all&quot;} if</span>
<span class="sd">                    not specified, and is used as a link selection expression</span>
<span class="sd">                    if specified as a string.</span>
<span class="sd">        aggregation: Aggregation operators if aggregating between network domains.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_format_spec</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">selections</span><span class="p">,</span> <span class="n">aggregation</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="tm2py.emme.network.NetworkCalculator.run" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.emme.network.NetworkCalculator.run" class="headerlink" title="Permanent link"> </a></h6>

    <div class="doc doc-contents ">

      <p>Run accumulated network calculations all at once.</p>
<p>Returns
    A list of dictionary reports with min, max, average and sum of the
    calculation expression. See Emme help &lsquo;Network calculator&rsquo; for more.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/emme/network.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;Run accumulated network calculations all at once.</span>

<span class="sd">    Returns</span>
<span class="sd">        A list of dictionary reports with min, max, average and sum of the</span>
<span class="sd">        calculation expression. See Emme help &#39;Network calculator&#39; for more.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_network_calc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_specs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scenario</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_specs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">reports</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="tm2py.config.EmmeConfig" class="doc doc-heading">
        <code>
tm2py.config.EmmeConfig            (<a class="autorefs autorefs-internal" title="tm2py.config.ConfigItem" href="#tm2py.config.ConfigItem">ConfigItem</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#tm2py.config.EmmeConfig" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Emme-specific parameters.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<div class="admonition all_day_scenario_id">
<p class="admonition-title">scenario ID to use for all day</p>
<p>(initial imported) scenario with all time period data</p>
</div>
<div class="admonition num_processors">
<p class="admonition-title">the number of processors to use in Emme procedures,</p>
<p>either as an integer, or value MAX, MAX-N. Typically recommend
using MAX-1 (on desktop systems) or MAX-2 (on servers with many
logical processors) to leave capacity for background / other tasks.</p>
</div>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/config.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">EmmeConfig</span><span class="p">(</span><span class="n">ConfigItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Emme-specific parameters.</span>

<span class="sd">    Properties:</span>
<span class="sd">        all_day_scenario_id: scenario ID to use for all day</span>
<span class="sd">            (initial imported) scenario with all time period data</span>
<span class="sd">        project_path: relative path to Emme desktop project (.emp)</span>
<span class="sd">        highway_database_path: relative path to highway Emmebank</span>
<span class="sd">        active_database_paths: list of relative paths to active mode Emmebanks</span>
<span class="sd">        transit_database_path: relative path to transit Emmebank</span>
<span class="sd">        num_processors: the number of processors to use in Emme procedures,</span>
<span class="sd">            either as an integer, or value MAX, MAX-N. Typically recommend</span>
<span class="sd">            using MAX-1 (on desktop systems) or MAX-2 (on servers with many</span>
<span class="sd">            logical processors) to leave capacity for background / other tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_day_scenario_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">project_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">highway_database_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">active_database_paths</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
    <span class="n">transit_database_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">num_processors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?i)^MAX$|^MAX[\s]*-[\s]*[\d]+$|^[\d]+$&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>

<h2 id="errata">Errata<a class="headerlink" href="#errata" title="Permanent link"> </a></h2>


  <div class="doc doc-object doc-module">



<h3 id="tm2py.logger" class="doc doc-heading">
        <code>tm2py.logger</code>



<a href="#tm2py.logger" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Logging module.</p>
<p>Note the general definition of logging levels as used in tm2py:</p>
<div class="admonition trace">
<p class="admonition-title">highly detailed level information which would rarely be of interest</p>
<p>except for detailed debugging by a developer</p>
</div>
<div class="admonition debug">
<p class="admonition-title">diagnostic information which would generally be useful to a developer</p>
<p>debugging the model code; this may also be useful to a model operator in
some cases.</p>
</div>
<div class="admonition detail">
<p class="admonition-title">more detail than would normally be of interest, but might be useful</p>
<p>to a model operator debugging a model run / data or understanding
model results</p>
</div>
<div class="admonition status">
<p class="admonition-title">top-level, model is running type messages. There should be</p>
<p>relatively few of these, generally one per component, or one per time
period if the procedure is long.</p>
</div>
<div class="admonition error">
<p class="admonition-title">problem causing operation to halt which is normal</p>
<p>(or not unexpected) in scope, e.g. file does not exist
Includes general Python exceptions.</p>
</div>
<p>FATAL: severe problem requiring operation to stop immediately.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogCache" class="doc doc-heading">
        <code>
LogCache            (<a class="autorefs autorefs-internal" title="tm2py.logger.LogFormatter" href="#tm2py.logger.LogFormatter">LogFormatter</a>)
        </code>



<a href="#tm2py.logger.LogCache" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Caches all messages for later recording in on error logfile.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<ul>
<li>file_path: the absolute file path to write to</li>
</ul>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LogCache</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Caches all messages for later recording in on error logfile.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogCache object.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_path (str): the absolute file path to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize log file (remove).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Format and store text for later recording.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">write_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write all cached messages.&quot;&quot;&quot;</span>
        <span class="n">_levels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">levels</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_levels</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">:</span><span class="s2">6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear message cache.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogCache.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.LogCache.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for LogCache object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file_path</code></td>
        <td><code>str</code></td>
        <td><p>the absolute file path to write to.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogCache object.</span>

<span class="sd">    Args:</span>
<span class="sd">        file_path (str): the absolute file path to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogCache.clear" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogCache.clear" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Clear message cache.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clear message cache.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogCache.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogCache.log" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Format and store text for later recording.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>int</code></td>
        <td><p>logging level</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>timestamp</code></td>
        <td><code>str</code></td>
        <td><p>formatted datetime as a string or None</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Format and store text for later recording.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogCache.open" class="doc doc-heading">
<code class="codehilite language-python"><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogCache.open" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Initialize log file (remove).</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initialize log file (remove).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogCache.write_cache" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">write_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogCache.write_cache" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Write all cached messages.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">write_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write all cached messages.&quot;&quot;&quot;</span>
    <span class="n">_levels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">levels</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msg_cache</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_levels</span><span class="p">[</span><span class="n">level</span><span class="p">]</span><span class="si">:</span><span class="s2">6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogDisplay" class="doc doc-heading">
        <code>
LogDisplay            (<a class="autorefs autorefs-internal" title="tm2py.logger.LogFormatter" href="#tm2py.logger.LogFormatter">LogFormatter</a>)
        </code>



<a href="#tm2py.logger.LogDisplay" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Format and print log text to console / Notebook.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<ul>
<li>level: the log level as an int</li>
</ul>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LogDisplay</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format and print log text to console / Notebook.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Format and display text on screen (print).</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogDisplay.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogDisplay.log" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Format and display text on screen (print).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>int</code></td>
        <td><p>logging level</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>timestamp</code></td>
        <td><code>str</code></td>
        <td><p>formatted datetime as a string or None</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Format and display text on screen (print).</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogFile" class="doc doc-heading">
        <code>
LogFile            (<a class="autorefs autorefs-internal" title="tm2py.logger.LogFormatter" href="#tm2py.logger.LogFormatter">LogFormatter</a>)
        </code>



<a href="#tm2py.logger.LogFile" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Format and write log text to file.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<ul>
<li>level: the log level as an int</li>
<li>file_path: the absolute file path to write to</li>
</ul>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LogFile</span><span class="p">(</span><span class="n">LogFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format and write log text to file.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogFile object.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (int): the log level as an int.</span>
<span class="sd">            file_path (str): the absolute file path to write to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the log file for writing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">        Note that log will not write to file until opened with a context.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close the open log file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFile.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.LogFile.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for LogFile object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>level</code></td>
        <td><code>int</code></td>
        <td><p>the log level as an int.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>file_path</code></td>
        <td><code>str</code></td>
        <td><p>the absolute file path to write to.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogFile object.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (int): the log level as an int.</span>
<span class="sd">        file_path (str): the absolute file path to write to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFile.close" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogFile.close" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Close the open log file.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Close the open log file.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFile.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogFile.log" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text to file and display depending upon log level and config.</p>
<p>Note that log will not write to file until opened with a context.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>int</code></td>
        <td><p>logging level</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>timestamp</code></td>
        <td><code>str</code></td>
        <td><p>formatted datetime as a string or None for timestamp</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">    Note that log will not write to file until opened with a context.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFile.open" class="doc doc-heading">
<code class="codehilite language-python"><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogFile.open" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Open the log file for writing.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Open the log file for writing.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogFileLevelOverride" class="doc doc-heading">
        <code>
LogFileLevelOverride            (<a class="autorefs autorefs-internal" title="tm2py.logger.LogFile" href="#tm2py.logger.LogFile">LogFile</a>)
        </code>



<a href="#tm2py.logger.LogFileLevelOverride" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Format and write log text to file.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<ul>
<li>level: the log level as an int</li>
<li>file_path: the absolute file path to write to</li>
<li>iter_component_level: TODO</li>
<li>controller: TODO</li>
</ul>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LogFileLevelOverride</span><span class="p">(</span><span class="n">LogFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format and write log text to file.</span>

<span class="sd">    Properties:</span>
<span class="sd">        - level: the log level as an int</span>
<span class="sd">        - file_path: the absolute file path to write to</span>
<span class="sd">        - iter_component_level: TODO</span>
<span class="sd">        - controller: TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogFileLevelOverride object.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (_type_): TODO</span>
<span class="sd">            file_path (_type_): TODO</span>
<span class="sd">            iter_component_level (_type_): TODO</span>
<span class="sd">            controller (_type_): TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">iter_component_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Current log level with iter_component_level config override.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">iter_component</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.logger.LogFileLevelOverride.level" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">level</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.logger.LogFileLevelOverride.level" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Current log level with iter_component_level config override.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFileLevelOverride.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.LogFileLevelOverride.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for LogFileLevelOverride object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>level</code></td>
        <td><code>_type_</code></td>
        <td><p>TODO</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>file_path</code></td>
        <td><code>_type_</code></td>
        <td><p>TODO</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>iter_component_level</code></td>
        <td><code>_type_</code></td>
        <td><p>TODO</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>controller</code></td>
        <td><code>_type_</code></td>
        <td><p>TODO</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">iter_component_level</span><span class="p">,</span> <span class="n">controller</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogFileLevelOverride object.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (_type_): TODO</span>
<span class="sd">        file_path (_type_): TODO</span>
<span class="sd">        iter_component_level (_type_): TODO</span>
<span class="sd">        controller (_type_): TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">iter_component_level</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogFormatter" class="doc doc-heading">
        <code>
LogFormatter        </code>



<a href="#tm2py.logger.LogFormatter" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Base class for recording text to log.</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<p>indent: current indentation level for the LogFormatter
level: log filter level (as an int)</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LogFormatter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for recording text to log.</span>

<span class="sd">    Properties:</span>
<span class="sd">        indent: current indentation level for the LogFormatter</span>
<span class="sd">        level: log filter level (as an int)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogFormatter.</span>

<span class="sd">        Args:</span>
<span class="sd">            level (int): log filter level (as an int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The current filter level for the LogFormatter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_level</span>

    <span class="k">def</span> <span class="nf">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Increase current indent if the log level is filtered in.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">decrease_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decrease current indent if the log level is filtered in.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format and log message text.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (int): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_format_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format text for logging.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to format</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts and</span>
<span class="sd">                timestamp width</span>
<span class="sd">            timestamp (str): formatted datetime as a string or None for timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="s2">&quot;                        &quot;</span> <span class="k">if</span> <span class="n">indent</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">indent</span><span class="p">:</span>
            <span class="n">num_indents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">num_indents</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}{</span><span class="n">indent</span><span class="si">}{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.logger.LogFormatter.level" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">level</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.logger.LogFormatter.level" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>The current filter level for the LogFormatter.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFormatter.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.LogFormatter.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for LogFormatter.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>level</code></td>
        <td><code>int</code></td>
        <td><p>log filter level (as an int)</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogFormatter.</span>

<span class="sd">    Args:</span>
<span class="sd">        level (int): log filter level (as an int)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_level</span> <span class="o">=</span> <span class="n">level</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFormatter.decrease_indent" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">decrease_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogFormatter.decrease_indent" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Decrease current indent if the log level is filtered in.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">decrease_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decrease current indent if the log level is filtered in.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFormatter.increase_indent" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogFormatter.increase_indent" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Increase current indent if the log level is filtered in.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">increase_indent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Increase current indent if the log level is filtered in.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogFormatter.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span></code>


<a href="#tm2py.logger.LogFormatter.log" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Format and log message text.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>int</code></td>
        <td><p>logging level</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>timestamp</code></td>
        <td><code>str</code></td>
        <td><p>formatted datetime as a string or None</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format and log message text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (int): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        timestamp (str): formatted datetime as a string or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.logger.LogStartEnd" class="doc doc-heading">
        <code>
LogStartEnd        </code>



<a href="#tm2py.logger.LogStartEnd" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Log the start and end time with optional message.</p>
<p>Used as a Component method decorator. If msg is not provided a default
message is generated with the object class and method name.</p>
<p>Example::
    @LogStartEnd(&ldquo;Highway assignment and skims&rdquo;, level=&rdquo;STATUS&rdquo;)
    def run(self):
        pass</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<p>text (str): message text to use in the start and end record.
level (str): logging level as a string.</p>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">LogStartEnd</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Log the start and end time with optional message.</span>

<span class="sd">    Used as a Component method decorator. If msg is not provided a default</span>
<span class="sd">    message is generated with the object class and method name.</span>

<span class="sd">    Example::</span>
<span class="sd">        @LogStartEnd(&quot;Highway assignment and skims&quot;, level=&quot;STATUS&quot;)</span>
<span class="sd">        def run(self):</span>
<span class="sd">            pass</span>

<span class="sd">    Properties:</span>
<span class="sd">        text (str): message text to use in the start and end record.</span>
<span class="sd">        level (str): logging level as a string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for LogStartEnd object.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str, optional): message text to use in the start and end record.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            level (str, optional): logging level as a string. Defaults to &quot;INFO&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ability to call logger.</span>

<span class="sd">        Args:</span>
<span class="sd">            func (_type_): _description_</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: _description_</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">with</span> <span class="n">obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogStartEnd.__call__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.LogStartEnd.__call__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Ability to call logger.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>func</code></td>
        <td><code>_type_</code></td>
        <td><p><em>description</em></p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>_type_</code></td>
      <td><p><em>description</em></p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ability to call logger.</span>

<span class="sd">    Args:</span>
<span class="sd">        func (_type_): _description_</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">with</span> <span class="n">obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_start_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.LogStartEnd.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.LogStartEnd.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for LogStartEnd object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>message text to use in the start and end record.
Defaults to None.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>str</code></td>
        <td><p>logging level as a string. Defaults to &ldquo;INFO&rdquo;.</p></td>
        <td><code>&#39;INFO&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for LogStartEnd object.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str, optional): message text to use in the start and end record.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        level (str, optional): logging level as a string. Defaults to &quot;INFO&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.logger.Logger" class="doc doc-heading">
        <code>
Logger        </code>



<a href="#tm2py.logger.Logger" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Logging of message text for display, text file, and Emme logbook, as well as notify to slack.</p>
<p>The log message levels can be one of:
TRACE, DEBUG, DETAIL, INFO, STATUS, WARN, ERROR, FATAL
Which will filter all messages of that severity and higher.
See module note on use of descriptive level names.</p>
<p>To be used as a context, e.g.::</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">with</span> <span class="nv">Logger</span><span class="ss">(</span><span class="nv">controller</span><span class="ss">)</span> <span class="nv">as</span> <span class="nv">logger</span>:
    <span class="nv">logger</span>.<span class="nv">log</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">a message</span><span class="s2">&quot;</span><span class="ss">)</span>
    <span class="nv">with</span> <span class="nv">logger</span>.<span class="nv">log_start_end</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">Running a set of steps</span><span class="s2">&quot;</span><span class="ss">)</span>:
        <span class="nv">logger</span>.<span class="nv">log_time</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">Message with timestamp</span><span class="s2">&quot;</span><span class="ss">)</span>
        <span class="nv">logger</span>.<span class="nv">log</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">A debug message</span><span class="s2">&quot;</span>, <span class="nv">level</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">DEBUG</span><span class="s2">&quot;</span><span class="ss">)</span>
        # <span class="nv">equivalently</span>, <span class="nv">use</span> <span class="nv">the</span> .<span class="nv">debug</span>:
        <span class="nv">logger</span>.<span class="nv">debug</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">Another debug message</span><span class="s2">&quot;</span><span class="ss">)</span>
        <span class="k">if</span> <span class="nv">logger</span>.<span class="nv">debug_enabled</span>:
            # <span class="nv">only</span> <span class="nv">generate</span> <span class="nv">this</span> <span class="nv">report</span> <span class="k">if</span> <span class="nv">logging</span> <span class="nv">DEBUG</span>
            <span class="nv">logger</span>.<span class="nv">log</span><span class="ss">(</span>
                <span class="s2">&quot;</span><span class="s">A debug report that takes time to produce</span><span class="s2">&quot;</span>,
                <span class="nv">level</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">DEBUG</span><span class="s2">&quot;</span><span class="ss">)</span>
        <span class="nv">logger</span>.<span class="nv">notify_slack</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">A slack message</span><span class="s2">&quot;</span><span class="ss">)</span>
</code></pre></div></td></tr></table></div>

<p>Note that the Logger should not be used until opened with a context.
Logger.log will not write to file.</p>
<p>Methods can also be decorated with LogStartEnd (see class for more).</p>
<p>Note that the Logger should only be initialized once per model run.
In places where the controller is not available, the last Logger
initialized can be obtained from the class method get_logger::</p>
<div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>logger = Logger.get_logger()
</code></pre></div></td></tr></table></div>

<p>Internal properties:
    _log_cache: the LogCache object
    !!! _log_formatters &ldquo;list of objects that format text and record, either&rdquo;
        to file, display (print to screen) or cache for log on error
    _use_emme_logbook: whether Emme logbook is enabled
    _slack_notifier: SlackNotifier object for sending messages to slack</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Logger</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Logging of message text for display, text file, and Emme logbook, as well as notify to slack.</span>

<span class="sd">    The log message levels can be one of:</span>
<span class="sd">    TRACE, DEBUG, DETAIL, INFO, STATUS, WARN, ERROR, FATAL</span>
<span class="sd">    Which will filter all messages of that severity and higher.</span>
<span class="sd">    See module note on use of descriptive level names.</span>

<span class="sd">    To be used as a context, e.g.::</span>

<span class="sd">        with Logger(controller) as logger:</span>
<span class="sd">            logger.log(&quot;a message&quot;)</span>
<span class="sd">            with logger.log_start_end(&quot;Running a set of steps&quot;):</span>
<span class="sd">                logger.log_time(&quot;Message with timestamp&quot;)</span>
<span class="sd">                logger.log(&quot;A debug message&quot;, level=&quot;DEBUG&quot;)</span>
<span class="sd">                # equivalently, use the .debug:</span>
<span class="sd">                logger.debug(&quot;Another debug message&quot;)</span>
<span class="sd">                if logger.debug_enabled:</span>
<span class="sd">                    # only generate this report if logging DEBUG</span>
<span class="sd">                    logger.log(</span>
<span class="sd">                        &quot;A debug report that takes time to produce&quot;,</span>
<span class="sd">                        level=&quot;DEBUG&quot;)</span>
<span class="sd">                logger.notify_slack(&quot;A slack message&quot;)</span>

<span class="sd">    Note that the Logger should not be used until opened with a context.</span>
<span class="sd">    Logger.log will not write to file.</span>

<span class="sd">    Methods can also be decorated with LogStartEnd (see class for more).</span>

<span class="sd">    Note that the Logger should only be initialized once per model run.</span>
<span class="sd">    In places where the controller is not available, the last Logger</span>
<span class="sd">    initialized can be obtained from the class method get_logger::</span>

<span class="sd">        logger = Logger.get_logger()</span>

<span class="sd">    Internal properties:</span>
<span class="sd">        _log_cache: the LogCache object</span>
<span class="sd">        _log_formatters: list of objects that format text and record, either</span>
<span class="sd">            to file, display (print to screen) or cache for log on error</span>
<span class="sd">        _use_emme_logbook: whether Emme logbook is enabled</span>
<span class="sd">        _slack_notifier: SlackNotifier object for sending messages to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># used to cache last initialized Logger</span>
    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Logger __new__ method override. TODO.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): TODO.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Logger</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructor for Logger object.</span>

<span class="sd">        Args:</span>
<span class="sd">            controller (RunController): Associated RunController instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
        <span class="n">log_config</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span>
        <span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">log_config</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">iter_component_level</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">levels</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">iter_component_level</span>
        <span class="p">)</span>
        <span class="n">display_logger</span> <span class="o">=</span> <span class="n">LogDisplay</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">display_level</span><span class="p">])</span>
        <span class="n">run_log_formatter</span> <span class="o">=</span> <span class="n">LogFile</span><span class="p">(</span>
            <span class="n">levels</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">run_file_level</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">run_file_path</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">standard_log_formatter</span> <span class="o">=</span> <span class="n">LogFileLevelOverride</span><span class="p">(</span>
            <span class="n">levels</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">log_file_level</span><span class="p">],</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_file_path</span><span class="p">),</span>
            <span class="n">iter_component_level</span><span class="p">,</span>
            <span class="n">controller</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="o">=</span> <span class="n">LogCache</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_on_error_file_path</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">display_logger</span><span class="p">,</span>
            <span class="n">run_log_formatter</span><span class="p">,</span>
            <span class="n">standard_log_formatter</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">use_emme_logbook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span> <span class="o">=</span> <span class="n">SlackNotifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the last initialized logger object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="nf">notify_slack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send message to slack if enabled by config.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to send to slack</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span><span class="o">.</span><span class="n">post_message</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">        Note that log will not write to file until Logger is opened with a context.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y (%H:%M:%S): &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">time</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">levels</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with timestamp.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=TRACE.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;TRACE&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=DEBUG.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=DETAIL.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DETAIL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=INFO.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=STATUS.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=WARN.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;WARN&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=ERROR.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log text with level=FATAL.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): text to log</span>
<span class="sd">            indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">            time (bool): if true include timestamp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;FATAL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with timestamp and &#39;Start&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">increase_indent</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_log_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Log message with timestamp and &#39;End&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">decrease_indent</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">log_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use with &#39;with&#39; statement to log the start and end time with message.</span>

<span class="sd">        If using the Emme logbook (config.logging.use_emme_logbook is True), will</span>
<span class="sd">        also create a logbook nest in the tree view using logbook_trace.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): message text</span>
<span class="sd">            level (str): logging level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_start</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="k">yield</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Format dictionary to string and log as text.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">),</span> <span class="n">level</span><span class="p">)</span>

    <span class="nd">@_context</span>
    <span class="k">def</span> <span class="nf">_skip_emme_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Temporary disable Emme logging (if enabled) and restore on exit.</span>

<span class="sd">        Intended use is with the log_start_end context and LogStartEnd decorator</span>
<span class="sd">        to allow use of the Emme context without double logging of the</span>
<span class="sd">        messages in the Emme logbook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">,</span> <span class="n">use_emme</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span>
        <span class="k">yield</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="n">use_emme</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enter context.</span>

<span class="sd">        Returns:</span>
<span class="sd">            _type_: TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">):</span>
                <span class="n">log_formatter</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context exit override.</span>

<span class="sd">        Args:</span>
<span class="sd">            exc_type (_type_): TODO</span>
<span class="sd">            exc_val (_type_): TODO</span>
<span class="sd">            exc_tb (_type_): TODO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="s2">&quot;Error during model run&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">_traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="o">.</span><span class="n">write_cache</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during model run in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exc_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
                <span class="n">log_formatter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">clear_msg_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear all log messages from cache.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">debug_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns True if DEBUG is currently filtered for display or print to file.</span>

<span class="sd">        Can be used to enable / disable debug logging which may have a performance</span>
<span class="sd">        impact.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="ow">and</span> <span class="n">log_formatter</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">debug</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trace_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns True if TRACE is currently filtered for display or print to file.</span>

<span class="sd">        Can be used to enable / disable trace logging which may have a performance</span>
<span class="sd">        impact.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="s2">&quot;TRACE&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_formatter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="ow">and</span> <span class="n">log_formatter</span><span class="o">.</span><span class="n">level</span> <span class="o">&lt;=</span> <span class="n">trace</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.logger.Logger.debug_enabled" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">debug_enabled</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.logger.Logger.debug_enabled" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Returns True if DEBUG is currently filtered for display or print to file.</p>
<p>Can be used to enable / disable debug logging which may have a performance
impact.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h5 id="tm2py.logger.Logger.trace_enabled" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">trace_enabled</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

<a href="#tm2py.logger.Logger.trace_enabled" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Returns True if TRACE is currently filtered for display or print to file.</p>
<p>Can be used to enable / disable trace logging which may have a performance
impact.</p>
    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.__enter__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.Logger.__enter__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Enter context.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>_type_</code></td>
      <td><p>TODO</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enter context.</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">):</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.__exit__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.Logger.__exit__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Context exit override.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>exc_type</code></td>
        <td><code>_type_</code></td>
        <td><p>TODO</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>exc_val</code></td>
        <td><code>_type_</code></td>
        <td><p>TODO</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>exc_tb</code></td>
        <td><code>_type_</code></td>
        <td><p>TODO</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Context exit override.</span>

<span class="sd">    Args:</span>
<span class="sd">        exc_type (_type_): TODO</span>
<span class="sd">        exc_val (_type_): TODO</span>
<span class="sd">        exc_tb (_type_): TODO</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_time</span><span class="p">(</span><span class="s2">&quot;Error during model run&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;ERROR&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">_traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="o">.</span><span class="n">write_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during model run in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exc_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
            <span class="n">log_formatter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.Logger.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for Logger object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>Associated RunController instance.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constructor for Logger object.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): Associated RunController instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="n">controller</span>
    <span class="n">log_config</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span>
    <span class="n">iter_component_level</span> <span class="o">=</span> <span class="n">log_config</span><span class="o">.</span><span class="n">iter_component_level</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="n">iter_component_level</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">levels</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">iter_component_level</span>
    <span class="p">)</span>
    <span class="n">display_logger</span> <span class="o">=</span> <span class="n">LogDisplay</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">display_level</span><span class="p">])</span>
    <span class="n">run_log_formatter</span> <span class="o">=</span> <span class="n">LogFile</span><span class="p">(</span>
        <span class="n">levels</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">run_file_level</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">run_file_path</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">standard_log_formatter</span> <span class="o">=</span> <span class="n">LogFileLevelOverride</span><span class="p">(</span>
        <span class="n">levels</span><span class="p">[</span><span class="n">log_config</span><span class="o">.</span><span class="n">log_file_level</span><span class="p">],</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_file_path</span><span class="p">),</span>
        <span class="n">iter_component_level</span><span class="p">,</span>
        <span class="n">controller</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span> <span class="o">=</span> <span class="n">LogCache</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">controller</span><span class="o">.</span><span class="n">run_dir</span><span class="p">,</span> <span class="n">log_config</span><span class="o">.</span><span class="n">log_on_error_file_path</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">display_logger</span><span class="p">,</span>
        <span class="n">run_log_formatter</span><span class="p">,</span>
        <span class="n">standard_log_formatter</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">use_emme_logbook</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span> <span class="o">=</span> <span class="n">SlackNotifier</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.__new__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">controller</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#tm2py.logger.Logger.__new__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Logger <strong>new</strong> method override. TODO.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>controller</code></td>
        <td><code>RunController</code></td>
        <td><p>TODO.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">controller</span><span class="p">:</span> <span class="n">RunController</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Logger __new__ method override. TODO.</span>

<span class="sd">    Args:</span>
<span class="sd">        controller (RunController): TODO.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=unused-argument</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Logger</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.clear_msg_cache" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">clear_msg_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.clear_msg_cache" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Clear all log messages from cache.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">clear_msg_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clear all log messages from cache.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.debug" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.debug" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text with level=DEBUG.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=DEBUG.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.detail" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.detail" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text with level=DETAIL.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=DETAIL.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;DETAIL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.error" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.error" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text with level=ERROR.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=ERROR.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.fatal" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.fatal" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text with level=FATAL.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">fatal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=FATAL.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;FATAL&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.get_logger" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_logger</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

<a href="#tm2py.logger.Logger.get_logger" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Return the last initialized logger object.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the last initialized logger object.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.info" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.info" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text with level=INFO.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=INFO.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.log" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.log" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text to file and display depending upon log level and config.</p>
<p>Note that log will not write to file until Logger is opened with a context.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>str</code></td>
        <td><p>logging level</p></td>
        <td><code>&#39;INFO&#39;</code></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">log</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text to file and display depending upon log level and config.</span>

<span class="sd">    Note that log will not write to file until Logger is opened with a context.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (str): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%b-%Y (%H:%M:%S): &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">time</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">log_formatter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_formatters</span><span class="p">:</span>
        <span class="n">log_formatter</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">levels</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">indent</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.log_dict" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.log_dict" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Format dictionary to string and log as text.</p>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format dictionary to string and log as text.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pformat</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">),</span> <span class="n">level</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.log_start_end" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;STATUS&#39;</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.log_start_end" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Use with &lsquo;with&rsquo; statement to log the start and end time with message.</p>
<p>If using the Emme logbook (config.logging.use_emme_logbook is True), will
also create a logbook nest in the tree view using logbook_trace.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>message text</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>str</code></td>
        <td><p>logging level</p></td>
        <td><code>&#39;STATUS&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@_context</span>
<span class="k">def</span> <span class="nf">log_start_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use with &#39;with&#39; statement to log the start and end time with message.</span>

<span class="sd">    If using the Emme logbook (config.logging.use_emme_logbook is True), will</span>
<span class="sd">    also create a logbook nest in the tree view using logbook_trace.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): message text</span>
<span class="sd">        level (str): logging level</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_start</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_emme_logbook</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">emme_manager</span><span class="o">.</span><span class="n">logbook_trace</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">yield</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_emme_logging</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_end</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.log_time" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">log_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.log_time" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log message with timestamp.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>level</code></td>
        <td><code>str</code></td>
        <td><p>logging level</p></td>
        <td><code>&#39;INFO&#39;</code></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">log_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="n">LogLevel</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log message with timestamp.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        level (str): logging level</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.notify_slack" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">notify_slack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.notify_slack" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Send message to slack if enabled by config.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to send to slack</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">notify_slack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Send message to slack if enabled by config.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to send to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_notifier</span><span class="o">.</span><span class="n">post_message</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.status" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.status" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text with level=STATUS.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=STATUS.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;STATUS&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.trace" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.trace" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text with level=TRACE.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=TRACE.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;TRACE&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.Logger.warn" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#tm2py.logger.Logger.warn" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Log text with level=WARN.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>text to log</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>indent</code></td>
        <td><code>bool</code></td>
        <td><p>if true indent text based on the number of open contexts</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td><code>bool</code></td>
        <td><p>if true include timestamp</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Log text with level=WARN.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): text to log</span>
<span class="sd">        indent (bool): if true indent text based on the number of open contexts</span>
<span class="sd">        time (bool): if true include timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;WARN&quot;</span><span class="p">,</span> <span class="n">indent</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="tm2py.logger.SlackNotifier" class="doc doc-heading">
        <code>
SlackNotifier        </code>



<a href="#tm2py.logger.SlackNotifier" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Notify slack of model run status.</p>
<p>The slack channel can be input directly, or is configured via text file found at
&ldquo;M:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if on MTC server)
rr&rdquo;C:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if local)</p>
<div class="admonition properties">
<p class="admonition-title">Properties</p>
<ul>
<li>logger (Logger): object for logging of trace messages</li>
<li>slack_webhook_url (str): optional, url to use for sending the message to slack</li>
</ul>
</div>

        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">SlackNotifier</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Notify slack of model run status.</span>

<span class="sd">    The slack channel can be input directly, or is configured via text file found at</span>
<span class="sd">    &quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">    rr&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if local)</span>

<span class="sd">    Properties:</span>
<span class="sd">        - logger (Logger): object for logging of trace messages</span>
<span class="sd">        - slack_webhook_url (str): optional, url to use for sending the message to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructor for SlackNotifier object.</span>

<span class="sd">        Args:</span>
<span class="sd">            logger (Logger): logger instance.</span>
<span class="sd">            slack_webhook_url (str, optional): . Defaults to None, which is replaced by either:</span>
<span class="sd">                - r&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">                - r&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (otherwise)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">hostname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mtc.ca.gov&quot;</span><span class="p">):</span>
                <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">r</span><span class="s2">&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on non-mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">url_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">url_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">slack_webhook_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SlackNotifier using slack webhook url </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">post_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Posts text to the slack channel via the webhook if slack_webhook_url is found.</span>

<span class="sd">        Args:</span>
<span class="sd">           text: text message to send to slack</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending message to slack: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receiving response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.SlackNotifier.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#tm2py.logger.SlackNotifier.__init__" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Constructor for SlackNotifier object.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>logger</code></td>
        <td><code>Logger</code></td>
        <td><p>logger instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>slack_webhook_url</code></td>
        <td><code>str</code></td>
        <td><p>. Defaults to None, which is replaced by either:
- r&rdquo;M:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (if on MTC server)
- r&rdquo;C:\Software\Slack\TravelModel_SlackWebhook.txt&rdquo; (otherwise)</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Logger</span><span class="p">,</span> <span class="n">slack_webhook_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructor for SlackNotifier object.</span>

<span class="sd">    Args:</span>
<span class="sd">        logger (Logger): logger instance.</span>
<span class="sd">        slack_webhook_url (str, optional): . Defaults to None, which is replaced by either:</span>
<span class="sd">            - r&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (if on MTC server)</span>
<span class="sd">            - r&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot; (otherwise)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">notify_slack</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getfqdn</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hostname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.mtc.ca.gov&quot;</span><span class="p">):</span>
            <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;M:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slack_webhook_url_file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;C:\Software\Slack\TravelModel_SlackWebhook.txt&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;SlackNotifier running on non-mtc host; using </span><span class="si">{</span><span class="n">slack_webhook_url_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">slack_webhook_url_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">url_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">url_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="o">=</span> <span class="n">slack_webhook_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;SlackNotifier using slack webhook url </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="tm2py.logger.SlackNotifier.post_message" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">post_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></code>


<a href="#tm2py.logger.SlackNotifier.post_message" class="headerlink" title="Permanent link"> </a></h5>

    <div class="doc doc-contents ">

      <p>Posts text to the slack channel via the webhook if slack_webhook_url is found.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td></td>
        <td><p>text message to send to slack</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/logger.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">post_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Posts text to the slack channel via the webhook if slack_webhook_url is found.</span>

<span class="sd">    Args:</span>
<span class="sd">       text: text message to send to slack</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sending message to slack: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_slack_webhook_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receiving response: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;TRACE&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="tm2py.tools" class="doc doc-heading">
        <code>tm2py.tools</code>



<a href="#tm2py.tools" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Tools module for common resources / shared code and &ldquo;utilities&rdquo; in the tm2py package.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="tm2py.tools.download_unzip" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">download_unzip</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">out_base_dir</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">,</span> <span class="n">zip_filename</span><span class="o">=</span><span class="s1">&#39;test_data.zip&#39;</span><span class="p">)</span></code>


<a href="#tm2py.tools.download_unzip" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Download and unzips a file from a URL. The zip file is removed after extraction.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>url</code></td>
        <td><code>str</code></td>
        <td><p>Full URL do download from.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>out_base_dir</code></td>
        <td><code>str</code></td>
        <td><p>Where to unzip the file.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>target_dir</code></td>
        <td><code>str</code></td>
        <td><p>What to unzip the file as.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>zip_filename</code></td>
        <td><code>str</code></td>
        <td><p>Filename to store zip file as. Defaults to &ldquo;test_data.zip&rdquo;.</p></td>
        <td><code>&#39;test_data.zip&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/tools.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">download_unzip</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_base_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test_data.zip&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Download and unzips a file from a URL. The zip file is removed after extraction.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): Full URL do download from.</span>
<span class="sd">        out_base_dir (str): Where to unzip the file.</span>
<span class="sd">        target_dir (str): What to unzip the file as.</span>
<span class="sd">        zip_filename (str, optional): Filename to store zip file as. Defaults to &quot;test_data.zip&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target_zip</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_base_dir</span><span class="p">)</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">_download</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">target_zip</span><span class="p">)</span>
    <span class="n">_unzip</span><span class="p">(</span><span class="n">target_zip</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target_zip</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="tm2py.tools.interpolate_dfs" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">interpolate_dfs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ref_points</span><span class="p">,</span> <span class="n">target_point</span><span class="p">,</span> <span class="n">ref_col_name</span><span class="o">=</span><span class="s1">&#39;ends_with&#39;</span><span class="p">)</span></code>


<a href="#tm2py.tools.interpolate_dfs" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Interpolate for the model year assuming linear growth between the reference years.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>df</code></td>
        <td><code>pd.DataFrame</code></td>
        <td><p>dataframe to interpolate on, with ref points contained in column
name per ref_col_name.  </p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>ref_points</code></td>
        <td><code>Collection[Union[float,int]]</code></td>
        <td><p>reference years to interpolate between</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>target_point</code></td>
        <td><code>Union[float,int]</code></td>
        <td><p>target year</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>ref_col_name</code></td>
        <td><code>str</code></td>
        <td><p>column name to use for reference years. 
Defaults to &ldquo;ends_with&rdquo;.</p></td>
        <td><code>&#39;ends_with&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/tools.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_dfs</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">ref_points</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]],</span>
    <span class="n">target_point</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">ref_col_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ends_with&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Interpolate for the model year assuming linear growth between the reference years.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): dataframe to interpolate on, with ref points contained in column</span>
<span class="sd">            name per ref_col_name.  </span>
<span class="sd">        ref_points (Collection[Union[float,int]]): reference years to interpolate between</span>
<span class="sd">        target_point (Union[float,int]): target year</span>
<span class="sd">        ref_col_name (str, optional): column name to use for reference years. </span>
<span class="sd">            Defaults to &quot;ends_with&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ref_col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ends_with&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_col_name</span><span class="si">}</span><span class="s2"> not implemented&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref_points</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_points</span><span class="si">}</span><span class="s2"> reference points not implemented&quot;</span><span class="p">)</span>

    <span class="n">ref_points</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">_start_point</span><span class="p">,</span> <span class="n">_end_point</span> <span class="o">=</span> <span class="n">ref_points</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">_start_point</span> <span class="o">&lt;=</span> <span class="n">target_point</span> <span class="o">&lt;=</span> <span class="n">_end_point</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target Point: </span><span class="si">{</span><span class="n">target_point</span><span class="si">}</span><span class="s2"> not within range of </span><span class="se">\</span>
<span class="s2">            Reference Points: </span><span class="si">{</span><span class="n">ref_points</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">_start_ref_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_end_ref_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">_start_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">_end_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2"> have different number of columns:</span><span class="se">\n\</span>
<span class="s2">           </span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2"> Columns: </span><span class="si">{</span><span class="n">_start_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="se">\n\</span>
<span class="s2">           </span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2"> Columns: </span><span class="si">{</span><span class="n">_end_ref_df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="se">\</span>
<span class="s2">        &quot;</span><span class="p">)</span>

    <span class="n">_start_ref_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">_start_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_end_ref_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">_end_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">_scale_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">target_point</span> <span class="o">-</span> <span class="n">_start_point</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">_end_point</span> <span class="o">-</span> <span class="n">_start_point</span><span class="p">)</span>

    <span class="n">interpolated_df</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">_scale_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">_start_ref_df</span>\
        <span class="o">+</span> <span class="n">_scale_factor</span> <span class="o">*</span> <span class="n">_end_ref_df</span>

    <span class="k">return</span> <span class="n">interpolated_df</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="tm2py.tools.parse_num_processors" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">parse_num_processors</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>


<a href="#tm2py.tools.parse_num_processors" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Convert input value (parse if string) to number of processors.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value</code></td>
        <td><code>Union[str, int, float]</code></td>
        <td><p>an int, float or string; string value can be &ldquo;X&rdquo; or &ldquo;MAX-X&rdquo;</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>An int of the number of processors to use</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>Exception</code></td>
        <td><p>Input value exceeds number of available processors</p></td>
      </tr>
      <tr>
        <td><code>Exception</code></td>
        <td><p>Input value less than 1 processors</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/tools.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_num_processors</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Convert input value (parse if string) to number of processors.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: an int, float or string; string value can be &quot;X&quot; or &quot;MAX-X&quot;</span>
<span class="sd">    Returns:</span>
<span class="sd">        An int of the number of processors to use</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: Input value exceeds number of available processors</span>
<span class="sd">        Exception: Input value less than 1 processors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_processors</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;MAX&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">max_processors</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[0-9]+$&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^MAX[\s]*-[\s]*&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_processors</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> is an int or string as &#39;MAX-X&#39;&quot;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="n">max_processors</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> greater than available processors&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input value </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> less than 1 processors&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="tm2py.tools.run_process" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>


<a href="#tm2py.tools.run_process" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Run system level commands as blocking process and log output and error messages.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>commands</code></td>
        <td><code>List[str]</code></td>
        <td><p>list of one or more commands to execute</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>optional name to use for the temp bat file</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/tools.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">run_process</span><span class="p">(</span><span class="n">commands</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run system level commands as blocking process and log output and error messages.</span>

<span class="sd">    Args:</span>
<span class="sd">        commands: list of one or more commands to execute</span>
<span class="sd">        name: optional name to use for the temp bat file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># when merged with develop_logging branch can use get_logger</span>
    <span class="c1"># logger = Logger.get_logger</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="n">temp_file</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.bat&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="n">bat_file</span><span class="p">,</span> <span class="n">bat_file_path</span><span class="p">):</span>
        <span class="n">bat_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">commands</span><span class="p">))</span>
        <span class="n">bat_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
            <span class="c1"># temporary file to capture output error messages generated by Java</span>
            <span class="c1"># Note: temp file created in the current working directory</span>
            <span class="k">with</span> <span class="n">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w+&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;_error.log&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="p">(</span><span class="n">err_file</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="n">_subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                        <span class="n">bat_file_path</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">err_file</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
                <span class="k">except</span> <span class="n">_subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
                    <span class="k">raise</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">err_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">error_msg</span> <span class="o">=</span> <span class="n">err_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">bat_file_path</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="tm2py.tools.temp_file" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>


<a href="#tm2py.tools.temp_file" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Temp file wrapper to return open file handle and named path.</p>
<p>A named temporary file (using mkstemp) with specified prefix and
suffix is created and opened with the specified mode. The file
handle and path are returned. The file is closed and deleted on exit.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>mode</code></td>
        <td><code>str</code></td>
        <td><p>mode to open file, [rw][+][b]</p></td>
        <td><code>&#39;w+&#39;</code></td>
      </tr>
      <tr>
        <td><code>prefix</code></td>
        <td><code>str</code></td>
        <td><p>optional text to start temp file name</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
      <tr>
        <td><code>suffix</code></td>
        <td><code>str</code></td>
        <td><p>optional text to end temp file name</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/tools.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="nd">@_context</span>
<span class="k">def</span> <span class="nf">temp_file</span><span class="p">(</span><span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;w+&quot;</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Temp file wrapper to return open file handle and named path.</span>

<span class="sd">    A named temporary file (using mkstemp) with specified prefix and</span>
<span class="sd">    suffix is created and opened with the specified mode. The file</span>
<span class="sd">    handle and path are returned. The file is closed and deleted on exit.</span>

<span class="sd">    Args:</span>
<span class="sd">        mode: mode to open file, [rw][+][b]</span>
<span class="sd">        prefix: optional text to start temp file name</span>
<span class="sd">        suffix: optional text to end temp file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_ref</span><span class="p">,</span> <span class="n">file_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">file_ref</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">file</span><span class="p">,</span> <span class="n">file_path</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="tm2py.examples" class="doc doc-heading">
        <code>tm2py.examples</code>



<a href="#tm2py.examples" class="headerlink" title="Permanent link"> </a></h3>

    <div class="doc doc-contents first">

      <p>Download and unzip examples for tm2py, used in tests.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="tm2py.examples.get_example" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_example</span><span class="p">(</span><span class="n">example_name</span><span class="o">=</span><span class="s1">&#39;UnionCity&#39;</span><span class="p">,</span> <span class="n">example_subdir</span><span class="o">=</span><span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="n">retrieval_url</span><span class="o">=</span><span class="s1">&#39;https://mtcdrive.box.com/shared/static/3entr016e9teq2wt46x1os3fjqylfoge.zip&#39;</span><span class="p">)</span></code>


<a href="#tm2py.examples.get_example" class="headerlink" title="Permanent link"> </a></h4>

    <div class="doc doc-contents ">

      <p>Returns example directory; downloads if necessary from retrieval URL.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>example_name</code></td>
        <td><code>str</code></td>
        <td><p>Used to retrieve sub-folder or create it if doesn&rsquo;t exist.
Defaults to _DEFAULT_EXAMPLE_NAME.</p></td>
        <td><code>&#39;UnionCity&#39;</code></td>
      </tr>
      <tr>
        <td><code>example_subdir</code></td>
        <td><code>str</code></td>
        <td><p>Where to find examples within root dir. Defaults
to _DEFAULT_EXAMPLE_SUBDIR.</p></td>
        <td><code>&#39;examples&#39;</code></td>
      </tr>
      <tr>
        <td><code>root_dir</code></td>
        <td><code>str</code></td>
        <td><p>Root dir of project. Defaults to _ROOT_DIR.</p></td>
        <td><code>&#39;..&#39;</code></td>
      </tr>
      <tr>
        <td><code>retrieval_url</code></td>
        <td><code>str</code></td>
        <td><p>URL to retrieve example data zip from. Defaults
to _DEFAULT_EXAMPLE_URL.</p></td>
        <td><code>&#39;https://mtcdrive.box.com/shared/static/3entr016e9teq2wt46x1os3fjqylfoge.zip&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>FileNotFoundError</code></td>
        <td><p>If can&rsquo;t find the files after trying to download it.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Path to example data.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>tm2py/examples.py</code></summary>
          <div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_example</span><span class="p">(</span>
    <span class="n">example_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_NAME</span><span class="p">,</span>
    <span class="n">example_subdir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_SUBDIR</span><span class="p">,</span>
    <span class="n">root_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_ROOT_DIR</span><span class="p">,</span>
    <span class="n">retrieval_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_DEFAULT_EXAMPLE_URL</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns example directory; downloads if necessary from retrieval URL.</span>

<span class="sd">    Args:</span>
<span class="sd">        example_name (str, optional): Used to retrieve sub-folder or create it if doesn&#39;t exist.</span>
<span class="sd">            Defaults to _DEFAULT_EXAMPLE_NAME.</span>
<span class="sd">        example_subdir (str, optional): Where to find examples within root dir. Defaults</span>
<span class="sd">            to _DEFAULT_EXAMPLE_SUBDIR.</span>
<span class="sd">        root_dir (str, optional): Root dir of project. Defaults to _ROOT_DIR.</span>
<span class="sd">        retrieval_url (str, optional): URL to retrieve example data zip from. Defaults</span>
<span class="sd">            to _DEFAULT_EXAMPLE_URL.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If can&#39;t find the files after trying to download it.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to example data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_example_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">example_subdir</span><span class="p">)</span>
    <span class="n">_this_example_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_example_dir</span><span class="p">,</span> <span class="n">example_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">_this_example_dir</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_this_example_dir</span>

    <span class="n">download_unzip</span><span class="p">(</span><span class="n">retrieval_url</span><span class="p">,</span> <span class="n">_example_dir</span><span class="p">,</span> <span class="n">_this_example_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">_this_example_dir</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;example </span><span class="si">{</span><span class="n">_this_example_dir</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_this_example_dir</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../architecture/" class="md-footer__link md-footer__link--next" aria-label="Next: Architecture" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Architecture
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "content.code.annotate", "content.tabs.link", "navigation.indexes"], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c2e1ee47.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.0/dist/mermaid.min.js"></script>
      
    
  </body>
</html>